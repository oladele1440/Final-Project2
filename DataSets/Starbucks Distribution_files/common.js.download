(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,function(e,t,i){var s=i(0),n=i(2),o=n.View.extend({classLabel:"cdb.core.View",constructor:function(e){this.options=s.defaults(e,this.options),this._models=[],this._subviews={},n.View.call(this,e),o.viewCount++,o.views[this.cid]=this,this._created_at=new Date},add_related_model:function(e){if(!e)throw new Error("added non valid model");this._models.push(e)},addView:function(e){this._subviews[e.cid]=e,e._parent=this},removeView:function(e){delete this._subviews[e.cid]},clearSubViews:function(){s(this._subviews).each(function(e){e.clean()}),this._subviews={}},clean:function(){return this.trigger("clean"),this.clearSubViews(),this._parent&&(this._parent.removeView(this),this._parent=null),this.remove(),this.allOff(),o.viewCount--,delete o.views[this.cid],this},allOff:function(){this.off(),this.model&&this.model.off&&this.model.off(null,null,this);var e=this;s(this._models).each(function(t){t.off(null,null,e)}),this._models=[]},show:function(){this.$el.show()},hide:function(){this.$el.hide()},retrigger:function(e,t,i){i||(i=e);var s=this;t.bind&&t.bind(e,function(){s.trigger(i)},s),this.add_related_model(t)},killEvent:function(e){e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation()},cleanTooltips:function(){this.$(".tipsy").remove()}},{viewCount:0,views:{},extendEvents:function(e){return function(){return s.extend(e,this.constructor.__super__.events)}},runChecker:function(){s.each(o.views,function(e){s.each(e,function(t,i){"_parent"!==i&&e.hasOwnProperty(i)&&t instanceof o&&void 0===e._subviews[t.cid]&&(console.log("========="),console.log("untracked view: "),console.log(t.el),console.log("parent"),console.log(e.el),console.log(" "))})})}});e.exports=o},,function(e,t,i){"use strict";var s=i(0);e.exports=function checkAndBuildRequiredOpts(e,t,i){if(void 0===t)throw new Error("Opts are required");s.each(t,function(t){if(void 0===e||void 0===e[t])throw new Error(t+" is required");i["_"+t]=e[t]},i)}},,,function(e,t,i){"use strict";var s=i(0),n=i(1);i(2688),e.exports=n.extend({options:{gravity:"s",opacity:1,fade:!0},events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave"},initialize:function initialize(e){if(!e.el)throw new Error("Element is needed to have tipsy tooltip working");this._mouseEnterAction=e.mouseEnterAction,this._mouseLeaveAction=e.mouseLeaveAction,this._tipsyOpenedManually="manual"===e.trigger,this._initTipsy()},_initTipsy:function _initTipsy(){var e=s.clone(this.options);"auto"===e.gravity&&(e.gravity=this.getOptimalGravity(e.gravityConfiguration&&e.gravityConfiguration.preferredGravities||["s","n","e","w"],e.gravityConfiguration&&e.gravityConfiguration.margin||0,window)),e.title||(e.title=this.getTitleFromDataAttribute),this.$el.tipsy(e),this.tipsy=this.$el.data("tipsy")},_onMouseEnter:function _onMouseEnter(){this._mouseEnterAction&&this._mouseEnterAction()},_onMouseLeave:function _onMouseLeave(){this._mouseLeaveAction&&this._mouseLeaveAction()},setOffset:function setOffset(e){this.tipsy.options.offset=e},showTipsy:function showTipsy(){this.$el.tipsy("show")},hideTipsy:function hideTipsy(){this.$el.tipsy("hide")},getElement:function getElement(){return this.el},getOptimalGravity:function getOptimalGravity(e,t,i){return function(n){if(!n)return e[0]||"n";var a=this.getBoundingClientRect(),l={n:"bottom",s:"top",w:"right",e:"left"},h={top:i.pageYOffset+t,right:i.innerWidth+i.pageXOffset-t,bottom:i.innerHeight+i.pageYOffset-t,left:i.pageXOffset+t},c={top:a.top-n.offsetHeight,right:a.left+a.width+n.offsetWidth,bottom:a.top+a.height+n.offsetHeight,left:a.left-n.offsetWidth},d="",u=s.find(e,function(e){var t=l[e],i=o(t,h[t],c[t]);return!i||"top"!==t&&"bottom"!==t||(d=r(l,h,c)),i});return u?u+d:e[0]}},getTitleFromDataAttribute:function getTitleFromDataAttribute(){return this.getAttribute("data-tooltip")},destroyTipsy:function destroyTipsy(){this.tipsy&&(this.tipsy.hide(),this.$el.unbind("mouseleave mouseenter")),this._tipsyOpenedManually&&this.hideTipsy(),this.$el.removeData("tipsy"),delete this.tipsy},clean:function clean(){this.destroyTipsy()}});var o=function isTooltipInsideViewport(e,t,i){return"top"===e||"left"===e?t<=i:"right"===e||"bottom"===e?t>=i:void 0},r=function getTooltipBodyGravity(e,t,i){var n=s.filter(["e","w"],function(s){var n=e[s];return o(n,t[n],i[n])});return 1===n.length?n[0]:""}},function(e,t,i){"use strict";var s=i(0),n=i(9);e.exports={isURL:function isURL(e){return!!e&&/^((http|https|ftp)\:\/\/)/g.test(e)},isBlank:function isBlank(e){return!e||/^\s*$/.test(e)},readablizeBytes:function readablizeBytes(e,t){if(!e||isNaN(e))return 0;var i=Math.floor(Math.log(e)/Math.log(1024)),s=(e/Math.pow(1024,Math.floor(i))).toFixed(2);return t&&(s=parseInt(s,10)),s+" "+["bytes","kB","MB","GB","TB","PB"][i]},readizableNumber:function readizableNumber(e){return e>=1e9?(e/1e9).toFixed(1)+"G":e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e},formatNumber:function formatNumber(e){if(!e)return"0";var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},result:function result(e,t){if(null==e)return null;var i=e[t];return s.isFunction(i)?i.apply(e,Array.prototype.slice.call(arguments,2)):i},getFileExtension:function getFileExtension(e){return e?e.substr(e.lastIndexOf(".")+1):""},pad:function pad(e,t){for(var i=e+"";i.length<t;)i="0"+i;return i},formatDate:function formatDate(e){if(!e.time)throw new Error;if(void 0===e.month)throw new Error;if(void 0===e.year)throw new Error;if(!e.day)throw new Error;var t=parseInt(e.month+1,10),i=function padZero(e){return(e=String(e))<10&&1===e.length?"0"+e:e};return e.year+"-"+i(t)+"-"+i(e.day)+"T"+e.time+"Z"},rgbToHex:function rgbToHex(e,t,i){function componentToHex(e){var t=e.toString(16);return 1===t.length?"0"+t:t}return"#"+componentToHex(e)+componentToHex(t)+componentToHex(i)},isValidHex:function isValidHex(e){return!!e.match(/(^#?[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i)},hexToRGB:function hexToRGB(e){e||(e="#FFFFFF");e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,i,s){return t+t+i+i+s+s});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},hexToRGBA:function hexToRGBA(e,t){var i=this.hexToRGB(e);return t=null!=t?function roundToTwo(e){return+(Math.round(e+"e+2")+"e-2")}(t):1,i?"rgba("+[i.r,i.g,i.b,t].join(", ")+")":e},stripHTML:function stripHTML(e,t){t=(((t||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return e&&"string"==typeof e?e.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(e,i){return t.indexOf("<"+i.toLowerCase()+">")>-1?e:""}):""},escapeHTML:function escapeHTML(e){return s.escape(e)},sanitizeString:function sanitizeString(e){return e.replace(/[^a-z0-9\s]/gi,"").replace(/[_\s]/g,"_")},isNumeric:function isNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)},formatDecimalPositions:function formatDecimalPositions(e){var t,i=+e,s=0;if(isNaN(i)||0===i)return e;(t=Math.abs(i))>10?s=1:t>.01&&(s=Math.min(Math.ceil(Math.abs(Math.log(t)/Math.log(10)))+2,2));var n=(e=e.toFixed(s)).match(/(\.0+)$/);return n&&(e=e.replace(n[0],"")),e},removeNewLines:function removeNewLines(e){return e.replace(/(\r\n|\n|\r)/gm,"")},replaceLastSpaceWithNbsp:function replaceLastSpaceWithNbsp(e){var t=e.lastIndexOf(" ");return e.substr(0,t)+"\xa0"+e.substr(t+1)},endsWith:function endsWith(e,t){return-1!==e.indexOf(t,e.length-t.length)},cloneObject:function cloneObject(e){return e?JSON.parse(JSON.stringify(e)):e},capitalize:function capitalize(e){return e?e.charAt(0).toUpperCase()+e.slice(1):e},sanitizeHtml:function sanitizeHtml(e){return n.core.sanitize.sanitize(e||"")},hasValue:function hasValue(e){return null!==e&&void 0!==e&&""!==e&&!("number"==typeof e&&isNaN(e))},isValidEmail:function isValidEmail(e){return/^([^@]+)@([^@]+)\.([^@\.]+)$/i.test(e)}}},function(e,t,i){"use strict";e.exports={Mode:{NESTED:"nested",FLOAT:"float",DEFAULT:"nested"}}},,function(e,t,i){"use strict";var s=i(2228),n=i(2225),o=function(){var e,t,i=!1,o=new n;function _init(n){if(!t&&!n)throw new Error("editorModel is required");!t&&n&&n.editorModel&&(t=n.editorModel),i=!0,e=new s({collection:o,editorModel:t})}return{DEFAULT_DELAY:5e3,init:function init(e){e.visDefinitionModel&&(this._visDefinitionModel=e.visDefinitionModel),_init(e)},off:function off(){0},getView:function getView(){return i||_init(),e.rebindEvents()},getCollection:function getCollection(){return o},getCount:function getCount(){return o.size()},getNotification:function getNotification(e){return"string"==typeof e?o.findById(e):o.findById(e.id)},addNotification:function addNotification(e){return o.addNotification(e,{visDefinitionModel:this._visDefinitionModel,delay:this.DEFAULT_DELAY})},removeNotification:function removeNotification(e){var t="string"==typeof e?o.findById(e):o.findById(e.id);return o.remove(t)}}}();e.exports=o},function(e,t,i){"use strict";var s=i(9),n=i(184),o=i(194);e.exports=function(e){var t=e.desc&&s.core.sanitize(e.desc);return n({title:e.title||"",descHTML:t||o()})}},,function(e,t,i){"use strict";var s=i(0);e.exports=function(e){if(!e)throw new Error("error is required");try{var t=e.responseText&&e.responseText.trim()&&JSON.parse(e.responseText),i=e.statusText||"";if(t)i=s.compact(s.map(["errors","error"],function(e){return t[e]&&t[e].join(", ")})).join(", ");return i}catch(e){return""}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(0),n=i(1);e.exports={createByHTML:function createByHTML(e,t){var i=new n(t);return i.render=function(){return this.$el.html(e),this},i},createByTemplate:function createByTemplate(e,t,i){var s=new n(i);return s.render=function(){return this.$el.html(e(t)),this},s},createListView:function createListView(e,t){if(!e||!e.forEach)throw new Error("createViewFns is required as an iterable list");if(!s.all(e,s.isFunction))throw new Error("createViewFns must only contain functions");var i=new n(t);return i.render=function(){return this.clearSubViews(),e.forEach(function(e){var t=e();this.addView(t),this.$el.append(t.render().el)},this),this},i}}},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(2231),r=i(2230),a="destroyedModal";e.exports=n.Model.extend({create:function create(e,t){if(!s.isFunction(e))throw new Error("createContentView is required");return this._modalView||(this.trigger("willCreateModal"),this._modalView=this._newModalView(t),this.trigger("didCreateModal",this._modalView),document.body.appendChild(this._modalView.el)),this._modalView.model.set("createContentView",e),this._modalView.render(),this._modalView},onDestroyOnce:function onDestroyOnce(e,t){this.once(a,e,t)},destroy:function destroy(){this._modalView&&this._modalView.model.destroy()},keepOpenOnRouteChange:function keepOpenOnRouteChange(){return this._modalView&&this._modalView.keepOpenOnRouteChange()},_newModalView:function _newModalView(e){var t=new r({keepOpenOnRouteChange:e&&e.keepOpenOnRouteChange});this._handleBodyClass(t);var i=e&&e.escapeOptionsDisabled,s=e&&e.breadcrumbsEnabled;return i||this._destroyOnEsc(t),this.listenToOnce(t,"destroy",function(){this._modalView=null,this.trigger.apply(this,[a].concat(Array.prototype.slice.call(arguments))),this.stopListening(t)}),new o({model:t,escapeOptionsDisabled:i,breadcrumbsEnabled:s})},_destroyOnEsc:function _destroyOnEsc(e){var t=function destroyOnEsc(t){27===t.keyCode&&(t.stopPropagation(),e.destroy())};document.addEventListener("keydown",t),this.listenToOnce(e,"destroy",function(){document.removeEventListener("keydown",t)})},_handleBodyClass:function _handleBodyClass(e){document.body.classList.add("is-inDialog"),this.set("open",!0),this.listenTo(e,"change:show",function(e,t){document.body.classList[t?"add":"remove"]("is-inDialog"),this.set("open",t)}),this.listenToOnce(e,"destroy",function(){document.body.classList.remove("is-inDialog"),this.set("open",!1)})},isOpen:function isOpen(){return!0===this.get("open")}})},function(e,t,i){"use strict";e.exports={Size:{MARKER_MIN:7,IMAGE_MIN:20,DEFAULT:{min:1,max:45,step:.5},DefaultInput100:{MIN:0,MAX:100,STEP:1},DEFAULT_RANGE:[5,20]},Panes:{FIXED:"fixed",BY_VALUE:"value",FILE:"file"},Tabs:{BINS:"bins",QUANTIFICATION:"quantification"},Quantification:{REFERENCE:{Jenks:"jenks","Equal Interval":"equal","Heads/Tails":"headtails",Quantile:"quantiles"}},Settings:{COLOR:{quantifications:{items:["jenks","equal","headtails","quantiles","category"],defaultIndex:0}},COLOR_RAMPS:{quantifications:{items:["quantiles","jenks","equal","headtails","category"],defaultIndex:0},bins:{items:["2","3","4","5","6","7"],defaultIndex:3}},NUMBER:{quantifications:{items:["quantiles","jenks","equal","headtails"],defaultIndex:0},bins:{items:["2","3","4","5","6","7"],defaultIndex:3}}}}},function(e,t,i){"use strict";var s=i(0);e.exports={setOptions:function setOptions(e,t){var i=[];if(t.schema&&t.schema.validators&&(i=i.concat(t.schema.validators)),e.options&&e.options.validators&&(i=i.concat(e.options.validators)),e.validators=i,e.options=this._getEditorOptions(e,t,i),e.options.className&&e.$el.addClass(e.options.className),e.options.trackingClass){var s=e.options.trackingClass+" track-"+e.options.key+e.options.editorType;e.$el.addClass(s)}},_editorAttrsFromBackboneFormSchema:function _editorAttrsFromBackboneFormSchema(e){return e.schema&&e.schema.editorAttrs||{}},_getEditorOptions:function _getEditorOptions(e,t,i){var n=s.omit(e.options,"validators")||{},o=t.schema,r=this._editorAttrsFromBackboneFormSchema(t),a=t.editorAttrs,l={keyAttr:t.key},h={validators:i},c=s.omit(t,"validators");return s.extend({},n,o,r,a,l,h,c)}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(2),n=i(248),o=i(0);e.exports=s.Collection.extend({sort_key:"id",initialize:function initialize(e,t){this.options=o.extend({silent:!0},t),this._initBinds()},comparator:function comparator(e){var t=e.get(this.sort_key);return this._nameToLowerCase(t)},model:function model(e,t){var i={};return"string"==typeof e?i.val=e:i=e,new n(i,t)},sortByKey:function sortByKey(e){this.sort_key=e,this.sort()},_initBinds:function _initBinds(){this.bind("change:selected",this._onSelectedChange,this)},_nameToLowerCase:function _nameToLowerCase(e){return o.isUndefined(e)||o.isNull(e)?e:o.isString(e)?e.toLowerCase():e.toString().toLowerCase()},search:function search(e){return e?(e=e.toLowerCase(),o(this.filter(function(t){var i=t.getName(),s=this._nameToLowerCase(i);return s?~s.indexOf(e):-1},this))):this},_onSelectedChange:function _onSelectedChange(e,t){t&&this.each(function(t){t.cid!==e.cid&&t.set({selected:!1},{silent:this.options.silent})},this)},getSelectedItem:function getSelectedItem(){return this.findWhere({selected:!0})},containsValue:function containsValue(e){return this.find(function(t){return t.getValue()===e})},setSelected:function setSelected(e){var t,i={silent:this.options.silent};return this.each(function(s){s.getValue()===e?(s.set({selected:!0},i),t=s):s.set({selected:!1},i)}),t},removeSelected:function removeSelected(){this.each(function(e){e.set({selected:!1})})},isAsync:function isAsync(){return!1}})},,function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(2693),r=n.Model.extend({urlRoot:"/api/v1/users",defaults:{avatar_url:"http://cartodb.s3.amazonaws.com/static/public_dashboard_default_avatar.png",username:""},initialize:function initialize(e,t){e=e||{},t=t||{},this.tables=[],null===this.get("avatar_url")&&this.set("avatar_url",this.defaults.avatar_url),this.email=void 0!==e.email?e.email:"",t.groups&&this.setGroups(t.groups),t.organization&&this.setOrganization(t.organization)},setGroups:function setGroups(e){this.groups=e},setOrganization:function setOrganization(e){this.organization=e,this.groups&&(this.groups.organization=e)},isInsideOrg:function isInsideOrg(){return!!this.organization&&(!1!==this.organization.id||this.isOrgOwner())},isAuthUsernamePasswordEnabled:function isAuthUsernamePasswordEnabled(){return!!this.organization&&this.organization.get("auth_username_password_enabled")},isOrgOwner:function isOrgOwner(){return!!this.organization&&this.organization.owner.get("id")===this.get("id")},isOrgAdmin:function isOrgAdmin(){return!!this.organization&&this.organization.isOrgAdmin(this)},isViewer:function isViewer(){return!0===this.get("viewer")},isBuilder:function isBuilder(){return!this.isViewer()},nameOrUsername:function nameOrUsername(){return this.fullName()||this.get("username")},fullName:function fullName(){var e=this.get("name")||"",t=this.get("last_name")||"";return e||t?e+(e&&t?" ":"")+t:""},renderData:function renderData(e){var t=this.get("username");return e&&e.id===this.id&&(t=_t("You")),{username:t,avatar_url:this.get("avatar_url")}},hasCreateDatasetsFeature:function hasCreateDatasetsFeature(){return this.isBuilder()},canCreateDatasets:function canCreateDatasets(){return!(!this.get("remaining_byte_quota")||this.get("remaining_byte_quota")<=0)&&this.hasCreateDatasetsFeature()},hasCreateMapsFeature:function hasCreateMapsFeature(){return this.isBuilder()},canAddLayerTo:function canAddLayerTo(e){if(!e||!e.layers||!e.layers.getDataLayers)throw new Error("Map model is not defined or wrong");return e.layers.getDataLayers().length<this.getMaxLayers()},getMaxLayers:function getMaxLayers(){return this.get("limits")&&this.get("limits").max_layers||5},getMaxConcurrentImports:function getMaxConcurrentImports(){return this.get("limits")&&this.get("limits").concurrent_imports||1},featureEnabled:function featureEnabled(e){var t=this.get("feature_flags");return!(!t||0===t.length||!e)&&s.contains(t,e)},isCloseToLimits:function isCloseToLimits(){var e=this.get("quota_in_bytes");return 100*this.get("remaining_byte_quota")/e<20},isEnterprise:function isEnterprise(){return-1!=this.get("account_type").toLowerCase().indexOf("enterprise")},getOrganizationName:function getOrganizationName(){return this.isInsideOrg()?this.organization.get("name"):""},getOrgName:function getOrgName(){return this.isInsideOrg()?this.organization.get("name"):""},getMaxLayersPerMap:function getMaxLayersPerMap(){return this.get("max_layers")||4},canStartTrial:function canStartTrial(){return!this.isInsideOrg()&&"FREE"===this.get("account_type")&&this.get("table_count")>0},canCreatePrivateDatasets:function canCreatePrivateDatasets(){var e=this.get("actions");return e&&e.private_tables},canCreateTwitterDataset:function canCreateTwitterDataset(){var e=this.get("twitter");return!(e.quota-e.monthly_use)<=0&&e.hard_limit},canSelectPremiumOptions:function canSelectPremiumOptions(e){return this.get("actions")[e.isVisualization()?"private_maps":"private_tables"]},hasOwnTwitterCredentials:function hasOwnTwitterCredentials(){var e=this.get("twitter");return e&&e.customized_config||!1},equals:function equals(e){if(e.get)return this.get("id")===e.get("id")},viewUrl:function viewUrl(){return new o({base_url:this.get("base_url"),is_org_admin:this.isOrgAdmin()})},upgradeContactEmail:function upgradeContactEmail(){return this.isInsideOrg()?this.isOrgOwner()?"enterprise-support@carto.com":this.organization.owner.get("email"):"support@carto.com"},needsPasswordConfirmation:function needsPasswordConfirmation(){return this.get("needs_password_confirmation")},usedQuotaPercentage:function usedQuotaPercentage(){return 100*this.get("db_size_in_bytes")/this.organization.get("available_quota_for_user")},assignedQuotaInRoundedMb:function assignedQuotaInRoundedMb(){return Math.floor(this.get("quota_in_bytes")/1024/1024).toFixed(0)},assignedQuotaPercentage:function assignedQuotaPercentage(){return 100*this.get("quota_in_bytes")/this.organization.get("available_quota_for_user")},getGoogleApiKey:function getGoogleApiKey(){return this.get("google_maps_private_key")},hasGoogleMaps:function hasGoogleMaps(){return!!this.getGoogleApiKey()},showGoogleApiKeys:function showGoogleApiKeys(){return this.hasGoogleMaps()&&(!this.isInsideOrg()||this.isOrgOwner())},getSchema:function getSchema(){return this.isInsideOrg()?this.get("username"):"public"},getAuthToken:function getAuthToken(){return btoa(this.get("username")+":"+this.get("api_key"))},getModelType:function getModelType(){return"user"},isActionEnabled:function isActionEnabled(e){return this.get("actions")&&this.get("actions")[e]},hasAccountType:function hasAccountType(e){return this.get("account_type")===e}});e.exports=r},function(e,t,i){"use strict";var s=i(2),n=i(0);e.exports=s.Collection.extend({constructor:function constructor(e,t){t=n.extend(t||{},{silent:!1}),s.Collection.prototype.constructor.call(this,e,t)},initialize:function initialize(e,t){this._disabledTabs=t.disabledTabs,this._initBinds(),this._setSelected()},_initBinds:function _initBinds(){this.bind("reset",this._setSelected,this),this.bind("change:selected",this._onSelectedChange,this)},getSelected:function getSelected(){return this.find(function(e){return e.get("selected")})},getDefault:function getDefault(){return this.find(function(e){return e.get("name")===this.getDefaultName()},this)},getDisabledTabs:function getDisabledTabs(){return this._disabledTabs||[]},getDefaultName:function getDefaultName(){return this._defaultTab},isDisabledTab:function isDisabledTab(e){return!!this.find(function(t){return t.get("disabled")&&t.get("name")===e})},_setSelected:function _setSelected(){!this.getSelected()&&this.size()>0&&this.at(0).set("selected",!0)},_onSelectedChange:function _onSelectedChange(e,t){t&&this.each(function(t){t!==e&&t.set("selected",!1)},this)},select:function select(e,t){var i=this.find(function(i){return i.get(e)===t},this);i&&i.set("selected",!0)}})},,function(e,t,i){"use strict";var s=i(2320);e.exports={init:function init(e){if(!e||!e.configModel)throw new Error("configModel is required");this._userId=e.userId,this._visId=e.visId,this._configModel=e.configModel},track:function track(e,t){if(!e)throw new Error("eventName is required");new s({eventName:e,eventProperties:t},{userId:this._userId,visId:this._visId,configModel:this._configModel}).save()}}},function(e,t,i){"use strict";var s=i(1),n=i(268),o=i(264),r=window.MutationObserver;e.exports=s.extend({tagName:"div",className:"ScrollView",initialize:function initialize(e){if(!e.createContentView)throw new Error("A factory createContentView function is required");this.options=e||{},this._type=e.type||"vertical",this._maxScroll=0,this._bindedCheckShadows=this._checkShadows.bind(this)},render:function render(){this.clearSubViews(),this._html();var e=this.options.createContentView.call(this);return this._contentContainer().append(e.render().el),this.addView(e),this._applyScroll(),this._updateScrollWhenExist(),this},_html:function _html(){this.$el.html(o({type:this._type})),"horizontal"===this._type&&this.$el.addClass("ScrollView--horizontal")},_contentContainer:function _contentContainer(){return this.$(".js-content")},_wrapperContainer:function _wrapperContainer(){return this.$(".js-wrapper")},_updateScrollWhenExist:function _updateScrollWhenExist(){if(r){var e=document.body,t=this._wrapperContainer().get(0),i=function onMutationObserver(){e.contains(t)&&(n.update(t),s.disconnect())},s=new r(i);i();s.observe(e,{subtree:!0,childList:!0})}},_applyScroll:function _applyScroll(){n.initialize(this._wrapperContainer().get(0),{wheelSpeed:2,wheelPropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20,suppressScrollX:"vertical"===this._type,suppressScrollY:"horizontal"===this._type}),this._bindScroll()},_bindScroll:function _bindScroll(){this._wrapperContainer().on("ps-dom-change",this._bindedCheckShadows).on("ps-x-reach-start",this._bindedCheckShadows).on("ps-x-reach-end",this._bindedCheckShadows).on("ps-y-reach-start",this._bindedCheckShadows).on("ps-y-reach-end",this._bindedCheckShadows).on("ps-scroll-x",this._bindedCheckShadows).on("ps-scroll-y",this._bindedCheckShadows)},_unbindScroll:function _unbindScroll(){this._wrapperContainer().off("ps-dom-change",this._bindedCheckShadows).off("ps-x-reach-start",this._bindedCheckShadows).off("ps-x-reach-end",this._bindedCheckShadows).off("ps-y-reach-start",this._bindedCheckShadows).off("ps-y-reach-end",this._bindedCheckShadows).off("ps-scroll-x",this._bindedCheckShadows).off("ps-scroll-y",this._bindedCheckShadows)},_checkShadows:function _checkShadows(){var e,t;"horizontal"===this._type?(e=this._wrapperContainer().scrollLeft(),t=this._wrapperContainer().get(0).scrollWidth-this._wrapperContainer().outerWidth(),this.$("> .js-leftShadow").toggleClass("is-visible",e>0),this.$("> .js-rightShadow").toggleClass("is-visible",e<t)):(e=this._wrapperContainer().scrollTop(),t=this._wrapperContainer().get(0).scrollHeight-this._wrapperContainer().outerHeight(),this.$("> .js-topShadow").toggleClass("is-visible",e>0),this.$("> .js-bottomShadow").toggleClass("is-visible",e<t))},destroyScroll:function destroyScroll(){this._wrapperContainer().length&&(this._unbindScroll(),n.destroy(this._wrapperContainer().get(0)))},clean:function clean(){this.destroyScroll(),s.prototype.clean.apply(this,arguments)}})},function(e,t,i){"use strict";var s=i(4),n=i(0),o=i(2);i(2402),i(2401),o.$=s,n.extend(o.Form.validators,{columnType:i(2400),interval:i(2399),requiredBoolean:i(2398)}),o.Form.Original=o.Form,i(2397),i(2396),i(2395),i(2387),i(2386),i(2385),i(2384),i(2383),i(2379),i(2378),i(2376),i(2375),i(2374),i(2373),i(2372),i(2370),i(2366),i(2365),i(2364),i(2363),i(2362),i(2361),i(2318),i(2310),i(2306),i(2303),i(2298),i(2297),i(2286),i(2276),i(2274)},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(1029),r=i(323);e.exports=n.extend({className:"Tab-pane",events:{mouseover:"_onMouseOver"},initialize:function initialize(e){if(!this.collection)throw new Error("A TabPaneCollection should be provided");this._tabPaneItemOptions=this.options.tabPaneItemOptions,this._createContentKey=this.options.createContentKey||"createContentView",this.template=this.options.template||r,this.options.mouseOverAction&&(this._mouseOverAction=this.options.mouseOverAction),this.collection.bind("change:selected",this._renderSelected,this)},render:function render(){this.clearSubViews(),this.$el.empty(),this.$el.html(this.template(this.options)),this._renderCollection();var e=this.getSelectedTabPane();return e&&this._renderSelected(e,!0),this},getTabPaneCollection:function getTabPaneCollection(){return this.collection},getSelectedTabPane:function getSelectedTabPane(){return this.collection.getSelected()},getTabPane:function getTabPane(e){return s.first(this.collection.where({name:e}))},getSelectedTabPaneName:function getSelectedTabPaneName(){var e=this.getSelectedTabPane();return e?e.get("name"):null},setSelectedTabPaneByName:function setSelectedTabPaneByName(e){return this.collection.select("name",e)},_renderSelected:function _renderSelected(e,t){t&&(this._selectedView&&(this._selectedView.clean(),this.removeView(this._selectedView)),this._selectedView=this._renderTabPaneContentView(e))},_renderCollection:function _renderCollection(){this.collection.each(function(e){e.get("createButtonView")&&this._renderTabPaneItemView(e)},this)},_renderTabPaneItemView:function _renderTabPaneItemView(e){var t=new o(s.extend({model:e},this._tabPaneItemOptions));this.addView(t),this.$(".js-menu").append(t.render().el)},_renderTabPaneContentView:function _renderTabPaneContentView(e){var t=e.get(this._createContentKey).call(e);return t&&(this.addView(t),this.$(".js-content").append(t.render().el),"function"==typeof t.afterRender&&t.afterRender()),t},changeStyleMenu:function changeStyleMenu(e){this.$(".js-theme").toggleClass("is-dark",e.isEditing())},_onMouseOver:function _onMouseOver(){this._mouseOverAction&&this._mouseOverAction()}})},,,function(e,t,i){"use strict";e.exports={Type:{SIMPLE:"simple",ANIMATION:"animation",HEATMAP:"heatmap",POLYGON:"polygon",REGIONS:"regions",HEXABINS:"hexabins",SQUARES:"squares",NONE:"none"},Blending:{SIMPLE:["none","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","xor","src-over"],ANIMATION:["lighter","multiply","source-over","xor"]}}},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(1),r=i(9),a=i(458);e.exports=o.extend({className:"IntermediateInfo",initialize:function initialize(e){var t=s.defaults(s.pick(e,["title","desc"]),{title:_t("components.error.default-title"),desc:_t("components.error.default-desc")});this._template=this.options&&this.options.template||a,this.model=new n.Model(t)},render:function render(){return this.$el.html(this._html()),this},_html:function _html(){var e=this.model;return this._template({title:e.get("title"),desc:r.core.sanitize.html(e.get("desc"))})}})},,,,,,,,function(e,t,i){"use strict";var s=i(235),n=[{quote:"Geographers never get lost. They just do accidental field work.",author:"Nicholas Chrisman"},{quote:"Geography is just physics slowed down, with a couple of trees stuck in it.",author:"Terry Pratchett"},{quote:"Not all those who wander are lost.",author:"J. R. R. Tolkien"},{quote:"In that Empire, the Art of Cartography attained such Perfection that the map of a single Province occupied the entirety of a City.",author:"Jorge Luis Borges"},{quote:"X marks the spot",author:"Indiana Jones"},{quote:"It's turtles all the way down.",author:null},{quote:"Remember: no matter where you go, there you are.",author:null},{quote:"Without geography, you're nowhere!",author:"Jimmy Buffett"},{quote:"our earth is a globe / whose surface we probe /<br />no map can replace her / but just try to trace her",author:"Steve Waterman"},{quote:"Everything happens somewhere.",author:"Doctor Who"},{quote:"A map is the greatest of all epic poems. Its lines and colors show the realization of great dreams.",author:"Gilbert H. Grosvenor"},{quote:"Everything is related to everything else,<br />but near things are more related than distant things.",author:"Tobler's first law of geography"},{quote:"Hic Sunt Dracones",author:null},{quote:"Here be dragons",author:null},{quote:"Stand in the place where you live / Now face North /<br/>Think about direction / Wonder why you haven't before",author:"R.E.M"},{quote:"The virtue of maps, they show what can be done with limited space, they foresee that everything can happen therein.",author:"Jos\xe9 Saramago"}];e.exports=function(){var e=Math.round(Math.random()*(n.length-1));return s(n[e])}},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=function pluralize(e,t,i){return 2===arguments.length?pluralize.call(this,arguments[0],arguments[0]+"s",arguments[1]):1===i?e:t};s.prefixWithCount=function(e,t,i){return s("1 "+e,i+" "+t,i)},e.exports=s},function(e,t,i){e.exports={en:i(230),sw:i(229),es:i(228)}},function(e,t,i){"use strict";var s=i(1),n=i(2355),o=i(0);e.exports=s.extend({module:"components:stack-layout:stack-layout-view",initialize:function initialize(e){if(!this.collection||!this.collection.size())throw new Error("A collection of stack views should be provided");this.model=new n({},{stackLayoutItems:this.collection}),this.model.bind("positionChanged",this._onPositionChange,this)},render:function render(){return this.clearSubViews(),this._genNewStackView(),this},_onPositionChange:function _onPositionChange(e,t){this._removeOldStackView(),this._genNewStackView(o.flatten(t)),this.trigger("positionChanged",this)},getCurrentPosition:function getCurrentPosition(){return this.model.get("position")},_removeOldStackView:function _removeOldStackView(){var e=this._getCurrentView();e&&(e.clean(),this.removeView(e))},_getCurrentView:function _getCurrentView(){for(var e in this._subviews)break;return this._subviews[e]},_genNewStackView:function _genNewStackView(){var e=[this.model].concat([o.flatten(arguments)]),t=this.collection.at(this.model.get("position")).get("createStackView").apply(this,e);this.addView(t),this.$el.html(t.render().el)}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(1),r=i(174),a=i(2381),l=i(491),h=i(487),c=i(2380),d=i(265),u=i(247);e.exports=o.extend({module:"components:custom-list:custom-view",options:{showSearch:!0,allowFreeTextInput:!1,typeLabel:"column",itemTemplate:d,itemView:u},className:"CDB-Box-modal CustomList",tagName:"div",events:{mouseover:"_onMouseOver",mouseout:"_onMouseOut"},initialize:function initialize(e){if(!e.collection){if(!e.options)throw new Error("options array {value, label} is required");this.collection=new r(e.options)}e.position&&this.$el.css(e.position),this.options=s.extend({},this.options,e),this._selectModel=this.options.selectModel,this.options.mouseOverAction&&(this._mouseOverAction=this.options.mouseOverAction),this.options.mouseOutAction&&(this._mouseOutAction=this.options.mouseOutAction),this.model=new n.Model({query:"",visible:!1}),this._initBinds()},render:function render(){return this.$el.empty(),this.clearSubViews(),(this.options.showSearch||this.options.actions)&&this._renderHeader(),this.options.showSearch&&this._renderSearch(),this.options.actions&&this._renderActions(),this._renderList(),this.options.showSearch&&this._focusSearch(),this},_initBinds:function _initBinds(){this.model.bind("change:visible",this._onVisibleChanged,this),this.model.bind("change:query",this._setActionsVisibility,this)},_renderHeader:function _renderHeader(){this.$el.prepend(h())},_renderSearch:function _renderSearch(){this._searchView=new a({template:this.options.searchTemplate,typeLabel:this.options.typeLabel,searchPlaceholder:this.options.searchPlaceholder,model:this.model}),this.$(".js-header").prepend(this._searchView.render().el),this.addView(this._searchView)},_renderActions:function _renderActions(){s.each(this.options.actions,function(e){var t=new c(e);this.$(".js-actions").append(t.render().el),this.addView(t)},this)},_setActionsVisibility:function _setActionsVisibility(){this.$(".js-actions").toggleClass("u-hide",""!==this.model.get("query"))},_focusSearch:function _focusSearch(){setTimeout(function(){if(this._searchView){this._searchView.focus();var e=this._searchView.$("input"),t=e.val();e.val(t+" "),e.val(t)}}.bind(this),0)},_renderList:function _renderList(){this._listView=new l({model:this.model,allowFreeTextInput:this.options.allowFreeTextInput,collection:this.collection,typeLabel:this.options.typeLabel,itemView:this.options.itemView,itemTemplate:this.options.itemTemplate,size:this.options.size,mouseOverAction:this._mouseOverAction,mouseOutAction:this._mouseOutAction}),this.$el.append(this._listView.render().el),this._listView.highlight(),this.addView(this._listView),this._listView.bind("customEvent",function(e,t){this.trigger(e,t,this)},this)},highlight:function highlight(){this._listView.highlight()},_onVisibleChanged:function _onVisibleChanged(e,t){this._resetQuery(),this._toggleVisibility(),t?this.render():this.clearSubViews()},_resetQuery:function _resetQuery(){var e=this._selectModel&&this._selectModel.get(this.options.typeLabel)||"";this.model.set("query",e);var t=this.collection.findWhere({val:e});e&&!t&&this.collection.add({label:e,val:e})},show:function show(){this.model.set("visible",!0)},hide:function hide(){this.trigger("hidden",this),this.model.set("visible",!1)},toggle:function toggle(){this.model.set("visible",!this.model.get("visible"))},_toggleVisibility:function _toggleVisibility(){this.$el.toggleClass("is-visible",!!this.model.get("visible"))},isVisible:function isVisible(){return this.model.get("visible")},_onMouseOver:function _onMouseOver(){this._mouseOverAction&&this._mouseOverAction()},_onMouseOut:function _onMouseOut(){this._mouseOutAction&&this._mouseOutAction()},remove:function remove(){this._listView&&this._listView.clean(),o.prototype.remove.call(this)}})},,,function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({VERSION:2,initialize:function initialize(){this.modules=new s.Collection,this.modules.on("add",function(e){this.trigger("moduleLoaded"),this.trigger("moduleLoaded:"+e.get("name"))},this)},REPORT_ERROR_URL:"/api/v0/error",ERROR_TRACK_ENABLED:!1,getSqlApiBaseUrl:function getSqlApiBaseUrl(){return this.get("sql_api_template")?this.get("sql_api_template").replace("{user}",this.get("user_name")):this.get("sql_api_protocol")+"://"+this.get("user_name")+"."+this.get("sql_api_domain")+":"+this.get("sql_api_port")},getSqlApiUrl:function getSqlApiUrl(e){return e=e||"v2",this.getSqlApiBaseUrl()+"/api/"+e+"/sql"},getMapsApiHost:function getMapsApiHost(){var e,t=this.get("maps_api_template");return t&&(e=t.replace(/https?:\/\/{user}\./,"")),e},setUrlVersion:function setUrlVersion(e,t,i){this.set(e+"_"+t+"_url_version",i||"v1")},urlVersion:function urlVersion(e,t,i){return t=t||"",this.get(e+"_"+t+"_url_version")||i||"v1"},prefixUrl:function prefixUrl(){return this.get("url_prefix")||""},prefixUrlPathname:function prefixUrlPathname(){var e=this.prefixUrl();if(""!==e)try{if(e&&-1===e.indexOf("/"))throw new TypeError("invalid URL");var t=document.createElement("a");return t.href=e,t.pathname.replace(/\/$/,"")}catch(e){}return e},getMapsResourceName:function getMapsResourceName(e){var t,i=this.get("maps_api_template");return i&&(t=i.replace(/(http|https)?:\/\//,"").replace(/{user}/g,e)),t},dataLibraryEnabled:function dataLibraryEnabled(){return this.get("data_library_enabled")},isHosted:function isHosted(){return this.get("cartodb_com_hosted")}})},,,,,function(e,t,i){"use strict";var s=i(1),n=i(4),o=i(0),r=i(11),a=["template","runAction","modalModel"];e.exports=s.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_onCancel"},initialize:function initialize(e){o.each(a,function(t){if(!e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),e.loadingTitle&&(this._hasLoading=!0,this._loadingTitle=e.loadingTitle),e.renderOpts&&(this._hasRenderOpts=!0,this._renderOpts=e.renderOpts),this._onKeyDown=this._onKeyDown.bind(this),this._initBinds()},render:function render(){this.clearSubViews();var e=this._hasRenderOpts?this._template(this._renderOpts):this._template();return this.$el.html(e),this},_initBinds:function _initBinds(){n(document).bind("keydown",this._onKeyDown)},_disableBinds:function _disableBinds(){n(document).unbind("keydown",this._onKeyDown)},_onKeyDown:function _onKeyDown(e){13===e.which&&this._onConfirm()},_renderLoadingView:function _renderLoadingView(){this.$el.html(r({title:this._loadingTitle}))},_$content:function _$content(){return this.$(".js-content")},_onConfirm:function _onConfirm(){this._hasLoading?this._renderLoadingView():this._modalModel.destroy(),this._runAction()},_onCancel:function _onCancel(){this._modalModel.destroy()},clean:function clean(){this._disableBinds(),s.prototype.clean.apply(this)}})},,function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(348),r={public:"PUBLIC",link:"LINK",private:"PRIVATE",password:"PASSWORD"};e.exports=n.Model.extend({defaults:{visChanges:0},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,this.get("permission")&&(this._permissionModel=new o(this.get("permission"),{configModel:t.configModel}),this.unset("permission"))},urlRoot:function urlRoot(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("visualization")+"/viz"},mapcapsURL:function mapcapsURL(){return this._configModel.get("base_url")+"/api/v3/viz/"+this.id+"/mapcaps"},embedURL:function embedURL(){return this._configModel.get("base_url")+"/builder/"+this.id+"/embed"},builderURL:function builderURL(){return this._configModel.get("base_url")+"/builder/"+this.id+"/"},vizjsonURL:function vizjsonURL(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("vizjson","read","v3")+"/viz/"+this.id+"/viz.json"},stateURL:function stateURL(){return this._configModel.get("base_url")+"/api/v3/viz/"+this.id+"/state"},isVisualization:function isVisualization(){return"derived"===this.get("type")},privacyOptions:function privacyOptions(){return s.values(r)},recordChange:function recordChange(){var e=this.get("visChanges");this.set("visChanges",e+1)},resetChanges:function resetChanges(){this.set("visChanges",0)},getPermissionModel:function getPermissionModel(){return this._permissionModel}},{isPubliclyAvailable:function isPubliclyAvailable(e){return e===r.password||e===r.link||e===r.public}})},function(e,t,i){var s,n,o;n=[i(4)],void 0===(o="function"==typeof(s=function(e){function focusable(t,i){var s,n,o,r=t.nodeName.toLowerCase();return"area"===r?(s=t.parentNode,n=s.name,!(!t.href||!n||"map"!==s.nodeName.toLowerCase())&&!!(o=e("img[usemap='#"+n+"']")[0])&&visible(o)):(/^(input|select|textarea|button|object)$/.test(r)?!t.disabled:"a"===r&&t.href||i)&&visible(t)}function visible(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var t=e(this);return(!s||"static"!==t.css("position"))&&n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(t){return focusable(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var i=e.attr(t,"tabindex"),s=isNaN(i);return(s||i>=0)&&focusable(t,!s)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){var s="Width"===i?["Left","Right"]:["Top","Bottom"],n=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};function reduce(t,i,n,o){return e.each(s,function(){i-=parseFloat(e.css(t,"padding"+this))||0,n&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),o&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(n,reduce(this,t)+"px")})},e.fn["outer"+i]=function(t,s){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(n,reduce(this,t,!0,s)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(("absolute"===(i=n.css("position"))||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,o=e.ui[t].prototype;for(n in s)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,o=e.plugins[t];if(o&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;n<o.length;n++)e.options[o[n][0]]&&o[n][1].apply(e.element,i)}};var t=0,i=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++)try{(s=e._data(n,"events"))&&s.remove&&e(n).triggerHandler("remove")}catch(e){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,o,r,a,l={},h=t.split(".")[0];return t=t.split(".")[1],n=h+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[h]=e[h]||{},o=e[h][t],r=e[h][t]=function(e,t){if(!this._createWidget)return new r(e,t);arguments.length&&this._createWidget(e,t)},e.extend(r,o,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),(a=new i).options=e.widget.extend({},a.options),e.each(s,function(t,s){e.isFunction(s)?l[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,o=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=o,t}}():l[t]=s}),r.prototype=e.widget.extend(a,{widgetEventPrefix:o&&a.widgetEventPrefix||t},l,{constructor:r,namespace:h,widgetName:t,widgetFullName:n}),o?(e.each(o._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,r,i._proto)}),delete o._childConstructors):i._childConstructors.push(r),e.widget.bridge(t,r),r},e.widget.extend=function(t){for(var s,n,o=i.call(arguments,1),r=0,a=o.length;r<a;r++)for(s in o[r])n=o[r][s],o[r].hasOwnProperty(s)&&void 0!==n&&(e.isPlainObject(n)?t[s]=e.isPlainObject(t[s])?e.widget.extend({},t[s],n):e.widget.extend({},n):t[s]=n);return t},e.widget.bridge=function(t,s){var n=s.prototype.widgetFullName||t;e.fn[t]=function(o){var r="string"==typeof o,a=i.call(arguments,1),l=this;return r?this.each(function(){var i,s=e.data(this,n);return"instance"===o?(l=s,!1):s?e.isFunction(s[o])&&"_"!==o.charAt(0)?(i=s[o].apply(s,a))!==s&&void 0!==i?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0:e.error("no such method '"+o+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+o+"'")}):(a.length&&(o=e.widget.extend.apply(null,[o].concat(a))),this.each(function(){var t=e.data(this,n);t?(t.option(o||{}),t._init&&t._init()):e.data(this,n,new s(o,this))})),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(i,s){s=e(s||this.defaultElement||this)[0],this.element=e(s),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),s!==this&&(e.data(s,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===s&&this.destroy()}}),this.document=e(s.style?s.ownerDocument:s.document||s),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),i),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,o,r=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(r={},s=t.split("."),t=s.shift(),s.length){for(n=r[t]=e.widget.extend({},this.options[t]),o=0;o<s.length-1;o++)n[s[o]]=n[s[o]]||{},n=n[s[o]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];r[t]=i}return this._setOptions(r),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,o=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,r){function handlerProxy(){if(t||!0!==o.options.disabled&&!e(this).hasClass("ui-state-disabled"))return("string"==typeof r?o[r]:r).apply(o,arguments)}"string"!=typeof r&&(handlerProxy.guid=r.guid=r.guid||handlerProxy.guid||e.guid++);var a=s.match(/^([\w:-]*)\s*(.*)$/),l=a[1]+o.eventNamespace,h=a[2];h?n.delegate(h,l,handlerProxy):i.bind(l,handlerProxy)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){var i=this;return setTimeout(function handlerProxy(){return("string"==typeof e?i[e]:e).apply(i,arguments)},t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var n,o,r=this.options[t];if(s=s||{},(i=e.Event(i)).type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(e.isFunction(r)&&!1===r.apply(this.element[0],[i].concat(s))||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,o){"string"==typeof n&&(n={effect:n});var r,a=n?!0===n||"number"==typeof n?i:n.effect||i:t;"number"==typeof(n=n||{})&&(n={duration:n}),r=!e.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),r&&e.effects&&e.effects.effect[a]?s[t](n):a!==t&&s[a]?s[a](n.duration,n.easing,o):s.queue(function(i){e(this)[t](),o&&o.call(s[0]),i()})}}),e.widget;var s=!1;e(document).mouseup(function(){s=!1}),e.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){if(!0===e.data(i.target,t.widgetName+".preventClickEvent"))return e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!s){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,n=1===t.which,o=!("string"!=typeof this.options.cancel||!t.target.nodeName)&&e(t.target).closest(this.options.cancel).length;return!(n&&!o&&this._mouseCapture(t)&&(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(t),!this._mouseStarted)?(t.preventDefault(),0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),s=!0,0)))}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,t),this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),s=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),function(){e.ui=e.ui||{};var t,i,s=Math.max,n=Math.abs,o=Math.round,r=/left|center|right/,a=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,h=/^\w+/,c=/%$/,d=e.fn.position;function getOffsets(e,t,i){return[parseFloat(e[0])*(c.test(e[0])?t/100:1),parseFloat(e[1])*(c.test(e[1])?i/100:1)]}function parseCss(t,i){return parseInt(e.css(t,i),10)||0}e.position={scrollbarWidth:function(){if(void 0!==t)return t;var i,s,n=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=n.children()[0];return e("body").append(n),i=o.offsetWidth,n.css("overflow","scroll"),s=o.offsetWidth,i===s&&(s=n[0].clientWidth),n.remove(),t=i-s},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),s=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),n="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,o="scroll"===s||"auto"===s&&t.height<t.element[0].scrollHeight;return{width:o?e.position.scrollbarWidth():0,height:n?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),s=e.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s||n?i.width():i.outerWidth(),height:s||n?i.height():i.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return d.apply(this,arguments);t=e.extend({},t);var c,u,p,g,m,f,_=e(t.of),v=e.position.getWithinInfo(t.within),y=e.position.getScrollInfo(v),b=(t.collision||"flip").split(" "),w={};return f=function getDimensions(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}(_),_[0].preventDefault&&(t.at="left top"),u=f.width,p=f.height,g=f.offset,m=e.extend({},g),e.each(["my","at"],function(){var e,i,s=(t[this]||"").split(" ");1===s.length&&(s=r.test(s[0])?s.concat(["center"]):a.test(s[0])?["center"].concat(s):["center","center"]),s[0]=r.test(s[0])?s[0]:"center",s[1]=a.test(s[1])?s[1]:"center",e=l.exec(s[0]),i=l.exec(s[1]),w[this]=[e?e[0]:0,i?i[0]:0],t[this]=[h.exec(s[0])[0],h.exec(s[1])[0]]}),1===b.length&&(b[1]=b[0]),"right"===t.at[0]?m.left+=u:"center"===t.at[0]&&(m.left+=u/2),"bottom"===t.at[1]?m.top+=p:"center"===t.at[1]&&(m.top+=p/2),c=getOffsets(w.at,u,p),m.left+=c[0],m.top+=c[1],this.each(function(){var r,a,l=e(this),h=l.outerWidth(),d=l.outerHeight(),f=parseCss(this,"marginLeft"),C=parseCss(this,"marginTop"),M=h+f+parseCss(this,"marginRight")+y.width,k=d+C+parseCss(this,"marginBottom")+y.height,S=e.extend({},m),x=getOffsets(w.my,l.outerWidth(),l.outerHeight());"right"===t.my[0]?S.left-=h:"center"===t.my[0]&&(S.left-=h/2),"bottom"===t.my[1]?S.top-=d:"center"===t.my[1]&&(S.top-=d/2),S.left+=x[0],S.top+=x[1],i||(S.left=o(S.left),S.top=o(S.top)),r={marginLeft:f,marginTop:C},e.each(["left","top"],function(i,s){e.ui.position[b[i]]&&e.ui.position[b[i]][s](S,{targetWidth:u,targetHeight:p,elemWidth:h,elemHeight:d,collisionPosition:r,collisionWidth:M,collisionHeight:k,offset:[c[0]+x[0],c[1]+x[1]],my:t.my,at:t.at,within:v,elem:l})}),t.using&&(a=function(e){var i=g.left-S.left,o=i+u-h,r=g.top-S.top,a=r+p-d,c={target:{element:_,left:g.left,top:g.top,width:u,height:p},element:{element:l,left:S.left,top:S.top,width:h,height:d},horizontal:o<0?"left":i>0?"right":"center",vertical:a<0?"top":r>0?"bottom":"middle"};u<h&&n(i+o)<u&&(c.horizontal="center"),p<d&&n(r+a)<p&&(c.vertical="middle"),s(n(i),n(o))>s(n(r),n(a))?c.important="horizontal":c.important="vertical",t.using.call(this,e,c)}),l.offset(e.extend(S,{using:a}))})},e.ui.position={fit:{left:function(e,t){var i,n=t.within,o=n.isWindow?n.scrollLeft:n.offset.left,r=n.width,a=e.left-t.collisionPosition.marginLeft,l=o-a,h=a+t.collisionWidth-r-o;t.collisionWidth>r?l>0&&h<=0?(i=e.left+l+t.collisionWidth-r-o,e.left+=l-i):e.left=h>0&&l<=0?o:l>h?o+r-t.collisionWidth:o:l>0?e.left+=l:h>0?e.left-=h:e.left=s(e.left-a,e.left)},top:function(e,t){var i,n=t.within,o=n.isWindow?n.scrollTop:n.offset.top,r=t.within.height,a=e.top-t.collisionPosition.marginTop,l=o-a,h=a+t.collisionHeight-r-o;t.collisionHeight>r?l>0&&h<=0?(i=e.top+l+t.collisionHeight-r-o,e.top+=l-i):e.top=h>0&&l<=0?o:l>h?o+r-t.collisionHeight:o:l>0?e.top+=l:h>0?e.top-=h:e.top=s(e.top-a,e.top)}},flip:{left:function(e,t){var i,s,o=t.within,r=o.offset.left+o.scrollLeft,a=o.width,l=o.isWindow?o.scrollLeft:o.offset.left,h=e.left-t.collisionPosition.marginLeft,c=h-l,d=h+t.collisionWidth-a-l,u="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,g=-2*t.offset[0];c<0?((i=e.left+u+p+g+t.collisionWidth-a-r)<0||i<n(c))&&(e.left+=u+p+g):d>0&&((s=e.left-t.collisionPosition.marginLeft+u+p+g-l)>0||n(s)<d)&&(e.left+=u+p+g)},top:function(e,t){var i,s,o=t.within,r=o.offset.top+o.scrollTop,a=o.height,l=o.isWindow?o.scrollTop:o.offset.top,h=e.top-t.collisionPosition.marginTop,c=h-l,d=h+t.collisionHeight-a-l,u="top"===t.my[1],p=u?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,g="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];c<0?((s=e.top+p+g+m+t.collisionHeight-a-r)<0||s<n(c))&&(e.top+=p+g+m):d>0&&((i=e.top-t.collisionPosition.marginTop+p+g+m-l)>0||n(i)<d)&&(e.top+=p+g+m)}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,s,n,o,r,a=document.getElementsByTagName("body")[0],l=document.createElement("div");for(r in t=document.createElement(a?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},a&&e.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"}),n)t.style[r]=n[r];t.appendChild(l),(s=a||document.documentElement).insertBefore(t,s.firstChild),l.style.cssText="position: absolute; left: 10.7432222px;",o=e(l).offset().left,i=o>10&&o<11,t.innerHTML="",s.removeChild(t)}()}(),e.ui.position,e.widget("ui.accordion",{version:"1.11.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),t.collapsible||!1!==t.active&&null!=t.active||(t.active=0),this._processPanels(),t.active<0&&(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e()}},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(),this._destroyIcons(),e=this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&e.css("height","")},_setOption:function(e,t){"active"!==e?("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||!1!==this.options.active||this._activate(0),"icons"===e&&(this._destroyIcons(),t&&this._createIcons()),"disabled"===e&&(this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t))):this._activate(t)},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var i=e.ui.keyCode,s=this.headers.length,n=this.headers.index(t.target),o=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:o=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(t);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[s-1]}o&&(e(t.target).attr("tabIndex",-1),e(o).attr("tabIndex",0),o.focus(),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().focus()},refresh:function(){var t=this.options;this._processPanels(),!1===t.active&&!0===t.collapsible||!this.headers.length?(t.active=!1,this.active=e()):!1===t.active?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var e=this.headers,t=this.panels;this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-state-default ui-corner-all"),this.panels=this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide(),t&&(this._off(e.not(this.headers)),this._off(t.not(this.panels)))},_refresh:function(){var t,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(){var t=e(this),i=t.uniqueId().attr("id"),s=t.next(),n=s.uniqueId().attr("id");t.attr("aria-controls",n),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(t=n.height(),this.element.siblings(":visible").each(function(){var i=e(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(t-=i.outerHeight(!0))}),this.headers.each(function(){t-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===s&&(t=0,this.headers.next().each(function(){t=Math.max(t,e(this).css("height","").height())}).height(t))},_activate:function(t){var i=this._findActive(t)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return"number"==typeof t?this.headers.eq(t):e()},_setupEvents:function(t){var i={keydown:"_keydown"};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),o=n[0]===s[0],r=o&&i.collapsible,a=r?e():n.next(),l=s.next(),h={oldHeader:s,oldPanel:l,newHeader:r?e():n,newPanel:a};t.preventDefault(),o&&!i.collapsible||!1===this._trigger("beforeActivate",t,h)||(i.active=!r&&this.headers.index(n),this.active=o?e():n,this._toggle(h),s.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&s.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),o||(n.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),n.next().addClass("ui-accordion-content-active")))},_toggle:function(t){var i=t.newPanel,s=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,t):(s.hide(),i.show(),this._toggleComplete(t)),s.attr({"aria-hidden":"true"}),s.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(e(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(e,t,i){var s,n,o,r=this,a=0,l=e.css("box-sizing"),h=e.length&&(!t.length||e.index()<t.index()),c=this.options.animate||{},d=h&&c.down||c,u=function(){r._toggleComplete(i)};return"number"==typeof d&&(o=d),"string"==typeof d&&(n=d),n=n||d.easing||c.easing,o=o||d.duration||c.duration,t.length?e.length?(s=e.show().outerHeight(),t.animate(this.hideProps,{duration:o,easing:n,step:function(e,t){t.now=Math.round(e)}}),void e.hide().animate(this.showProps,{duration:o,easing:n,complete:u,step:function(e,i){i.now=Math.round(e),"height"!==i.prop?"content-box"===l&&(a+=i.now):"content"!==r.options.heightStyle&&(i.now=Math.round(s-t.outerHeight()-a),a=0)}})):t.animate(this.hideProps,o,n,u):e.animate(this.showProps,o,n,u)},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}}),e.widget("ui.menu",{version:"1.11.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},items:"> *",menus:"ul",position:{my:"left-1 top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item":function(e){e.preventDefault()},"click .ui-menu-item":function(t){var i=e(t.target);!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&e(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){if(!this.previousFilter){var i=e(t.currentTarget);i.siblings(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i)}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.find(this.options.items).eq(0);t||this.focus(e,i)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){var i,s,n,o,r=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:r=!1,s=this.previousFilter||"",n=String.fromCharCode(t.keyCode),o=!1,clearTimeout(this.filterTimer),n===s?o=!0:n=s+n,i=this._filterMenuItems(n),(i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i).length||(n=String.fromCharCode(t.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(t,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}r&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.is("[aria-haspopup='true']")?this.expand(e):this.select(e))},refresh:function(){var t,i,s=this,n=this.options.icons.submenu,o=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),o.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),i=t.parent(),s=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(s),t.attr("aria-labelledby",i.attr("id"))}),t=o.add(this.element),(i=t.find(this.options.items)).not(".ui-menu-item").each(function(){var t=e(this);s._isDivider(t)&&t.addClass("ui-widget-content ui-menu-divider")}),i.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},focus:function(e,t){var i,s;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),s=this.active.addClass("ui-state-focus").removeClass("ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),(i=t.children(".ui-menu")).length&&e&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,s,n,o,r,a;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,n=t.offset().top-this.activeMenu.offset().top-i-s,o=this.activeMenu.scrollTop(),r=this.activeMenu.height(),a=t.outerHeight(),n<0?this.activeMenu.scrollTop(o+n):n+a>r&&this.activeMenu.scrollTop(o+n-r+a))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(t),this.activeMenu=s},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active")},_closeOnDocumentClick:function(t){return!e(t.target).closest(".ui-menu").length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var s;this.active&&(s="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[t]()),this.focus(i,s)},nextPage:function(t){var i,s,n;this.active?this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return(i=e(this)).offset().top-s-n<0}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())):this.next(t)},previousPage:function(t){var i,s,n;this.active?this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return(i=e(this)).offset().top-s+n>0}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items).first())):this.next(t)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)},_filterMenuItems:function(t){var i=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=new RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(e.trim(e(this).text()))})}}),e.widget("ui.autocomplete",{version:"1.11.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,s,n=this.element[0].nodeName.toLowerCase(),o="textarea"===n,r="input"===n;this.isMultiLine=!!o||!r&&this.element.prop("isContentEditable"),this.valueMethod=this.element[o||r?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return t=!0,s=!0,void(i=!0);t=!1,s=!1,i=!1;var o=e.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:t=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:t=!0,this._move("nextPage",n);break;case o.UP:t=!0,this._keyEvent("previous",n);break;case o.DOWN:t=!0,this._keyEvent("next",n);break;case o.ENTER:this.menu.active&&(t=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(t)return t=!1,void(this.isMultiLine&&!this.menu.element.is(":visible")||s.preventDefault());if(!i){var n=e.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(e){if(s)return s=!1,void e.preventDefault();this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){this.cancelBlur?delete this.cancelBlur:(clearTimeout(this.searching),this.close(e),this._change(e))}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(s){s.target===t.element[0]||s.target===i||e.contains(i,s.target)||t.close()})})},menufocus:function(t,i){var s,n;if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)});n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",t,{item:n})&&t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(n.value),(s=i.item.attr("aria-label")||n.value)&&e.trim(s).length&&(this.liveRegion.children().hide(),e("<div>").text(s).appendTo(this.liveRegion))},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),s=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,s=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,s){s(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,n){s.xhr&&s.xhr.abort(),s.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){n(e)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){var t=this.term===this._value(),i=this.menu.element.is(":visible"),s=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;t&&(!t||i||s)||(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):!1!==this._trigger("search",t)?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({},t,{label:t.label||t.value,value:t.value||t.label})})},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var s=this;e.each(i,function(e,i){s._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").text(i.label).appendTo(t)},_move:function(e,t){if(this.menu.element.is(":visible"))return this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[e](t);this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){this.isMultiLine&&!this.menu.element.is(":visible")||(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var s=new RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return s.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.children().hide(),e("<div>").text(i).appendTo(this.liveRegion))}}),e.ui.autocomplete;var n,o,r="ui-button ui-widget ui-state-default ui-corner-all",a="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",l=function(){var t=e(this);setTimeout(function(){t.find(":ui-button").button("refresh")},1)},h=function(t){var i=t.name,s=t.form,n=e([]);return i&&(i=i.replace(/'/g,"\\'"),n=s?e(s).find("[name='"+i+"'][type=radio]"):e("[name='"+i+"'][type=radio]",t.ownerDocument).filter(function(){return!this.form})),n};function Datepicker(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=datepicker_bindHover(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function datepicker_bindHover(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(i,"mouseout",function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",datepicker_handleMouseover)}function datepicker_handleMouseover(){e.datepicker._isDisabledDatepicker(o.inline?o.dpDiv.parent()[0]:o.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))}function datepicker_extendRemove(t,i){for(var s in e.extend(t,i),i)null==i[s]&&(t[s]=i[s]);return t}e.widget("ui.button",{version:"1.11.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,l),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,i=this.options,s="checkbox"===this.type||"radio"===this.type,o=s?"":"ui-state-active";null===i.label&&(i.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(r).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){i.disabled||this===n&&e(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){i.disabled||e(this).removeClass(o)}).bind("click"+this.eventNamespace,function(e){i.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),s&&this.element.bind("change"+this.eventNamespace,function(){t.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var s=t.element[0];h(s).not(s).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).addClass("ui-state-active"),n=this,t.document.one("mouseup",function(){n=null})}).bind("mouseup"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(t){if(i.disabled)return!1;t.keyCode!==e.ui.keyCode.SPACE&&t.keyCode!==e.ui.keyCode.ENTER||e(this).addClass("ui-state-active")}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",i.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.element.is("[type=checkbox]")?this.type="checkbox":this.element.is("[type=radio]")?this.type="radio":this.element.is("input")?this.type="input":this.type="button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),(i=this.element.is(":checked"))&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(r+" ui-state-active "+a).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){if(this._super(e,t),"disabled"===e)return this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),void(t&&("checkbox"===this.type||"radio"===this.type?this.buttonElement.removeClass("ui-state-focus"):this.buttonElement.removeClass("ui-state-focus ui-state-active")));this._resetButton()},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?h(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"!==this.type){var t=this.buttonElement.removeClass(a),i=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),s=this.options.icons,n=s.primary&&s.secondary,o=[];s.primary||s.secondary?(this.options.text&&o.push("ui-button-text-icon"+(n?"s":s.primary?"-primary":"-secondary")),s.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+s.primary+"'></span>"),s.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+s.secondary+"'></span>"),this.options.text||(o.push(n?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(i)))):o.push("ui-button-text-only"),t.addClass(o.join(" "))}else this.options.label&&this.element.val(this.options.label)}}),e.widget("ui.buttonset",{version:"1.11.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t="rtl"===this.element.css("direction"),i=this.element.find(this.options.items),s=i.filter(":ui-button");i.not(":ui-button").button(),s.button("refresh"),this.buttons=i.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}}),e.ui.button,e.extend(e.ui,{datepicker:{version:"1.11.4"}}),e.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return datepicker_extendRemove(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var s,n,o;s=t.nodeName.toLowerCase(),n="div"===s||"span"===s,t.id||(this.uuid+=1,t.id="dp"+this.uuid),(o=this._newInst(e(t),n)).settings=e.extend({},i||{}),"input"===s?this._connectDatepicker(t,o):n&&this._inlineDatepicker(t,o)},_newInst:function(t,i){var s=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?datepicker_bindHover(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var s=e(t);i.append=e([]),i.trigger=e([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),e.data(t,"datepicker",i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var s,n,o,r=this._get(i,"appendText"),a=this._get(i,"isRTL");i.append&&i.append.remove(),r&&(i.append=e("<span class='"+this._appendClass+"'>"+r+"</span>"),t[a?"before":"after"](i.append)),t.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),"focus"!==(s=this._get(i,"showOn"))&&"both"!==s||t.focus(this._showDatepicker),"button"!==s&&"both"!==s||(n=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:o,alt:n,title:n}):e("<button type='button'></button>").addClass(this._triggerClass).html(o?e("<img/>").attr({src:o,alt:n,title:n}):n)),t[a?"before":"after"](i.trigger),i.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,s,n,o=new Date(2009,11,20),r=this._get(e,"dateFormat");r.match(/[DM]/)&&(t=function(e){for(i=0,s=0,n=0;n<e.length;n++)e[n].length>i&&(i=e[n].length,s=n);return s},o.setMonth(t(this._get(e,r.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(t(this._get(e,r.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),e.input.attr("size",this._formatDate(e,o).length)}},_inlineDatepicker:function(t,i){var s=e(t);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),e.data(t,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,s,n,o){var r,a,l,h,c,d=this._dialogInst;return d||(this.uuid+=1,r="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+r+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),(d=this._dialogInst=this._newInst(this._dialogInput,!1)).settings={},e.data(this._dialogInput[0],"datepicker",d)),datepicker_extendRemove(d.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(d,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(a=document.documentElement.clientWidth,l=document.documentElement.clientHeight,h=document.documentElement.scrollLeft||document.body.scrollLeft,c=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[a/2-100+h,l/2-150+c]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(t){var i,s=e(t),n=e.data(t,"datepicker");s.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):"div"!==i&&"span"!==i||s.removeClass(this.markerClassName).empty(),o===n&&(o=null))},_enableDatepicker:function(t){var i,s,n=e(t),o=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):"div"!==i&&"span"!==i||((s=n.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var i,s,n=e(t),o=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):"div"!==i&&"span"!==i||((s=n.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,"datepicker")}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,i,s){var n,o,r,a,l=this._getInst(t);if(2===arguments.length&&"string"==typeof i)return"defaults"===i?e.extend({},e.datepicker._defaults):l?"all"===i?e.extend({},l.settings):this._get(l,i):null;n=i||{},"string"==typeof i&&((n={})[i]=s),l&&(this._curInst===l&&this._hideDatepicker(),o=this._getDateDatepicker(t,!0),r=this._getMinMaxDate(l,"min"),a=this._getMinMaxDate(l,"max"),datepicker_extendRemove(l.settings,n),null!==r&&void 0!==n.dateFormat&&void 0===n.minDate&&(l.settings.minDate=this._formatDate(l,r)),null!==a&&void 0!==n.dateFormat&&void 0===n.maxDate&&(l.settings.maxDate=this._formatDate(l,a)),"disabled"in n&&(n.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),l),this._autoSize(l),this._setDate(l,o),this._updateAlternate(l),this._updateDatepicker(l))},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,s,n,o=e.datepicker._getInst(t.target),r=!0,a=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),r=!1;break;case 13:return(n=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",o.dpDiv))[0]&&e.datepicker._selectDay(t.target,o.selectedMonth,o.selectedYear,n[0]),(i=e.datepicker._get(o,"onSelect"))?(s=e.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[s,o])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(o,"stepBigMonths"):-e.datepicker._get(o,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(o,"stepBigMonths"):+e.datepicker._get(o,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),r=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),r=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,a?1:-1,"D"),r=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(o,"stepBigMonths"):-e.datepicker._get(o,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),r=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,a?-1:1,"D"),r=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(o,"stepBigMonths"):+e.datepicker._get(o,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),r=t.ctrlKey||t.metaKey;break;default:r=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):r=!1;r&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,s,n=e.datepicker._getInst(t.target);if(e.datepicker._get(n,"constrainInput"))return i=e.datepicker._possibleChars(e.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||s<" "||!i||i.indexOf(s)>-1},_doKeyUp:function(t){var i=e.datepicker._getInst(t.target);if(i.input.val()!==i.lastVal)try{e.datepicker.parseDate(e.datepicker._get(i,"dateFormat"),i.input?i.input.val():null,e.datepicker._getFormatConfig(i))&&(e.datepicker._setDateFromField(i),e.datepicker._updateAlternate(i),e.datepicker._updateDatepicker(i))}catch(e){}return!0},_showDatepicker:function(t){var i,s,n,o,r,a,l;"input"!==(t=t.target||t).nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),e.datepicker._isDisabledDatepicker(t)||e.datepicker._lastInput===t||(i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),s=e.datepicker._get(i,"beforeShow"),!1!==(n=s?s.apply(t,[t,i]):{})&&(datepicker_extendRemove(i.settings,n),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),o=!1,e(t).parents().each(function(){return!(o|="fixed"===e(this).css("position"))}),r={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),r=e.datepicker._checkOffset(i,r,o),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":o?"fixed":"absolute",display:"none",left:r.left+"px",top:r.top+"px"}),i.inline||(a=e.datepicker._get(i,"showAnim"),l=e.datepicker._get(i,"duration"),i.dpDiv.css("z-index",function datepicker_getZindex(e){for(var t,i;e.length&&e[0]!==document;){if(("absolute"===(t=e.css("position"))||"relative"===t||"fixed"===t)&&(i=parseInt(e.css("zIndex"),10),!isNaN(i)&&0!==i))return i;e=e.parent()}return 0}(e(t))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[a]?i.dpDiv.show(a,e.datepicker._get(i,"showOptions"),l):i.dpDiv[a||"show"](a?l:null),e.datepicker._shouldFocusInput(i)&&i.input.focus(),e.datepicker._curInst=i)))},_updateDatepicker:function(t){this.maxRows=4,o=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t);var i,s=this._getNumberOfMonths(t),n=s[1],r=t.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&datepicker_handleMouseover.apply(r.get(0)),t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&t.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",17*n+"em"),t.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(i=t.yearshtml,setTimeout(function(){i===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),i=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,i,s){var n=t.dpDiv.outerWidth(),o=t.dpDiv.outerHeight(),r=t.input?t.input.outerWidth():0,a=t.input?t.input.outerHeight():0,l=document.documentElement.clientWidth+(s?0:e(document).scrollLeft()),h=document.documentElement.clientHeight+(s?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?n-r:0,i.left-=s&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=s&&i.top===t.input.offset().top+a?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>l&&l>n?Math.abs(i.left+n-l):0),i.top-=Math.min(i.top,i.top+o>h&&h>o?Math.abs(o+a):0),i},_findPos:function(t){for(var i,s=this._getInst(t),n=this._get(s,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[n?"previousSibling":"nextSibling"];return[(i=e(t).offset()).left,i.top]},_hideDatepicker:function(t){var i,s,n,o,r=this._curInst;!r||t&&r!==e.data(t,"datepicker")||this._datepickerShowing&&(i=this._get(r,"showAnim"),s=this._get(r,"duration"),n=function(){e.datepicker._tidyDialog(r)},e.effects&&(e.effects.effect[i]||e.effects[i])?r.dpDiv.hide(i,e.datepicker._get(r,"showOptions"),s,n):r.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,(o=this._get(r,"onClose"))&&o.apply(r.input?r.input[0]:null,[r.input?r.input.val():"",r]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),s=e.datepicker._getInst(i[0]);(i[0].id===e.datepicker._mainDivId||0!==i.parents("#"+e.datepicker._mainDivId).length||i.hasClass(e.datepicker.markerClassName)||i.closest("."+e.datepicker._triggerClass).length||!e.datepicker._datepickerShowing||e.datepicker._inDialog&&e.blockUI)&&(!i.hasClass(e.datepicker.markerClassName)||e.datepicker._curInst===s)||e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,s){var n=e(t),o=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(o,i+("M"===s?this._get(o,"showCurrentAtPos"):0),s),this._updateDatepicker(o))},_gotoToday:function(t){var i,s=e(t),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(t,i,s){var n=e(t),o=this._getInst(n[0]);o["selected"+("M"===s?"Month":"Year")]=o["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(n)},_selectDay:function(t,i,s,n){var o,r=e(t);e(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(r[0])||((o=this._getInst(r[0])).selectedDay=o.currentDay=e("a",n).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=s,this._selectDate(t,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var s,n=e(t),o=this._getInst(n[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),(s=this._get(o,"onSelect"))?s.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var i,s,n,o=this._get(t,"altField");o&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),s=this._getDate(t),n=this.formatDate(i,s,this._getFormatConfig(t)),e(o).each(function(){e(this).val(n)}))},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,s){if(null==t||null==i)throw"Invalid arguments";if(""===(i="object"==typeof i?i.toString():i+""))return null;var n,o,r,a,l=0,h=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof h?h:(new Date).getFullYear()%100+parseInt(h,10),d=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,u=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,g=(s?s.monthNames:null)||this._defaults.monthNames,m=-1,f=-1,_=-1,v=-1,y=!1,b=function(e){var i=n+1<t.length&&t.charAt(n+1)===e;return i&&n++,i},w=function(e){var t=b(e),s="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,n="y"===e?s:1,o=new RegExp("^\\d{"+n+","+s+"}"),r=i.substring(l).match(o);if(!r)throw"Missing number at position "+l;return l+=r[0].length,parseInt(r[0],10)},C=function(t,s,n){var o=-1,r=e.map(b(t)?n:s,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(r,function(e,t){var s=t[1];if(i.substr(l,s.length).toLowerCase()===s.toLowerCase())return o=t[0],l+=s.length,!1}),-1!==o)return o+1;throw"Unknown name at position "+l},M=function(){if(i.charAt(l)!==t.charAt(n))throw"Unexpected literal at position "+l;l++};for(n=0;n<t.length;n++)if(y)"'"!==t.charAt(n)||b("'")?M():y=!1;else switch(t.charAt(n)){case"d":_=w("d");break;case"D":C("D",d,u);break;case"o":v=w("o");break;case"m":f=w("m");break;case"M":f=C("M",p,g);break;case"y":m=w("y");break;case"@":a=new Date(w("@")),m=a.getFullYear(),f=a.getMonth()+1,_=a.getDate();break;case"!":a=new Date((w("!")-this._ticksTo1970)/1e4),m=a.getFullYear(),f=a.getMonth()+1,_=a.getDate();break;case"'":b("'")?M():y=!0;break;default:M()}if(l<i.length&&(r=i.substr(l),!/^\s+/.test(r)))throw"Extra/unparsed characters found in date: "+r;if(-1===m?m=(new Date).getFullYear():m<100&&(m+=(new Date).getFullYear()-(new Date).getFullYear()%100+(m<=c?0:-100)),v>-1)for(f=1,_=v;o=this._getDaysInMonth(m,f-1),!(_<=o);)f++,_-=o;if((a=this._daylightSavingAdjust(new Date(m,f-1,_))).getFullYear()!==m||a.getMonth()+1!==f||a.getDate()!==_)throw"Invalid date";return a},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(e,t,i){if(!t)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,r=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,a=(i?i.monthNames:null)||this._defaults.monthNames,l=function(t){var i=s+1<e.length&&e.charAt(s+1)===t;return i&&s++,i},h=function(e,t,i){var s=""+t;if(l(e))for(;s.length<i;)s="0"+s;return s},c=function(e,t,i,s){return l(e)?s[t]:i[t]},d="",u=!1;if(t)for(s=0;s<e.length;s++)if(u)"'"!==e.charAt(s)||l("'")?d+=e.charAt(s):u=!1;else switch(e.charAt(s)){case"d":d+=h("d",t.getDate(),2);break;case"D":d+=c("D",t.getDay(),n,o);break;case"o":d+=h("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":d+=h("m",t.getMonth()+1,2);break;case"M":d+=c("M",t.getMonth(),r,a);break;case"y":d+=l("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":d+=t.getTime();break;case"!":d+=1e4*t.getTime()+this._ticksTo1970;break;case"'":l("'")?d+="'":u=!0;break;default:d+=e.charAt(s)}return d},_possibleChars:function(e){var t,i="",s=!1,n=function(i){var s=t+1<e.length&&e.charAt(t+1)===i;return s&&t++,s};for(t=0;t<e.length;t++)if(s)"'"!==e.charAt(t)||n("'")?i+=e.charAt(t):s=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),s=e.lastVal=e.input?e.input.val():null,n=this._getDefaultDate(e),o=n,r=this._getFormatConfig(e);try{o=this.parseDate(i,s,r)||n}catch(e){s=t?"":s}e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),e.currentDay=s?o.getDate():0,e.currentMonth=s?o.getMonth():0,e.currentYear=s?o.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,s){var n=null==i||""===i?s:"string"==typeof i?function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(e){}for(var s=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,n=s.getFullYear(),o=s.getMonth(),r=s.getDate(),a=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=a.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":o+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(n,o));break;case"y":case"Y":n+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(n,o))}l=a.exec(i)}return new Date(n,o,r)}(i):"number"==typeof i?isNaN(i)?s:function(e){var t=new Date;return t.setDate(t.getDate()+e),t}(i):new Date(i.getTime());return(n=n&&"Invalid Date"===n.toString()?s:n)&&(n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0)),this._daylightSavingAdjust(n)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var s=!t,n=e.selectedMonth,o=e.selectedYear,r=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=r.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=r.getMonth(),e.drawYear=e.selectedYear=e.currentYear=r.getFullYear(),n===e.selectedMonth&&o===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(s?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),s="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(s,-i,"M")},next:function(){e.datepicker._adjustDate(s,+i,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(s)},selectDay:function(){return e.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(s,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,s,n,o,r,a,l,h,c,d,u,p,g,m,f,_,v,y,b,w,C,M,k,S,x,T,D,V,E,A,B,I,z,F,N,P,O,L,q=new Date,R=this._daylightSavingAdjust(new Date(q.getFullYear(),q.getMonth(),q.getDate())),$=this._get(e,"isRTL"),j=this._get(e,"showButtonPanel"),H=this._get(e,"hideIfNoPrevNext"),U=this._get(e,"navigationAsDateFormat"),W=this._getNumberOfMonths(e),G=this._get(e,"showCurrentAtPos"),Y=this._get(e,"stepMonths"),Q=1!==W[0]||1!==W[1],K=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),J=this._getMinMaxDate(e,"min"),X=this._getMinMaxDate(e,"max"),Z=e.drawMonth-G,ee=e.drawYear;if(Z<0&&(Z+=12,ee--),X)for(t=this._daylightSavingAdjust(new Date(X.getFullYear(),X.getMonth()-W[0]*W[1]+1,X.getDate())),t=J&&t<J?J:t;this._daylightSavingAdjust(new Date(ee,Z,1))>t;)--Z<0&&(Z=11,ee--);for(e.drawMonth=Z,e.drawYear=ee,i=this._get(e,"prevText"),i=U?this.formatDate(i,this._daylightSavingAdjust(new Date(ee,Z-Y,1)),this._getFormatConfig(e)):i,s=this._canAdjustMonth(e,-1,ee,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+($?"e":"w")+"'>"+i+"</span></a>":H?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+($?"e":"w")+"'>"+i+"</span></a>",n=this._get(e,"nextText"),n=U?this.formatDate(n,this._daylightSavingAdjust(new Date(ee,Z+Y,1)),this._getFormatConfig(e)):n,o=this._canAdjustMonth(e,1,ee,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+($?"w":"e")+"'>"+n+"</span></a>":H?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+($?"w":"e")+"'>"+n+"</span></a>",r=this._get(e,"currentText"),a=this._get(e,"gotoCurrent")&&e.currentDay?K:R,r=U?this.formatDate(r,a,this._getFormatConfig(e)):r,l=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",h=j?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+($?l:"")+(this._isInRange(e,a)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+r+"</button>":"")+($?"":l)+"</div>":"",c=parseInt(this._get(e,"firstDay"),10),c=isNaN(c)?0:c,d=this._get(e,"showWeek"),u=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),g=this._get(e,"monthNames"),m=this._get(e,"monthNamesShort"),f=this._get(e,"beforeShowDay"),_=this._get(e,"showOtherMonths"),v=this._get(e,"selectOtherMonths"),y=this._getDefaultDate(e),b="",C=0;C<W[0];C++){for(M="",this.maxRows=4,k=0;k<W[1];k++){if(S=this._daylightSavingAdjust(new Date(ee,Z,e.selectedDay)),x=" ui-corner-all",T="",Q){if(T+="<div class='ui-datepicker-group",W[1]>1)switch(k){case 0:T+=" ui-datepicker-group-first",x=" ui-corner-"+($?"right":"left");break;case W[1]-1:T+=" ui-datepicker-group-last",x=" ui-corner-"+($?"left":"right");break;default:T+=" ui-datepicker-group-middle",x=""}T+="'>"}for(T+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+x+"'>"+(/all|left/.test(x)&&0===C?$?o:s:"")+(/all|right/.test(x)&&0===C?$?s:o:"")+this._generateMonthYearHeader(e,Z,ee,J,X,C>0||k>0,g,m)+"</div><table class='ui-datepicker-calendar'><thead><tr>",D=d?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",w=0;w<7;w++)V=(w+c)%7,D+="<th scope='col'"+((w+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+u[V]+"'>"+p[V]+"</span></th>";for(T+=D+"</tr></thead><tbody>",E=this._getDaysInMonth(ee,Z),ee===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,E)),A=(this._getFirstDayOfMonth(ee,Z)-c+7)%7,B=Math.ceil((A+E)/7),I=Q&&this.maxRows>B?this.maxRows:B,this.maxRows=I,z=this._daylightSavingAdjust(new Date(ee,Z,1-A)),F=0;F<I;F++){for(T+="<tr>",N=d?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(z)+"</td>":"",w=0;w<7;w++)P=f?f.apply(e.input?e.input[0]:null,[z]):[!0,""],O=z.getMonth()!==Z,L=O&&!v||!P[0]||J&&z<J||X&&z>X,N+="<td class='"+((w+c+6)%7>=5?" ui-datepicker-week-end":"")+(O?" ui-datepicker-other-month":"")+(z.getTime()===S.getTime()&&Z===e.selectedMonth&&e._keyEvent||y.getTime()===z.getTime()&&y.getTime()===S.getTime()?" "+this._dayOverClass:"")+(L?" "+this._unselectableClass+" ui-state-disabled":"")+(O&&!_?"":" "+P[1]+(z.getTime()===K.getTime()?" "+this._currentClass:"")+(z.getTime()===R.getTime()?" ui-datepicker-today":""))+"'"+(O&&!_||!P[2]?"":" title='"+P[2].replace(/'/g,"&#39;")+"'")+(L?"":" data-handler='selectDay' data-event='click' data-month='"+z.getMonth()+"' data-year='"+z.getFullYear()+"'")+">"+(O&&!_?"&#xa0;":L?"<span class='ui-state-default'>"+z.getDate()+"</span>":"<a class='ui-state-default"+(z.getTime()===R.getTime()?" ui-state-highlight":"")+(z.getTime()===K.getTime()?" ui-state-active":"")+(O?" ui-priority-secondary":"")+"' href='#'>"+z.getDate()+"</a>")+"</td>",z.setDate(z.getDate()+1),z=this._daylightSavingAdjust(z);T+=N+"</tr>"}++Z>11&&(Z=0,ee++),T+="</tbody></table>"+(Q?"</div>"+(W[0]>0&&k===W[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),M+=T}b+=M}return b+=h,e._keyEvent=!1,b},_generateMonthYearHeader:function(e,t,i,s,n,o,r,a){var l,h,c,d,u,p,g,m,f=this._get(e,"changeMonth"),_=this._get(e,"changeYear"),v=this._get(e,"showMonthAfterYear"),y="<div class='ui-datepicker-title'>",b="";if(o||!f)b+="<span class='ui-datepicker-month'>"+r[t]+"</span>";else{for(l=s&&s.getFullYear()===i,h=n&&n.getFullYear()===i,b+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;c<12;c++)(!l||c>=s.getMonth())&&(!h||c<=n.getMonth())&&(b+="<option value='"+c+"'"+(c===t?" selected='selected'":"")+">"+a[c]+"</option>");b+="</select>"}if(v||(y+=b+(!o&&f&&_?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",o||!_)y+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(d=this._get(e,"yearRange").split(":"),u=(new Date).getFullYear(),g=(p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?u+parseInt(e,10):parseInt(e,10);return isNaN(t)?u:t})(d[0]),m=Math.max(g,p(d[1]||"")),g=s?Math.max(g,s.getFullYear()):g,m=n?Math.min(m,n.getFullYear()):m,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g<=m;g++)e.yearshtml+="<option value='"+g+"'"+(g===i?" selected='selected'":"")+">"+g+"</option>";e.yearshtml+="</select>",y+=e.yearshtml,e.yearshtml=null}return y+=this._get(e,"yearSuffix"),v&&(y+=(!o&&f&&_?"":"&#xa0;")+b),y+="</div>"},_adjustInstDate:function(e,t,i){var s=e.drawYear+("Y"===i?t:0),n=e.drawMonth+("M"===i?t:0),o=Math.min(e.selectedDay,this._getDaysInMonth(s,n))+("D"===i?t:0),r=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(s,n,o)));e.selectedDay=r.getDate(),e.drawMonth=e.selectedMonth=r.getMonth(),e.drawYear=e.selectedYear=r.getFullYear(),"M"!==i&&"Y"!==i||this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),s=this._getMinMaxDate(e,"max"),n=i&&t<i?i:t;return s&&n>s?s:n},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,s){var n=this._getNumberOfMonths(e),o=this._daylightSavingAdjust(new Date(i,s+(t<0?t:n[0]*n[1]),1));return t<0&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(e,o)},_isInRange:function(e,t){var i,s,n=this._getMinMaxDate(e,"min"),o=this._getMinMaxDate(e,"max"),r=null,a=null,l=this._get(e,"yearRange");return l&&(i=l.split(":"),s=(new Date).getFullYear(),r=parseInt(i[0],10),a=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(r+=s),i[1].match(/[+\-].*/)&&(a+=s)),(!n||t.getTime()>=n.getTime())&&(!o||t.getTime()<=o.getTime())&&(!r||t.getFullYear()>=r)&&(!a||t.getFullYear()<=a)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return{shortYearCutoff:t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,s){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var n=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(s,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),n,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new Datepicker,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.11.4",e.datepicker,e.widget("ui.draggable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){(this.helper||this.element).is(".ui-draggable-dragging")?this.destroyOnClear=!0:(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy())},_mouseCapture:function(t){var i=this.options;return this._blurActiveElement(t),!(this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0||(this.handle=this._getHandle(t),!this.handle||(this._blockFrames(!0===i.iframeFix?"iframe":i.iframeFix),0)))},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=this.document[0];if(this.handleElement.is(t.target))try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&e(i.activeElement).blur()}catch(e){}},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),!1===this._trigger("start",t)?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(!1===this._trigger("drag",t,s))return this._mouseUp({}),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||!0===this.options.revert||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==i._trigger("stop",t)&&i._clear()}):!1!==this._trigger("stop",t)&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return!this.options.handle||!!e(t.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper),n=s?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options,o=this.document[0];this.relativeContainer=null,n.containment?"window"!==n.containment?"document"!==n.containment?n.containment.constructor!==Array?("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=e(n.containment),(s=i[0])&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i)):this.containment=n.containment:this.containment=[0,0,e(o).width()-this.helperProportions.width-this.margins.left,(e(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=null},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,s,n,o,r=this.options,a=this._isRootNode(this.scrollParent[0]),l=e.pageX,h=e.pageY;return a&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(h=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(h=i[3]+this.offset.click.top)),r.grid&&(n=r.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/r.grid[1])*r.grid[1]:this.originalPageY,h=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-r.grid[1]:n+r.grid[1]:n,o=r.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/r.grid[0])*r.grid[0]:this.originalPageX,l=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-r.grid[0]:o+r.grid[0]:o),"y"===r.axis&&(l=this.originalPageX),"x"===r.axis&&(h=this.originalPageY)),{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:a?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:a?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,s){var n=e.extend({},i,{item:s.element});s.sortables=[],e(s.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,n))})},stop:function(t,i,s){var n=e.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,e.each(s.sortables,function(){this.isOver?(this.isOver=0,s.cancelHelperRemoval=!0,this.cancelHelperRemoval=!1,this._storedCSS={position:this.placeholder.css("position"),top:this.placeholder.css("top"),left:this.placeholder.css("left")},this._mouseStop(t),this.options.helper=this.options._helper):(this.cancelHelperRemoval=!0,this._trigger("deactivate",t,n))})},drag:function(t,i,s){e.each(s.sortables,function(){var n=!1,o=this;o.positionAbs=s.positionAbs,o.helperProportions=s.helperProportions,o.offset.click=s.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,e.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&e.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,s._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},t.target=o.currentItem[0],o._mouseCapture(t,!0),o._mouseStart(t,!0,!0),o.offset.click.top=s.offset.click.top,o.offset.click.left=s.offset.click.left,o.offset.parent.left-=s.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=s.offset.parent.top-o.offset.parent.top,s._trigger("toSortable",t),s.dropped=o.element,e.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,o.fromOutside=s),o.currentItem&&(o._mouseDrag(t),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",t,o._uiHash(o)),o._mouseStop(t,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(t),i.position=s._generatePosition(t,!0),s._trigger("fromSortable",t),s.dropped=!1,e.each(s.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,s){var n=e("body"),o=s.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(t,i,s){var n=s.options;n._cursor&&e("body").css("cursor",n._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,s){var n=e(i.helper),o=s.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(t,i,s){var n=s.options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,s){var n=s.options,o=!1,r=s.scrollParentNotHidden[0],a=s.document[0];r!==a&&"HTML"!==r.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+r.offsetHeight-t.pageY<n.scrollSensitivity?r.scrollTop=o=r.scrollTop+n.scrollSpeed:t.pageY-s.overflowOffset.top<n.scrollSensitivity&&(r.scrollTop=o=r.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+r.offsetWidth-t.pageX<n.scrollSensitivity?r.scrollLeft=o=r.scrollLeft+n.scrollSpeed:t.pageX-s.overflowOffset.left<n.scrollSensitivity&&(r.scrollLeft=o=r.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(a).scrollTop()<n.scrollSensitivity?o=e(a).scrollTop(e(a).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(a).scrollTop())<n.scrollSensitivity&&(o=e(a).scrollTop(e(a).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(a).scrollLeft()<n.scrollSensitivity?o=e(a).scrollLeft(e(a).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(a).scrollLeft())<n.scrollSensitivity&&(o=e(a).scrollLeft(e(a).scrollLeft()+n.scrollSpeed)))),!1!==o&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(s,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,s){var n=s.options;s.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var t=e(this),i=t.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,s){var n,o,r,a,l,h,c,d,u,p,g=s.options,m=g.snapTolerance,f=i.offset.left,_=f+s.helperProportions.width,v=i.offset.top,y=v+s.helperProportions.height;for(u=s.snapElements.length-1;u>=0;u--)l=s.snapElements[u].left-s.margins.left,h=l+s.snapElements[u].width,c=s.snapElements[u].top-s.margins.top,d=c+s.snapElements[u].height,_<l-m||f>h+m||y<c-m||v>d+m||!e.contains(s.snapElements[u].item.ownerDocument,s.snapElements[u].item)?(s.snapElements[u].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[u].item})),s.snapElements[u].snapping=!1):("inner"!==g.snapMode&&(n=Math.abs(c-y)<=m,o=Math.abs(d-v)<=m,r=Math.abs(l-_)<=m,a=Math.abs(h-f)<=m,n&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:d,left:0}).top),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left)),p=n||o||r||a,"outer"!==g.snapMode&&(n=Math.abs(c-v)<=m,o=Math.abs(d-y)<=m,r=Math.abs(l-f)<=m,a=Math.abs(h-_)<=m,n&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:d-s.helperProportions.height,left:0}).top),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left)),!s.snapElements[u].snapping&&(n||o||r||a||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[u].item})),s.snapElements[u].snapping=n||o||r||a||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,s){var n,o=s.options,r=e.makeArray(e(o.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});r.length&&(n=parseInt(e(r[0]).css("zIndex"),10)||0,e(r).each(function(t){e(this).css("zIndex",n+t)}),this.css("zIndex",n+r.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,s){var n=e(i.helper),o=s.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(t,i,s){var n=s.options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}}),e.ui.draggable,e.widget("ui.resizable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseInt(e,10)||0},_isNumber:function(e){return!isNaN(parseInt(e,10))},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return t[s]>0||(t[s]=1,n=t[s]>0,t[s]=0,n)},_create:function(){var t,i,s,n,o=this,r=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;i<t.length;i++)s=e.trim(t[i]),(n=e("<div class='ui-resizable-handle ui-resizable-"+s+"'></div>")).css({zIndex:r.zIndex}),"se"===s&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(n);this._renderAxis=function(t){var i,s,n,r;for(i in t=t||this.element,this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=e(this.handles[i]),this._on(this.handles[i],{mousedown:o._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=e(this.handles[i],this.element),r=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(n,r),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=n&&n[1]?n[1]:"se")}),r.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){r.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){r.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,s,n=!1;for(i in this.handles)((s=e(this.handles[i])[0])===t.target||e.contains(s,t.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(t){var i,s,n,o=this.options,r=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),o.containment&&(i+=e(o.containment).scrollLeft()||0,s+=e(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:r.width(),height:r.height()},this.originalSize=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.sizeDiff={width:r.outerWidth()-r.width(),height:r.outerHeight()-r.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===n?this.axis+"-resize":n),r.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,s,n=this.originalMousePosition,o=this.axis,r=t.pageX-n.left||0,a=t.pageY-n.top||0,l=this._change[o];return this._updatePrevProperties(),!!l&&(i=l.apply(this,[t,r,a]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1)},_mouseStop:function(t){this.resizing=!1;var i,s,n,o,r,a,l,h=this.options;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:this.sizeDiff.height,o=s?0:this.sizeDiff.width,r={width:this.helper.width()-o,height:this.helper.height()-n},a=parseInt(this.element.css("left"),10)+(this.position.left-this.originalPosition.left)||null,l=parseInt(this.element.css("top"),10)+(this.position.top-this.originalPosition.top)||null,h.animate||this.element.css(e.extend(r,{top:l,left:a})),this.helper.height(this.size.height),this.helper.width(this.size.width),this._helper&&!h.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,s,n,o,r=this.options;o={minWidth:this._isNumber(r.minWidth)?r.minWidth:0,maxWidth:this._isNumber(r.maxWidth)?r.maxWidth:1/0,minHeight:this._isNumber(r.minHeight)?r.minHeight:0,maxHeight:this._isNumber(r.maxHeight)?r.maxHeight:1/0},(this._aspectRatio||e)&&(t=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,t>o.minWidth&&(o.minWidth=t),s>o.minHeight&&(o.minHeight=s),i<o.maxWidth&&(o.maxWidth=i),n<o.maxHeight&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,s=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,s=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,n=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,o=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,r=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,a=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,h=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return o&&(e.width=t.minWidth),r&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),n&&(e.height=t.maxHeight),o&&h&&(e.left=a-t.minWidth),s&&h&&(e.left=a-t.maxWidth),r&&c&&(e.top=l-t.minHeight),n&&c&&(e.top=l-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],s=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],n=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];t<4;t++)i[t]=parseInt(s[t],10)||0,i[t]+=parseInt(n[t],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;t<this._proportionallyResizeElements.length;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},sw:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,s]))},ne:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},nw:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,s]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),r=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,a=o?0:i.sizeDiff.width,l={width:i.size.width-a,height:i.size.height-r},h=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,c&&h?{top:c,left:h}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&e(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,s,n,o,r,a,l=e(this).resizable("instance"),h=l.options,c=l.element,d=h.containment,u=d instanceof e?d.get(0):/parent/.test(d)?c.parent().get(0):d;u&&(l.containerElement=e(u),/document/.test(d)||d===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(u),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,s){i[e]=l._num(t.css("padding"+s))}),l.containerOffset=t.offset(),l.containerPosition=t.position(),l.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},s=l.containerOffset,n=l.containerSize.height,o=l.containerSize.width,r=l._hasScroll(u,"left")?u.scrollWidth:o,a=l._hasScroll(u)?u.scrollHeight:n,l.parentData={element:u,left:s.left,top:s.top,width:r,height:a}))},resize:function(t){var i,s,n,o,r=e(this).resizable("instance"),a=r.options,l=r.containerOffset,h=r.position,c=r._aspectRatio||t.shiftKey,d={top:0,left:0},u=r.containerElement,p=!0;u[0]!==document&&/static/.test(u.css("position"))&&(d=l),h.left<(r._helper?l.left:0)&&(r.size.width=r.size.width+(r._helper?r.position.left-l.left:r.position.left-d.left),c&&(r.size.height=r.size.width/r.aspectRatio,p=!1),r.position.left=a.helper?l.left:0),h.top<(r._helper?l.top:0)&&(r.size.height=r.size.height+(r._helper?r.position.top-l.top:r.position.top),c&&(r.size.width=r.size.height*r.aspectRatio,p=!1),r.position.top=r._helper?l.top:0),n=r.containerElement.get(0)===r.element.parent().get(0),o=/relative|absolute/.test(r.containerElement.css("position")),n&&o?(r.offset.left=r.parentData.left+r.position.left,r.offset.top=r.parentData.top+r.position.top):(r.offset.left=r.element.offset().left,r.offset.top=r.element.offset().top),i=Math.abs(r.sizeDiff.width+(r._helper?r.offset.left-d.left:r.offset.left-l.left)),s=Math.abs(r.sizeDiff.height+(r._helper?r.offset.top-d.top:r.offset.top-l.top)),i+r.size.width>=r.parentData.width&&(r.size.width=r.parentData.width-i,c&&(r.size.height=r.size.width/r.aspectRatio,p=!1)),s+r.size.height>=r.parentData.height&&(r.size.height=r.parentData.height-s,c&&(r.size.width=r.size.height*r.aspectRatio,p=!1)),p||(r.position.left=r.prevPosition.left,r.position.top=r.prevPosition.top,r.size.width=r.prevSize.width,r.size.height=r.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),i=t.options,s=t.containerOffset,n=t.containerPosition,o=t.containerElement,r=e(t.helper),a=r.offset(),l=r.outerWidth()-t.sizeDiff.width,h=r.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(o.css("position"))&&e(this).css({left:a.left-n.left-s.left,width:l,height:h}),t._helper&&!i.animate&&/static/.test(o.css("position"))&&e(this).css({left:a.left-n.left-s.left,width:l,height:h})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),i=t.options;e(i.alsoResize).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})},resize:function(t,i){var s=e(this).resizable("instance"),n=s.options,o=s.originalSize,r=s.originalPosition,a={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-r.top||0,left:s.position.left-r.left||0};e(n.alsoResize).each(function(){var t=e(this),s=e(this).data("ui-resizable-alsoresize"),n={},o=t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var i=(s[t]||0)+(a[t]||0);i&&i>=0&&(n[t]=i||null)}),t.css(n)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.options,s=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),s=i.options,n=i.size,o=i.originalSize,r=i.originalPosition,a=i.axis,l="number"==typeof s.grid?[s.grid,s.grid]:s.grid,h=l[0]||1,c=l[1]||1,d=Math.round((n.width-o.width)/h)*h,u=Math.round((n.height-o.height)/c)*c,p=o.width+d,g=o.height+u,m=s.maxWidth&&s.maxWidth<p,f=s.maxHeight&&s.maxHeight<g,_=s.minWidth&&s.minWidth>p,v=s.minHeight&&s.minHeight>g;s.grid=l,_&&(p+=h),v&&(g+=c),m&&(p-=h),f&&(g-=c),/^(se|s|e)$/.test(a)?(i.size.width=p,i.size.height=g):/^(ne)$/.test(a)?(i.size.width=p,i.size.height=g,i.position.top=r.top-u):/^(sw)$/.test(a)?(i.size.width=p,i.size.height=g,i.position.left=r.left-d):((g-c<=0||p-h<=0)&&(t=i._getPaddingPlusBorderDimensions(this)),g-c>0?(i.size.height=g,i.position.top=r.top-u):(g=c-t.height,i.size.height=g,i.position.top=r.top+o.height-g),p-h>0?(i.size.width=p,i.position.left=r.left-d):(p=h-t.width,i.size.width=p,i.position.left=r.left+o.width-p))}}),e.ui.resizable,e.widget("ui.dialog",{version:"1.11.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"Close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=e(this).css(t).offset().top;i<0&&e(this).css("top",t.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(e=t.parent.children().eq(t.index)).length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var i,s=this;if(this._isOpen&&!1!==this._trigger("beforeClose",t)){if(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),!this.opener.filter(":focusable").focus().length)try{(i=this.document[0].activeElement)&&"body"!==i.nodeName.toLowerCase()&&e(i).blur()}catch(e){}this._hide(this.uiDialog,this.options.hide,function(){s._trigger("close",t)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+e(this).css("z-index")}).get(),o=Math.max.apply(null,n);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),s=!0),s&&!i&&this._trigger("focus",t),s},open:function(){var t=this;this._isOpen?this._moveToTop()&&this._focusTabbable():(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"))},_focusTabbable:function(){var e=this._focusedElement;e||(e=this.element.find("[autofocus]")),e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function checkFocus(){var t=this.document[0].activeElement,i=this.uiDialog[0]===t||e.contains(this.uiDialog[0],t);i||this._focusTabbable()}t.preventDefault(),checkFocus.call(this),this._delay(checkFocus)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),void this.close(t);if(t.keyCode===e.ui.keyCode.TAB&&!t.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");t.target!==n[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==s[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(this._delay(function(){n.focus()}),t.preventDefault()):(this._delay(function(){s.focus()}),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,i=this.options.buttons;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&&!i.length?this.uiDialog.removeClass("ui-dialog-buttons"):(e.each(i,function(i,s){var n,o;s=e.isFunction(s)?{click:s,text:i}:s,s=e.extend({type:"button"},s),n=s.click,s.click=function(){n.apply(t.element[0],arguments)},o={icons:s.icons,text:s.showText},delete s.icons,delete s.showText,e("<button></button>",s).button(o).appendTo(t.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){var t=this,i=this.options;function filteredUi(e){return{position:e.position,offset:e.offset}}this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(i,s){e(this).addClass("ui-dialog-dragging"),t._blockFrames(),t._trigger("dragStart",i,filteredUi(s))},drag:function(e,i){t._trigger("drag",e,filteredUi(i))},stop:function(s,n){var o=n.offset.left-t.document.scrollLeft(),r=n.offset.top-t.document.scrollTop();i.position={my:"left top",at:"left"+(o>=0?"+":"")+o+" top"+(r>=0?"+":"")+r,of:t.window},e(this).removeClass("ui-dialog-dragging"),t._unblockFrames(),t._trigger("dragStop",s,filteredUi(n))}})},_makeResizable:function(){var t=this,i=this.options,s=i.resizable,n=this.uiDialog.css("position"),o="string"==typeof s?s:"n,e,s,w,se,sw,ne,nw";function filteredUi(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:i.maxWidth,maxHeight:i.maxHeight,minWidth:i.minWidth,minHeight:this._minHeight(),handles:o,start:function(i,s){e(this).addClass("ui-dialog-resizing"),t._blockFrames(),t._trigger("resizeStart",i,filteredUi(s))},resize:function(e,i){t._trigger("resize",e,filteredUi(i))},stop:function(s,n){var o=t.uiDialog.offset(),r=o.left-t.document.scrollLeft(),a=o.top-t.document.scrollTop();i.height=t.uiDialog.height(),i.width=t.uiDialog.width(),i.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" top"+(a>=0?"+":"")+a,of:t.window},e(this).removeClass("ui-dialog-resizing"),t._unblockFrames(),t._trigger("resizeStop",s,filteredUi(n))}}).css("position",n)},_trackFocus:function(){this._on(this.widget(),{focusin:function(t){this._makeFocusTarget(),this._focusedElement=e(t.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var t=this._trackingInstances(),i=e.inArray(this,t);-1!==i&&t.splice(i,1)},_trackingInstances:function(){var e=this.document.data("ui-dialog-instances");return e||(e=[],this.document.data("ui-dialog-instances",e)),e},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var i=this,s=!1,n={};e.each(t,function(e,t){i._setOption(e,t),e in i.sizeRelatedOptions&&(s=!0),e in i.resizableRelatedOptions&&(n[e]=t)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,t){var i,s,n=this.uiDialog;"dialogClass"===e&&n.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&((i=n.is(":data(ui-draggable)"))&&!t&&n.draggable("destroy"),!i&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&((s=n.is(":data(ui-resizable)"))&&!t&&n.resizable("destroy"),s&&"string"==typeof t&&n.resizable("option","handles",t),s||!1===t||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),e=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),t=Math.max(0,s.minHeight-e),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-e):"none","auto"===s.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return!!e(t.target).closest(".ui-dialog").length||!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=!0;this._delay(function(){t=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(e){t||this._allowInteraction(e)||(e.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var e=this.document.data("ui-dialog-overlays")-1;e?this.document.data("ui-dialog-overlays",e):this.document.unbind("focusin").removeData("ui-dialog-overlays"),this.overlay.remove(),this.overlay=null}}}),e.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(s)?s:function(e){return e.is(s)},this.proportions=function(){if(!arguments.length)return t||(t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight});t=arguments[0]},this._addToManager(i.scope),i.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;t<e.length;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){if("accept"===t)this.accept=e.isFunction(i)?i:function(e){return e.is(i)};else if("scope"===t){var s=e.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(t,i)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var s=i||e.ui.ddmanager.current,n=!1;return!(!s||(s.currentItem||s.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=e(this).droppable("instance");if(i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&e.ui.intersect(s,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,t))return n=!0,!1}),!n&&!!this.accept.call(this.element[0],s.currentItem||s.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(s)),this.element))},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(){function isOverAxis(e,t,i){return e>=t&&e<t+i}return function(e,t,i,s){if(!t.offset)return!1;var n=(e.positionAbs||e.position.absolute).left+e.margins.left,o=(e.positionAbs||e.position.absolute).top+e.margins.top,r=n+e.helperProportions.width,a=o+e.helperProportions.height,l=t.offset.left,h=t.offset.top,c=l+t.proportions().width,d=h+t.proportions().height;switch(i){case"fit":return l<=n&&r<=c&&h<=o&&a<=d;case"intersect":return l<n+e.helperProportions.width/2&&r-e.helperProportions.width/2<c&&h<o+e.helperProportions.height/2&&a-e.helperProportions.height/2<d;case"pointer":return isOverAxis(s.pageY,h,t.proportions().height)&&isOverAxis(s.pageX,l,t.proportions().width);case"touch":return(o>=h&&o<=d||a>=h&&a<=d||o<h&&a>d)&&(n>=l&&n<=c||r>=l&&r<=c||n<l&&r>c);default:return!1}}}(),e.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(t,i){var s,n,o=e.ui.ddmanager.droppables[t.options.scope]||[],r=i?i.type:null,a=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(s=0;s<o.length;s++)if(!(o[s].options.disabled||t&&!o[s].accept.call(o[s].element[0],t.currentItem||t.element))){for(n=0;n<a.length;n++)if(a[n]===o[s].element[0]){o[s].proportions().height=0;continue e}o[s].visible="none"!==o[s].element.css("display"),o[s].visible&&("mousedown"===r&&o[s]._activate.call(o[s],i),o[s].offset=o[s].element.offset(),o[s].proportions({width:o[s].element[0].offsetWidth,height:o[s].element[0].offsetHeight}))}},drop:function(t,i){var s=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,o,r=e.ui.intersect(t,this,this.options.tolerance,i),a=!r&&this.isover?"isout":r&&!this.isover?"isover":null;a&&(this.options.greedy&&(n=this.options.scope,(o=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===n})).length&&((s=e(o[0]).droppable("instance")).greedyChild="isover"===a)),s&&"isover"===a&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,i),s&&"isout"===a&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}},e.ui.droppable;var c=e;function spinner_modifier(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}e.effects={effect:{}},function(e,t){var i,s=/^([\-+])=\s*(\d+\.?\d*)/,n=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],o=e.Color=function(t,i,s,n){return new e.Color.fn.parse(t,i,s,n)},r={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},a={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},l=o.support={},h=e("<p>")[0],c=e.each;function clamp(e,t,i){var s=a[t.type]||{};return null==e?i||!t.def?null:t.def:(e=s.floor?~~e:parseFloat(e),isNaN(e)?t.def:s.mod?(e+s.mod)%s.mod:0>e?0:s.max<e?s.max:e)}function stringParse(t){var s=o(),a=s._rgba=[];return t=t.toLowerCase(),c(n,function(e,i){var n,o=i.re.exec(t),l=o&&i.parse(o),h=i.space||"rgba";if(l)return n=s[h](l),s[r[h].cache]=n[r[h].cache],a=s._rgba=n._rgba,!1}),a.length?("0,0,0,0"===a.join()&&e.extend(a,i.transparent),s):i[t]}function hue2rgb(e,t,i){return 6*(i=(i+1)%1)<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}h.style.cssText="background-color:rgba(1,1,1,.5)",l.rgba=h.style.backgroundColor.indexOf("rgba")>-1,c(r,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),o.fn=e.extend(o.prototype,{parse:function(t,s,n,a){if(void 0===t)return this._rgba=[null,null,null,null],this;(t.jquery||t.nodeType)&&(t=e(t).css(s),s=void 0);var l=this,h=e.type(t),d=this._rgba=[];return void 0!==s&&(t=[t,s,n,a],h="array"),"string"===h?this.parse(stringParse(t)||i._default):"array"===h?(c(r.rgba.props,function(e,i){d[i.idx]=clamp(t[i.idx],i)}),this):"object"===h?(c(r,t instanceof o?function(e,i){t[i.cache]&&(l[i.cache]=t[i.cache].slice())}:function(i,s){var n=s.cache;c(s.props,function(e,i){if(!l[n]&&s.to){if("alpha"===e||null==t[e])return;l[n]=s.to(l._rgba)}l[n][i.idx]=clamp(t[e],i,!0)}),l[n]&&e.inArray(null,l[n].slice(0,3))<0&&(l[n][3]=1,s.from&&(l._rgba=s.from(l[n])))}),this):void 0},is:function(e){var t=o(e),i=!0,s=this;return c(r,function(e,n){var o,r=t[n.cache];return r&&(o=s[n.cache]||n.to&&n.to(s._rgba)||[],c(n.props,function(e,t){if(null!=r[t.idx])return i=r[t.idx]===o[t.idx]})),i}),i},_space:function(){var e=[],t=this;return c(r,function(i,s){t[s.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var i=o(e),s=i._space(),n=r[s],l=0===this.alpha()?o("transparent"):this,h=l[n.cache]||n.to(l._rgba),d=h.slice();return i=i[n.cache],c(n.props,function(e,s){var n=s.idx,o=h[n],r=i[n],l=a[s.type]||{};null!==r&&(null===o?d[n]=r:(l.mod&&(r-o>l.mod/2?o+=l.mod:o-r>l.mod/2&&(o-=l.mod)),d[n]=clamp((r-o)*t+o,s)))}),this[s](d)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=o(t)._rgba;return o(e.map(i,function(e,t){return(1-s)*n[t]+s*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&t<3&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),s=i.pop();return t&&i.push(~~(255*s)),"#"+e.map(i,function(e){return 1===(e=(e||0).toString(16)).length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),o.fn.parse.prototype=o.fn,r.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,s=e[0]/255,n=e[1]/255,o=e[2]/255,r=e[3],a=Math.max(s,n,o),l=Math.min(s,n,o),h=a-l,c=a+l,d=.5*c;return t=l===a?0:s===a?60*(n-o)/h+360:n===a?60*(o-s)/h+120:60*(s-n)/h+240,i=0===h?0:d<=.5?h/c:h/(2-c),[Math.round(t)%360,i,d,null==r?1:r]},r.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],s=e[2],n=e[3],o=s<=.5?s*(1+i):s+i-s*i,r=2*s-o;return[Math.round(255*hue2rgb(r,o,t+1/3)),Math.round(255*hue2rgb(r,o,t)),Math.round(255*hue2rgb(r,o,t-1/3)),n]},c(r,function(t,i){var n=i.props,r=i.cache,a=i.to,l=i.from;o.fn[t]=function(t){if(a&&!this[r]&&(this[r]=a(this._rgba)),void 0===t)return this[r].slice();var i,s=e.type(t),h="array"===s||"object"===s?t:arguments,d=this[r].slice();return c(n,function(e,t){var i=h["object"===s?e:t.idx];null==i&&(i=d[t.idx]),d[t.idx]=clamp(i,t)}),l?((i=o(l(d)))[r]=d,i):o(d)},c(n,function(i,n){o.fn[i]||(o.fn[i]=function(o){var r,a=e.type(o),l="alpha"===i?this._hsla?"hsla":"rgba":t,h=this[l](),c=h[n.idx];return"undefined"===a?c:("function"===a&&(o=o.call(this,c),a=e.type(o)),null==o&&n.empty?this:("string"===a&&(r=s.exec(o))&&(o=c+parseFloat(r[2])*("+"===r[1]?1:-1)),h[n.idx]=o,this[l](h)))})})}),o.hook=function(t){var i=t.split(" ");c(i,function(t,i){e.cssHooks[i]={set:function(t,s){var n,r,a="";if("transparent"!==s&&("string"!==e.type(s)||(n=stringParse(s)))){if(s=o(n||s),!l.rgba&&1!==s._rgba[3]){for(r="backgroundColor"===i?t.parentNode:t;(""===a||"transparent"===a)&&r&&r.style;)try{a=e.css(r,"backgroundColor"),r=r.parentNode}catch(e){}s=s.blend(a&&"transparent"!==a?a:"_default")}s=s.toRgbaString()}try{t.style[i]=s}catch(e){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=o(t.elem,i),t.end=o(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},o.hook("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor"),e.cssHooks.borderColor={expand:function(e){var t={};return c(["Top","Right","Bottom","Left"],function(i,s){t["border"+s+"Color"]=e}),t}},i=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(c),function(){var t=["add","remove","toggle"],i={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};function getElementStyles(t){var i,s,n=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(o[e.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(c.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(s,n,o,r){var a=e.speed(n,o,r);return this.queue(function(){var n,o=e(this),r=o.attr("class")||"",l=a.children?o.find("*").addBack():o;l=l.map(function(){var t=e(this);return{el:t,start:getElementStyles(this)}}),(n=function(){e.each(t,function(e,t){s[t]&&o[t+"Class"](s[t])})})(),l=l.map(function(){return this.end=getElementStyles(this.el[0]),this.diff=function styleDifference(t,s){var n,o,r={};for(n in s)o=s[n],t[n]!==o&&(i[n]||!e.fx.step[n]&&isNaN(parseFloat(o))||(r[n]=o));return r}(this.start,this.end),this}),o.attr("class",r),l=l.map(function(){var t=this,i=e.Deferred(),s=e.extend({},a,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,s),i.promise()}),e.when.apply(e,l.get()).done(function(){n(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),a.complete.call(o[0])})})},e.fn.extend({addClass:function(t){return function(i,s,n,o){return s?e.effects.animateClass.call(this,{add:i},s,n,o):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,s,n,o){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},s,n,o):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(t){return function(i,s,n,o,r){return"boolean"==typeof s||void 0===s?n?e.effects.animateClass.call(this,s?{add:i}:{remove:i},n,o,r):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},s,n,o)}}(e.fn.toggleClass),switchClass:function(t,i,s,n,o){return e.effects.animateClass.call(this,{add:i,remove:t},s,n,o)}})}(),function(){function _normalizeArguments(t,i,s,n){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(n=s,s=i,i={}),e.isFunction(s)&&(n=s,s=null),i&&e.extend(t,i),s=s||i.duration,t.duration=e.fx.off?0:"number"==typeof s?s:s in e.fx.speeds?e.fx.speeds[s]:e.fx.speeds._default,t.complete=n||i.complete,t}function standardAnimationOption(t){return!(t&&"number"!=typeof t&&!e.fx.speeds[t])||"string"==typeof t&&!e.effects.effect[t]||!!e.isFunction(t)||"object"==typeof t&&!t.effect}e.extend(e.effects,{version:"1.11.4",save:function(e,t){for(var i=0;i<t.length;i++)null!==t[i]&&e.data("ui-effects-"+t[i],e[0].style[t[i]])},restore:function(e,t){var i,s;for(s=0;s<t.length;s++)null!==t[s]&&(void 0===(i=e.data("ui-effects-"+t[s]))&&(i=""),e.css(t[s],i))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,s;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=e[1]/t.width}return{x:s,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),float:t.css("float")},s=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:t.width(),height:t.height()},o=document.activeElement;try{o.id}catch(e){o=document.body}return t.wrap(s),(t[0]===o||e.contains(t[0],o))&&e(o).focus(),s=t.parent(),"static"===t.css("position")?(s.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,s){i[s]=t.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(n),s.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,s,n){return n=n||{},e.each(i,function(e,i){var o=t.cssUnit(i);o[0]>0&&(n[i]=o[0]*s+o[1])}),n}}),e.fn.extend({effect:function(){var t=_normalizeArguments.apply(this,arguments),i=t.mode,s=t.queue,n=e.effects.effect[t.effect];if(e.fx.off||!n)return i?this[i](t.duration,t.complete):this.each(function(){t.complete&&t.complete.call(this)});function run(i){var s=e(this),o=t.complete,r=t.mode;function done(){e.isFunction(o)&&o.call(s[0]),e.isFunction(i)&&i()}(s.is(":hidden")?"hide"===r:"show"===r)?(s[r](),done()):n.call(s[0],t,done)}return!1===s?this.each(run):this.queue(s||"fx",run)},show:function(e){return function(t){if(standardAnimationOption(t))return e.apply(this,arguments);var i=_normalizeArguments.apply(this,arguments);return i.mode="show",this.effect.call(this,i)}}(e.fn.show),hide:function(e){return function(t){if(standardAnimationOption(t))return e.apply(this,arguments);var i=_normalizeArguments.apply(this,arguments);return i.mode="hide",this.effect.call(this,i)}}(e.fn.hide),toggle:function(e){return function(t){if(standardAnimationOption(t)||"boolean"==typeof t)return e.apply(this,arguments);var i=_normalizeArguments.apply(this,arguments);return i.mode="toggle",this.effect.call(this,i)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),s=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(s=[parseFloat(i),t])}),s}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;e<((t=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return e<.5?i(2*e)/2:1-i(-2*e+2)/2}})}(),e.effects,e.effects.effect.blind=function(t,i){var s,n,o,r=e(this),a=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(r,t.mode||"hide"),h=t.direction||"up",c=/up|down|vertical/.test(h),d=c?"height":"width",u=c?"top":"left",p=/up|left|vertical|horizontal/.test(h),g={},m="show"===l;r.parent().is(".ui-effects-wrapper")?e.effects.save(r.parent(),a):e.effects.save(r,a),r.show(),s=e.effects.createWrapper(r).css({overflow:"hidden"}),n=s[d](),o=parseFloat(s.css(u))||0,g[d]=m?n:0,p||(r.css(c?"bottom":"right",0).css(c?"top":"left","auto").css({position:"absolute"}),g[u]=m?o:n+o),m&&(s.css(d,0),p||s.css(u,o+n)),s.animate(g,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){"hide"===l&&r.hide(),e.effects.restore(r,a),e.effects.removeWrapper(r),i()}})},e.effects.effect.bounce=function(t,i){var s,n,o,r=e(this),a=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(r,t.mode||"effect"),h="hide"===l,c="show"===l,d=t.direction||"up",u=t.distance,p=t.times||5,g=2*p+(c||h?1:0),m=t.duration/g,f=t.easing,_="up"===d||"down"===d?"top":"left",v="up"===d||"left"===d,y=r.queue(),b=y.length;for((c||h)&&a.push("opacity"),e.effects.save(r,a),r.show(),e.effects.createWrapper(r),u||(u=r["top"===_?"outerHeight":"outerWidth"]()/3),c&&((o={opacity:1})[_]=0,r.css("opacity",0).css(_,v?2*-u:2*u).animate(o,m,f)),h&&(u/=Math.pow(2,p-1)),(o={})[_]=0,s=0;s<p;s++)(n={})[_]=(v?"-=":"+=")+u,r.animate(n,m,f).animate(o,m,f),u=h?2*u:u/2;h&&((n={opacity:0})[_]=(v?"-=":"+=")+u,r.animate(n,m,f)),r.queue(function(){h&&r.hide(),e.effects.restore(r,a),e.effects.removeWrapper(r),i()}),b>1&&y.splice.apply(y,[1,0].concat(y.splice(b,g+1))),r.dequeue()},e.effects.effect.clip=function(t,i){var s,n,o,r=e(this),a=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(r,t.mode||"hide"),h="show"===l,c=t.direction||"vertical",d="vertical"===c,u=d?"height":"width",p=d?"top":"left",g={};e.effects.save(r,a),r.show(),s=e.effects.createWrapper(r).css({overflow:"hidden"}),n="IMG"===r[0].tagName?s:r,o=n[u](),h&&(n.css(u,0),n.css(p,o/2)),g[u]=h?o:0,g[p]=h?0:o/2,n.animate(g,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){h||r.hide(),e.effects.restore(r,a),e.effects.removeWrapper(r),i()}})},e.effects.effect.drop=function(t,i){var s,n=e(this),o=["position","top","bottom","left","right","opacity","height","width"],r=e.effects.setMode(n,t.mode||"hide"),a="show"===r,l=t.direction||"left",h="up"===l||"down"===l?"top":"left",c="up"===l||"left"===l?"pos":"neg",d={opacity:a?1:0};e.effects.save(n,o),n.show(),e.effects.createWrapper(n),s=t.distance||n["top"===h?"outerHeight":"outerWidth"](!0)/2,a&&n.css("opacity",0).css(h,"pos"===c?-s:s),d[h]=(a?"pos"===c?"+=":"-=":"pos"===c?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===r&&n.hide(),e.effects.restore(n,o),e.effects.removeWrapper(n),i()}})},e.effects.effect.explode=function(t,i){var s,n,o,r,a,l,h=t.pieces?Math.round(Math.sqrt(t.pieces)):3,c=h,d=e(this),u=e.effects.setMode(d,t.mode||"hide"),p="show"===u,g=d.show().css("visibility","hidden").offset(),m=Math.ceil(d.outerWidth()/c),f=Math.ceil(d.outerHeight()/h),_=[];function childComplete(){_.push(this),_.length===h*c&&function animComplete(){d.css({visibility:"visible"}),e(_).remove(),p||d.hide(),i()}()}for(s=0;s<h;s++)for(r=g.top+s*f,l=s-(h-1)/2,n=0;n<c;n++)o=g.left+n*m,a=n-(c-1)/2,d.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-n*m,top:-s*f}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:m,height:f,left:o+(p?a*m:0),top:r+(p?l*f:0),opacity:p?0:1}).animate({left:o+(p?0:a*m),top:r+(p?0:l*f),opacity:p?1:0},t.duration||500,t.easing,childComplete)},e.effects.effect.fade=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"toggle");s.animate({opacity:n},{queue:!1,duration:t.duration,easing:t.easing,complete:i})},e.effects.effect.fold=function(t,i){var s,n,o=e(this),r=["position","top","bottom","left","right","height","width"],a=e.effects.setMode(o,t.mode||"hide"),l="show"===a,h="hide"===a,c=t.size||15,d=/([0-9]+)%/.exec(c),u=!!t.horizFirst,p=l!==u,g=p?["width","height"]:["height","width"],m=t.duration/2,f={},_={};e.effects.save(o,r),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),n=p?[s.width(),s.height()]:[s.height(),s.width()],d&&(c=parseInt(d[1],10)/100*n[h?0:1]),l&&s.css(u?{height:0,width:c}:{height:c,width:0}),f[g[0]]=l?n[0]:c,_[g[1]]=l?n[1]:0,s.animate(f,m,t.easing).animate(_,m,t.easing,function(){h&&o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()})},e.effects.effect.highlight=function(t,i){var s=e(this),n=["backgroundImage","backgroundColor","opacity"],o=e.effects.setMode(s,t.mode||"show"),r={backgroundColor:s.css("backgroundColor")};"hide"===o&&(r.opacity=0),e.effects.save(s,n),s.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(r,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&s.hide(),e.effects.restore(s,n),i()}})},e.effects.effect.size=function(t,i){var s,n,o,r=e(this),a=["position","top","bottom","left","right","width","height","overflow","opacity"],l=["width","height","overflow"],h=["fontSize"],c=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],d=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],u=e.effects.setMode(r,t.mode||"effect"),p=t.restore||"effect"!==u,g=t.scale||"both",m=t.origin||["middle","center"],f=r.css("position"),_=p?a:["position","top","bottom","left","right","overflow","opacity"],v={height:0,width:0,outerHeight:0,outerWidth:0};"show"===u&&r.show(),s={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()},"toggle"===t.mode&&"show"===u?(r.from=t.to||v,r.to=t.from||s):(r.from=t.from||("show"===u?v:s),r.to=t.to||("hide"===u?v:s)),o={from:{y:r.from.height/s.height,x:r.from.width/s.width},to:{y:r.to.height/s.height,x:r.to.width/s.width}},"box"!==g&&"both"!==g||(o.from.y!==o.to.y&&(_=_.concat(c),r.from=e.effects.setTransition(r,c,o.from.y,r.from),r.to=e.effects.setTransition(r,c,o.to.y,r.to)),o.from.x!==o.to.x&&(_=_.concat(d),r.from=e.effects.setTransition(r,d,o.from.x,r.from),r.to=e.effects.setTransition(r,d,o.to.x,r.to))),"content"!==g&&"both"!==g||o.from.y!==o.to.y&&(_=_.concat(h).concat(l),r.from=e.effects.setTransition(r,h,o.from.y,r.from),r.to=e.effects.setTransition(r,h,o.to.y,r.to)),e.effects.save(r,_),r.show(),e.effects.createWrapper(r),r.css("overflow","hidden").css(r.from),m&&(n=e.effects.getBaseline(m,s),r.from.top=(s.outerHeight-r.outerHeight())*n.y,r.from.left=(s.outerWidth-r.outerWidth())*n.x,r.to.top=(s.outerHeight-r.to.outerHeight)*n.y,r.to.left=(s.outerWidth-r.to.outerWidth)*n.x),r.css(r.from),"content"!==g&&"both"!==g||(c=c.concat(["marginTop","marginBottom"]).concat(h),d=d.concat(["marginLeft","marginRight"]),l=a.concat(c).concat(d),r.find("*[width]").each(function(){var i=e(this),s={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};p&&e.effects.save(i,l),i.from={height:s.height*o.from.y,width:s.width*o.from.x,outerHeight:s.outerHeight*o.from.y,outerWidth:s.outerWidth*o.from.x},i.to={height:s.height*o.to.y,width:s.width*o.to.x,outerHeight:s.height*o.to.y,outerWidth:s.width*o.to.x},o.from.y!==o.to.y&&(i.from=e.effects.setTransition(i,c,o.from.y,i.from),i.to=e.effects.setTransition(i,c,o.to.y,i.to)),o.from.x!==o.to.x&&(i.from=e.effects.setTransition(i,d,o.from.x,i.from),i.to=e.effects.setTransition(i,d,o.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,function(){p&&e.effects.restore(i,l)})})),r.animate(r.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===r.to.opacity&&r.css("opacity",r.from.opacity),"hide"===u&&r.hide(),e.effects.restore(r,_),p||("static"===f?r.css({position:"relative",top:r.to.top,left:r.to.left}):e.each(["top","left"],function(e,t){r.css(t,function(t,i){var s=parseInt(i,10),n=e?r.to.left:r.to.top;return"auto"===i?n+"px":s+n+"px"})})),e.effects.removeWrapper(r),i()}})},e.effects.effect.scale=function(t,i){var s=e(this),n=e.extend(!0,{},t),o=e.effects.setMode(s,t.mode||"effect"),r=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"hide"===o?0:100),a=t.direction||"both",l=t.origin,h={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},c={y:"horizontal"!==a?r/100:1,x:"vertical"!==a?r/100:1};n.effect="size",n.queue=!1,n.complete=i,"effect"!==o&&(n.origin=l||["middle","center"],n.restore=!0),n.from=t.from||("show"===o?{height:0,width:0,outerHeight:0,outerWidth:0}:h),n.to={height:h.height*c.y,width:h.width*c.x,outerHeight:h.outerHeight*c.y,outerWidth:h.outerWidth*c.x},n.fade&&("show"===o&&(n.from.opacity=0,n.to.opacity=1),"hide"===o&&(n.from.opacity=1,n.to.opacity=0)),s.effect(n)},e.effects.effect.puff=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"hide"),o="hide"===n,r=parseInt(t.percent,10)||150,a=r/100,l={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:n,complete:i,percent:o?r:100,from:o?l:{height:l.height*a,width:l.width*a,outerHeight:l.outerHeight*a,outerWidth:l.outerWidth*a}}),s.effect(t)},e.effects.effect.pulsate=function(t,i){var s,n=e(this),o=e.effects.setMode(n,t.mode||"show"),r="show"===o,a="hide"===o,l=r||"hide"===o,h=2*(t.times||5)+(l?1:0),c=t.duration/h,d=0,u=n.queue(),p=u.length;for(!r&&n.is(":visible")||(n.css("opacity",0).show(),d=1),s=1;s<h;s++)n.animate({opacity:d},c,t.easing),d=1-d;n.animate({opacity:d},c,t.easing),n.queue(function(){a&&n.hide(),i()}),p>1&&u.splice.apply(u,[1,0].concat(u.splice(p,h+1))),n.dequeue()},e.effects.effect.shake=function(t,i){var s,n=e(this),o=["position","top","bottom","left","right","height","width"],r=e.effects.setMode(n,t.mode||"effect"),a=t.direction||"left",l=t.distance||20,h=t.times||3,c=2*h+1,d=Math.round(t.duration/c),u="up"===a||"down"===a?"top":"left",p="up"===a||"left"===a,g={},m={},f={},_=n.queue(),v=_.length;for(e.effects.save(n,o),n.show(),e.effects.createWrapper(n),g[u]=(p?"-=":"+=")+l,m[u]=(p?"+=":"-=")+2*l,f[u]=(p?"-=":"+=")+2*l,n.animate(g,d,t.easing),s=1;s<h;s++)n.animate(m,d,t.easing).animate(f,d,t.easing);n.animate(m,d,t.easing).animate(g,d/2,t.easing).queue(function(){"hide"===r&&n.hide(),e.effects.restore(n,o),e.effects.removeWrapper(n),i()}),v>1&&_.splice.apply(_,[1,0].concat(_.splice(v,c+1))),n.dequeue()},e.effects.effect.slide=function(t,i){var s,n=e(this),o=["position","top","bottom","left","right","width","height"],r=e.effects.setMode(n,t.mode||"show"),a="show"===r,l=t.direction||"left",h="up"===l||"down"===l?"top":"left",c="up"===l||"left"===l,d={};e.effects.save(n,o),n.show(),s=t.distance||n["top"===h?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(n).css({overflow:"hidden"}),a&&n.css(h,c?isNaN(s)?"-"+s:-s:s),d[h]=(a?c?"+=":"-=":c?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===r&&n.hide(),e.effects.restore(n,o),e.effects.removeWrapper(n),i()}})},e.effects.effect.transfer=function(t,i){var s=e(this),n=e(t.to),o="fixed"===n.css("position"),r=e("body"),a=o?r.scrollTop():0,l=o?r.scrollLeft():0,h=n.offset(),c={top:h.top-a,left:h.left-l,height:n.innerHeight(),width:n.innerWidth()},d=s.offset(),u=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:d.top-a,left:d.left-l,height:s.innerHeight(),width:s.innerWidth(),position:o?"fixed":"absolute"}).animate(c,t.duration,t.easing,function(){u.remove(),i()})},e.widget("ui.progressbar",{version:"1.11.4",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){if(void 0===e)return this.options.value;this.options.value=this._constrainedValue(e),this._refreshValue()},_constrainedValue:function(e){return void 0===e&&(e=this.options.value),this.indeterminate=!1===e,"number"!=typeof e&&(e=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}}),e.widget("ui.selectable",e.ui.mouse,{version:"1.11.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){(t=e(i.options.filter,i.element[0])).addClass("ui-selectee"),t.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this,s=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(s.filter,this.element[0]),this._trigger("start",t),e(s.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=e.data(this,"selectable-item");s.startselected=!0,t.metaKey||t.ctrlKey||(s.$element.removeClass("ui-selected"),s.selected=!1,s.$element.addClass("ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",t,{unselecting:s.element}))}),e(t.target).parents().addBack().each(function(){var s,n=e.data(this,"selectable-item");if(n)return s=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected"),n.$element.removeClass(s?"ui-unselecting":"ui-selected").addClass(s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",t,{selecting:n.element}):i._trigger("unselecting",t,{unselecting:n.element}),!1}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],r=this.opos[1],a=t.pageX,l=t.pageY;return o>a&&(i=a,a=o,o=i),r>l&&(i=l,l=r,r=i),this.helper.css({left:o,top:r,width:a-o,height:l-r}),this.selectees.each(function(){var i=e.data(this,"selectable-item"),h=!1;i&&i.element!==s.element[0]&&("touch"===n.tolerance?h=!(i.left>a||i.right<o||i.top>l||i.bottom<r):"fit"===n.tolerance&&(h=i.left>o&&i.right<a&&i.top>r&&i.bottom<l),h?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,s._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",t,{unselecting:i.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",t,{unselected:s.element})}),e(".ui-selecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-selecting").addClass("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",t,{selected:s.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),e.widget("ui.selectmenu",{version:"1.11.4",defaultElement:"<select>",options:{appendTo:null,disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:null,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this.options.disabled&&this.disable()},_drawButton:function(){var t=this;this.label=e("label[for='"+this.ids.element+"']").attr("for",this.ids.button),this._on(this.label,{click:function(e){this.button.focus(),e.preventDefault()}}),this.element.hide(),this.button=e("<span>",{class:"ui-selectmenu-button ui-widget ui-state-default ui-corner-all",tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true"}).insertAfter(this.element),e("<span>",{class:"ui-icon "+this.options.icons.button}).prependTo(this.button),this.buttonText=e("<span>",{class:"ui-selectmenu-text"}).appendTo(this.button),this._setText(this.buttonText,this.element.find("option:selected").text()),this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){t.menuItems||t._refreshMenu()}),this._hoverable(this.button),this._focusable(this.button)},_drawMenu:function(){var t=this;this.menu=e("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=e("<div>",{class:"ui-selectmenu-menu ui-front"}).append(this.menu).appendTo(this._appendTo()),this.menuInstance=this.menu.menu({role:"listbox",select:function(e,i){e.preventDefault(),t._setSelection(),t._select(i.item.data("ui-selectmenu-item"),e)},focus:function(e,i){var s=i.item.data("ui-selectmenu-item");null!=t.focusIndex&&s.index!==t.focusIndex&&(t._trigger("focus",e,{item:s}),t.isOpen||t._select(s,e)),t.focusIndex=s.index,t.button.attr("aria-activedescendant",t.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menu.addClass("ui-corner-bottom").removeClass("ui-corner-all"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this._setText(this.buttonText,this._getSelectedItem().text()),this.options.width||this._resizeButton()},_refreshMenu:function(){this.menu.empty();var e,t=this.element.find("option");t.length&&(this._parseOptions(t),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup"),e=this._getSelectedItem(),this.menuInstance.focus(null,e),this._setAria(e.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(e){this.options.disabled||(this.menuItems?(this.menu.find(".ui-state-focus").removeClass("ui-state-focus"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",e))},_position:function(){this.menuWrap.position(e.extend({of:this.button},this.options.position))},close:function(e){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",e))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderMenu:function(t,i){var s=this,n="";e.each(i,function(i,o){o.optgroup!==n&&(e("<li>",{class:"ui-selectmenu-optgroup ui-menu-divider"+(o.element.parent("optgroup").prop("disabled")?" ui-state-disabled":""),text:o.optgroup}).appendTo(t),n=o.optgroup),s._renderItemData(t,o)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-selectmenu-item",t)},_renderItem:function(t,i){var s=e("<li>");return i.disabled&&s.addClass("ui-state-disabled"),this._setText(s,i.label),s.appendTo(t)},_setText:function(e,t){t?e.text(t):e.html("&#160;")},_move:function(e,t){var i,s,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex):(i=this.menuItems.eq(this.element[0].selectedIndex),n+=":not(.ui-state-disabled)"),(s="first"===e||"last"===e?i["first"===e?"prevAll":"nextAll"](n).eq(-1):i[e+"All"](n).eq(0)).length&&this.menuInstance.focus(t,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex)},_toggle:function(e){this[this.isOpen?"close":"open"](e)},_setSelection:function(){var e;this.range&&(window.getSelection?((e=window.getSelection()).removeAllRanges(),e.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(t){this.isOpen&&(e(t.target).closest(".ui-selectmenu-menu, #"+this.ids.button).length||this.close(t))}},_buttonEvents:{mousedown:function(){var e;window.getSelection?(e=window.getSelection()).rangeCount&&(this.range=e.getRangeAt(0)):this.range=document.selection.createRange()},click:function(e){this._setSelection(),this._toggle(e)},keydown:function(t){var i=!0;switch(t.keyCode){case e.ui.keyCode.TAB:case e.ui.keyCode.ESCAPE:this.close(t),i=!1;break;case e.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(t);break;case e.ui.keyCode.UP:t.altKey?this._toggle(t):this._move("prev",t);break;case e.ui.keyCode.DOWN:t.altKey?this._toggle(t):this._move("next",t);break;case e.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(t):this._toggle(t);break;case e.ui.keyCode.LEFT:this._move("prev",t);break;case e.ui.keyCode.RIGHT:this._move("next",t);break;case e.ui.keyCode.HOME:case e.ui.keyCode.PAGE_UP:this._move("first",t);break;case e.ui.keyCode.END:case e.ui.keyCode.PAGE_DOWN:this._move("last",t);break;default:this.menu.trigger(t),i=!1}i&&t.preventDefault()}},_selectFocusedItem:function(e){var t=this.menuItems.eq(this.focusIndex);t.hasClass("ui-state-disabled")||this._select(t.data("ui-selectmenu-item"),e)},_select:function(e,t){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=e.index,this._setText(this.buttonText,e.label),this._setAria(e),this._trigger("select",t,{item:e}),e.index!==i&&this._trigger("change",t,{item:e}),this.close(t)},_setAria:function(e){var t=this.menuItems.eq(e.index).attr("id");this.button.attr({"aria-labelledby":t,"aria-activedescendant":t}),this.menu.attr("aria-activedescendant",t)},_setOption:function(e,t){"icons"===e&&this.button.find("span.ui-icon").removeClass(this.options.icons.button).addClass(t.button),this._super(e,t),"appendTo"===e&&this.menuWrap.appendTo(this._appendTo()),"disabled"===e&&(this.menuInstance.option("disabled",t),this.button.toggleClass("ui-state-disabled",t).attr("aria-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)),"width"===e&&this._resizeButton()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_toggleAttr:function(){this.button.toggleClass("ui-corner-top",this.isOpen).toggleClass("ui-corner-all",!this.isOpen).attr("aria-expanded",this.isOpen),this.menuWrap.toggleClass("ui-selectmenu-open",this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var e=this.options.width;e||(e=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(e)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){return{disabled:this.element.prop("disabled")}},_parseOptions:function(t){var i=[];t.each(function(t,s){var n=e(s),o=n.parent("optgroup");i.push({element:n,index:t,value:n.val(),label:n.text(),optgroup:o.attr("label")||"",disabled:o.prop("disabled")||n.prop("disabled")})}),this.items=i},_destroy:function(){this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.label.attr("for",this.ids.element)}}),e.widget("ui.slider",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,s=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),t=n.length;t<i;t++)o.push("<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>");this.handles=n.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,i="";t.range?(!0===t.range&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,s,n,o,r,a,l,h=this,c=this.options;return!c.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(s-h.values(t));(n>i||n===i&&(t===h._lastChangedValue||h.values(t)===c.min))&&(n=i,o=e(this),r=t)}),!1!==this._start(t,r)&&(this._mouseSliding=!0,this._handleIndex=r,o.addClass("ui-state-active").focus(),a=o.offset(),l=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:t.pageX-a.left-o.width()/2,top:t.pageY-a.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,r,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,s,n,o;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),(s=i/t)>1&&(s=1),s<0&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),o=this._valueMin()+s*n,this._trimAlignValue(o)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var s,n,o;this.options.values&&this.options.values.length?(s=this.values(t?0:1),2===this.options.values.length&&!0===this.options.range&&(0===t&&i>s||1===t&&i<s)&&(i=s),i!==this.values(t)&&((n=this.values())[t]=i,o=this._trigger("slide",e,{handle:this.handles[t],value:i,values:n}),s=this.values(t?0:1),!1!==o&&this.values(t,i))):i!==this.value()&&!1!==(o=this._trigger("slide",e,{handle:this.handles[t],value:i}))&&this.value(i)},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(t,i){var s,n,o;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,t);if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(s=this.options.values,n=arguments[0],o=0;o<s.length;o+=1)s[o]=this._trimAlignValue(n[o]),this._change(null,o);this._refreshValue()},_setOption:function(t,i){var s,n=0;switch("range"===t&&!0===this.options.range&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(n=this.options.values.length),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!i),this._super(t,i),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=0;s<n;s+=1)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,s;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),s=0;s<i.length;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,s=e-i;return 2*Math.abs(i)>=t&&(s+=i>0?t:-t),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var e=this.options.max,t=this._valueMin(),i=this.options.step,s=Math.floor(+(e-t).toFixed(this._precision())/i)*i;e=s+t,this.max=parseFloat(e.toFixed(this._precision()))},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),i=t.indexOf(".");return-1===i?0:t.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshValue:function(){var t,i,s,n,o,r=this.options.range,a=this.options,l=this,h=!this._animateOff&&a.animate,c={};this.options.values&&this.options.values.length?this.handles.each(function(s){i=(l.values(s)-l._valueMin())/(l._valueMax()-l._valueMin())*100,c["horizontal"===l.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[h?"animate":"css"](c,a.animate),!0===l.options.range&&("horizontal"===l.orientation?(0===s&&l.range.stop(1,1)[h?"animate":"css"]({left:i+"%"},a.animate),1===s&&l.range[h?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:a.animate})):(0===s&&l.range.stop(1,1)[h?"animate":"css"]({bottom:i+"%"},a.animate),1===s&&l.range[h?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:a.animate}))),t=i}):(s=this.value(),n=this._valueMin(),o=this._valueMax(),i=o!==n?(s-n)/(o-n)*100:0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[h?"animate":"css"](c,a.animate),"min"===r&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:i+"%"},a.animate),"max"===r&&"horizontal"===this.orientation&&this.range[h?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:a.animate}),"min"===r&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:i+"%"},a.animate),"max"===r&&"vertical"===this.orientation&&this.range[h?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:a.animate}))},_handleEvents:{keydown:function(t){var i,s,n,o=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(t.target).addClass("ui-state-active"),!1===this._start(t,o)))return}switch(n=this.options.step,i=s=this.options.values&&this.options.values.length?this.values(o):this.value(),t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;s=this._trimAlignValue(i+n);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;s=this._trimAlignValue(i-n)}this._slide(t,o,s)},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&e<t+i},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var s=null,n=!1,o=this;return!(this.reverting||this.options.disabled||"static"===this.options.type||(this._refreshItems(t),e(t.target).parents().each(function(){if(e.data(this,o.widgetName+"-item")===o)return s=e(this),!1}),e.data(t.target,o.widgetName+"-item")===o&&(s=e(t.target)),!s||this.options.handle&&!i&&(e(this.options.handle,s).find("*").addBack().each(function(){this===t.target&&(n=!0)}),!n)||(this.currentItem=s,this._removeCurrentsFromItems(),0)))},_mouseStart:function(t,i,s){var n,o,r=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,r.cursorAt&&this._adjustOffsetFromHelper(r.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),r.containment&&this._setContainment(),r.cursor&&"auto"!==r.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",r.cursor),this.storedStylesheet=e("<style>*{ cursor: "+r.cursor+" !important; }</style>").appendTo(o)),r.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",r.opacity)),r.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",r.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,s,n,o,r=this.options,a=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<r.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+r.scrollSpeed:t.pageY-this.overflowOffset.top<r.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-r.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<r.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+r.scrollSpeed:t.pageX-this.overflowOffset.left<r.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-r.scrollSpeed)):(t.pageY-this.document.scrollTop()<r.scrollSensitivity?a=this.document.scrollTop(this.document.scrollTop()-r.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<r.scrollSensitivity&&(a=this.document.scrollTop(this.document.scrollTop()+r.scrollSpeed)),t.pageX-this.document.scrollLeft()<r.scrollSensitivity?a=this.document.scrollLeft(this.document.scrollLeft()-r.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<r.scrollSensitivity&&(a=this.document.scrollLeft(this.document.scrollLeft()+r.scrollSpeed))),!1!==a&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],(o=this._intersectsWithPointer(s))&&s.instance===this.currentContainer&&!(n===this.currentItem[0]||this.placeholder[1===o?"next":"prev"]()[0]===n||e.contains(this.placeholder[0],n)||"semi-dynamic"===this.options.type&&e.contains(this.element[0],n))){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,r={};o&&"x"!==o||(r.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(r.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(r,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+"="),s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=e.left,r=o+e.width,a=e.top,l=a+e.height,h=this.offset.click.top,c=this.offset.click.left,d="x"===this.options.axis||s+h>a&&s+h<l,u="y"===this.options.axis||t+c>o&&t+c<r,p=d&&u;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:o<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<r&&a<s+this.helperProportions.height/2&&n-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=t&&i,n=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return!!s&&(this.floating?o&&"right"===o||"down"===n?2:1:n&&("down"===n?2:1))},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&t||"up"===s&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i,s,n,o,r=[],a=[],l=this._connectWith();if(l&&t)for(i=l.length-1;i>=0;i--)for(n=e(l[i],this.document[0]),s=n.length-1;s>=0;s--)(o=e.data(n[s],this.widgetFullName))&&o!==this&&!o.options.disabled&&a.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);function addItems(){r.push(this)}for(a.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=a.length-1;i>=0;i--)a[i][0].each(addItems);return e(r)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;i<t.length;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,n,o,r,a,l,h,c=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],u=this._connectWith();if(u&&this.ready)for(i=u.length-1;i>=0;i--)for(n=e(u[i],this.document[0]),s=n.length-1;s>=0;s--)(o=e.data(n[s],this.widgetFullName))&&o!==this&&!o.options.disabled&&(d.push([e.isFunction(o.options.items)?o.options.items.call(o.element[0],t,{item:this.currentItem}):e(o.options.items,o.element),o]),this.containers.push(o));for(i=d.length-1;i>=0;i--)for(r=d[i][1],a=d[i][0],s=0,h=a.length;s<h;s++)(l=e(a[s])).data(this.widgetName+"-item",r),c.push({item:l,instance:r,width:0,height:0,left:0,top:0})},refreshPositions:function(t){var i,s,n,o;for(this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),i=this.items.length-1;i>=0;i--)(s=this.items[i]).instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){var i,s=(t=t||this).options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+s+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===s?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(n)):"tr"===s?t._createTrPlaceholder(t.currentItem,n):"img"===s&&n.attr("src",t.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(e,n){i&&!s.forcePlaceholderSize||(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,i){var s=this;t.children().each(function(){e("<td>&#160;</td>",s.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(t){var i,s,n,o,r,a,l,h,c,d,u=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(u&&e.contains(this.containers[i].element[0],u.element[0]))continue;u=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(u)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,c=u.floating||this._isFloating(this.currentItem),r=c?"left":"top",a=c?"width":"height",d=c?"clientX":"clientY",s=this.items.length-1;s>=0;s--)e.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(l=this.items[s].item.offset()[r],h=!1,t[d]-l>this.items[s][a]/2&&(h=!0),Math.abs(t[d]-l)<n&&(n=Math.abs(t[d]-l),o=this.items[s],this.direction=h?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return void(this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1));o?this._rearrange(t,o,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),s[0].style.width&&!i.forceHelperSize||s.width(this.currentItem.width()),s[0].style.height&&!i.forceHelperSize||s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),"document"!==n.containment&&"window"!==n.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],i=e(n.containment).offset(),s="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(t){var i,s,n=this.options,o=t.pageX,r=t.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(r=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(r=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((r-this.originalPageY)/n.grid[1])*n.grid[1],r=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:a.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:a.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(e,t){this.reverting=!1;var i,s=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)"auto"!==this._storedCSS[i]&&"static"!==this._storedCSS[i]||(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();function delayEvent(e,t,i){return function(s){i._trigger(e,s,t._uiHash(t))}}for(this.fromOutside&&!t&&s.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||s.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(s.push(function(e){this._trigger("remove",e,this._uiHash())}),s.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),s.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)t||s.push(delayEvent("deactivate",this,this.containers[i])),this.containers[i].containerCache.over&&(s.push(delayEvent("out",this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(i=0;i<s.length;i++)s[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){!1===e.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}}),e.widget("ui.spinner",{version:"1.11.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t={},i=this.element;return e.each(["min","max","step"],function(e,s){var n=i.attr(s);void 0!==n&&n.length&&(t[s]=n)}),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){this.cancelBlur?delete this.cancelBlur:(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e))},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()}},"mousedown .ui-spinner-button":function(t){var i;function checkFocus(){var e=this.element[0]===this.document[0].activeElement;e||(this.element.focus(),this.previous=i,this._delay(function(){this.previous=i}))}i=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),checkFocus.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,checkFocus.call(this)}),!1!==this._start(t)&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){if(e(t.currentTarget).hasClass("ui-state-active"))return!1!==this._start(t)&&void this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*e.height())&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable()},_keydown:function(t){var i=this.options,s=e.ui.keyCode;switch(t.keyCode){case s.UP:return this._repeat(null,1,t),!0;case s.DOWN:return this._repeat(null,-1,t),!0;case s.PAGE_UP:return this._repeat(null,i.page,t),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,t),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(e){return!(!this.spinning&&!1===this._trigger("start",e)||(this.counter||(this.counter=1),this.spinning=!0,0))},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",t,{value:i})||(this._value(i),this.counter++)},_increment:function(t){var i=this.options.incremental;return i?e.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),i=t.indexOf(".");return-1===i?0:t.length-i-1},_adjustValue:function(e){var t,i,s=this.options;return t=null!==s.min?s.min:0,i=e-t,i=Math.round(i/s.step)*s.step,e=t+i,e=parseFloat(e.toFixed(this._precision())),null!==s.max&&e>s.max?s.max:null!==s.min&&e<s.min?s.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){if("culture"===e||"numberFormat"===e){var i=this._parse(this.element.val());return this.options[e]=t,void this.element.val(this._format(i))}"max"!==e&&"min"!==e&&"step"!==e||"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),"disabled"===e&&(this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable"))},_setOptions:spinner_modifier(function(e){this._super(e)}),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var e=this.value();return null!==e&&e===this._adjustValue(e)},_value:function(e,t){var i;""!==e&&null!==(i=this._parse(e))&&(t||(i=this._adjustValue(i)),e=this._format(i)),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:spinner_modifier(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:spinner_modifier(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:spinner_modifier(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:spinner_modifier(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){if(!arguments.length)return this._parse(this.element.val());spinner_modifier(this._value).call(this,e)},widget:function(){return this.uiSpinner}}),e.widget("ui.tabs",{version:"1.11.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var e=/#.*$/;return function(t){var i,s;t=t.cloneNode(!1),i=t.href.replace(e,""),s=location.href.replace(e,"");try{i=decodeURIComponent(i)}catch(e){}try{s=decodeURIComponent(s)}catch(e){}return t.hash.length>1&&i===s}}(),_create:function(){var t=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible),this._processTabs(),i.active=this._initialActive(),e.isArray(i.disabled)&&(i.disabled=e.unique(i.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),!1!==this.options.active&&this.anchors.length?this.active=this._findActive(i.active):this.active=e(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var t=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===t&&(s&&this.tabs.each(function(i,n){if(e(n).attr("aria-controls")===s)return t=i,!1}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),null!==t&&-1!==t||(t=!!this.tabs.length&&0)),!1!==t&&-1===(t=this.tabs.index(this.tabs.eq(t)))&&(t=!i&&0),!i&&!1===t&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var i=e(this.document[0].activeElement).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:s++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:n=!1,s--;break;case e.ui.keyCode.END:s=this.anchors.length-1;break;case e.ui.keyCode.HOME:s=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),void this._activate(s);case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),void this._activate(s!==this.options.active&&s);default:return}t.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),t.ctrlKey||t.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,i){var s=this.tabs.length-1;for(;-1!==e.inArray((t>s&&(t=0),t<0&&(t=s),t),this.options.disabled);)t=i?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){"active"!==e?"disabled"!==e?(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||!1!==this.options.active||this._activate(0)),"event"===e&&this._setupEvents(t),"heightStyle"===e&&this._setupHeightStyle(t)):this._setupDisabled(t):this._activate(t)},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,i=this.tablist.children(":has(a[href])");t.disabled=e.map(i.filter(".ui-state-disabled"),function(e){return i.index(e)}),this._processTabs(),!1!==t.active&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this,i=this.tabs,s=this.anchors,n=this.panels;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(i,s){var n,o,r,a=e(s).uniqueId().attr("id"),l=e(s).closest("li"),h=l.attr("aria-controls");t._isLocal(s)?(n=s.hash,r=n.substring(1),o=t.element.find(t._sanitizeSelector(n))):(r=l.attr("aria-controls")||e({}).uniqueId()[0].id,n="#"+r,(o=t.element.find(n)).length||(o=t._createPanel(r)).insertAfter(t.panels[i-1]||t.tablist),o.attr("aria-live","polite")),o.length&&(t.panels=t.panels.add(o)),h&&l.data("ui-tabs-aria-controls",h),l.attr({"aria-controls":r,"aria-labelledby":a}),o.attr("aria-labelledby",a)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var i,s=0;i=this.tabs[s];s++)!0===t||-1!==e.inArray(s,t)?e(i).addClass("ui-state-disabled").attr("aria-disabled","true"):e(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var i={};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(e){e.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,s=this.element.parent();"fill"===t?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),s=t.css("position");"absolute"!==s&&"fixed"!==s&&(i-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(i=0,this.panels.each(function(){i=Math.max(i,e(this).height("").height())}).height(i))},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),o=n.closest("li"),r=o[0]===s[0],a=r&&i.collapsible,l=a?e():this._getPanelForTab(o),h=s.length?this._getPanelForTab(s):e(),c={oldTab:s,oldPanel:h,newTab:a?e():o,newPanel:l};t.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||r&&!i.collapsible||!1===this._trigger("beforeActivate",t,c)||(i.active=!a&&this.tabs.index(o),this.active=r?e():o,this.xhr&&this.xhr.abort(),h.length||l.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(o),t),this._toggle(t,c))},_toggle:function(t,i){var s=this,n=i.newPanel,o=i.oldPanel;function complete(){s.running=!1,s._trigger("activate",t,i)}function show(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),n.length&&s.options.show?s._show(n,s.options.show,complete):(n.show(),complete())}this.running=!0,o.length&&this.options.hide?this._hide(o,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),show()}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),o.hide(),show()),o.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),n.length&&o.length?i.oldTab.attr("tabIndex",-1):n.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),n.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(t){var i,s=this._findActive(t);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return!1===t?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tablist.unbind(this.eventNamespace),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),i=t.data("ui-tabs-aria-controls");i?t.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(t){var i=this.options.disabled;!1!==i&&(void 0===t?i=!1:(t=this._getIndex(t),i=e.isArray(i)?e.map(i,function(e){return e!==t?e:null}):e.map(this.tabs,function(e,i){return i!==t?i:null})),this._setupDisabled(i))},disable:function(t){var i=this.options.disabled;if(!0!==i){if(void 0===t)i=!0;else{if(t=this._getIndex(t),-1!==e.inArray(t,i))return;i=e.isArray(i)?e.merge([t],i).sort():[t]}this._setupDisabled(i)}},load:function(t,i){t=this._getIndex(t);var s=this,n=this.tabs.eq(t),o=n.find(".ui-tabs-anchor"),r=this._getPanelForTab(n),a={tab:n,panel:r},l=function(e,t){"abort"===t&&s.panels.stop(!1,!0),n.removeClass("ui-tabs-loading"),r.removeAttr("aria-busy"),e===s.xhr&&delete s.xhr};this._isLocal(o[0])||(this.xhr=e.ajax(this._ajaxSettings(o,i,a)),this.xhr&&"canceled"!==this.xhr.statusText&&(n.addClass("ui-tabs-loading"),r.attr("aria-busy","true"),this.xhr.done(function(e,t,n){setTimeout(function(){r.html(e),s._trigger("load",i,a),l(n,t)},1)}).fail(function(e,t){setTimeout(function(){l(e,t)},1)})))},_ajaxSettings:function(t,i,s){var n=this;return{url:t.attr("href"),beforeSend:function(t,o){return n._trigger("beforeLoad",i,e.extend({jqXHR:t,ajaxSettings:o},s))}}},_getPanelForTab:function(t){var i=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),e.widget("ui.tooltip",{version:"1.11.4",options:{content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_addDescribedBy:function(t,i){var s=(t.attr("aria-describedby")||"").split(/\s+/);s.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(s.join(" ")))},_removeDescribedBy:function(t){var i=t.data("ui-tooltip-id"),s=(t.attr("aria-describedby")||"").split(/\s+/),n=e.inArray(i,s);-1!==n&&s.splice(n,1),t.removeData("ui-tooltip-id"),(s=e.trim(s.join(" ")))?t.attr("aria-describedby",s):t.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable(),this.liveRegion=e("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body)},_setOption:function(t,i){var s=this;if("disabled"===t)return this[i?"_disable":"_enable"](),void(this.options[t]=i);this._super(t,i),"content"===t&&e.each(this.tooltips,function(e,t){s._updateContent(t.element)})},_disable:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event("blur");n.target=n.currentTarget=s.element[0],t.close(n,!0)}),this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).removeAttr("title")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var i=this,s=e(t?t.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&s.parents().each(function(){var t,s=e(this);s.data("ui-tooltip-open")&&((t=e.Event("blur")).target=t.currentTarget=this,i.close(t,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._registerCloseHandlers(t,s),this._updateContent(s,t))},_updateContent:function(e,t){var i,s=this.options.content,n=this,o=t?t.type:null;if("string"==typeof s)return this._open(t,e,s);(i=s.call(e[0],function(i){n._delay(function(){e.data("ui-tooltip-open")&&(t&&(t.type=o),this._open(t,e,i))})}))&&this._open(t,e,i)},_open:function(t,i,s){var n,o,r,a,l=e.extend({},this.options.position);function position(e){l.of=e,o.is(":hidden")||o.position(l)}s&&((n=this._find(i))?n.tooltip.find(".ui-tooltip-content").html(s):(i.is("[title]")&&(t&&"mouseover"===t.type?i.attr("title",""):i.removeAttr("title")),n=this._tooltip(i),o=n.tooltip,this._addDescribedBy(i,o.attr("id")),o.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),s.clone?(a=s.clone()).removeAttr("id").find("[id]").removeAttr("id"):a=s,e("<div>").html(a).appendTo(this.liveRegion),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:position}),position(t)):o.position(e.extend({of:i},this.options.position)),o.hide(),this._show(o,this.options.show),this.options.show&&this.options.show.delay&&(r=this.delayedShow=setInterval(function(){o.is(":visible")&&(position(l.of),clearInterval(r))},e.fx.interval)),this._trigger("open",t,{tooltip:o})))},_registerCloseHandlers:function(t,i){var s={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var s=e.Event(t);s.currentTarget=i[0],this.close(s,!0)}}};i[0]!==this.element[0]&&(s.remove=function(){this._removeTooltip(this._find(i).tooltip)}),t&&"mouseover"!==t.type||(s.mouseleave="close"),t&&"focusin"!==t.type||(s.focusout="close"),this._on(!0,i,s)},close:function(t){var i,s=this,n=e(t?t.currentTarget:this.element),o=this._find(n);o?(i=o.tooltip,o.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),o.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(e(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,i){e(i.element).attr("title",i.title),delete s.parents[t]}),o.closing=!0,this._trigger("close",t,{tooltip:i}),o.hiding||(o.closing=!1))):n.removeData("ui-tooltip-open")},_tooltip:function(t){var i=e("<div>").attr("role","tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||"")),s=i.uniqueId().attr("id");return e("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),this.tooltips[s]={element:t,tooltip:i}},_find:function(e){var t=e.data("ui-tooltip-id");return t?this.tooltips[t]:null},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event("blur"),o=s.element;n.target=n.currentTarget=o[0],t.close(n,!0),e("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title")||o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}})})?s.apply(t,n):s)||(e.exports=o)},,,,,function(e,t,i){"use strict";var s=i(1),n=i(806),o=i(527);e.exports=s.extend({initialize:function initialize(e){if(!e.createContentView)throw new Error("createContentView factory function is mandatory");if(!e.editorModel)throw new Error("editorModel is required");this.template=this.options.template||n,this._createContentView=e.createContentView,this._editorModel=e.editorModel,this._createControlView=e.createControlView,this._createActionView=e.createActionView,this._infoboxModel=e.infoboxModel,this._infoboxCollection=e.infoboxCollection,this._editorModel.on("change:edition",this._setStyleMenu,this),this.add_related_model(this._editorModel)},render:function render(){var e,t,i,s;return this.clearSubViews(),this.$el.empty(),this.$el.html(this.template()),e=this._createContentView(),this._content().html(e.render().el),this.addView(e),this._infoboxModel&&(s=new o({infoboxModel:this._infoboxModel,infoboxCollection:this._infoboxCollection}),this._info().html(s.render().el),this.addView(s)),this._createControlView&&(t=this._createControlView(),this._controls().html(t.render().el),this.addView(t)),this._createActionView&&(i=this._createActionView(),this._actions().html(i.render().el),this.addView(i)),this._setStyleMenu(),this},_content:function _content(){return this.$(".js-content")},_controls:function _controls(){return this.$(".js-controls")},_actions:function _actions(){return this.$(".js-actions")},_info:function _info(){return this.$(".js-info")},_setStyleMenu:function _setStyleMenu(){this.$(".js-theme").toggleClass("is-dark",this._editorModel.isEditing())}})},function(e,t,i){"use strict";var s=i(0),n=i(621).getVersion("latest"),o=i(340),r={},a=[void 0,null,"",NaN];e.exports={hasType:function hasType(e){return!!n.analyses[e]},paramsForType:function paramsForType(e){if(!this.hasType(e))throw new Error("no analysis params found for type: "+e);return s.clone(n.analyses[e].params)},validate:function validate(e){var t={},i=this.parse(e),n=this.paramsForType(e.type);for(var o in n){var r=n[o],a=i[o];if(!r.optional||void 0!==a)switch(r.type){case"node":a||(t[o]=_t("data.analysis-definition-node-model.validation.invalid-source"));break;case"number":isNaN(a)&&(t[o]=_t("data.analysis-definition-node-model.validation.invalid-value"));break;case"enum":s.contains(r.values,a)||(t[o]=_t("data.analysis-definition-node-model.validation.invalid-enum",{expectedValues:JSON.stringify(r.values)}));break;default:null===a&&(t[o]=_t("data.analysis-definition-node-model.validation.missing-required"))}}if(!s.isEmpty(t))return t},parse:function parse(e){var t=s.extend({},e),i=this.paramsForType(e.type);for(var n in i){var o=i[n],r=t[n];if(o.optional&&s.contains(a,r))delete t[n];else switch(o.type){case"node":t[n]=(r||"").trim();break;case"number":t[n]=parseFloat(r,10);break;case"boolean":t[n]="true"===r||!0===r;break;default:s.contains(a,r)?t[n]=null:s.isString(r)&&(t[n]=r.trim())}}return t},getSourceNamesForAnalysisType:function getSourceNamesForAnalysisType(e){if(!r[e]){var t=[],i=this.paramsForType(e);for(var s in i){"node"===i[s].type&&t.push(s)}r[e]=t}return r[e]},getDefaultCartoCSSForType:function getDefaultCartoCSSForType(){return s.template(["#layer['mapnik::geometry_type'=1] {","  marker-width: <%= point.fill.size.fixed %>;","  marker-fill: <%= point.fill.color.fixed %>;","  marker-fill-opacity: <%= point.fill.color.opacity %>;","  marker-line-color: <%= point.stroke.color.fixed %>;","  marker-line-width: <%= point.stroke.size.fixed %>;","  marker-line-opacity: <%= point.stroke.color.opacity %>;","  marker-type: ellipse;","  marker-allow-overlap: true;","}","#layer['mapnik::geometry_type'=2] {","  line-color: <%= line.stroke.color.fixed %>;","  line-width: <%= line.stroke.size.fixed %>;","  line-opacity: 1;","}","#layer['mapnik::geometry_type'=3] {","  polygon-fill: <%= polygon.fill.color.fixed %>;","  polygon-opacity: <%= polygon.fill.color.opacity %>;","  ::outline {","    line-color: <%= polygon.stroke.color.fixed%>;","    line-width: <%= polygon.stroke.size.fixed %>;","    line-opacity: <%= polygon.stroke.color.opacity %>;","  }","}"].join("\n"))(o.simple)},isValidInputGeometryForType:function isValidInputGeometryForType(e,t){var i=this.getValidInputGeometriesForType(t);return s.contains(i,e)||s.contains(i,"*")},getValidInputGeometriesForType:function getValidInputGeometriesForType(e){var t=this.paramsForType(e),i=[];for(var n in t){var o=t[n];"node"===o.type&&(i=s.union(i,o.geometry))}return i}}},,function(e,t,i){var s=i(0),n=i(250),o=i(5),r={second:{display:"HH:mm:ss",unit:"s"},minute:{display:"HH:mm - MMM Do, YYYY",unit:"m"},hour:{display:"HH:00 - MMM Do, YYYY",unit:"h"},day:{display:"MMM Do, YYYY",unit:"d"},week:{display:"MMM Do, YYYY",unit:"w"},month:{display:"MMM YYYY",unit:"M"},quarter:{display:"[Q]Q YYYY",unit:"Q"},year:{display:"YYYY",unit:"y"},decade:{display:"YYYY",unit:"y"}},a={formatNumber:function(e,t){if(!s.isNumber(e)||0===e)return e;var i=n.format(".2s"),o=0,r=Math.abs(e);if(e>1e3)return e=i(e)+(t?" "+t:"");r>100?o=0:r>10?o=1:r>1?o=2:r>0&&(o=Math.max(Math.ceil(Math.abs(Math.log(r)/Math.log(10)))+2,3));var a=(e=e.toFixed(o)).match(/(\.0+)$/);return a&&(e=e.replace(a[0],"")),e},formatDate:function(e){return n.time.format("%Y-%m-%d")(e)},formatTime:function(e){return n.time.format("%H:%M:%S %d/%m/%Y")(e)},timeFactory:function(e){return n.time.format(e)},formatValue:function(e){return s.isNumber(e)?a.formatNumber(e):s.isDate(e)?a.formatDate(e):e},timestampFactory:function(e,t){return function(i){if(!s.has(r,e))return"-";var n=r[e],a=o.unix(i).utc();return s.isFinite(t)&&a.utcOffset(t/60),a.format(n.display)}}};e.exports=a},,function(e,t,i){"use strict";var s=i(4),n=i(2236);e.exports=n.extend({show:function show(){var e=s.Deferred();return this.delegateEvents(),this.$el.css({marginTop:"down"===this.options.verticalPosition?"-10px":"10px",opacity:0,display:"block"}).animate({margin:"0",opacity:1},{duration:this.options.speedIn,complete:function complete(){e.resolve()}}),this.trigger("onDropdownShown",this.el),e.promise()},openAt:function openAt(e,t){var i=s.Deferred();return this.$el.css({top:t,left:e,width:this.options.width}).addClass(("up"===this.options.verticalPosition?"vertical_top":"vertical_bottom")+" "+("right"===this.options.horizontalPosition?"horizontal_right":"horizontal_left")+" tick_"+this.options.tick),this.modelView.set({open:!0}),s.when(this.show()).done(function(){i.resolve()}),i.promise()},hide:function hide(e){if(this.isOpen){var t=this;this.$el.animate({marginTop:"down"===t.options.verticalPosition?"10px":"-10px",opacity:0},this.options.speedOut,function(){s(t.options.target).removeClass("selected"),t.$el.hide(),e&&e(),t.trigger("onDropdownHidden",t.el)})}else e&&e()}})},function(e,t,i){"use strict";var s=i(2);e.exports=function(e,t,i){this._xhr&&this._xhr.abort();var n=this._xhr=s.Model.prototype.sync.apply(this,arguments);return n.always(function(){t._xhr=null}),n}},function(e,t,i){"use strict";var s=i(0),n=i(4),o=window.MutationObserver,r=8,a=8,l=function Manager(e,t,i){this.id=e,this.reference=t,this.popup=i,this.state={position:"bottom",scroll:0},i.attr("data-cid",e),i.attr("data-dialog",e)};l.prototype={append:function append(e){this.mode=e;var t=this.popup.get(0),i=this.reference.get(0);"float"===e?document.body.appendChild(t):i.appendChild(t)},track:function track(){"float"===this.mode&&(this.observer=function initObserver(e,t){if(o){var i=new o(t);return i.observe(e.get?e.get(0):e,{childList:!0,subtree:!0}),i}}(this.popup,this.onChangeMutation.bind(this)),this.emitter=function initScroll(e){return e.closest(".js-perfect-scroll")}(this.reference),this.repositionBinded=s.throttle(this.reposition.bind(this),15),this.emitter&&this.emitter.on("ps-scroll-x",this.repositionBinded).on("ps-scroll-y",this.repositionBinded),this.reposition())},onChangeMutation:function onChangeMutation(e){s.each(e,function(e){var t=n(e.target),i=t.attr("data-cid");i||(i=t.closest("[data-cid]").attr("data-cid")),i===this.id&&this.repositionBinded()},this)},reposition:function reposition(){if("float"===this.mode&&this.emitter){var e,t=this.emitter.get(0).scrollTop,i=n(window).height(),s=this.reference,o=this.popup,l=this.state,h=s.offset(),c=o.outerHeight(),d=h.top+s.outerHeight()+r,u=h.top-c-a;l.scroll===t?"top"===l.position?u<=0?(e=d,l.position="bottom"):e=u:d+c+a>=i?(e=u,l.position="top"):e=d:d+c+a>=i?(e=u,l.position="top"):(e=d,l.position="bottom"),e=e<0?r:Math.min(e,i-c-a),o.css({top:e,left:h.left}),l.scroll=t}},untrack:function untrack(){this.observer&&this.observer.disconnect(),this.emitter&&this.emitter.off("ps-scroll-x",this.repositionBinded).off("ps-scroll-y",this.repositionBinded)},destroy:function destroy(){this.untrack();var e=document.querySelector("[data-dialog="+this.id+"]");e&&e.parentNode.removeChild(e),this.emitter=null,this.reference=null,this.popup=null}},e.exports=l},function(e,t,i){"use strict";var s=i(0),n=i(1);e.exports=n.extend({options:{template:i(265)},className:"CDB-ListDecoration-item CustomList-item js-listItem",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave",click:"_onClick"},initialize:function initialize(e){this.options=s.extend({},this.options,e),this.model.on("change",this.render,this)},render:function render(){this.$el.empty(),this.clearSubViews();var e=null==this.model.getName()?"null":this.model.getName();return this.$el.append(this.options.template(s.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),name:e,val:this.model.getValue(),options:this.model.get("renderOptions")}))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this},_onMouseLeave:function _onMouseLeave(){this.$el.removeClass("is-highlighted")},_onMouseEnter:function _onMouseEnter(){this.$el.addClass("is-highlighted")},_onClick:function _onClick(e){this.killEvent(e),this.model.set({selectedClass:e.target.classList,selected:!0})}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({defaults:{selected:!1},getName:function getName(){return null==this.get("label")?this.getValue():this.get("label")},getValue:function getValue(){return this.get("val")}})},function(e,t,i){"use strict";var s=i(4);function isMacCmdKeyPressed(e){return e.metaKey}e.exports=function(e){this.killEvent(e);var t=s(e.target).closest("a").attr("href");if(!t)return!1;if(function isLinuxMiddleOrRightClick(e){return 2===e.which||3===e.which}(e)||isMacCmdKeyPressed(e))((function isCtrlKeyPressed(e){return e.ctrlKey})(e)||isMacCmdKeyPressed(e))&&window.open(t,"_blank");else{var i=this.routerModel||this.options.routerModel||this.options.router;if(!i)throw new Error("routerModel is required");i.navigate(t,{trigger:!0})}}},,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(0),n=/^([a-z]+)(\d*)$/,o=function newId(e,t){if(!e||!e.match)throw new Error("invalid id");var i=e.match(n);if(i[2]=i[2]||-1,i&&3===i.length){var s=i[1],o=parseInt(i[2],10)+t;return s+Math.max(o,0)}throw new Error("invalid id")};e.exports={next:function next(e){return o(e,1)},prev:function prev(e){return o(e,-1)},letter:function letter(e){if(!e||!s.isString(e))return"";var t=e.match(/^([a-z]+)/);return s.isArray(t)&&t[0]||""},sequence:function sequence(e){if(e&&s.isString(e)){var t=e.match(/(\d+$)/);return s.isArray(t)&&t[0]||void 0}},changeLetter:function changeLetter(e,t){return t+e.match(/(\d+)$/)[0]}}},function(e,t,i){"use strict";var s=i(0),n=i(2);!function(){var e=function getValue(e,t,i){return e&&e[t]?s.isFunction(e[t])?e[t](i):e[t]:null},t=function urlError(){throw new Error('A "url" property or function must be specified')};n.originalSync=n.sync,n.sync=function(i,s,o){var r=o.url||e(s,"url",i)||t(),a=0===r.indexOf("http")||0===r.indexOf("//");return o.url=a?r:(s._configModel||s._config||s).get("base_url")+r,"read"!==i&&s.surrogateKeys&&n.cachedSync.invalidateSurrogateKeys(e(s,"surrogateKeys")),n.originalSync(i,s,o)},n.currentSync=n.sync,n.withCORS=function(e,t,i){return i||(i={}),i.crossDomain||(i.crossDomain=!0),i.xhrFields||(i.xhrFields={withCredentials:!0}),n.currentSync(e,t,i)},n.cachedSync=function(i,o){if(!i)throw new Error("cachedSync needs a namespace as argument");var r=i,a=window.user_data&&window.user_data.username;if(!a)return n.sync;var l="cdb-cache/"+(i+="-"+a),h={_keys:function _keys(){return JSON.parse(localStorage.getItem(l)||"{}")},add:function add(e){var t=this._keys();t[e]=+new Date,localStorage.setItem(l,JSON.stringify(t))},invalidate:function invalidate(){var e=this._keys();s.each(e,function(e,t){localStorage.removeItem(t)}),localStorage.removeItem(l)}},c={setItem:function setItem(e,t){return localStorage.setItem(e,t),h.add(e),this},getItem:function getItem(e,t){var i=localStorage.getItem(e);s.defer(function(){t(i)})},removeItem:function removeItem(e){localStorage.removeItem(e),h.invalidate()}},d=function cached(i,s,r){var a=r.url||e(s,"url")||t(),h=l+"/"+a;if("read"===i){var d=r.success,u=null;r.success=function(e,t,i){u&&i.responseText===u||(c.setItem(h,i.responseText),d(e,t,i))},c.getItem(h,function(e){u=e,e&&d(JSON.parse(e),"success")})}else c.removeItem(h);return(o||n.sync)(i,s,r)};return d.invalidate=function(){h.invalidate()},d.cache=c,n.cachedSync.surrogateKeys[r]=d,d},n.cachedSync.surrogateKeys={},n.cachedSync.invalidateSurrogateKeys=function(e){s.each(e,function(e){var t=n.cachedSync.surrogateKeys[e];t?t.invalidate():console.error("Backbone sync options: surrogate key not found: "+e)})},n.syncAbort=function(){var e=arguments[1];return e._xhr&&e._xhr.abort(),e._xhr=n.sync.apply(this,arguments),e._xhr.always(function(){e._xhr=null}),e._xhr},n.delayedSaveSync=function(e,t){var i=s.debounce(e,t);return function(t,s,n){return"create"===t||"update"===t?i(t,s,n):e(t,s,n)}},n.saveAbort=function(){var e=this;this._saving&&this._xhr&&this._xhr.abort(),this._saving=!0;var t=n.Model.prototype.save.apply(this,arguments);return this._xhr=t,t.always(function(){e._saving=!1}),t}}()},,,,,,,,,,function(e,t,i){"use strict";var s=i(4),n=i(2),o=i(1),r=i(491),a=i(247),l=i(265),h=i(829),c=i(353);e.exports=o.extend({options:{position:{x:0,y:0},offset:{x:0,y:15},itemTemplate:l,itemView:a},className:"CDB-Box-modal CDB-SelectItem CustomList CustomList--small",tagName:"div",initialize:function initialize(e){if(!(e=e||{}).collection)throw new Error("collection option is required");if(!e.triggerElementID)throw new Error("element id is required");this._triggerElementID=e.triggerElementID,this.model=new n.Model({visible:!1}),this._onEscapePressed=this._onEscapePressed.bind(this),this._initBinds()},_initBinds:function _initBinds(){this.model.on("change:visible",function(e,t){this.render(),t?this._initDocumentBinds():this._destroyDocumentBinds()},this),this.collection.on("change:selected",this.hide,this),this.add_related_model(this.collection)},_initDocumentBinds:function _initDocumentBinds(){s(document).on("keydown",this._onEscapePressed)},_destroyDocumentBinds:function _destroyDocumentBinds(){s(document).off("keydown",this._onEscapePressed)},render:function render(){var e=s("body"),t=(this.options.position.x||0)+this.options.offset.x,i=(this.options.position.y||0)+this.options.offset.y;return this.clearSubViews(),this.$el.empty(),this._renderList(),this.$el.toggle(this.isVisible()),e.append(this.el),this.$el.css(h({parentView:e,posX:t,posY:i})),this.dropdownOverlay=new c({visible:this.isVisible(),onClickAction:this.hide.bind(this)}),this.addView(this.dropdownOverlay),this},_onEscapePressed:function _onEscapePressed(e){27===e.which&&this.hide()},_renderList:function _renderList(){this._listView=new r({model:this.model,collection:this.collection,typeLabel:"",itemView:this.options.itemView,itemTemplate:this.options.itemTemplate,size:5}),this.$el.append(this._listView.render().el),this.addView(this._listView)},show:function show(){this.model.set("visible",!0)},hide:function hide(){this.model.set("visible",!1)},toggle:function toggle(){this.model.set("visible",!this.model.get("visible"))},isVisible:function isVisible(){return this.model.get("visible")},clean:function clean(){this._destroyDocumentBinds(),o.prototype.clean.apply(this)}})},function(e,t,i){"use strict";var s={background:"Plain",carto:"CartoDB",gmapsbase:"GMapsBase",tiled:"Tiled",torque:"torque",wms:"WMS"};e.exports={getType:function getType(e){var t=s[e];if(!t)throw new Error("no type found for given kind "+e);return t},getKind:function getKind(e){if(!e)throw new Error("no kind found for given type "+e);var t;for(t in s)if(s[t]===e)break;return t},isKindDataLayer:function isKindDataLayer(e){var t=s[e];return this.isTypeDataLayer(t)},isTypeDataLayer:function isTypeDataLayer(e){return this.isCartoDBType(e)||this.isTorqueType(e)},isCartoDBType:function isCartoDBType(e){return"CartoDB"===e},isTorqueType:function isTorqueType(e){return"torque"===e},isTiledType:function isTiledType(e){return"Tiled"===e},isPlainType:function isPlainType(e){return"Plain"===e},isGMapsBase:function isGMapsBase(e){return"GMapsBase"===e}}},function(e,t,i){"use strict";e.exports={COLORS:["#11A579","#E83f74","#9F5DC8","#EF8205","#29B3B2","#E54F3B","#59BB12","#EF57BA","#E2AF00","#12AADE"],getColorForLetter:function getColorForLetter(e){if(!e)return this.COLORS[0];var t=((e.charCodeAt(0)-97)/this.COLORS.length%1*10).toFixed();return this.COLORS[t]||this.COLORS[0]}}},function(e,t,i){"use strict";var s=i(281);e.exports={isSameQuery:function isSameQuery(e,t){if(null==e||null==t)throw new Error("Needed parameters not provided");var i=function parseQuery(e){return e.toLowerCase().replace(/\"/g,"").replace(/;/g,"")};return i(e)===i(t)},altersSchema:function altersSchema(e){return!!e&&(-1!==(e=this._removeLineBreaks(e.trim())).search(/alter\s+[\w\."]+\s+/i)||-1!==e.search(/drop\s+[\w\.\"]+/i)||-1!==e.search(/^vacuum\s+[\w\.\"]+/i)||-1!==e.search(/^create\s+[\w\.\"]+/i)||-1!==e.search(/^reindex\s+[\w\.\"]+/i)||-1!==e.search(/^grant\s+[\w\.\"]+/i)||-1!==e.search(/^revoke\s+[\w\.\"]+/i)||-1!==e.search(/^cluster\s+[\w\.\"]+/i)||-1!==e.search(/^comment\s+on\s+[\w\.\"]+/i)||-1!==e.search(/^explain\s+[\w\.\"]+/i))},altersData:function altersData(e){return!!e&&(e=this._removeLineBreaks(e.trim()),this.altersSchema(e)||-1!==e.search(/^refresh\s+materialized\s+view\s+[\w\.\"]+/i)||-1!==e.search(/^truncate\s+[\w\.\"]+/i)||-1!==e.search(/insert\s+into/i)||-1!==e.search(/update\s+[\w\.\-"]+\s+.*set/i)||-1!==e.search(/delete\s+from/i))},_removeLineBreaks:function _removeLineBreaks(e){return e.replace(/\r?\n|\r/g," ")},getDefaultSQL:function getDefaultSQL(e,t,i){return this.getDefaultSQLFromTableName(s.getQualifiedTableName(e,t,i))},getDefaultSQLFromTableName:function getDefaultSQLFromTableName(e){return"SELECT * FROM "+e}}},function(e,t,i){"use strict";e.exports={initial:"initial",unavailable:"unavailable",unfetched:"unfetched",fetching:"fetching",fetched:"fetched",errored:"errored"}},function(e,t,i){"use strict";var s=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();var n=i(4),o=i(1963),r=function(){function PasswordValidatedForm(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,PasswordValidatedForm)}return s(PasswordValidatedForm,null,[{key:"bindEventTo",value:function bindEventTo(e,t){var i=this,s=n(e);s.find(".js-save").bind("click",function(e){if(e.preventDefault(),e.stopPropagation(),!t.passwordConfirmationNeeded)return t.onPasswordTyped?t.onPasswordTyped():i.addPasswordToForm(s);i.showPasswordModal({modalService:t.modals,onPasswordTyped:t.onPasswordTyped||i.addPasswordToForm.bind(i,s)})})}},{key:"showPasswordModal",value:function showPasswordModal(e){e.modalService.create(function(t){return new o({modalModel:t,onPasswordTyped:e.onPasswordTyped})})}},{key:"addPasswordToForm",value:function addPasswordToForm(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=document.createElement("input");s.setAttribute("type","hidden"),s.setAttribute("name","password_confirmation"),s.setAttribute("value",t),e.prepend(s),i.doNotSubmit||e.submit()}}]),PasswordValidatedForm}();e.exports=r},,function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(312),r=i(348),a=i(410),l=i(2241),h=["PUBLIC","LINK","PRIVATE"];e.exports=s.Model.extend({urlRoot:function urlRoot(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("visualization")+"/viz"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,this._initModels()},_initModels:function _initModels(){var e=this.get("table");n.isEmpty(this.get("external_source"))||(e=this.get("external_source")),this._tableModel=new o(e,{configModel:this._configModel,parse:!0}),this.get("permission")&&(this._permissionModel=new r(this.get("permission"),{configModel:this._configModel}),this.unset("permission")),this._likesModel=l.newByVisData({vis_id:this.id,liked:this.get("liked"),likes:this.get("likes"),configModel:this._configModel}),this.get("synchronization")&&(this._synchronizationModel=new a(this.get("synchronization"),{configModel:this._configModel}),this._synchronizationModel.linkToTable(this._tableModel))},isVisualization:function isVisualization(){return!1},getTableModel:function getTableModel(){return this._tableModel},getLikesModel:function getLikesModel(){return this._likesModel},getPermissionModel:function getPermissionModel(){return this._permissionModel},getSynchronizationModel:function getSynchronizationModel(){return this._synchronizationModel},vizjsonURL:function vizjsonURL(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("vizjson","read","v3")+"/viz/"+this.id+"/viz.json"},isRaster:function isRaster(){return"raster"===this.get("kind")},datasetURL:function datasetURL(){return this._configModel.get("base_url")+"/dataset/"+this.getTableModel().getUnquotedName()},privacyOptions:function privacyOptions(){return h},toJSON:function toJSON(){return n.omit(this.attributes,"synchronization","stats","table")}})},function(e,t,i){"use strict";e.exports={getUnqualifiedName:function getUnqualifiedName(e){if(!e)return null;var t=e.split(".");return 2===t.length?this._getUnquotedName(t[1]):this._getUnquotedName(e)},getUsername:function getUsername(e){if(!e)return null;var t=e.split(".");return 2===t.length?this._getUnquotedName(t[0]):""},_getUnquotedName:function _getUnquotedName(e){return e&&e.replace(/"/g,"")},_quoteIfNeeded:function _quoteIfNeeded(e){return e=this._getUnquotedName(e),/^[a-zA-Z_][a-zA-Z0-9_$]*$/.test(e)||(e='"'+e+'"'),e},getQualifiedTableName:function getQualifiedTableName(e,t,i){return(i&&t?this._quoteIfNeeded(t)+".":"")+this._quoteIfNeeded(this.getUnqualifiedName(e))},isSameTableName:function isSameTableName(e,t,i){var s=this._getTableNameParts(e,i),n=this._getTableNameParts(t,i);return s[0]===n[0]&&s[1]===n[1]},_getTableNameParts:function _getTableNameParts(e,t){var i=this.getUnqualifiedName(e);return[this.getUsername(e)||t,i]}}},function(e,t,i){"use strict";var s=i(2),n=i(2336);e.exports=s.Collection.extend({model:function model(e,t){var i={};return"string"==typeof e?i.val=e:i=e,new n(i)},initialize:function initialize(){this._initBinds()},_initBinds:function _initBinds(){this.bind("change:selected",this._onSelectedChange,this)},_onSelectedChange:function _onSelectedChange(e,t){t&&this.each(function(t){t.cid!==e.cid&&t.get("selected")&&t.set("selected",!1)})},getSelected:function getSelected(){return this.findWhere({selected:!0})},getSelectedValue:function getSelectedValue(){var e=this.getSelected();return e&&e.get("val")},getHighlighted:function getHighlighted(){return this.findWhere({highlighted:!0})}})},,function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(355),r=i(7),a=i(5);i(605),e.exports=n.Model.extend({url:function url(){return this._configModel.get("base_url")+"/api/v1/imports"},fileAttribute:"filename",defaults:{type:"",value:"",interval:0,privacy:"",progress:0,state:"idle",service_item_id:"",service_name:"",option:"",content_guessing:!0,type_guessing:!0,create_vis:!0},initialize:function initialize(e,t){if(!t.userModel)throw new Error("userModel is required");if(!t.configModel)throw new Error("configModel is required");this._userModel=t.userModel,this._configModel=t.configModel,this._initBinds(),this._validate(this.attributes,{validate:!0})},setUpload:function setUpload(e){this.set(e,{validate:!0})},isValidToUpload:function isValidToUpload(){return this.get("value")&&"error"!==this.get("state")},setFresh:function setFresh(e){e&&!s.isEmpty(e)?this.set(s.omit(e,"create_vis")):this.clear()},_initBinds:function _initBinds(){this.bind("progress",function(e){this.set({progress:100*e,state:"uploading"})},this),this.bind("change:value",function(){"error"===this.get("state")&&(this.set({state:"idle"}),this.unset("get_error_text",{silent:!0}))},this),this.bind("error invalid",function(e,t){this.set({state:"error",error_code:t&&t.error_code||"",get_error_text:{title:_t("data.upload-model.invalid-import"),what_about:t&&t.msg||""}})},this)},validate:function validate(e){if(e){if("file"===e.type){if(e.value&&e.value.length)return{msg:_t("data.upload-model.one-file")};var t=e.value.name;if(!t)return{msg:_t("data.upload-model.file-defined")};var i=t.substr(t.lastIndexOf(".")+1);if(i&&(i=i.toLowerCase()),!s.contains(o.fileExtensions,i))return{msg:_t("data.upload-model.file-extension")};if(this._userModel.get("remaining_byte_quota")*o.fileTimesBigger<e.value.size)return{msg:_t("data.upload-model.file-size"),error_code:8001}}if("remote"===e.type){if(!e.remote_visualization_id)return{msg:_t("data.upload-model.visualization-id")};if(e.size&&this._userModel.get("remaining_byte_quota")*o.fileTimesBigger<e.size)return{msg:_t("data.upload-model.remote-file-size"),error_code:8001}}if("url"===e.type&&!r.isURL(e.value))return{msg:_t("data.upload-model.url-invalid")};if("sql"===e.type&&!e.value)return{msg:_t("data.upload-model.query-undefined")};if("duplication"===e.type&&!e.value)return{msg:_t("data.upload-model.dataset-copy-undefined")};if("service"===e.type&&"twitter_search"===e.service_name){var n=e.service_item_id;if(!n||s.isEmpty(n))return{msg:_t("data.upload-model.twitter-data")};if(s.isEmpty(n.categories))return{msg:_t("data.upload-model.twitter-categories-invalid")};var l=n.dates;if(!l||s.isEmpty(l))return{msg:_t("data.upload-model.twitter-dates-empty")};var h=a(l.fromDate)<=a(new Date);if(!l.fromDate||!l.toDate||!h)return{msg:_t("data.upload-model.twitter-dates-invalid")}}}},isValid:function isValid(){return this.get("value")&&"error"!==this.get("state")},upload:function upload(){if("file"===this.get("type")){var e=this;this.xhr=this.save({filename:this.get("value")},{success:function success(e){e.set("state","uploaded")},error:function error(t,i){var s=_t("data.upload-model.connection-error");i&&429===i.status&&(s=JSON.parse(i.responseText).errors.imports);e.set({state:"error",get_error_text:{title:_t("data.upload-model.error-happened"),what_about:s}})},complete:function complete(){delete e.xhr}})}},stopUpload:function stopUpload(){this.xhr&&this.xhr.abort()},setGuessing:function setGuessing(e){this.set({type_guessing:e,content_guessing:e})},setPrivacy:function setPrivacy(e){this.set("privacy",e)}})},function(e,t,i){"use strict";var s=i(1),n=i(4),o=i(249),r=i(324);e.exports=s.extend({className:"Pagination",events:{"click .js-listItem":"_paginate"},initialize:function initialize(e){if(this._routerModel=e.routerModel,this.router&&!this.model.hasUrl())throw new Error("since router is set the model must have a url method set too");this.template=e.template||r,this.model.bind("change",this.render,this)},render:function render(){return this.model.shouldBeVisible()?(this.$el.html(this.template({m:this.model,pagesCount:this.model.pagesCount(),currentPage:this.model.get("current_page")})),this.$el.addClass(this.className),this.delegateEvents()):this.$el.html(""),this},_paginate:function _paginate(e){this._routerModel?o.apply(this,arguments):this.model.hasUrl()||this.killEvent(e);var t=n(e.target).data("page");this.model.set("current_page",t)}})},function(e,t,i){"use strict";var s=i(2),n=i(0);e.exports=s.Model.extend({defaults:{total_count:0,per_page:10,current_page:1,display_count:5,extras_display_count:1,url_to:void 0},pagesCount:function pagesCount(){return Math.max(Math.ceil(this.get("total_count")/this.get("per_page")),1)},isCurrentPage:function isCurrentPage(e){return this.get("current_page")===e},shouldBeVisible:function shouldBeVisible(){var e=this.pagesCount();return this.get("total_count")>0&&e>1&&this.get("current_page")<=e},urlTo:function urlTo(e){if(this.hasUrl())return this.get("url_to")(e)},hasUrl:function hasUrl(){return"function"==typeof this.get("url_to")},pagesToDisplay:function pagesToDisplay(){var e;return e=this._inLowRange()?1:this._inHighRange()?this.get("current_page")-this._startOffset():this.pagesCount()-this.get("display_count")+1,e=Math.max(e,1),this._withExtraPages(n.range(e,this._rangeEnd(e)))},_withExtraPages:function _withExtraPages(e){var t=this.pagesCount(),i=this.get("extras_display_count"),s=n.range(1,i+1),o=n.range(t-i+1,t+1),r=e[0]-s.slice(-1)[0];2===r?s.push(e[0]-1):r>2&&s.push(-1);var a=o[0]-e.slice(-1);return 2===a&&o.unshift(o[0]-1),a>2&&o.unshift(-2),n.union(s,e,o)},_inLowRange:function _inLowRange(){return this.get("current_page")<this._startOffset()},_inHighRange:function _inHighRange(){return this.get("current_page")<this._highBoundary()},_highBoundary:function _highBoundary(){return this.pagesCount()-this._startOffset()},_startOffset:function _startOffset(){return Math.floor(this.get("display_count")/2)},_rangeEnd:function _rangeEnd(e){return Math.min(e+this.get("display_count"),this.pagesCount()+1)}})},,,,function(e,t,i){"use strict";var s=i(0),n=i(2).Model.extend({initialize:function initialize(e){if(!e.base_url)throw new Error("base_url is required")},urlToPath:function urlToPath(){return n.byBaseUrl(this.toString.apply(this,arguments))},pathname:function pathname(){return this.toString().match(/^.+\/\/[^\/]+(.*)$/)[1]},toString:function toString(){return this._joinArgumentsWithSlashes(this.get("base_url"),Array.prototype.slice.call(arguments,0))},_joinArgumentsWithSlashes:function _joinArgumentsWithSlashes(){return s.chain(arguments).flatten().compact().value().join("/")}},{byBaseUrl:function byBaseUrl(e){return new n({base_url:e})}});e.exports=n},,function(e,t,i){"use strict";var s=i(1),n=i(805),o=i(6);e.exports=s.extend({className:"Toggle",events:{"click .js-input":"_onClick"},initialize:function initialize(e){if(!e.model)throw new Error("togglerModel should be provided");this.model=e.model,this._onChange=this.model.get("onChange"),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.append(n({labels:this.model.get("labels"),checked:this.model.get("active"),disabled:this.model.get("disabled")&&this.model.get("isDisableable")})),this._initViews(),this},_initViews:function _initViews(){if(this.model.get("tooltip")){var e=new o({el:this.$(".js-input"),gravity:"s",offset:0,title:function(){return this.model.get("tooltip")}.bind(this)});this.addView(e)}},_initBinds:function _initBinds(){this.listenTo(this.model,"change:active",this.render),this.listenTo(this.model,"change:disabled",this.render)},_onClick:function _onClick(){this.model.set("active",!this.model.get("active"))}})},function(e,t,i){"use strict";var s=i(1),n=i(0),o=["template","onEdit","renderOptions"],r=0;e.exports=s.extend({events:{"blur .js-input":"blur","keyup .js-input":"_onKeyUpInput"},initialize:function initialize(e){n.each(o,function(t){if(!e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),this._onClickHandler=this._onClickHandler.bind(this),this.edit=this.edit.bind(this),this.save=n.debounce(this.save,200,!0),this._timeout=e.timeout||200},render:function render(){return this._unbindEvents(),this.clearSubViews(),this.$el.empty(),this._initViews(),this._initBinds(),this},_initBinds:function _initBinds(){this.options.onClick?(this._onClick=this.options.onClick,this._title().on("click",this._onClickHandler)):this._title().on("dblclick",this.edit)},_unbindEvents:function _unbindEvents(){var e=this._title();e&&e.off("click dblclick")},_onClickHandler:function _onClickHandler(e){var t=this;1===++r&&setTimeout(function(){1===r?t._onClick&&t._onClick(e):t.edit(),r=0},this._timeout)},_initViews:function _initViews(){this.$el.append(this._template(this._renderOptions)),this.setElement(this.$(".Inline-editor"))},_backupText:function _backupText(){this._oldText=this.$(".js-title").text()},_restoreText:function _restoreText(){this.$(".js-input").val(this._oldText)},edit:function edit(){this._backupText(),this.$(".js-input").val(this._oldText),this.$(".js-input").prop("readonly",!1).show().focus(),this.$(".js-input").get(0).setSelectionRange(0,this.$(".js-input").val().length)},getValue:function getValue(){return this.$(".js-input").val()},_title:function _title(){return this.$(".js-title")},hide:function hide(){this.$(".js-input").prop("readonly",!0).hide()},blur:function blur(){this.save(),this.hide()},save:function save(){var e=this.getValue();e===this._oldText||n.isEmpty(e)||this._onEdit&&this._onEdit(e)},clean:function clean(){this._unbindEvents(),s.prototype.clean.call(this)},_onKeyUpInput:function _onKeyUpInput(e){27===e.which&&(this._restoreText(),this.hide()),13===e.which&&(this.$(".js-input").blur(),this.save())}})},function(e,t,i){"use strict";var s=i(0),n=i(873),o=i(340),r=i(535),a=i(7);e.exports=s.defaults({generateAttributes:function generateAttributes(e){return s.extend({},this._getFillAttrs(e),this._getStrokeAttrs(e),{blending:r.blending},this._getAggrAttrs(e),this._getLabelsAttrs())},_getFillAttrs:function _getFillAttrs(e){var t=o.simple[e].fill;return{fill:a.cloneObject(t)}},_getStrokeAttrs:function _getStrokeAttrs(e){var t=o.simple[e].stroke;return{stroke:a.cloneObject(t)}},_getAggrAttrs:function _getAggrAttrs(){var e=r.aggregation;return{aggregation:a.cloneObject(e)}},_getLabelsAttrs:function _getLabelsAttrs(){var e=r.labels;return{labels:a.cloneObject(e)}}},n)},,,,function(e,t,i){"use strict";var s=i(4),n=i(0),o=i(1),r=i(3),a="<%- protocol %>://<%= mapsApiResource %>/api/v1/map/static/named/<%- tpl %>/<%- width %>/<%- height %>.png<%= authTokens %>",l="<%- protocol %>://<%- cdn %>/<%- username %>/api/v1/map/static/named/<%- tpl %>/<%- width %>/<%- height %>.png<%= authTokens %>",h=["config","visId","mapsApiResource","username"];e.exports=o.extend({options:{width:300,height:170,privacy:"PUBLIC",className:"",authTokens:[]},initialize:function initialize(e){r(e,h,this)},load:function load(){return this._startLoader(),this._loadFromVisId(),this},_generateImageTemplate:function _generateImageTemplate(){return"tpl_"+this._visId.replace(/-/g,"_")},_loadFromVisId:function _loadFromVisId(){var e=this._isHTTPS()?"https":"http",t=this._config.get("cdn_url"),i=n.template(t?l:a),s={protocol:e,username:this._username,mapsApiResource:this._mapsApiResource,tpl:this._generateImageTemplate(),width:this.options.width,height:this.options.height,authTokens:this._generateAuthTokensParams()};t&&(s=n.extend(s,{cdn:t[e]}));var o=i(s);this._loadImage({},o)},_generateAuthTokensParams:function _generateAuthTokensParams(){var e=this.options.authTokens;return e&&e.length>0?"?"+n.map(e,function(e){return"auth_token="+e}).join("&"):""},_isHTTPS:function _isHTTPS(){return 0===location.protocol.indexOf("https")},loadURL:function loadURL(e){var t=s('<img class="MapCard-preview" src="'+e+'" />');this.$el.append(t),this.options.className&&t.addClass(this.options.className),t.fadeIn(250)},showError:function showError(){this._onError()},_startLoader:function _startLoader(){this.$el.addClass("is-loading")},_stopLoader:function _stopLoader(){this.$el.removeClass("is-loading")},_onSuccess:function _onSuccess(e){this._stopLoader(),this.loadURL(e),this.trigger("loaded",e)},_onError:function _onError(){this._stopLoader(),this.$el.addClass("has-error");var e=s('<div class="MapCard-error" />');this.$el.append(e),e.fadeIn(250),this.trigger("error")},_loadImage:function _loadImage(e,t){var i=this,s=new Image;s.onerror=function(){i._onError(e)},s.onload=function(){i._onSuccess(t)};try{s.src=t}catch(e){this._onError(e)}}})},,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(2243),r=i(980),a=i(348),l=i(410),h=i(281);e.exports=n.Model.extend({idAttribute:"name",defaults:{fetched:!1,schema:[]},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel},urlRoot:function urlRoot(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("table")+"/tables"},parse:function parse(e,t){var i=t&&t.configModel||this._configModel;e.table_visualization&&!s.isEmpty(e.table_visualization)&&(e=s.extend({},e.table_visualization,{geometry_types:e.geometry_types})),e.synchronization&&(this._syncModel?this._syncModel.set(e.synchronization):this._syncModel=new l(e.synchronization,{configModel:i})),e.permission&&(this._permissionModel?this._permissionModel.set(e.permission):this._permissionModel=new a(e.permission,{configModel:i}));var n=s.defaults({fetched:!0},e),r=s.map(e.schema,function(e){return{name:e[0],type:e[1]}},this);return this.columnsCollection?this.columnsCollection.reset(r):this.columnsCollection=new o(r,{configModel:i,tableModel:this}),n},isOwner:function isOwner(e){return!(!e||!this._permissionModel)&&this._permissionModel.isOwner(e)},getUnqualifiedName:function getUnqualifiedName(){return h.getUnqualifiedName(this.get("name"))},getOwnerName:function getOwnerName(){var e=this.get("name");if(!e)return null;var t=e.split(".");return 2===t.length?t[0].replace(/"/g,""):this._permissionModel?this._permissionModel.getOwner().get("username"):""},getUnquotedName:function getUnquotedName(){var e=this.get("name");return e&&e.replace(/"/g,"")},getGeometryType:function getGeometryType(){var e=this.get("geometry_types"),t=[];if(!s.isArray(e))return[];for(var i in e){var n=e[i];if(n){var o=r(n.toLowerCase());o&&t.push(o)}}return s.uniq(t)},getPermissionModel:function getPermissionModel(){return this._permissionModel},isReadOnly:function isReadOnly(e){return this.isSync()||!this.hasWriteAccess(e)},isSync:function isSync(){var e=this.getSyncModel(),isSync=e&&e.get("id");return!!isSync},hasWriteAccess:function hasWriteAccess(e){return!(!e||!this._permissionModel)&&this._permissionModel.hasWriteAccess(e)},getSyncModel:function getSyncModel(){return this._syncModel}})},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(407),r=i(176),a=i(408),l=i(2255),h=i(2252),c=i(2251),d=i(2250),u=i(2249),p=i(347),g=i(3),m=["configModel"],f={public:"PUBLIC",link:"LINK",private:"PRIVATE",password:"PASSWORD"},_=s.Model.extend({defaults:{bindMap:!0},INHERIT_TABLE_ATTRIBUTES:["name","description","privacy"],initialize:function initialize(e,t){g(t,m,this),this.map=new l({configModel:this._configModel}),this.permission=new a(this.get("permission"),{configModel:this._configModel}),this.order=new h({visualization:this}),this.transition=new c(this.get("transition_options"),{parse:!0}),this.like=o.newByVisData({vis_id:this.id,liked:this.get("liked"),likes:this.get("likes"),config:this._configModel}),this.get("bindMap")&&this._bindMap(),this._initBinds()},_initBinds:function _initBinds(){this.permission.acl.bind("reset",function(){this.set("permission",this.permission.attributes,{silent:!0}),this.trigger("change:permission",this)},this),this.bind("change:permission",function(){this.permission.set(this.get("permission"))},this)},_bindMap:function _bindMap(){this.on("change:map_id",this._fetchMap,this),this.map.bind("change:id",function(){this.set("map_id",this.map.id)},this),this.map.set("id",this.get("map_id"))},url:function url(e){var t="/api/"+this._configModel.urlVersion("visualization",e)+"/viz";return this.isNew()?t:t+"/"+this.id},parse:function parse(e){return this.transition&&e.transition_options&&this.transition.set(this.transition.parse(e.transition_options)),this.like&&this.like.set({vis_id:this.id,likes:this.get("likes"),liked:this.get("liked")}),this.owner&&(this.owner=new r(this.owner)),e},toJSON:function toJSON(){var e=n.clone(this.attributes);return delete e.bindMap,delete e.stats,delete e.related_tables,delete e.children,e.transition_options=this.transition.toJSON(),e},getLikesModel:function getLikesModel(){return this.like},copy:function copy(e,t){e=e||{},t=t||{};var i=new _(n.extend({source_visualization_id:this.id},e),{configModel:this._configModel});return i.save(null,t),i},_fetchMap:function _fetchMap(){this.map.set("id",this.get("map_id")).fetch()},viewUrl:function viewUrl(e){var t=this.permission.owner,i=this.permission.owner.viewUrl();if(this.isVisualization()||n.isUndefined(this.get("type"))){var s=this.get("id");return e&&e.id!==t.id&&this.permission.hasAccess(e)&&(i=e.viewUrl(),s=t.get("username")+"."+s),new d({base_url:i.urlToPath("viz",s)})}return e&&this.permission.hasAccess(e)&&(i=e.viewUrl()),new u({base_url:i.urlToPath("tables",this.tableMetadata().getUnquotedName())})},sharedWithEntities:function sharedWithEntities(){return n.map(this.permission.acl.toArray()||[],function(e){return e.get("entity")})},isVisualization:function isVisualization(){return"derived"===this.get("type")||"slide"===this.get("type")},tableMetadata:function tableMetadata(){return this._metadata||(this._metadata=new p(this.get("table"),{configModel:this._configModel})),this._metadata},getTableModel:function getTableModel(){return this._metadata||(this._metadata=new p(this.get("table"),{configModel:this._configModel})),this._metadata},privacyOptions:function privacyOptions(){var privacyOptions=n.values(f);return this.isVisualization()?privacyOptions:n.filter(privacyOptions,function(e){return"PASSWORD"!==e})},isRaster:function isRaster(){return"raster"===this.get("kind")},getPermissionModel:function getPermissionModel(){return this.permission},getSynchronizationModel:function getSynchronizationModel(){return this._synchronizationModel},mapcapsURL:function mapcapsURL(){return this._configModel.get("base_url")+"/api/v3/viz/"+this.id+"/mapcaps"}},{isPubliclyAvailable:function isPubliclyAvailable(e){return e===f.password||e===f.link||e===f.public}});e.exports=_},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(2258),r=i(2257),a=i(984),l=i(1101),h=i(176),c=i(3),d=["configModel"];e.exports=n.Model.extend({url:"/api/v1/org/",initialize:function initialize(e,t){c(t,d,this),e=e||{},this.owner=new h(this.get("owner")),this.display_email=void 0!==e.admin_email&&null!=e.admin_email&&(""==e.admin_email?this.owner.email:e.admin_email);var i={organization:this,currentUserId:t&&t.currentUserId,configModel:this._configModel};this.users=new o(e.users,i),this.groups=new a(e.groups,i),this.grantables=new r(void 0,i),this.users.each(this._setOrganizationOnModel,this),this.groups.each(this._setOrganizationOnModel,this)},_setOrganizationOnModel:function _setOrganizationOnModel(e){e.organization=this},fetch:function fetch(){throw new Error("organization should not be fetch, should be static")},containsUser:function containsUser(e){return!!this.users.find(function(t){return t.id===e.id})},isOrgAdmin:function isOrgAdmin(e){return this.owner.id===e.id||!!s.find(this.get("admins"),function(t){return t.id===e.id})},viewUrl:function viewUrl(){return new l({base_url:this.get("base_url")})},getModelType:function getModelType(){return"org"}})},function(e,t,i){"use strict";var s=i(2),n=i(0);e.exports=s.Model.extend({getAttributes:function getAttributes(){return JSON.parse(JSON.stringify(this.attributes))},_generateClassName:function _generateClassName(e){return e?e.replace(/\s+/g,"").replace(/[^a-zA-Z_0-9 ]/g,"").toLowerCase():""},parse:function parse(e){var t={};return n.extend(t,e.options,{id:e.id,className:this._generateClassName(e.options.urlTemplate),type:"Tiled",order:e.order,parent_id:e.parent_id}),t},toJSON:function toJSON(){return{kind:"tiled",options:n.clone(n.omit(this.attributes,["order","id"])),order:this.get("order"),id:this.id}},getValue:function getValue(){return this.get("val")},validateTemplateURL:function validateTemplateURL(e){var t=["a","b","c"],i=new Image;i.onload=e.success,i.onerror=e.error,i.src=this.get("urlTemplate").replace(/\{s\}/g,function(){return t[Math.floor(3*Math.random())]}).replace(/\{x\}/g,"0").replace(/\{y\}/g,"0").replace(/\{z\}/g,"0")}})},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(4),r=i(9),a=i(13),l=i(3),h=i(174),c=["configModel","nodeDefModel"];e.exports=h.extend({initialize:function initialize(e,t){l(t,c,this),this._querySchemaModel=this._nodeDefModel.querySchemaModel;var i=t.configModel;this.SQL=new r.SQL({user:i.get("user_name"),sql_api_template:i.get("sql_api_template"),api_key:i.get("api_key")}),this.stateModel=new s.Model({state:"unfetched"}),h.prototype.initialize.call(this,e,t)},_onSelectedChange:function _onSelectedChange(e,t){"multiple"!==this.type&&t&&this.each(function(t){t.cid!==e.cid&&t.set({selected:!1},{silent:!0})},this)},buildQuery:function buildQuery(){throw new Error("subclasses of DataObservatoryBaseCollection must implement buildQuery")},fetch:function fetch(e){this._success=e&&e.success,this._error=e&&e.error;var t={filters:null,measurement:null,normalize:null,timespan:null,query:this._querySchemaModel.get("query")};this.deferred=o.Deferred();var i=n.defaults(e,t),s=this.buildQuery(i);return this.stateModel.set("state","fetching"),this.SQL.execute(s,i,{success:function(e){this._onFetchSuccess(e),this.stateModel.set("state","fetched"),this.deferred.resolve(),this._success&&this._success()}.bind(this),error:function(e){this.stateModel.set("state","error"),this.deferred.reject(),this._error&&this._error(a(e))}.bind(this)}),this.deferred.promise()},_onFetchSuccess:function _onFetchSuccess(e){var t=e.rows;this.reset(t)},isFetching:function isFetching(){return"fetching"===this.getState()},getState:function getState(){return this.stateModel.get("state")},getItem:function getItem(e){return this.findWhere({val:e})},isAsync:function isAsync(){return!0}})},function(e,t,i){"use strict";var s=i(1),n=i(0),o=i(2296),r=i(2295),a=i(427),l=i(426),h=i(425);i(2294)(o),i(2293)(o),i(2292)(o),i(2291)(o),i(2290)(o),i(2289)(o),i(2288)(o),i(2287)(o);var c=[27,13],d={"color-picker":r};e.exports=s.extend({module:"components:code-mirror:code-mirror-view",className:"Editor-content",options:{readonly:!1,lineNumbers:!0,autocompleteChars:3},initialize:function initialize(e){if(!e)throw new Error("options for codemirror are required.");if(!e.model)throw new Error("Model for codemirror is required.");if(void 0===e.model.get("content")&&void 0===e.placeholder)throw new Error("Content property or placeholder for codemirror is required.");if(!e.tips)throw new Error("tip messages are required");this._autocompleteChars=e.autocompleteChars||this.options.autocompleteChars,this._mode=e.mode||"cartocss",this._addons=e.addons,this._hints=e.hints,this._autocompletePrefix=e.autocompletePrefix,this._autocompleteTriggers=e.autocompleteTriggers,this._autocompleteSuffix=e.autocompleteSuffix,this._errorTemplate=e.errorTemplate||h,this._tips=e.tips,this._lineWithErrors=[],this._onInputRead=n.bind(this._onKeyUpEditor,this),this._placeholder=e.placeholder},render:function render(){return this.$el.html(a({content:this.model.get("content"),tips:this._tips.join(" ")})),this._initViews(),this._bindEvents(),this._showErrors(),this},_initViews:function _initViews(){var e=n.defaults(n.extend({},this.model.toJSON()),this.options),t=e.readonly,i=e.lineNumbers,s={"Ctrl-S":this.triggerApplyEvent.bind(this),"Cmd-S":this.triggerApplyEvent.bind(this),"Ctrl-Space":this._completeIfAfterCtrlSpace.bind(this)};this.editor=o.fromTextArea(this.$(".js-editor").get(0),{lineNumbers:i,theme:"material",mode:this._mode,scrollbarStyle:"simple",lineWrapping:!0,readOnly:t,extraKeys:s,placeholder:this._placeholder}),this.editor.on("change",n.debounce(this._onCodeMirrorChange.bind(this),150),this),n.isEmpty(this._addons)||n.each(this._addons,function(e){var t=new(0,d[e])({editor:this.editor});t.bind("codeSaved",this.triggerApplyEvent,this),this.$el.append(t.el),this.addView(t)},this),this._hints&&this.editor.on("keyup",this._onInputRead),this._toggleReadOnly(),setTimeout(function(){this.editor&&this.editor.refresh()}.bind(this),0)},_completeIfAfterCtrlSpace:function _completeIfAfterCtrlSpace(e){var t=this._autocompletePrefix,i={},s=e.getCursor();return t&&e.getRange(o.Pos(s.line,s.ch-t.length),s)!==t&&(i={autocompletePrefix:t}),this._completeAfter(e,i)},updateHints:function updateHints(e){this._hints=e},_onKeyUpEditor:function _onKeyUpEditor(e,t){var i=t.keyCode,s=this._hints,r=this._autocompleteChars-1,a=this._autocompletePrefix;if(-1===c.indexOf(i)){var l=this;this._autocompleteTimeout&&clearTimeout(this._autocompleteTimeout),this._autocompleteTimeout=setTimeout(function(){var t={},i=e.getCursor(),h=e.getTokenAt(i).string;return h=h.toLowerCase(),a&&e.getRange(o.Pos(i.line,i.ch-a.length),i)!==a&&(t={autocompletePrefix:a}),l._completeAfter(e,t,function(){if(h.length>r)return n.filter(s,function autocompleteHandler(e){var t=n.isObject(e)?e.text:e;return-1!==(t=t.toLowerCase()).indexOf(h)}).length>0||a&&a===h})},150)}},_onCodeMirrorChange:function _onCodeMirrorChange(){this.trigger("codeChanged")},_completeAfter:function _completeAfter(e,t,i){return i&&!i()||e.state.completionActive||this._showAutocomplete(e,n.extend({},t)),o.Pass},_showAutocomplete:function _showAutocomplete(e,t){var i=t&&t.autocompletePrefix;o.showHint(e,o.hint["custom-list"],{completeSingle:!1,list:this._hints,autocompletePrefix:i,autocompleteSuffix:this._autocompleteSuffix})},_bindEvents:function _bindEvents(){var e=this;this.editor.on("change",function(t,i){e.model.set("content",e.getContent(),{silent:!0})}),this.model.on("change:content",function(){this.setContent(this.model.get("content"))},this),this.model.on("change:readonly",this._toggleReadOnly,this),this.model.on("change:errors",function(){this._showErrors()},this),this.model.on("undo redo",function(){this.setContent(this.model.get("content"))},this)},_toggleReadOnly:function _toggleReadOnly(){var e=!!this.model.get("readonly");this.editor.setOption("readOnly",e),e?(this.editor.setOption("theme",""),this._getInfo().hide()):(this.editor.setOption("theme","material"),this._getInfo().show())},search:function search(e,t){var i=this.editor.getSearchCursor(e,null,!0);return i.find(),i.pos},markReadOnly:function markReadOnly(e,t){this.editor.markText(e,t,{readOnly:!0,inclusiveLeft:!0});for(var i=e.line;i<=t.line;i++)this.editor.addLineClass(i,"background","CodeMirror-readonlyLine")},setContent:function setContent(e){this.editor.setValue(e)},getContent:function getContent(){return this.editor.getValue()},triggerApplyEvent:function triggerApplyEvent(){this.trigger("codeSaved",this.getContent(),this)},destroyEditor:function destroyEditor(){this.editor.off("change");var e=this.editor.getWrapperElement(),t=e.parentNode;t&&t.removeChild(e),this.editor=null},_getInfo:function _getInfo(){return this.$(".js-console")},_getConsole:function _getConsole(){return this.$(".js-console-error")},_getCode:function _getCode(){return this.$(".CodeMirror-code")},_removeErrors:function _removeErrors(){this._getConsole().empty(),n.each(this._lineWithErrors,function(e){e.find(".CodeMirror-bullet").remove(),e.find(".CodeMirror-linenumber").removeClass("has-error")}),this._lineWithErrors=[]},_showErrors:function _showErrors(){var e=this.model.get("errors");this._removeErrors(),e&&e.length>0&&n.each(e,function(e){this._renderError(e),this._renderBullet(e)},this)},_renderBullet:function _renderBullet(e){var t,i=e.line;i&&((t=this._getCode().children().eq(+i-1)).append(l),t.find(".CodeMirror-linenumber").addClass("has-error"),this._lineWithErrors.push(t))},_renderError:function _renderError(e){this._getConsole().append(this._errorTemplate(e))},clean:function clean(){this.destroyEditor(),s.prototype.clean.apply(this)}})},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(2337);e.exports=n.extend({module:"components:carousel-form-view",className:"js-aggregationTypes",initialize:function initialize(e){if(!e.collection)throw new Error("Carousel collection is required");if(!e.template)throw new Error("template is required");this.template=e.template,this._initBinds()},render:function render(){var e=this.collection.getSelected(),t=e&&e.getName();return this.$el.html(this.template({name:t})),this._initViews(),this},_initBinds:function _initBinds(){this.collection.bind("change:highlighted",this._onChangeHighlighted,this)},_initViews:function _initViews(){var e=new o(s.extend(this.options,{collection:this.collection}));if(!this.$(".js-selector").length)throw new Error("HTML element with js-selector class is required");this.$(".js-selector").append(e.render().el),e.initScroll(),this.addView(e)},_onChangeHighlighted:function _onChangeHighlighted(){var e=this.collection.getHighlighted()||this.collection.getSelected();if(e){var t=this.$(".js-highlight");t&&t.text(e.getName())}}})},function(e,t,i){"use strict";var s=i(4),n=i(1),o=i(7),r={width:"18px",height:"18px"},a=i(0).template("0 0 <%- w %> <%- h %>");e.exports=n.extend({initialize:function initialize(e){if(!e.imageClass)throw new Error("Image class is mandatory.");this._imageClass=e.imageClass,this._imageURL=e.imageUrl,this._color=e.color,this._lastImage={url:null,content:null}},render:function render(){return this.$el.empty(),this._loadImage(),this},_loadImage:function _loadImage(){if(this._imageURL){if(this._isSVG(this._imageURL))this._loadSVG();else{var e=s('<img crossorigin="anonymous"/>');for(var t in e.attr("class",this._imageClass+" js-image"),e.attr("src",this._imageURL+"?req=markup"),r)e.attr(t,r[t]);this.$el.append(e)}}},_loadSVG:function _loadSVG(){var e=this;this._requestImageURL(this._imageURL,function(t){var i=t.cloneNode(!0),n=s(i);(n=n.removeAttr("xmlns:a")).attr("class",e._imageClass+" js-image");var o={w:18,h:18};for(var l in n.attr("viewBox")||(n.attr("height")&&n.attr("width")&&(o={w:i.width.baseVal.value,h:i.height.baseVal.value}),n.attr("viewBox",a(o))),r)n.attr(l,r[l]);e.$el.append(n),n.css("fill",e._color),n.find("g").css("fill","inherit"),n.find("path").css("fill","inherit"),n.find("rect").each(function(e,t){var i=s(t);"none"!==i.css("fill")&&i.css("fill","inherit")})})},_requestImageURL:function _requestImageURL(e,t){var i=this,n=e+"?req=ajax";this._lastImage.url===n?t&&t(this._lastImage.content):s.ajax(n).done(function(e){i._lastImage.url=n;var s=i._lastImage.content=e.getElementsByTagName("svg")[0];t&&t(s)}).fail(function(){throw new Error("Couldn't get "+n+" file.")})},updateImageColor:function updateImageColor(e){this.$(".js-image").css("fill",e)},_isSVG:function _isSVG(e){if(!e)return!1;var t=e.split("?")[0];return t&&o.endsWith(t.toUpperCase(),"SVG")}})},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(182),r=i(177),a=i(1013);e.exports=function(e,t){var i=(t=t||{}).tabPaneItemLabelOptions,l=e.map(function(e){return["label","createContentView"].forEach(function(t){if(!e[t])throw new Error(t+" should be provided")}),{name:e.name,selected:e.selected,disabled:e.disabled,tooltip:e.tooltip,label:e.label,selectedChild:e.selectedChild,createButtonView:function createButtonView(){return new a(s.extend({model:this},i))},createContentView:function createContentView(){return e.createContentView&&e.createContentView()||new n}}}),h=new r(l),c=t.tabPaneOptions;return new o(s.extend({collection:h},c))}},,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(1),n=i(0),o=i(11),r=i(186),a=["errorTitle","loadingTitle","runAction","modalModel"];e.exports=s.extend({className:"Dialog-content",initialize:function initialize(e){n.each(a,function(t){if(!e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this)},render:function render(){return this.clearSubViews(),this.$el.html(o({title:this._loadingTitle})),this._runAction({error:this._renderErrorView.bind(this)}),this},_renderErrorView:function _renderErrorView(e){var t=new r({title:this._errorTitle,desc:e});this.$el.html(t.render().el),this.addView(t)}})},function(e,t,i){var s=i(0);e.exports=function escapeHTML(e){return s.escape(e)}},function(e,t,i){var s=i(221),n=new(i(227))({locale:"en",phrases:s.en}),o=n.t.bind(n),r={"aggregate-intersection":{title:o("analyses.aggregate-intersection.short-title")},"bounding-box":{title:o("analyses.bounding-box.short-title")},"bounding-circle":{title:o("analyses.bounding-circle.short-title")},buffer:{title:o("analyses.area-of-influence.short-title")},centroid:{title:o("analyses.centroid.short-title")},"convex-hull":{title:o("analyses.convex-hull.short-title")},"concave-hull":{title:o("analyses.concave-hull.short-title")},"data-observatory-measure":{title:o("analyses.data-observatory-measure.short-title")},"data-observatory-multiple-measures":{title:o("analyses.data-observatory-multiple-measures.short-title")},"filter-by-node-column":{title:o("analyses.filter-by-node-column.short-title")},"filter-category":{title:o("analyses.filter.short-title")},"filter-range":{title:o("analyses.filter.short-title")},"georeference-city":{title:o("analyses.georeference.short-title")},"georeference-ip-address":{title:o("analyses.georeference.short-title")},"georeference-country":{title:o("analyses.georeference.short-title")},"georeference-long-lat":{title:o("analyses.georeference.short-title")},"georeference-postal-code":{title:o("analyses.georeference.short-title")},"georeference-street-address":{title:o("analyses.georeference.short-title")},"georeference-admin-region":{title:o("analyses.georeference.short-title")},intersection:{title:o("analyses.filter-intersection.short-title")},kmeans:{title:o("analyses.kmeans.short-title")},"line-to-single-point":{title:o("analyses.connect-with-lines.short-title")},"line-source-to-target":{title:o("analyses.connect-with-lines.short-title")},"line-sequential":{title:o("analyses.connect-with-lines.short-title")},merge:{title:o("analyses.merge.short-title")},moran:{title:o("analyses.moran-cluster.short-title")},"routing-sequential":{title:o("analyses.routing.short-title")},"routing-to-layer-all-to-all":{title:o("analyses.routing.short-title")},"routing-to-single-point":{title:o("analyses.routing.short-title")},sampling:{title:o("analyses.sampling.short-title")},"spatial-markov-trend":{title:o("analyses.spatial-markov-trend.short-title")},"trade-area":{title:o("analyses.area-of-influence.short-title")},"weighted-centroid":{title:o("analyses.centroid.short-title")},closest:{title:o("analyses.find-nearest.short-title")},"deprecated-sql-function":{title:o("analyses.deprecated-sql-function.short-title")}};e.exports={MAP:r,title:function(e){return function(e){var t=""===e?"unknown":e;return r[t]||{title:o("analyses."+t)}}(e).title}}},function(e,t,i){var s=i(0);e.exports={COLORS:["#11A579","#E83f74","#9F5DC8","#EF8205","#29B3B2","#E54F3B","#59BB12","#EF57BA","#E2AF00","#12AADE"],letter:function(e){if(!e||!s.isString(e))return"";var t=e.match(/^([a-z]+)/);return s.isArray(t)&&t[0]||""},getColorForLetter:function(e){if(!e)return this.COLORS[0];var t=((e.charCodeAt(0)-97)/this.COLORS.length%1*10).toFixed();return this.COLORS[t]||this.COLORS[0]}}},function(e,t,i){var s=i(4),n=i(0),o=i(1),r=i(918),a=i(353);e.exports=o.extend({className:"CDB-Dropdown",events:{"click .js-toggleLocalTimezone":"_toggleLocalTimezone","click .js-toggleNormalized":"_toggleNormalized","click .js-toggleCollapsed":"_toggleCollapsed","click .js-removeWidget":"_removeWidget","click .js-editWidget":"_editWidget"},initialize:function(e){if(!e.target)throw new Error("target is not defined");this._target=this.options.target,this._$container=this.options.container,this._initBinds()},render:function(){var e=n.defaults(this.options.flags||{},{canCollapse:!0}),t=n.defaults({},this.model.attributes,{flags:e},{local_timezone:!1,normalized:!1,collapsed:!1,show_options:!1});return this.$el.html(r(t)),this._dropdownOverlay=new a({visible:!0,onClickAction:this._onGlobalClick.bind(this)}),this.addView(this._dropdownOverlay),this},_initBinds:function(){this.add_related_model(this.model),this.model.bind("change:widget_dropdown_open",this._onChangeOpen,this),this._$container.delegate(this._target,"click",n.bind(this._toggle,this))},_removeWidget:function(){this.model.trigger("removeWidget",this.model),this._toggle()},_editWidget:function(){this.model.trigger("editWidget",this.model),this._toggle()},_bindESC:function(){s(document).bind("keyup."+this.cid,n.bind(this._onKeyUp,this))},_unbindESC:function(){s(document).unbind("keyup."+this.cid)},_onGlobalClick:function(e){this.model.set("widget_dropdown_open",!1)},_onKeyUp:function(e){if(27===e.keyCode)return this.model.set("widget_dropdown_open",!1),!1},_onChangeOpen:function(){this.model.get("widget_dropdown_open")?this._open():this._close()},_toggleCollapsed:function(){var e=!this.model.get("collapsed");this.model.set("collapsed",e),this._toggle()},_toggleNormalized:function(){var e=!this.model.get("normalized");this.model.set("normalized",e),this._toggle()},_toggleLocalTimezone:function(){var e=!this.model.get("local_timezone");this.model.set("local_timezone",e),this._toggle()},_open:function(){this._bindESC(),this.render(),this._$container.append(this.$el),this.$el.show(),this._adjustVerticalPosition()},_adjustVerticalPosition:function(){this._getDropdownBottom()>this._getBodyHeight()&&this.$el.addClass("has-top-position")},_getDropdownBottom:function(){return this.$el.offset().top+this.$el.height()},_getBodyHeight:function(){return s("body").height()},_close:function(){this._unbindESC(),this._dropdownOverlay&&this._dropdownOverlay.clean(),this.$el.hide(),this.$el.removeClass("has-top-position")},_toggle:function(){this.model.set("widget_dropdown_open",!this.model.get("widget_dropdown_open"))},clean:function(){this.model.set("widget_dropdown_open",!1),this._unbindESC(),this._dropdownOverlay&&this._dropdownOverlay.clean(),this._$container.undelegate(this._target,"click"),o.prototype.clean.call(this)}})},,function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({defaults:{username:"",avatar_url:""},url:function url(){return"//"+this.getHost()+"/api/v1/get_authenticated_users"},getHost:function getHost(){var e=window.location.host;return this.get("host")?this.get("host"):e}})},function(e,t,i){"use strict";var s=i(1),n=i(400);e.exports=s.extend({tagName:"a",events:{click:"_toggleLike"},initialize:function initialize(){this.model.on("change:likeable change:liked change:likes error",this.render,this)},render:function render(){return this.$el.html(n({likes:this.model.get("likes"),size:this.model.get("size"),show_count:this.model.get("show_count"),show_label:this.model.get("show_label")})).attr({class:this._classNames(),href:this._hrefLocation()}),this},_hrefLocation:function _hrefLocation(){var e="#/like";return this.model.get("likeable")||(e=window.login_url),e},_classNames:function _classNames(){var e=["LikesIndicator"];return this.model.get("likeable")&&e.push("is-likeable"),this.model.get("liked")&&e.push("is-liked"),this._animate&&(e.push("is-animated"),this.$el.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){this._animate=!1,this.render()}.bind(this))),e.join(" ")},_toggleLike:function _toggleLike(e){this.model.get("likeable")&&(this.killEvent(e),this._animate=!0,this.model.toggleLiked())}})},,,function(e,t,i){"use strict";var s=i(0),n=i(1);e.exports=n.extend({initialize:function initialize(){this.tabs={},this.activeTab=null,this.activePane=null},addTab:function addTab(e,t,i){if(i=i||{active:!0},void 0!==this.tabs[e])console.debug(e+"already added");else{if(this.tabs[e]=t.cid,this.addView(t),void 0!==i.after){var s=this.$el.children()[i.after];t.$el.insertAfter(s)}else i.prepend?this.$el.prepend(t.el):this.$el.append(t.el);this.trigger("tabAdded",e,t),i.active?this.active(e):t.hide()}},getPreviousPane:function getPreviousPane(){var e=s.toArray(this.tabs),t=s.toArray(this._subviews),i=s.indexOf(e,this.activePane.cid)-1;return i<0&&(i=t.length-1),t[i]},getNextPane:function getNextPane(){var e=s.toArray(this.tabs),t=s.toArray(this._subviews),i=1+s.indexOf(e,this.activePane.cid);return i>t.length-1&&(i=0),t[i]},getPane:function getPane(e){var t=this.tabs[e];return this._subviews[t]},getActivePane:function getActivePane(){return this.activePane},size:function size(){return s.size(this.tabs)},clean:function clean(){this.removeTabs(),n.prototype.clean.call(this)},removeTab:function removeTab(e){if(void 0!==this.tabs[e]){var t=this.tabs[e];this._subviews[t].clean(),delete this.tabs[e],this.activeTab==e&&(this.activeTab=null),s.size(this.tabs)&&this.active(s.keys(this.tabs)[0])}},removeTabs:function removeTabs(){for(var e in this.tabs){var t=this.tabs[e];this._subviews[t].clean(),delete this.tabs[e]}this.activeTab=null},active:function active(e){var t=this.tabs[e];if(void 0!==t){if(this.activeTab!==e){var i=this._subviews[t];if(this.activeTab){var s=this._subviews[this.tabs[this.activeTab]];s.hide(),this.trigger("tabDisabled",this.activeTab,s),this.trigger("tabDisabled:"+this.activeTab,s),s.deactivated&&s.deactivated()}i.show(),i.activated&&i.activated(),this.activeTab=e,this.activePane=i,this.trigger("tabEnabled",e,i),this.trigger("tabEnabled:"+e,i)}return this.activePane}},render:function render(){return this},each:function each(e){var t=this;s.each(this.tabs,function(i,s){e(s,t.getPane(s))})}})},function(e,t,i){"use strict";var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},n=i(2),o=i(0),r=i(4),a=i(313),l=i(3),h=["configModel"];e.exports=n.Collection.extend({_PREVIEW_TABLES_PER_PAGE:10,_TABLES_PER_PAGE:20,_PREVIEW_ITEMS_PER_PAGE:3,_ITEMS_PER_PAGE:9,sync:i(985),initialize:function initialize(e,t){l(t,h,this);var i=new n.Model({tag_name:"",q:"",page:1,type:"derived",exclude_shared:!1,per_page:this._ITEMS_PER_PAGE});this.options=o.extend(i,this.options),this.total_entries=0,this.bind("reset",this._checkPage,this)},model:function model(e,t){var i=s({},t,{configModel:t.collection._configModel});return new a(e,i)},getTotalPages:function getTotalPages(){return Math.ceil(this.total_entries/this.options.get("per_page"))},_checkPage:function _checkPage(){var e=this.getTotalPages();this.options.get("page")>e?this.options.set({page:e+1}):this.options.get("page")<1&&this.options.set({page:1})},_createUrlOptions:function _createUrlOptions(){var e=o(this.options.attributes).map(function(e,t){return t+"="+encodeURIComponent(e)});return o.compact(e).join("&")},url:function url(e){return"/api/"+this._configModel.urlVersion("visualizations",e)+"/viz?"+this._createUrlOptions()},remove:function remove(e){this.total_entries--,n.Collection.prototype.remove.apply(this,arguments)},parse:function parse(e){return this.total_entries=e.total_entries,this.slides&&this.slides.reset(e.children),this.total_shared=e.total_shared,this.total_likes=e.total_likes,this.total_user_entries=e.total_user_entries,e.visualizations.map(function(e){return s({},e,{bindMap:!1})})},create:function create(e){var t=r.Deferred();return n.Collection.prototype.create.call(this,e,{wait:!0,success:function success(){return t.resolve()},error:function error(){return t.reject()}}),t.promise()},fetch:function fetch(e){var t=r.Deferred(),i=this;return this.trigger("loading",this),r.when(n.Collection.prototype.fetch.call(this,e)).done(function(e){i.trigger("loaded"),t.resolve()}).fail(function(e){i.trigger("loadFailed"),t.reject(e)}),t.promise()},getTotalStat:function getTotalStat(e){return this[e]||0},getDefaultParam:function getDefaultParam(e){}})},function(e,t,i){"use strict";var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},n=i(0),o=i(4),r=i(2),a=i(9).SQL,l=i(983),h=i(982),c=i(3),d=i(589),u=i(2247),p=i(588),g=i(408),m=i(2246),f=i(2245),_=i(980),v=i(2244),y=["configModel"],b=r.Model.extend({columnNames:function columnNames(){return n.map(this.get("schema"),function(e){return e[0]})},columnName:function columnName(e){return this.columnNames()[e]}}),w=b.extend({currentLoading:0,_TEXTS:{columnDeleted:"Your column has been deleted",columnDeleting:"Deleting your column",columnAdded:"Your column has been added",columnAdding:"Adding new column"},hiddenColumns:["the_geom","the_geom_webmercator","cartodb_georef_status","created_at","updated_at","cartodb_id"],initialize:function initialize(e,t){c(t,y,this),n.bindAll(this,"notice"),this.readOnly=!1,this.bind("change:schema",this._prepareSchema,this),this._prepareSchema(),this.sqlView=null,this.synchronization=new f({configModel:t.configModel}),this.synchronization.linkToTable(this),this.synchronization.bind("change:id",function isSyncChanged(){this.trigger("change:isSync",this,this.synchronization.isSync())},this),this.get("no_data_fetch")&&(this.no_data_fetch=!0,delete this.attributes.no_data_fetch),this.data(),this.bind("error",function(e,t){this.error("",t)},this),this._data.bind("error",function(e,t){this.notice("error loading rows, check your SQL query","error",5e3)},this),this._data.bind("reset",function(){var e=this._data;this.set({schema:e.schemaFromData(this.get("schema")),geometry_types:e.getGeometryTypes()})},this),v.call(this,"change",this._data,"data:changed"),v.call(this,"saved",this._data,"data:saved"),this.bind("change:table_visualization",function(){this.permission=new g(this.get("table_visualization").permission,{configModel:this._configModel}),this.trigger("change:permission",this,this.permission)},this),this.permission=new g(this.get("permission"),{configModel:this._configModel})},url:function url(e){var t="/api/"+this._configModel.urlVersion("table",e)+"/tables";return this.isNew()?t:t+"/"+this.id},parse:function parse(e,t){return e.name&&(e.id=e.name),e.stats_geometry_types=e.geometry_types,delete e.geometry_types,delete e.schema,e},notice:function notice(e,t,i){this.trigger("notice",e,t,i)},setReadOnly:function setReadOnly(e){var t=!1;this.readOnly!==e&&(t=!0),this.readOnly=e,t&&this.trigger("change:readOnly",this,e)},isReadOnly:function isReadOnly(){return this.readOnly||this.data().isReadOnly()||this.synchronization.isSync()},isSync:function isSync(){return this.synchronization.isSync()},getUnqualifiedName:function getUnqualifiedName(){var e=this.get("name");if(!e)return null;var t=e.split(".");return 2==t.length?t[1]:e},getUnquotedName:function getUnquotedName(){var e=this.get("name");return e&&e.replace(/"/g,"")},sortSchema:function sortSchema(){this.set("schema",w.sortSchema(this.get("schema")))},error:function error(e,t){var i="";try{i=t&&t.responseText&&JSON.parse(t.responseText).errors[0]}catch(e){}finally{this.trigger("notice",e+": "+i,"error")}},_prepareSchema:function _prepareSchema(){var e=this;this._columnType={},n(this.get("schema")).each(function(t){e._columnType[t[0]]=t[1]}),this.isInSQLView()||this.set("original_schema",this.get("schema"))},columnNames:function columnNames(e){return e=e||"schema",n(this.get(e)).pluck(0)},containsColumn:function containsColumn(e){return n.contains(this.columnNames(),e)},columnNamesByType:function columnNamesByType(e,t){t=t||"schema";var i=n(this.get(t)).filter(function(t){return t[1]==e});return n(i).pluck(0)},statsGeomColumnTypes:function statsGeomColumnTypes(e){return this.geomColumnTypes(this.get("stats_geometry_types"))},geomColumnTypes:function geomColumnTypes(e){var t=e||this.get("geometry_types"),i=[];if(!n.isArray(t))return[];var s={st_multipolygon:"polygon",st_polygon:"polygon",st_multilinestring:"line",st_linestring:"line",st_multipoint:"point",st_point:"point"};for(var o in t){var r=t[o];if(r){var a=s[r.toLowerCase()];a&&i.push(a)}}return n.uniq(i)},addGeomColumnType:function addGeomColumnType(e,t){if(e){var i=n.clone(this.get("geometry_types"))||[];n.contains(i,e)||(i.push(e),this.set({geometry_types:i},t))}},nonReservedColumnNames:function nonReservedColumnNames(){var e=this;return n.filter(this.columnNames(),function(t){return!e.isReservedColumn(t)})},columnTypes:function columnTypes(){return n.clone(this._columnType)},_getColumn:function _getColumn(e){if(void 0!==this._columnType[e])return new u({table:this,name:e,type:this._columnType[e],configModel:this._configModel},{configModel:this._configModel})},getColumnType:function getColumnType(e,t){t=t||"schema";var i=n(this.get(t)).filter(function(t){return t[0]==e});if(i.length>0)return i[0][1]},addColumn:function addColumn(e,t,i){var s=this,n=new u({table:this,_name:e,type:t||"string",configModel:this._configModel},{configModel:this._configModel});this.notice(this._TEXTS.columnAdding,"load",0),n.save(null,{success:function success(t,n){s.notice(s._TEXTS.columnAdded,"info"),s.trigger("columnAdd",e),s.data().fetch(),i&&i.success&&i.success(t,n)},error:function error(e,t){s.error("error adding column",t),i&&i.error&&i.error(e)},wait:!0})},deleteColumn:function deleteColumn(e,t){var i=this,s=this._getColumn(e);void 0!==s&&(this.notice(this._TEXTS.columnDeleting,"load",0),s.destroy({success:function success(){i.trigger("columnDelete",e),i.notice(i._TEXTS.columnDeleted,"info"),i.data().fetch(),t&&t.success&&t.success()},error:function error(e,s){i.error("error deleting column",s),t&&t.error&&t.error()},wait:!0}))},renameColumn:function renameColumn(e,t,i){var s=this;if(e!=t){var n=this._getColumn(e),o=n.get("name");n.set({new_name:t,old_name:n.get("name")}),this.notice("renaming column","load",0),n.save(null,{success:function success(e,n){s.notice("Column has been renamed","info"),s.trigger("columnRename",t,o),s.data().fetch(),i&&i.success&&i.success(e,n)},error:function error(e,t){console.error("can't rename column"),s.error("error renaming column",t),i&&i.error&&i.error(e,t)},wait:!0})}},isTypeChangeAllowed:function isTypeChangeAllowed(e,t){var i=this._getColumn(e);if(!i)return!0;var s=i.get("type"),o={number:["date"],boolean:["date"],date:["boolean"]}[s]||[];return o=o.concat([s]),!n.contains(o,t)},isTypeChangeDestructive:function isTypeChangeDestructive(e,t){return{string:{string:!1,number:!0,date:!0,boolean:!0},number:{string:!1,number:!1,date:!0,boolean:!0},date:{string:!1,number:!0,date:!1,boolean:!0},boolean:{string:!1,number:!1,date:!0,boolean:!1}}[this.getColumnType(e)][t]},changeColumnType:function changeColumnType(e,t,i){var s=this._getColumn(e);this.getColumnType(e)!=t?this.saveNewColumnType(s,t,i):i&&i.success&&i.success()},saveNewColumnType:function saveNewColumnType(e,t,i){var s=this;e.set({type:t}),this.notice("Changing column type","load",0),e.save(null,{success:function success(){s.notice("Column type has been changed","info"),s.trigger("typeChanged",t),s.data().fetch(),i&&i.success&&i.success()},error:function error(e,n){s.trigger("typeChangeFailed",t,e),s.error("error changing column type",n),i&&i.error&&i.error(e,n)},wait:!0})},originalData:function originalData(){return this._data},data:function data(){return void 0===this._data&&(this._data=new d(null,{table:this,configModel:this._configModel}),this.bindData()),this.sqlView?this.sqlView:this._data},bindData:function bindData(e){this._data&&!this._data.bindedReset&&(v.call(this,"sync",this._data,"dataLoaded"),v.call(this,"add",this._data,"dataAdded"),this._data.bindedReset=!0),this.sqlView&&!this.sqlView.bindedReset&&(v.call(this,"sync",this.sqlView,"dataLoaded"),v.call(this,"add",this.sqlView,"dataAdded"),this.sqlView.bindedReset=!0)},useSQLView:function useSQLView(e,t){(e||this.sqlView)&&(t=t||{},this.sqlView&&(this.sqlView.unbind(null,null,this),this.sqlView.unbind(null,null,this._data)),!e&&this.sqlView&&(this.sqlView.table=null),this.sqlView=e,this.bindData(),e?(e.bind("sync reset",function(){e.modify_rows||this.set({schema:e.schemaFromData(this.get("schema")),geometry_types:e.getGeometryTypes()})},this),e.bind("error",function(e,t){this.notice("error loading rows, check your SQL query","error",5e3)},this),e.bind("loading",function(){},this),e.bind("reset loaded",function(){e.modify_rows?(this.notice(e.affected_rows+" rows affected"),this.useSQLView(null)):this.notice(_t("loaded"))},this),this.dataModel=this.sqlView,e.table=this):(this.dataModel=this._data,this.set({schema:this.get("original_schema")}),this.data().fetch()),this.trigger("change:dataSource",this.dataModel,this))},isInSQLView:function isInSQLView(){return!!this.sqlView},fetch:function fetch(e){var t=this,i=!!e&&e.silent;i||this.notice("loading table","load",this,0,0);var s=b.prototype.fetch.call(this,e);return o.when(s).done(function(){e&&e.success&&e.success.old_success&&e.success.old_success(),i||t.notice("loaded")}).fail(function(){i||t.notice("error loading the table")}),s},isReservedColumn:function isReservedColumn(e){return p.isReservedColumn(e)},linkToInfowindow:function linkToInfowindow(e){this.bind("columnRename",function(t,i){e.containsField(i)&&(e.removeField(i),e.addField(t))},e),this.bind("columnDelete",function(t,i){e.removeField(t)},e),this.bind("change:schema",function(){var t=n(this.columnNames()).filter(function(t){return!n.contains(e.SYSTEM_COLUMNS,t)});function _hash(e){var t,i=0;for(t=0;t<e.length;t++)i=e.charCodeAt(t)+(i<<6)+(i<<16)-i;return i}if(this.isInSQLView()){e.has("defaul_schema_fields")||e.saveFields("defaul_schema_fields");var i="schema_"+_hash(this.columnNames().sort().join("")),s="schema_"+_hash(n(this.previous("schema")).pluck(0).sort().join(""));e.has(s)||e.saveFields(s),e.has(i)&&e.restoreFields(null,i)}else e.restoreFields(null,"defaul_schema_fields");e.get("template")?e.mergeFields(t):e.removeMissingFields(t)},this)},embedURL:function embedURL(){return"/tables/"+this.get("name")+"/embed_map"},viewUrl:function viewUrl(){return this._configModel.prefixUrl()+"/tables/"+this.getUnqualifiedName()},hasTheGeom:function hasTheGeom(){var e=this.get("schema");for(var t in e)if("the_geom"===e[t][0])return!0;return!1},fetchGeoreferenceStatus:function fetchGeoreferenceStatus(){var e=o.Deferred(),t=this.options&&this.options.user_data?this.options.user_data.username:window.user_data?window.user_data.username:window.user_name,i=this.options&&this.options.user_data?this.options.user_data.api_key:window.user_data?window.user_data.api_key:window.api_key;this.sqlApi=new a({user:t,version:"v1",api_key:i,sql_api_template:this._configModel.getSqlApiBaseUrl()});var s="SELECT the_geom FROM "+this.get("name")+" WHERE the_geom is not null";return this.sqlApi.execute(s).done(function(t){t.rows.length>0?e.resolve(!0):e.resolve(!1)}),e.promise()},isGeoreferenced:function isGeoreferenced(){var e=this.geomColumnTypes();return!!(e&&e.length>0)||!this.isInSQLView()&&this._data.any(function(e){return e.hasGeometry()})},geometryTypeChanged:function geometryTypeChanged(){if(!("geometry_types"in this.changed))return!1;var e=this.get("geometry_types"),t=this.previousAttributes().geometry_types;function normalize(e){return"st_multipolygon"===(e=e.toLowerCase())?"st_polygon":"st_multilinestring"===e?"st_linestring":"st_multipoint"===e?"st_point":e}return!e||0===e.length||!t||0===t.length||normalize(e[0])!==normalize(t[0])},duplicate:function duplicate(e,t){var i=this;t=t||{};var s={table_name:e};if(this.isInSQLView()){var n=this.data().getSQL();s.sql=n&&""!=n?n:"SELECT * FROM "+l(this.get("name"))}else s.table_copy=this.get("name");(new m).save(s,{error:t.error,success:function success(e,s){var n=new m({item_queue_id:s.item_queue_id});n.bind("importComplete",function(){n.unbind();var e=new w({id:n.get("table_id")},{configModel:i._configModel});e.fetch({success:function success(){t.success(e)},error:t.error})}),n.bind("importError",function(){n.unbind(),t.error.apply(this,arguments)}),n.pollCheck()}})},dependentVisualizations:function dependentVisualizations(){return n.chain(this.get("dependent_visualizations")).union(this.get("non_dependent_visualizations")).compact().value()||[]},getGeometryType:function getGeometryType(){var e=this.get("geometry_types"),t=[];if(!n.isArray(e))return[];for(var i in e){var s=e[i];if(s){var o=_(s.toLowerCase());o&&t.push(o)}}return n.uniq(t)}},s({createFromQuery:function createFromQuery(e,t,i){return new w({sql:t,name:e},{configModel:i})}},h));e.exports=w},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(7),r=i(409),a=i(987),l=i(592),h=i(2260),c=e.exports=s.Model.extend({urlRoot:function urlRoot(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("perm")+"/perm"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,this.acl=new s.Collection,this.owner=t._userModel,this._generateOwner(),this._generateAcl(),this._initBinds()},_initBinds:function _initBinds(){this.bind("change:owner",this._generateOwner,this),this.bind("change:acl",this._generateAcl,this)},_generateOwner:function _generateOwner(){this.owner||(this.owner=new r(null,{configModel:this._configModel})),this.owner.set(this.get("owner"))},getOwner:function getOwner(){return this.owner},_generateAcl:function _generateAcl(){var e=this;this.acl.reset([],{silent:!0}),n.each(this.get("acl"),function(t){var i;switch(t.type){case"user":i=new r(t.entity,{configModel:e._configModel});break;case"org":i=new a(t.entity,{configModel:e._configModel});break;case"group":i=new l(t.entity,{configModel:e._configModel});break;default:throw new Error("Unknown ACL item type: "+t.type)}this._grantAccess(i,t.access)},this)},cleanPermissions:function cleanPermissions(){this.acl.reset()},hasAccess:function hasAccess(e){return this.hasReadAccess(e)},hasReadAccess:function hasReadAccess(e){return!!this.findRepresentableAclItem(e)},hasWriteAccess:function hasWriteAccess(e){return"rw"===o.result(this.findRepresentableAclItem(e),"get","access")},canChangeReadAccess:function canChangeReadAccess(e){return this._canChangeAccess(e)},canChangeWriteAccess:function canChangeWriteAccess(e){return(!e.isBuilder||e.isBuilder())&&this._canChangeAccess(e,function(e){return"rw"!==o.result(e,"get","access")})},_canChangeAccess:function _canChangeAccess(e){var t=this.findRepresentableAclItem(e);return this.isOwner(e)||!t||t===this._ownAclItem(e)||o.result(arguments,1,t)||!1},grantWriteAccess:function grantWriteAccess(e){this._grantAccess(e,"rw")},grantReadAccess:function grantReadAccess(e){this._grantAccess(e,"r")},revokeWriteAccess:function revokeWriteAccess(e){this.grantReadAccess(e)},revokeAccess:function revokeAccess(e){var t=this._ownAclItem(e);t&&this.acl.remove(t)},isOwner:function isOwner(e){return n.result(this.owner,"id")===n.result(e,"id")},toJSON:function toJSON(){return{entity:this.get("entity"),acl:this.acl.toJSON()}},getUsersWithAnyPermission:function getUsersWithAnyPermission(){return this.acl.chain().filter(this._hasTypeUser).map(this._getEntity).value()},isSharedWithOrganization:function isSharedWithOrganization(){return this.acl.any(this._hasTypeOrg)},clone:function clone(){var e=n.clone(this.attributes);return delete e.id,new c(e,{configModel:this._configModel})},overwriteAcl:function overwriteAcl(e){this.acl.reset(e.acl.models)},findRepresentableAclItem:function findRepresentableAclItem(e){if(this.isOwner(e))return this._newAclItem(e,"rw");return this._findMostPrivilegedAclItem(["_ownAclItem","_organizationAclItem","_mostPrivilegedGroupAclItem"],function(t){return this[t](e)})},_hasTypeUser:function _hasTypeUser(e){return"user"===e.get("type")},_getEntity:function _getEntity(e){return e.get("entity")},_hasTypeOrg:function _hasTypeOrg(e){return"org"===e.get("type")},_isOrganization:function _isOrganization(e){return e instanceof a},_ownAclItem:function _ownAclItem(e){if(e&&n.isFunction(e.isNew)||console.log("model is required to find an ACL item"),!e.isNew())return this.acl.find(function(t){return t.get("entity").id===e.id})},_organizationAclItem:function _organizationAclItem(e){var t=n.result(e.collection,"organization")||e.organization||e._organizationModel;if(t)return this._ownAclItem(t)},_mostPrivilegedGroupAclItem:function _mostPrivilegedGroupAclItem(e){var t=n.result(e.groups,"models");if(t)return this._findMostPrivilegedAclItem(t,this._ownAclItem)},_findMostPrivilegedAclItem:function _findMostPrivilegedAclItem(e,t){for(var i,s=0,n=e[s];n&&"rw"!==o.result(i,"get","access");n=e[++s])i=t.call(this,n)||i;return i},_grantAccess:function _grantAccess(e,t){var i=this._ownAclItem(e);if(i)i.set("access",t);else{if(!(i=this._newAclItem(e,t)).isValid())throw new Error(t+" is not a valid ACL access");this.acl.add(i)}},_newAclItem:function _newAclItem(e,t){var i;if(e instanceof r)i="user";else if(e instanceof l)i="group";else{if(!this._isOrganization(e))throw new Error("model not recognized as a valid ACL entity "+e);i="org"}return new h({type:i,entity:e,access:t})}});t.READ_ONLY="r",t.READ_WRITE="rw"},,,,,function(e,t,i){"use strict";var s=i(0),n=i(4),o=i(2),r=i(1);e.exports=r.extend({className:"CDB-Box-modalOverlay",events:{click:"_onOverlayClicked"},initialize:function initialize(e){this.container=e&&e.container,this.onClickAction=e&&e.onClickAction,this.model=new o.Model({visible:!s.isUndefined(e&&e.visible)&&e.visible}),this._initBinds(),this.render()},_initBinds:function _initBinds(){this.listenTo(this.model,"change:visible",this._onVisibilityChange)},render:function render(){return(this.container||n(document.body)).append(this.$el),this.$el.toggle(this.isVisible()),this},_onOverlayClicked:function _onOverlayClicked(){this.onClickAction&&this.onClickAction(),this.hide()},show:function show(){this.model.set("visible",!0)},hide:function hide(){this.model.set("visible",!1)},toggle:function toggle(){this.model.set("visible",!this.model.get("visible"))},isVisible:function isVisible(){return this.model.get("visible")},_onVisibilityChange:function _onVisibilityChange(){this.$el.toggle(this.isVisible())}})},,function(e,t,i){"use strict";e.exports={uploadStates:["pending","enqueued","uploading","unpacking","importing","guessing","complete"],fileExtensions:["csv","xls","xlsx","zip","kml","geojson","json","ods","kmz","tsv","gpx","tar","gz","tgz","osm","bz2","tif","tiff","txt","rar"],fileTimesBigger:3}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(1),n=i(4);e.exports=s.extend({tagName:"input",className:"CDB-InputText CDB-Text",events:{keyup:"_onValueChange",change:"_onValueChange"},initialize:function initialize(e){if(!e.editorModel)throw new Error("editorModel is required");this._editorModel=e.editorModel,this._onKeyPressed=this._onKeyPressed.bind(this),this._onValueChange=this._onValueChange.bind(this)},render:function render(){return this.$el.val(this.model.get("value")),this._setFocus(),this._initDocumentBind(),this},_setFocus:function _setFocus(){setTimeout(function(){this.$el.focus()}.bind(this),100)},_initDocumentBind:function _initDocumentBind(){n(document).bind("keydown",this._onKeyPressed)},_destroyDocumentBind:function _destroyDocumentBind(){n(document).unbind("keydown",this._onKeyPressed)},_onKeyPressed:function _onKeyPressed(e){if(13===e.which){if(!this.model.isValid())return!1;this._editorModel.confirm()}},_onValueChange:function _onValueChange(){this._setValue(),this._checkValidity()},_setValue:function _setValue(){this.model.set("value",this.$el.val())},_checkValidity:function _checkValidity(){this.$el.toggleClass("has-error",!this.model.isValid())},clean:function clean(){this._destroyDocumentBind(),s.prototype.clean.apply(this)}})},function(e,t,i){"use strict";var s=i(0),n=i(1751);e.exports={init:function init(e,t){if(!e)throw new Error("model is required to initialize undoManager");t=t||{},this.model=e,this.model._undoManager=this.undoManager=new n({maximumStackLength:t.maximumStackLength||30,register:this.model,track:t.track}),this._trackEvents(),this._addMethods(),s.isEmpty(t.history)||(t.track&&this.undoManager.stopTracking(),this._addHistory(t.history),t.track&&this.undoManager.startTracking())},_trackEvents:function _trackEvents(){s.each(["undo","redo"],function(e){this.undoManager.bind(e,function(){this.trigger(e,this.changed,this)},this.model)},this),this.undoManager.stack.bind("add remove reset",function(){this.trigger("unredoChanged",this.changed,this)},this.model)},_addHistory:function _addHistory(e){var t=this.undoManager.stack;s.each(e,function(i,s){e[s+1]&&t.add({after:e[s+1],before:i,type:"change",undoTypes:this.undoManager.undoTypes,object:this.model,magicFusionIndex:0})},this),t.pointer=t.length-1},_addMethods:function _addMethods(){s.extend(this.model,{undo:function undo(){this._undoManager.undo()},redo:function redo(){this._undoManager.redo()},canUndo:function canUndo(){return this._undoManager.isAvailable("undo")},canRedo:function canRedo(){return this._undoManager.isAvailable("redo")},getUndoHistory:function getUndoHistory(){var e=this._undoManager.stack.toJSON(),t=s.reduce(e,function(e,t,i){return e.push(t.before),e},[],this);return t.push(this.attributes),t}})}}},function(e,t,i){"use strict";var s=i(0),n=i(873),o=i(294),r=i(1755),a=i(1754),l=i(1753),h=i(872),c=i(1752),d={none:{tooltipTranslationKey:"editor.style.tooltip.none",labelTranslationKey:"editor.style.types.none",checkIfValid:function checkIfValid(e){return!e},defaultStyles:n},simple:{tooltipTranslationKey:"editor.style.style-form.aggregation.tooltips.simple",labelTranslationKey:"editor.style.types.simple",iconTemplate:i(871),checkIfValid:function checkIfValid(e){return!!e},defaultStyles:o},squares:{tooltipTranslationKey:"editor.style.style-form.aggregation.tooltips.squares",labelTranslationKey:"editor.style.types.squares",iconTemplate:i(870),checkIfValid:function checkIfValid(e){return"point"===e},defaultStyles:l},hexabins:{tooltipTranslationKey:"editor.style.style-form.aggregation.tooltips.hexabins",labelTranslationKey:"editor.style.types.hexabins",iconTemplate:i(869),checkIfValid:function checkIfValid(e){return"point"===e},defaultStyles:h},regions:{tooltipTranslationKey:"editor.style.style-form.aggregation.tooltips.regions",labelTranslationKey:"editor.style.types.regions",iconTemplate:i(868),checkIfValid:function checkIfValid(e){return"point"===e},defaultStyles:c},animation:{tooltipTranslationKey:"editor.style.style-form.aggregation.tooltips.animation",labelTranslationKey:"editor.style.types.animation",iconTemplate:i(867),checkIfValid:function checkIfValid(e){return"point"===e},defaultStyles:a},heatmap:{tooltipTranslationKey:"editor.style.style-form.aggregation.tooltips.heatmap",labelTranslationKey:"editor.style.types.heatmap",iconTemplate:i(866),checkIfValid:function checkIfValid(e){return"point"===e},defaultStyles:r}};e.exports={getDefaultStyleAttrsByType:function getDefaultStyleAttrsByType(e,t){return d[e].defaultStyles.generateAttributes(t)},getStyleTypes:function getStyleTypes(e,t){return s.reduce(d,function(i,s,n){return e!==n&&s.checkIfValid&&!s.checkIfValid(t)||i.push({value:n,label:_t(s.labelTranslationKey),tooltip:_t(s.tooltipTranslationKey),iconTemplate:s.iconTemplate}),i},[])},getFormTemplateByType:function getFormTemplateByType(e){return d[e].formTemplate},getAggregationTypes:function getAggregationTypes(){return["squares","hexabins","regions"]}}},,function(e,t,i){var s=i(0),n=i(9),o=i(1799);e.exports=n.core.Model.extend({defaults:{attrsNames:[],show_stats:!1,show_source:!1},defaultState:{collapsed:!1},initialize:function(e,t,i){if(i=i||{},!t.dataviewModel)throw new Error("dataviewModel is required.");if(!t.layerModel)throw new Error("layerModel is required.");this.dataviewModel=t.dataviewModel,this.layerModel=t.layerModel,this._autoStyleEnabledWhenCreated=void 0===i.autoStyleEnabled||i.autoStyleEnabled,this.activeAutoStyler(),this.listenTo(this,"change:style",this.activeAutoStyler)},activeAutoStyler:function(){this.isAutoStyleEnabled()&&!this.autoStyler&&(this.autoStyler=o.get(this.dataviewModel,this.layerModel,this.get("style")))},update:function(e){var t=s.pick(e,this.get("attrsNames"));return this.set(t),this.dataviewModel.update(e),this._triggerChangesInAutoStyle(),!(!this.changedAttributes()&&!this.dataviewModel.changedAttributes())},_triggerChangesInAutoStyle:function(){var e=this.changed&&this.changed.style&&this.changed.style.auto_style&&this.changed.style.auto_style.definition,t=this.previousAttributes(),i=t.style&&t.style.auto_style&&t.style.auto_style.definition;s.isEqual(e,i)||this.trigger("customAutoStyle",this)},remove:function(){this.dataviewModel.remove(),this.trigger("destroy",this),this.stopListening()},isAutoStyleEnabled:function(){var e=this.get("style");return("category"===this.get("type")||"histogram"===this.get("type"))&&(e&&e.auto_style?e&&e.auto_style&&e.auto_style.allowed:this._autoStyleEnabledWhenCreated)},getWidgetColor:function(){var e=this.get("style"),t=e&&e.widget_style,i=t&&t.definition&&t.definition.color&&t.definition.color.fixed;return(t&&t.widget_color_changed||t&&!t.widget_color_changed&&"#9DE0AD"!==i)&&i},hasColorsAutoStyle:function(){var e=this.getAutoStyle(),t=!1;return!(!e||s.isEmpty(e)||s.isEmpty(e.definition))&&(s.each(e.definition,function(e){e.color&&e.color.range&&e.color.range.length>0&&(t=!0)},this),t)},getColor:function(e){return this.isAutoStyleEnabled()&&this.isAutoStyle()&&"category"===this.get("type")?this.autoStyler.colors.getColorByCategory(e):this.getWidgetColor()},isAutoStyle:function(){return this.get("autoStyle")},autoStyle:function(){if(this.isAutoStyleEnabled()&&this.dataForAutoStyle()){var e=this.layerModel,t=e.get("cartocss");!t&&e.get("meta")&&(t=e.get("meta").cartocss),e.set("initialStyle",t);var i=this.autoStyler.getStyle();e.set("cartocss",i),this.set("autoStyle",!0)}},dataForAutoStyle:function(){return this.dataviewModel.get("data").length>0},reapplyAutoStyle:function(){var e=this.autoStyler.getStyle();this.layerModel.set("cartocss",e),this.set("autoStyle",!0)},cancelAutoStyle:function(e){e||this.layerModel.restoreCartoCSS(),this.set("autoStyle",!1)},getAutoStyle:function(){var e=this.get("style"),t=this.layerModel,i=t.get("cartocss")||t.get("meta")&&t.get("meta").cartocss;if(this.isAutoStyleEnabled()&&this.autoStyler){if(e&&e.auto_style&&e.auto_style.definition){var n=s.extend(e.auto_style,{cartocss:i});return s.extend({},n,{definition:this.autoStyler.getDef(i)})}return{definition:this.autoStyler.getDef(i),cartocss:i}}return{}},_updateAutoStyle:function(e,t){this.autoStyler&&this.autoStyler.updateStyle(t),this.isAutoStyle()&&this.reapplyAutoStyle()},setInitialState:function(e){this.initialState=e||{}},applyInitialState:function(){var e=s.extend(this.initialState,{hasInitialState:!0});this.setState(e)},setState:function(e){this.set(e)},getState:function(){var e={};for(var t in this.defaultState){var i=this.get(t),n=this.defaultState[t];void 0===n||void 0===i||s.isEqual(i,n)||(e[t]=i)}return e},forceResize:function(){var e=this.get("type");"time-series"!==e&&"histogram"!==e||this.trigger("forceResize")}})},function(e,t,i){var s=i(0),n=i(250),o=i(1);e.exports=o.extend({animateFromValues:function(e,t,i,o,r){var a=this.$(i),l=r||{},h=l.formatter||n.format("0,000"),c=l.templateData||{},d=l.debounceWait||500,u=t%1==0,p=function(e){e=u?Math.round(e):e;var t=s.isNaN(e)||void 0===e?l.defaultValue||0:h(e),i=s.extend({value:t},c);a.text(o(i))};0!==l.animationSpeed?(p(e),s.debounce(function(){a.prop("counter",e).stop().animate({counter:t},{duration:l.animationSpeed||500,easing:l.easingMethod||"swing",step:p})},d)()):p(t)},animateFromCurrentValue:function(e,t,i,o){var r=this.$(t),a=o||{},l=a.debounceWait||500,h=e,c=+this.$(t).text(),d=a.formatter||n.format("0,000"),u=a.templateData||{},p=h%1==0,g=function(t){t=p?Math.round(t):t,e=s.isNaN(t)||void 0===t?a.defaultValue||0:d(t);var n=s.extend({value:e},u);r.text(i(n))};0!==a.animationSpeed?(g(c),s.debounce(function(){r.prop("counter",c).stop().animate({counter:h},{duration:a.animationSpeed||500,easing:a.easingMethod||"swing",step:g})},l)()):g(h)},animateValue:function(e,t,i,o,r){var a=this.$(i),l=r||{},h=l.debounceWait||500,c=e.get(t),d=e.previous(t)||0,u=l.formatter||n.format("0,000"),p=l.templateData||{},g=c%1==0,m=function(e){e=g?Math.round(e):e;var t=s.isNaN(e)||void 0===e?l.defaultValue||0:u(e),i=s.extend({value:t},p);a.text(o(i))};0!==l.animationSpeed?(m(d),s.debounce(function(){a.prop("counter",d).stop().animate({counter:c},{duration:l.animationSpeed||500,easing:l.easingMethod||"swing",step:m})},h)()):m(c)}})},,function(e,t){e.exports=function(e,t,i){return t.split(".").reduce(function(e,t){return(e||{})[t]},e)||i}},,function(e,t,i){"use strict";var s=i(4),n=i(1),o=i(2130);e.exports=n.extend({events:{"click .js-dropdown-target":"_createDropdown"},_createDropdown:function _createDropdown(e){e&&e.preventDefault();var t=s(e.target),i=new o({target:t,verticalOffset:-10,horizontalOffset:t.width()-100,horizontalPosition:"left",tick:"center"});i.render(),i.on("onDropdownHidden",function(){i.clean()},this),i.open()}})},,,function(e,t,i){"use strict";var s=i(4),n=i(1),o=i(2131),r=i(395);e.exports=n.extend({events:{"click .js-dropdown-target":"_createDropdown"},render:function render(){var e=this.model.viewUrl().dashboard(),t=e.datasets(),i=e.maps();return this.$el.html(r({avatarUrl:this.model.get("avatar_url"),mapsUrl:i,datasetsUrl:t})),this},_createDropdown:function _createDropdown(e){var t=new o({target:s(e.target),model:this.model,horizontalOffset:18});t.render(),t.on("onDropdownHidden",function(){t.clean()},this),t.open()}})},,function(e,t,i){"use strict";var s=i(1),n=i(398),o=i(3),r=["configModel","userModel"];e.exports=s.extend({initialize:function initialize(e){o(e,r,this),this._initBinds()},render:function render(){var e=this._configModel.get("upgrade_url"),t=e&&!this._configModel.get("cartodb_com_hosted")&&(!this._userModel.isInsideOrg()||this._userModel.isOrgOwner());return this.$el.html(n({canUpgrade:t,closeToLimits:this._userModel.isCloseToLimits(),upgradeableWithoutContactingSales:!this._userModel.isEnterprise(),quotaPer:100*this._userModel.get("remaining_byte_quota")/this._userModel.get("quota_in_bytes"),upgradeUrl:e,showTrial:this._userModel.canStartTrial()})),this},_initBinds:function _initBinds(){this.listenTo(this._userModel,"change",this.render)}})},,,function(e,t,i){"use strict";var s=i(1),n=i(401),o=i(3),r=["userModel"];e.exports=s.extend({className:"SupportBanner",initialize:function initialize(e){o(e,r,this)},render:function render(){return this.$el.html(n({userType:this._getUserType(),orgDisplayEmail:this._getOrgAdminEmail(),isViewer:this._userModel.isViewer()})),this},_getUserType:function _getUserType(){var e=this._userModel.get("account_type").toLowerCase();return this._userModel.isOrgOwner()?"org_admin":this._userModel.isInsideOrg()?"org":"internal"===e||"partner"===e||"ambassador"===e?"internal":"free"!==e?"client":"regular"},_getOrgAdminEmail:function _getOrgAdminEmail(){return this._userModel.isInsideOrg()?this._userModel.organization&&this._userModel.organization.display_email:null}})},function(e,t,i){"use strict";var s=i(4),n=i(1),o=i(3),r=i(303),a=i(302),l=i(2215),h=i(2214),c=i(978),d=i(2213),u=["viewModel","configModel"];e.exports=n.extend({events:{"click .js-breadcrumb-dropdown":"_createBreadcrumbsDropdown","click .js-settings-dropdown":"_createSettingsDropdown"},initialize:function initialize(e){if(o(e,u,this),!this.options.el)throw new Error("el element is required");this.router=this.options.router,this._initBinds()},render:function render(){return this.clearSubViews(),this._renderBreadcrumbsDropdownLink(),this._renderSupportLink(),this._renderNotifications(),this._renderLogoLink(),this},_initBinds:function _initBinds(){this._viewModel.bind("change",this._renderBreadcrumbsDropdownLink,this),this.listenTo(this._viewModel,"change",this._renderBreadcrumbsDropdownLink),this.router&&this.listenTo(this.router.model,"change",this._onRouterChange),this.collection&&(this.listenTo(this.collection,"reset",this._stopLogoAnimation),this.listenTo(this.collection,"error",this._onCollectionError))},_onCollectionError:function _onCollectionError(e,t,i){(!t||t&&"abort"!==t.statusText)&&this._stopLogoAnimation()},_onRouterChange:function _onRouterChange(e,t){e.changed&&!e.changed.content_type&&this.collection.total_user_entries>0&&this._startLogoAnimation()},_startLogoAnimation:function _startLogoAnimation(){this.$(".Logo").addClass("is-loading")},_stopLogoAnimation:function _stopLogoAnimation(){this.$(".Logo").removeClass("is-loading")},_renderBreadcrumbsDropdownLink:function _renderBreadcrumbsDropdownLink(){this.$(".js-breadcrumb-dropdown").html(a({title:this._viewModel.breadcrumbTitle(),dropdownEnabled:this._viewModel.isBreadcrumbDropdownEnabled()}))},_renderNotifications:function _renderNotifications(){var e=new c({user:this.model,configModel:this._configModel,organizationNotifications:this.options.organizationNotifications});this.$(".js-user-notifications").html(e.render().el),this.addView(e)},_renderSupportLink:function _renderSupportLink(){new d({el:s(".js-user-support"),userModel:this.model,configModel:this._configModel}).render()},_renderLogoLink:function _renderLogoLink(){this.$(".js-logo").html(r({homeUrl:this.model.viewUrl().dashboard(),googleEnabled:this.model.featureEnabled("google_maps")}))},_createSettingsDropdown:function _createSettingsDropdown(e){this.killEvent(e),this._setupDropdown(new l({target:s(e.target),model:this.model,configModel:this._configModel,horizontalOffset:15}))},_createBreadcrumbsDropdown:function _createBreadcrumbsDropdown(e){this._viewModel.isBreadcrumbDropdownEnabled()&&(this.killEvent(e),this._setupDropdown(new h({target:s(e.target),model:this.model,viewModel:this._viewModel,router:this.router,tick:"center",template:i(299),horizontalOffset:this.options.breadcrumbsDropdownOffset})))},_setupDropdown:function _setupDropdown(e){this._closeAnyOtherOpenDialogs(),this._previousDropDown=e,this.addView(e),e.on("onDropdownHidden",function(){e.clean()},this),e.render(),e.open()},_closeAnyOtherOpenDialogs:function _closeAnyOtherOpenDialogs(){this._previousDropDown&&this._previousDropDown.hide()}})},function(e,t,i){"use strict";var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e};var n=i(2),o=i(3),r=["key","configModel"];e.exports=n.Model.extend({sync:function sync(e,t,i){return n.sync("update",t,i)},url:function url(){return this._configModel.get("url_prefix")+"/api/v3/notifications/"+this.get("key")},initialize:function initialize(e,t){o(t,r,this),this.attributes={notifications:e,key:this._key}},getKey:function getKey(e){return(this.get("notifications")||{})[e]},setKey:function setKey(e,t){var i=this.get("notifications");this.set("notifications",s({},i,function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}({},e,t)))}})},function(e,t,i){"use strict";var s=i(0),n=function LocalStorageWrapper(e){this.name=e||"cartodb",!localStorage.getItem(this.name)&&this.isEnabled()&&localStorage.setItem(this.name,"{}")};n.prototype.isEnabled=function(){try{return localStorage.setItem("checking","test"),localStorage.removeItem("checking"),!0}catch(e){return!1}},n.prototype.get=function(e){return!!this.isEnabled()&&(void 0===e?JSON.parse(localStorage.getItem(this.name)):JSON.parse(localStorage.getItem(this.name))[e])},n.prototype.search=function(e){if(!this.isEnabled())return null;var t=JSON.parse(localStorage.getItem(this.name));for(var i in t)if(t[i][e])return t[i][e];return null},n.prototype.set=function(e){if(!this.isEnabled())return null;var t=s.extend(this.get(),e);return localStorage.setItem(this.name,JSON.stringify(t))},n.prototype.add=function(e){return this.set(e)},n.prototype.remove=function(e){if(!this.isEnabled())return null;var t=s.omit(this.get(),e);return localStorage.setItem(this.name,JSON.stringify(t))},n.prototype.destroy=function(){localStorage.removeItem(this.name)},e.exports=n},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({defaults:{content_type:"",page:1,q:"",tag:"",category:"",shared:"no",locked:!1,liked:!1,library:!1,order:"updated_at",deepInsights:!1},isSearching:function isSearching(){return this.get("q")||this.get("tag")},isDatasets:function isDatasets(){return"datasets"===this.get("content_type")},isMaps:function isMaps(){return"maps"===this.get("content_type")},isDeepInsights:function isDeepInsights(){return this.isMaps()&&this.get("deepInsights")}})},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(3),r=["config"],a=s.Model.extend({defaults:{likeable:!0},url:function url(e){var t=this._config.urlVersion("like",e);return this._config.get("base_url")+"/api/"+t+"/viz/"+this.get("vis_id")+"/like"},initialize:function initialize(e,t){o(t,r,this),n.bindAll(this,"_onSaveError"),this.on("destroy",function(){this.set({liked:!1,likes:this.get("likes")-1})},this)},_onSaveError:function _onSaveError(e,t){this.trigger("error",{status:t.status,statusText:t.statusText})},toggleLiked:function toggleLiked(){this.get("liked")?this.destroy():(this.set({id:null},{silent:!0}),this.save({},{error:this._onSaveError}))}},{newByVisData:function newByVisData(e){var t=n.defaults({id:e.liked?e.vis_id:null},n.omit(e,"url","config")),i=new a(t,{config:e.config});return e.url&&(i.url=e.url),i}});e.exports=a},function(e,t,i){"use strict";var s=i(0),n=i(7).result,o=i(2),r=i(176),a=i(314),l=i(590),h=i(3),c=o.Model.extend({defaults:{access:"r"},isOwn:function isOwn(e){return e.id===this.get("entity").id},validate:function validate(e,t){var i=u;if(e.access!==i.READ_ONLY&&e.access!==i.READ_WRITE)return"access can't take 'r' or 'rw' values"},toJSON:function toJSON(){var e=s.pick(this.get("entity").toJSON(),"id","username","avatar_url","name");return e.username||(e.username=e.name,delete e.name),{type:this.get("type")||"user",entity:e,access:this.get("access")}}}),d=["configModel"],u=o.Model.extend({urlRoot:"/api/v1/perm",initialize:function initialize(e,t){h(t,d,this),this.acl=new o.Collection,this.owner=null,this._generateOwner(),this._generateAcl(),this.bind("change:owner",this._generateOwner,this),this.bind("change:acl",this._generateAcl,this)},_generateOwner:function _generateOwner(){this.owner||(this.owner=new r(void 0,{configModel:this._configModel})),this.owner.set(this.get("owner"))},_generateAcl:function _generateAcl(){this.acl.reset([],{silent:!0}),s.each(this.get("acl"),function(e){var t;switch(e.type){case"user":t=new r(e.entity,{configModel:this._configModel});break;case"org":t=new a(e.entity,{configModel:this._configModel});break;case"group":t=new l(e.entity,{configModel:this._configModel});break;default:throw new Error("Unknown ACL item type: "+e.type)}this._grantAccess(t,e.access)},this)},cleanPermissions:function cleanPermissions(){this.acl.reset()},hasAccess:function hasAccess(e){return this.hasReadAccess(e)},hasReadAccess:function hasReadAccess(e){return!!this.findRepresentableAclItem(e)},hasWriteAccess:function hasWriteAccess(e){return n(this.findRepresentableAclItem(e),"get","access")===u.READ_WRITE},canChangeReadAccess:function canChangeReadAccess(e){return this._canChangeAccess(e)},canChangeWriteAccess:function canChangeWriteAccess(e){return(!e.isBuilder||e.isBuilder())&&this._canChangeAccess(e,function(e){return n(e,"get","access")!==u.READ_WRITE})},_canChangeAccess:function _canChangeAccess(e){var t=this.findRepresentableAclItem(e);return this.isOwner(e)||!t||t===this._ownAclItem(e)||n(arguments,1,t)||!1},grantWriteAccess:function grantWriteAccess(e){this._grantAccess(e,this.constructor.READ_WRITE)},grantReadAccess:function grantReadAccess(e){this._grantAccess(e,this.constructor.READ_ONLY)},revokeWriteAccess:function revokeWriteAccess(e){this.grantReadAccess(e)},revokeAccess:function revokeAccess(e){var t=this._ownAclItem(e);t&&this.acl.remove(t)},getOwner:function getOwner(){return this.owner},isOwner:function isOwner(e){return s.result(this.owner,"id")===s.result(e,"id")},toJSON:function toJSON(){return{entity:this.get("entity"),acl:this.acl.toJSON()}},getUsersWithAnyPermission:function getUsersWithAnyPermission(){return this.acl.chain().filter(this._hasTypeUser).map(this._getEntity).value()},isSharedWithOrganization:function isSharedWithOrganization(){return this.acl.any(this._hasTypeOrg)},clone:function clone(){var e=s.clone(this.attributes);return delete e.id,new u(e,{configModel:this._configModel})},overwriteAcl:function overwriteAcl(e){this.acl.reset(e.acl.models)},findRepresentableAclItem:function findRepresentableAclItem(e){if(this.isOwner(e))return this._newAclItem(e,this.constructor.READ_WRITE);return this._findMostPrivilegedAclItem(["_ownAclItem","_organizationAclItem","_mostPrivilegedGroupAclItem"],function(t){return this[t](e)})},_hasTypeUser:function _hasTypeUser(e){return"user"===e.get("type")},_getEntity:function _getEntity(e){return e.get("entity")},_hasTypeOrg:function _hasTypeOrg(e){return"org"===e.get("type")},_isOrganization:function _isOrganization(e){return e instanceof a},_ownAclItem:function _ownAclItem(e){if(e&&s.isFunction(e.isNew)||console.error("model is required to find an ACL item"),!e.isNew())return this.acl.find(function(t){return t.get("entity").id===e.id})},_organizationAclItem:function _organizationAclItem(e){var t=s.result(e.collection,"organization")||e.organization;if(t)return this._ownAclItem(t)},_mostPrivilegedGroupAclItem:function _mostPrivilegedGroupAclItem(e){var t=s.result(e.groups,"models");if(t)return this._findMostPrivilegedAclItem(t,this._ownAclItem)},_findMostPrivilegedAclItem:function _findMostPrivilegedAclItem(e,t){for(var i,s=0,o=e[s];o&&n(i,"get","access")!==u.READ_WRITE;o=e[++s])i=t.call(this,o)||i;return i},_grantAccess:function _grantAccess(e,t){var i=this._ownAclItem(e);if(i)i.set("access",t);else{if(!(i=this._newAclItem(e,t)).isValid())throw new Error(t+" is not a valid ACL access");this.acl.add(i)}},_newAclItem:function _newAclItem(e,t){var i=e.get("type")||e.getModelType();return new c({type:i,entity:e,access:t})}},{READ_ONLY:"r",READ_WRITE:"rw"});e.exports=u},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(987),r=i(2262),a=i(2261),l=s.Model.extend({urlRoot:function urlRoot(){return this._configModel.get("base_url")+"/api/v1/users"},defaults:{avatar_url:"http://cartodb.s3.amazonaws.com/static/public_dashboard_default_avatar.png",username:"",email:""},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,e=e||{},n.isEmpty(this.get("organization"))||(this._organizationModel=new o(this.get("organization"),{configModel:this._configModel,currentUserId:this.id})),this.get("layers")&&(this.layers=new a(this.get("layers"),{configModel:this._configModel,currentUserId:this.id})),this.groups=new r(e.groups,{organization:this._organizationModel})},isViewer:function isViewer(){return!0===this.get("viewer")},isBuilder:function isBuilder(){return!this.isViewer()},canCreateDatasets:function canCreateDatasets(){return!(!this.get("remaining_byte_quota")||this.get("remaining_byte_quota")<=0)},hasCreateMapsFeature:function hasCreateMapsFeature(){return this.isBuilder()},canCreateTwitterDataset:function canCreateTwitterDataset(){var e=this.get("twitter");return!(e.quota-e.monthly_use)<=0&&e.hard_limit},hasOwnTwitterCredentials:function hasOwnTwitterCredentials(){var e=this.get("twitter");return e&&e.customized_config||!1},canSelectPremiumOptions:function canSelectPremiumOptions(e){return this.get("actions")[e.isVisualization()?"private_maps":"private_tables"]},canStartTrial:function canStartTrial(){return!this.isInsideOrg()&&"FREE"===this.get("account_type")&&this.get("table_count")>0},isActionEnabled:function isActionEnabled(e){return this.get("actions")&&this.get("actions")[e]},canCreatePrivateDatasets:function canCreatePrivateDatasets(){var e=this.get("actions");return e&&e.private_tables},isInsideOrg:function isInsideOrg(){return!!this._organizationModel&&(!!this._organizationModel.id||this.isOrgOwner())},isOrgOwner:function isOrgOwner(){return!!this._organizationModel&&this._organizationModel.getOwnerId()===this.get("id")},isOrgAdmin:function isOrgAdmin(){return!!this._organizationModel&&this._organizationModel.isOrgAdmin(this)},hasAccountType:function hasAccountType(e){return this.get("account_type")===e},featureEnabled:function featureEnabled(e){var t=this.get("feature_flags");return!(!t||0===t.length||!e)&&n.contains(t,e)},upgradeContactEmail:function upgradeContactEmail(){return this.isInsideOrg()?this.isOrgOwner()?"enterprise-support@carto.com":this._organizationModel.getOwnerEmail():"support@carto.com"},nameOrUsername:function nameOrUsername(){return this.fullName()||this.get("username")},fullName:function fullName(){var e=this.get("name")||"",t=this.get("last_name")||"";return e||t?e+(e&&t?" ":"")+t:""},getMaxConcurrentImports:function getMaxConcurrentImports(){return this.get("limits")&&this.get("limits").concurrent_imports||1},getSchemaName:function getSchemaName(){return this.isInsideOrg()?this.get("username"):"public"},renderData:function renderData(e){var t=this.get("username");return e&&e.id===this.id&&(t=_t("user.you")),{username:t,avatar_url:this.get("avatar_url")}},clone:function clone(){var e=n.clone(this.attributes);return delete e.id,new l(e,{configModel:this._configModel})},getOrganization:function getOrganization(){return this._organizationModel}});e.exports=l},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(4),r=1.2;e.exports=s.Model.extend({defaults:{name:"",url:"",state:"",run_at:0,ran_at:0,retried_times:0,interval:0,error_code:0,error_message:"",service_name:"",service_item_id:"",content_guessing:!0,type_guessing:!0},urlRoot:function urlRoot(){var e=this._configModel.urlVersion("synchronizations");return this._configModel.get("base_url")+"/api/"+e+"/synchronizations/"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,this.bind("destroy",function(){this.unset("id")}),this._checkState(),this.bind("change:error_code change:error_message change:state",this._checkState,this)},toJSON:function toJSON(){var e=n.clone(this.attributes),t={url:e.url,interval:e.interval,content_guessing:e.content_guessing,type_guessing:e.type_guessing,create_vis:e.create_vis};return"remote"===e.type&&n.extend(t,{remote_visualization_id:e.remote_visualization_id,create_vis:!1,value:e.value}),void 0!==e.id&&(t.id=e.id),e.service_name&&(t.service_name=e.service_name,t.service_item_id=e.service_item_id),t},_checkState:function _checkState(){(this.get("error_code")||this.get("error_message"))&&this.set("state","failure")},syncNow:function syncNow(e){if(!e)throw new Error("callback is required");o.ajax({url:this.url()+"/sync_now",type:"PUT"}).always(e)},pollCheck:function pollCheck(e){var t=this,i=1500;this.pollTimer=setInterval(function request(){t.destroyCheck();t.fetch({error:function error(e,i){t.set({error_message:i.statusText||"",state:"failure"})}});i*=r;t.pollTimer=setInterval(request,i)},i)},destroyCheck:function destroyCheck(){clearInterval(this.pollTimer)},isSync:function isSync(){return!this.isNew()&&this.get("interval")>0},isSyncing:function isSyncing(){return"syncing"===this.get("state")||"queued"===this.get("state")},canSyncNow:function canSyncNow(){var e=new Date(this.get("ran_at")),t=new Date;return!this.isSyncing()&&t.getTime()-e.getTime()>9e5},linkToTable:function linkToTable(e){var t=this;e.has("synchronization")&&this.set(e.get("synchronization")),e.bind("change:synchronization",function(){t.set(e.get("synchronization"))},e),e.bind("destroy",function destroy(){t.unbind(null,null,e),t.destroy()},e)}},{SYNC_GAP:9e5,POLLING_GAP:15e3})},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(989),r=i(988),a=[8001,8005];e.exports=n.extend({initialize:function initialize(e){if(!e.userModel)throw new Error("userModel is required");if(!e.configModel)throw new Error("configModel is required");if(!e.error)throw new Error("error is required");this._userModel=e.userModel,this._configModel=e.configModel,this._error=e.error},render:function render(){var e=s.contains(a,this._error.errorCode),t=this._configModel.get("upgrade_url"),i=t&&!this._configModel.get("cartodb_com_hosted")&&(!this._userModel.isInsideOrg()||this._userModel.isOrgOwner()),n=this._getTemplate(e)({errorCode:this._error.errorCode,title:this._error.title,text:this._error.what_about,itemQueueId:this._error.item_queue_id,originalUrl:this._error.originalUrl,httpResponseCode:this._error.httpResponseCode,httpResponseCodeMessage:this._error.httpRresponseCodeMessage,userCanUpgrade:i,showTrial:this._userModel.canStartTrial(),upgradeUrl:t});return this.$el.html(n),this},_getTemplate:function _getTemplate(e){var t=o;return e&&(t=r),t}})},,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(0),n=i(281),o={},r=["querySchemaModel","layerDefinitionModel","tokens"],a={tableName:!0,columnsName:!0,keywords:!0};e.exports={init:function init(e){if(!e)throw new Error("options are required for hints");this.options=s.defaults(s.pick(e,["tableName","columnsName","keywords"]),a),s.each(r,function(t){this["_"+t]=e[t]},this)},hints:function hints(){return this.hints},reset:function reset(){return this.hints=s.union(this._getTableName(),this._getColumns(),this._getKeywords()),this},_getKeywords:function _getKeywords(){return this.options.keywords?this._tokens&&this._memo(this._tokens):[]},_getColumns:function _getColumns(){return this.options.columnsName?this._querySchemaModel.columnsCollection.map(function(e){return{text:e.get("name"),type:"Column_name"}}):[]},_getTableName:function _getTableName(){if(!this.options.tableName)return[];var e=this._layerDefinitionModel.getTableName();return[{text:e=n.getUnqualifiedName(e),type:"Table_name"}]},_memo:function _memo(e,t){return e in o?o[e]:o[e]=this._make(e,t)},_make:function _make(e,t){return s.chain(e).map(function(e){return e.keywords.split(" ").map(function(t){return{text:t,type:e.type}})}).flatten().value()}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(0),n=i(4),o=i(2),r=i(1),a=i(463),l=i(462),h=i(7);i(2347);e.exports=r.extend({events:{"blur .js-hex":"_onChangeHex","blur .js-inputColor":"_onChangeColorValue","blur .js-a":"_onChangeOpacity"},initialize:function initialize(e){var t=null!=e.opacity?e.opacity:1;this.model=new o.Model({hex:e.value,opacity:t}),this._onEscape=this._onEscapePressed.bind(this),this._initBinds()},render:function render(){var e=h.hexToRGB(this.model.get("hex")),t=s.extend(e,{hex:this.model.get("hex"),opacity:this.model.get("opacity"),opacityDisabled:this.options.disableOpacity});this.$el.append(a(t));var i=s.template("rgba(<%- r %>, <%- g %>, <%- b %>, <%- opacity %>)");this.$(".js-colorPicker").colorpicker({color:i(t),format:"rgba",container:!0,horizontal:!0,inline:!0,customClass:"ColorPicker",template:l(),slidersHorz:{saturation:{maxLeft:206,maxTop:95,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:180,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:180,maxTop:0,callLeft:"setAlpha",callTop:!1}}}),this.options.disableOpacity&&this.$(".js-colorPicker .js-alpha").addClass("is-hidden");var n=function(e){var t=e.color.toRGB(),i=e.color.toHex();this.model.set({hex:i,r:t.r,g:t.g,b:t.b,opacity:t.a}),this.$(".js-color").css("opacity",t.a)}.bind(this);return this.$(".js-colorPicker").colorpicker().on("changeColor",n),this._initDocumentBinds(),this},_initBinds:function _initBinds(){this.model.bind("change:hex",this._onChangeColor,this),this.model.bind("change:r",this._onChangeColor,this),this.model.bind("change:g",this._onChangeColor,this),this.model.bind("change:b",this._onChangeColor,this),this.model.bind("change:opacity",this._onChangeColor,this)},_onEscapePressed:function _onEscapePressed(e){27===e.which&&this.remove()},_initDocumentBinds:function _initDocumentBinds(){n(document).on("keydown",this._onEscape)},_destroyDocumentBinds:function _destroyDocumentBinds(){n(document).off("keydown",this._onEscape)},_onChangeColor:function _onChangeColor(){this.trigger("change",{opacity:this.model.get("opacity"),hex:this.model.get("hex")},this),this.$(".js-hex").val(this.model.get("hex")),this.$(".js-r").val(this.model.get("r")),this.$(".js-g").val(this.model.get("g")),this.$(".js-b").val(this.model.get("b")),this.$(".js-a").val(this.model.get("opacity"))},_onChangeOpacity:function _onChangeOpacity(){var e=+this.$(".js-a").val();s.isNumber(e)&&e>=0&&e<=1&&this.setColor(this.model.get("hex"),e)},_onChangeColorValue:function _onChangeColorValue(e){this.$(e.target).removeClass("has-error");var t=+this.$(".js-r").val(),i=+this.$(".js-g").val(),s=+this.$(".js-b").val(),n=h.rgbToHex(t,i,s);h.isValidHex(n)?this.setColor(n):this.$(e.target).addClass("has-error")},_onChangeHex:function _onChangeHex(e){this.$(e.target).removeClass("has-error");var t=this.$(".js-hex").val();h.isValidHex(t)?this.setColor(t):this.$(e.target).addClass("has-error")},setColor:function setColor(e,t){s.isUndefined(t)&&(t=this.model.get("opacity")||1),this.$(".js-colorPicker").colorpicker("setValue",h.hexToRGBA(e,t))},clean:function clean(){this._destroyDocumentBinds(),this.trigger("onClean",this),r.prototype.clean.apply(this)}})},,,,,,function(e,t,i){"use strict";var s=i(1),n=i(223),o=i(174),r=i(469);e.exports=s.extend({defaults:{headerTitle:""},events:{"click .js-back":"_onClickBack"},initialize:function initialize(e){if(!e.stackLayoutModel)throw new Error("stackLayoutModel is required");if(!e.columns)throw new Error("columns param is required");this._stackLayoutModel=e.stackLayoutModel,this._columns=e.columns,this._showSearch=e.showSearch||!1,this._typeLabel=e.typeLabel,this._itemTemplate=e.itemTemplate,this.collection=new o(this._columns),this.listenTo(this.collection,"change:selected",this._onSelectItem)},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.append(r({headerTitle:this.options.headerTitle})),this._initViews(),this},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_initViews:function _initViews(){this._listView=new n({collection:this.collection,showSearch:this._showSearch,typeLabel:this._typeLabel,itemTemplate:this._itemTemplate}),this.$(".js-content").append(this._listView.render().$el),this.addView(this._listView)},_onSelectItem:function _onSelectItem(e){this.trigger("selectItem",e,this)}})},,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(1),n=i(0),o=i(268),r=i(490),a=i(489),l=i(488),h=i(7);e.exports=s.extend({module:"components:custom-list:custom-list-view",options:{size:3},className:"CDB-Text CDB-Size-medium CustomList-listWrapper",tagName:"div",events:{"click .js-add-custom-value":"_onClickAddCustomValue",mouseover:"_onMouseOver",mouseout:"_onMouseOut"},initialize:function initialize(e){this.options=n.extend({},this.options,e),this._onKeyDownBinded=this._onKeyDown.bind(this),this._needsMaxSize=!0,this.options.mouseOverAction&&(this._mouseOverAction=this.options.mouseOverAction),this.options.mouseOutAction&&(this._mouseOutAction=this.options.mouseOutAction),this._initBinds()},render:function render(){this.clearSubViews(),this._removeArrowBinds(),this._destroyCustomScroll(),this.$el.empty();var e=this.model.get("query"),t=this.collection.search(e);this.$el.append(l());var i=this.options.allowFreeTextInput;return i&&e&&!h.isBlank(e)&&(this.collection.containsValue(e)||this.$el.prepend(a({query:e,typeLabel:this.options.typeLabel}))),t.size()>0?(t.each(this._renderItem,this),this._applyArrowBinds(),setTimeout(this._applyCustomScroll.bind(this),0)):i&&!h.isBlank(e)||this.$el.append(r({query:e,typeLabel:this.options.typeLabel})),this},_renderItem:function _renderItem(e){if(!e.get("hidden")){var t=new(0,this.options.itemView)({model:e,typeLabel:this.options.typeLabel,template:this.options.itemTemplate});this.$(".js-list").append(t.render().el),this.addView(t),t.bind("customEvent",function(e,t){this.trigger("customEvent",e,t,this)},this)}},_initBinds:function _initBinds(){this.model.bind("change:query",this._onQueryChanged,this)},_applyArrowBinds:function _applyArrowBinds(){document.addEventListener("keydown",this._onKeyDownBinded)},_removeArrowBinds:function _removeArrowBinds(){document.removeEventListener("keydown",this._onKeyDownBinded)},_getSelected:function _getSelected(){var e,t=this.collection.getSelectedItem();return t?(e=t.getValue(),this.$("[data-val='"+e+"']")):null},_highlightSelected:function _highlightSelected(e){var t=e.outerHeight();e.addClass("is-highlighted"),this.$(".js-list").scrollTop(e.index()*t)},_onClickAddCustomValue:function _onClickAddCustomValue(e){this.killEvent(e);var t=this.model.get("query"),i=this.collection.add({val:t,label:"\u201c"+t+"\u201d",dirty:!0});this.collection.sortByKey("val"),i.set("selected",!0)},_onKeyDown:function _onKeyDown(e){if(!1!==this.model.get("visible")){var t,i,s=e.which,o=this.$(".js-listItem"),r=o.filter(".is-highlighted");if(r.removeClass("is-highlighted"),40===s)t=r.length&&r[0]!==o.last()[0]?r.next():o.eq(0);else if(38===s)t=r.length&&r[0]!==o.first()[0]?r.prev():o.last();else if(13===s&&(e.preventDefault(),r&&r.length))return(i=n.first(this.collection.where({val:r.data("val")})))&&i.set("selected",!0),!1;t&&this._highlightSelected(t)}},_onQueryChanged:function _onQueryChanged(){var e=this.collection.findWhere({val:this.model.previous("query"),dirty:!0});this.collection.remove(e),this.render()},_applyCustomScroll:function _applyCustomScroll(){o.initialize(this._wrapperContainer().get(0),{wheelSpeed:2,wheelPropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20})},_destroyCustomScroll:function _destroyCustomScroll(){this._wrapperContainer().length>0&&o.destroy(this._wrapperContainer().get(0))},_wrapperContainer:function _wrapperContainer(){return this.$(".js-list")},clean:function clean(){this._removeArrowBinds(),this._destroyCustomScroll(),s.prototype.clean.apply(this)},highlight:function highlight(){var e=this._getSelected();e&&this._highlightSelected(e)},_onMouseOver:function _onMouseOver(){this._mouseOverAction&&this._mouseOverAction()},_onMouseOut:function _onMouseOut(){this._mouseOutAction&&this._mouseOutAction()}})},,,,function(e,t,i){!function(e){var t=e.Markdown=function(e){switch(typeof e){case"undefined":this.dialect=t.dialects.Gruber;break;case"object":this.dialect=e;break;default:if(!(e in t.dialects))throw new Error("Unknown Markdown dialect '"+String(e)+"'");this.dialect=t.dialects[e]}this.em_state=[],this.strong_state=[],this.debug_indent=""};function mk_block_toSource(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function mk_block_inspect(){var e=i(328);return"Markdown.mk_block( "+e.inspect(this.toString())+", "+e.inspect(this.trailing)+", "+e.inspect(this.lineNumber)+" )"}e.parse=function(e,i){return new t(i).toTree(e)},e.toHTML=function toHTML(t,i,s){var n=e.toHTMLTree(t,i,s);return e.renderJsonML(n)},e.toHTMLTree=function toHTMLTree(e,t,i){"string"==typeof e&&(e=this.parse(e,t));var s=extract_attr(e),n={};s&&s.references&&(n=s.references);var o=function convert_tree_to_html(e,t,i){var s;i=i||{};var n=e.slice(0);"function"==typeof i.preprocessTreeNode&&(n=i.preprocessTreeNode(n,t));var o=extract_attr(n);if(o){for(s in n[1]={},o)n[1][s]=o[s];o=n[1]}if("string"==typeof n)return n;switch(n[0]){case"header":n[0]="h"+n[1].level,delete n[1].level;break;case"bulletlist":n[0]="ul";break;case"numberlist":n[0]="ol";break;case"listitem":n[0]="li";break;case"para":n[0]="p";break;case"markdown":n[0]="html",o&&delete o.references;break;case"code_block":n[0]="pre",s=o?2:1;var r=["code"];r.push.apply(r,n.splice(s,n.length-s)),n[s]=r;break;case"inlinecode":n[0]="code";break;case"img":n[1].src=n[1].href,delete n[1].href;break;case"linebreak":n[0]="br";break;case"link":n[0]="a";break;case"link_ref":n[0]="a";var a=t[o.ref];if(!a)return o.original;delete o.ref,o.href=a.href,a.title&&(o.title=a.title),delete o.original;break;case"img_ref":n[0]="img";var a=t[o.ref];if(!a)return o.original;delete o.ref,o.src=a.href,a.title&&(o.title=a.title),delete o.original}s=1;if(o){for(var l in n[1]){s=2;break}1===s&&n.splice(s,1)}for(;s<n.length;++s)n[s]=convert_tree_to_html(n[s],t,i);return n}(e,n,i);return function merge_text_nodes(e){var t=extract_attr(e)?2:1;for(;t<e.length;)"string"==typeof e[t]?t+1<e.length&&"string"==typeof e[t+1]?e[t]+=e.splice(t+1,1)[0]:++t:(merge_text_nodes(e[t]),++t)}(o),o};var s=t.mk_block=function(e,t,i){1==arguments.length&&(t="\n\n");var s=new String(e);return s.trailing=t,s.inspect=mk_block_inspect,s.toSource=mk_block_toSource,void 0!=i&&(s.lineNumber=i),s};function count_lines(e){for(var t=0,i=-1;-1!==(i=e.indexOf("\n",i+1));)t++;return t}function strong_em(e,t){var i=e+"_state",s="strong"==e?"em_state":"strong_state";function CloseTag(e){this.len_after=e,this.name="close_"+t}return function(n,o){if(this[i][0]==t)return this[i].shift(),[n.length,new CloseTag(n.length-t.length)];var r=this[s].slice(),a=this[i].slice();this[i].unshift(t);var l=this.processInline(n.substr(t.length)),h=l[l.length-1];this[i].shift();return h instanceof CloseTag?(l.pop(),[n.length-h.len_after,[e].concat(l)]):(this[s]=r,this[i]=a,[t.length,t])}}t.prototype.split_blocks=function splitBlocks(e,t){e=e.replace(/(\r\n|\n|\r)/g,"\n");var i,n=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,o=[],r=1;for(null!=(i=/^(\s*\n)/.exec(e))&&(r+=count_lines(i[0]),n.lastIndex=i[0].length);null!==(i=n.exec(e));)"\n#"==i[2]&&(i[2]="\n",n.lastIndex--),o.push(s(i[1],i[2],r)),r+=count_lines(i[0]);return o},t.prototype.processBlock=function processBlock(e,t){var i=this.dialect.block,s=i.__order__;if("__call__"in i)return i.__call__.call(this,e,t);for(var n=0;n<s.length;n++){var r=i[s[n]].call(this,e,t);if(r)return(!o(r)||r.length>0&&!o(r[0]))&&this.debug(s[n],"didn't return a proper array"),r}return[]},t.prototype.processInline=function processInline(e){return this.dialect.inline.__call__.call(this,String(e))},t.prototype.toTree=function toTree(e,t){var i=e instanceof Array?e:this.split_blocks(e),s=this.tree;try{for(this.tree=t||this.tree||["markdown"];i.length;){var n=this.processBlock(i.shift(),i);n.length&&this.tree.push.apply(this.tree,n)}return this.tree}finally{t&&(this.tree=s)}},t.prototype.debug=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,e),"undefined"!=typeof console&&void 0!==console.log&&console.log.apply(null,e)},t.prototype.loop_re_over_block=function(e,t,i){for(var s,n=t.valueOf();n.length&&null!=(s=e.exec(n));)n=n.substr(s[0].length),i.call(this,s);return n},t.dialects={},t.dialects.Gruber={block:{atxHeader:function atxHeader(e,t){var i=e.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(i){var n=["header",{level:i[1].length}];return Array.prototype.push.apply(n,this.processInline(i[2])),i[0].length<e.length&&t.unshift(s(e.substr(i[0].length),e.trailing,e.lineNumber+2)),[n]}},setextHeader:function setextHeader(e,t){var i=e.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(i){var n=["header",{level:"="===i[2]?1:2},i[1]];return i[0].length<e.length&&t.unshift(s(e.substr(i[0].length),e.trailing,e.lineNumber+2)),[n]}},code:function code(e,t){var i=[],n=/^(?: {0,3}\t| {4})(.*)\n?/;if(e.match(n)){e:for(;;){var o=this.loop_re_over_block(n,e.valueOf(),function(e){i.push(e[1])});if(o.length){t.unshift(s(o,e.trailing));break e}if(!t.length)break e;if(!t[0].match(n))break e;i.push(e.trailing.replace(/[^\n]/g,"").substring(2)),e=t.shift()}return[["code_block",i.join("\n")]]}},horizRule:function horizRule(e,t){var i=e.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(i){var n=[["hr"]];return i[1]&&n.unshift.apply(n,this.processBlock(i[1],[])),i[3]&&t.unshift(s(i[3])),n}},lists:function(){var e="[*+-]|\\d+\\.",t=/[*+-]/,i=new RegExp("^( {0,3})("+e+")[ \t]+"),o="(?: {0,3}\\t| {4})";function regex_for_depth(t){return new RegExp("(?:^("+o+"{0,"+t+"} {0,3})("+e+")\\s+)|(^"+o+"{0,"+(t-1)+"}[ ]{0,4})")}function expand_tab(e){return e.replace(/ {0,3}\t/g,"    ")}function add(e,t,i,s){if(t)e.push(["para"].concat(i));else{var n=e[e.length-1]instanceof Array&&"para"==e[e.length-1][0]?e[e.length-1]:e;s&&e.length>1&&i.unshift(s);for(var o=0;o<i.length;o++){var r=i[o];"string"==typeof r&&n.length>1&&"string"==typeof n[n.length-1]?n[n.length-1]+=r:n.push(r)}}}function get_contained_blocks(e,t){for(var i=new RegExp("^("+o+"{"+e+"}.*?\\n?)*$"),n=new RegExp("^"+o+"{"+e+"}","gm"),r=[];t.length>0&&i.exec(t[0]);){var a=t.shift(),l=a.replace(n,"");r.push(s(l,a.trailing,a.lineNumber))}return r}function paragraphify(e,t,i){var s=e.list,n=s[s.length-1];if(!(n[1]instanceof Array&&"para"==n[1][0]))if(t+1==i.length)n.push(["para"].concat(n.splice(1,n.length-1)));else{var o=n.pop();n.push(["para"].concat(n.splice(1,n.length-1)),o)}}return function(e,s){var o=e.match(i);if(o){for(var r,a,l=[],h=make_list(o),c=!1,d=[l[0].list];;){for(var u=e.split(/(?=\n)/),p="",g=0;g<u.length;g++){var m="",f=u[g].replace(/^\n/,function(e){return m=e,""}),_=regex_for_depth(l.length);if(void 0!==(o=f.match(_))[1]){p.length&&(add(r,c,this.processInline(p),m),c=!1,p=""),o[1]=expand_tab(o[1]);var v=Math.floor(o[1].length/4)+1;if(v>l.length)h=make_list(o),r.push(h),r=h[1]=["listitem"];else{var y=!1;for(a=0;a<l.length;a++)if(l[a].indent==o[1]){h=l[a].list,l.splice(a+1,l.length-(a+1)),y=!0;break}y||(++v<=l.length?(l.splice(v,l.length-v),h=l[v-1].list):(h=make_list(o),r.push(h))),r=["listitem"],h.push(r)}m=""}f.length>o[0].length&&(p+=m+f.substr(o[0].length))}p.length&&(add(r,c,this.processInline(p),m),c=!1,p="");var b=get_contained_blocks(l.length,s);b.length>0&&(n(l,paragraphify,this),r.push.apply(r,this.toTree(b,[])));var w=s[0]&&s[0].valueOf()||"";if(!w.match(i)&&!w.match(/^ /))break;e=s.shift();var C=this.dialect.block.horizRule(e,s);if(C){d.push.apply(d,C);break}n(l,paragraphify,this),c=!0}return d}function make_list(e){var i=t.exec(e[2])?["bulletlist"]:["numberlist"];return l.push({list:i,indent:e[1]}),i}}}(),blockquote:function blockquote(e,t){if(e.match(/^>/m)){var i=[];if(">"!=e[0]){for(var n=e.split(/\n/),o=[],a=e.lineNumber;n.length&&">"!=n[0][0];)o.push(n.shift()),a++;var l=s(o.join("\n"),"\n",e.lineNumber);i.push.apply(i,this.processBlock(l,[])),e=s(n.join("\n"),e.trailing,a)}for(;t.length&&">"==t[0][0];){var h=t.shift();e=s(e+e.trailing+h,h.trailing,e.lineNumber)}var c=e.replace(/^> ?/gm,""),d=(this.tree,this.toTree(c,["blockquote"])),u=extract_attr(d);return u&&u.references&&(delete u.references,r(u)&&d.splice(1,1)),i.push(d),i}},referenceDefn:function referenceDefn(e,t){var i=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(e.match(i)){extract_attr(this.tree)||this.tree.splice(1,0,{});var n=extract_attr(this.tree);void 0===n.references&&(n.references={});var o=this.loop_re_over_block(i,e,function(e){e[2]&&"<"==e[2][0]&&">"==e[2][e[2].length-1]&&(e[2]=e[2].substring(1,e[2].length-1));var t=n.references[e[1].toLowerCase()]={href:e[2]};void 0!==e[4]?t.title=e[4]:void 0!==e[5]&&(t.title=e[5])});return o.length&&t.unshift(s(o,e.trailing)),[]}},para:function para(e,t){return[["para"].concat(this.processInline(e))]}}},t.dialects.Gruber.inline={__oneElement__:function oneElement(e,t,i){var s,n;return t=t||this.dialect.inline.__patterns__,(s=new RegExp("([\\s\\S]*?)("+(t.source||t)+")").exec(e))?s[1]?[s[1].length,s[1]]:(s[2]in this.dialect.inline&&(n=this.dialect.inline[s[2]].call(this,e.substr(s.index),s,i||[])),n=n||[s[2].length,s[2]]):[e.length,e]},__call__:function inline(e,t){var i,s=[];function add(e){"string"==typeof e&&"string"==typeof s[s.length-1]?s[s.length-1]+=e:s.push(e)}for(;e.length>0;)i=this.dialect.inline.__oneElement__.call(this,e,t,s),e=e.substr(i.shift()),n(i,add);return s},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function escaped(e){return this.dialect.inline.__escape__.exec(e)?[2,e.charAt(1)]:[1,"\\"]},"![":function image(e){var t=e.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(t){t[2]&&"<"==t[2][0]&&">"==t[2][t[2].length-1]&&(t[2]=t[2].substring(1,t[2].length-1)),t[2]=this.dialect.inline.__call__.call(this,t[2],/\\/)[0];var i={alt:t[1],href:t[2]||""};return void 0!==t[4]&&(i.title=t[4]),[t[0].length,["img",i]]}return(t=e.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/))?[t[0].length,["img_ref",{alt:t[1],ref:t[2].toLowerCase(),original:t[0]}]]:[2,"!["]},"[":function link(e){var i=String(e),s=t.DialectHelpers.inline_until_char.call(this,e.substr(1),"]");if(!s)return[1,"["];var link,n,o=1+s[0],r=s[1],a=(e=e.substr(o)).match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(a){var l=a[1];if(o+=a[0].length,l&&"<"==l[0]&&">"==l[l.length-1]&&(l=l.substring(1,l.length-1)),!a[3])for(var h=1,c=0;c<l.length;c++)switch(l[c]){case"(":h++;break;case")":0==--h&&(o-=l.length-c,l=l.substring(0,c))}return n={href:(l=this.dialect.inline.__call__.call(this,l,/\\/)[0])||""},void 0!==a[3]&&(n.title=a[3]),link=["link",n].concat(r),[o,link]}return(a=e.match(/^\s*\[(.*?)\]/))?(o+=a[0].length,link=["link_ref",n={ref:(a[1]||String(r)).toLowerCase(),original:i.substr(0,o)}].concat(r),[o,link]):1==r.length&&"string"==typeof r[0]?(link=["link_ref",n={ref:r[0].toLowerCase(),original:i.substr(0,o)},r[0]],[o,link]):[1,"["]},"<":function autoLink(e){var t;return null!=(t=e.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?t[3]?[t[0].length,["link",{href:"mailto:"+t[3]},t[3]]]:"mailto"==t[2]?[t[0].length,["link",{href:t[1]},t[1].substr("mailto:".length)]]:[t[0].length,["link",{href:t[1]},t[1]]]:[1,"<"]},"`":function inlineCode(e){var t=e.match(/(`+)(([\s\S]*?)\1)/);return t&&t[2]?[t[1].length+t[2].length,["inlinecode",t[3]]]:[1,"`"]},"  \n":function lineBreak(e){return[3,["linebreak"]]}},t.dialects.Gruber.inline["**"]=strong_em("strong","**"),t.dialects.Gruber.inline.__=strong_em("strong","__"),t.dialects.Gruber.inline["*"]=strong_em("em","*"),t.dialects.Gruber.inline._=strong_em("em","_"),t.buildBlockOrder=function(e){var t=[];for(var i in e)"__order__"!=i&&"__call__"!=i&&t.push(i);e.__order__=t},t.buildInlinePatterns=function(e){var t=[];for(var i in e)if(!i.match(/^__.*__$/)){var s=i.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");t.push(1==i.length?s:"(?:"+s+")")}t=t.join("|"),e.__patterns__=t;var n=e.__call__;e.__call__=function(e,i){return void 0!=i?n.call(this,e,i):n.call(this,e,t)}},t.DialectHelpers={},t.DialectHelpers.inline_until_char=function(e,t){for(var i=0,s=[];;){if(e.charAt(i)==t)return[++i,s];if(i>=e.length)return null;var n=this.dialect.inline.__oneElement__.call(this,e.substr(i));i+=n[0],s.push.apply(s,n.slice(1))}},t.subclassDialect=function(e){function Block(){}function Inline(){}return Block.prototype=e.block,Inline.prototype=e.inline,{block:new Block,inline:new Inline}},t.buildBlockOrder(t.dialects.Gruber.block),t.buildInlinePatterns(t.dialects.Gruber.inline),t.dialects.Maruku=t.subclassDialect(t.dialects.Gruber),t.dialects.Maruku.processMetaHash=function processMetaHash(e){for(var t=function split_meta_hash(e){var t=e.split(""),i=[""],s=!1;for(;t.length;){var n=t.shift();switch(n){case" ":s?i[i.length-1]+=n:i.push("");break;case"'":case'"':s=!s;break;case"\\":n=t.shift();default:i[i.length-1]+=n}}return i}(e),i={},s=0;s<t.length;++s)if(/^#/.test(t[s]))i.id=t[s].substring(1);else if(/^\./.test(t[s]))i.class?i.class=i.class+t[s].replace(/./," "):i.class=t[s].substring(1);else if(/\=/.test(t[s])){var n=t[s].split(/\=/);i[n[0]]=n[1]}return i},t.dialects.Maruku.block.document_meta=function document_meta(e,t){if(!(e.lineNumber>1)&&e.match(/^(?:\w+:.*\n)*\w+:.*$/)){extract_attr(this.tree)||this.tree.splice(1,0,{});var i=e.split(/\n/);for(p in i){var s=i[p].match(/(\w+):\s*(.*)$/),n=s[1].toLowerCase(),o=s[2];this.tree[1][n]=o}return[]}},t.dialects.Maruku.block.block_meta=function block_meta(e,t){var i=e.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(i){var s,n=this.dialect.processMetaHash(i[2]);if(""===i[1]){var o=this.tree[this.tree.length-1];if(s=extract_attr(o),"string"==typeof o)return;for(a in s||(s={},o.splice(1,0,s)),n)s[a]=n[a];return[]}var r=e.replace(/\n.*$/,""),l=this.processBlock(r,[]);for(a in(s=extract_attr(l[0]))||(s={},l[0].splice(1,0,s)),n)s[a]=n[a];return l}},t.dialects.Maruku.block.definition_list=function definition_list(e,t){var i,s=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,n=["dl"];if(a=e.match(s)){for(var o=[e];t.length&&s.exec(t[0]);)o.push(t.shift());for(var r=0;r<o.length;++r){var a,l=(a=o[r].match(s))[1].replace(/\n$/,"").split(/\n/),h=a[2].split(/\n:\s+/);for(i=0;i<l.length;++i)n.push(["dt",l[i]]);for(i=0;i<h.length;++i)n.push(["dd"].concat(this.processInline(h[i].replace(/(\n)\s+/,"$1"))))}return[n]}},t.dialects.Maruku.block.table=function table(e,t){var i,s,o=function(e,t){(t=t||"\\s").match(/^[\\|\[\]{}?*.+^$]$/)&&(t="\\"+t);for(var i,s=[],n=new RegExp("^((?:\\\\.|[^\\\\"+t+"])*)"+t+"(.*)");i=e.match(n);)s.push(i[1]),e=i[2];return s.push(e),s};if(s=e.match(/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/))s[3]=s[3].replace(/^\s*\|/gm,"");else if(!(s=e.match(/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/)))return;var table=["table",["thead",["tr"]],["tbody"]];s[2]=s[2].replace(/\|\s*$/,"").split("|");var r=[];for(n(s[2],function(e){e.match(/^\s*-+:\s*$/)?r.push({align:"right"}):e.match(/^\s*:-+\s*$/)?r.push({align:"left"}):e.match(/^\s*:-+:\s*$/)?r.push({align:"center"}):r.push({})}),s[1]=o(s[1].replace(/\|\s*$/,""),"|"),i=0;i<s[1].length;i++)table[1][1].push(["th",r[i]||{}].concat(this.processInline(s[1][i].trim())));return n(s[3].replace(/\|\s*$/gm,"").split("\n"),function(e){var t=["tr"];for(e=o(e,"|"),i=0;i<e.length;i++)t.push(["td",r[i]||{}].concat(this.processInline(e[i].trim())));table[2].push(t)},this),[table]},t.dialects.Maruku.inline["{:"]=function inline_meta(e,t,i){if(!i.length)return[2,"{:"];var s=i[i.length-1];if("string"==typeof s)return[2,"{:"];var n=e.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!n)return[2,"{:"];var o=this.dialect.processMetaHash(n[1]),r=extract_attr(s);for(var a in r||(r={},s.splice(1,0,r)),o)r[a]=o[a];return[n[0].length,""]},t.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/,t.buildBlockOrder(t.dialects.Maruku.block),t.buildInlinePatterns(t.dialects.Maruku.inline);var n,o=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)};n=Array.prototype.forEach?function(e,t,i){return e.forEach(t,i)}:function(e,t,i){for(var s=0;s<e.length;s++)t.call(i||e,e[s],s,e)};var r=function(e){for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0};function extract_attr(e){return o(e)&&e.length>1&&"object"==typeof e[1]&&!o(e[1])?e[1]:void 0}function escapeHTML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function render_tree(e){if("string"==typeof e)return escapeHTML(e);var t=e.shift(),i={},s=[];for(!e.length||"object"!=typeof e[0]||e[0]instanceof Array||(i=e.shift());e.length;)s.push(render_tree(e.shift()));var n="";for(var o in i)n+=" "+o+'="'+escapeHTML(i[o])+'"';return"img"==t||"br"==t||"hr"==t?"<"+t+n+"/>":"<"+t+n+">"+s.join("")+"</"+t+">"}e.renderJsonML=function(e,t){(t=t||{}).root=t.root||!1;var i=[];if(t.root)i.push(render_tree(e));else for(e.shift(),!e.length||"object"!=typeof e[0]||e[0]instanceof Array||e.shift();e.length;)i.push(render_tree(e.shift()));return i.join("\n\n")}}(t)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(1),n=i(802),o=i(6);e.exports=s.extend({events:{"click .js-redo":"_onRedoClick","click .js-undo":"_onUndoClick","click .js-apply":"_onApplyClick","click .js-clear":"_onClearClick"},options:{applyButton:!1,cancelButton:!1},initialize:function initialize(e){if(!e.editorModel)throw new Error("editorModel is required");if(!e.trackModel)throw new Error("trackModel is required");this._trackModel=e.trackModel,this._editorModel=e.editorModel,this._clearModel=e.clearModel,this._applyStatusModel=e.applyStatusModel,this._overlayModel=e.overlayModel,this._initBinds()},render:function render(){this.clearSubViews();var e=!1;return this._clearModel&&(e=!0===this._clearModel.get("visible")),this.$el.html(n({canUndo:this._canUndo(),canRedo:this._canRedo(),canApply:this.options.applyButton&&this._editorModel.isEditing(),canClear:e,isDisabled:this._isDisabled(),isLoading:this._applyStatusModel&&this._applyStatusModel.get("loading")})),this._initViews(),this._checkButtonsStyle(),this},_initViews:function _initViews(){if(this._canUndo()){var e=new o({el:this.$(".js-undo"),gravity:"s",title:function title(){return _t("components.undo-redo.undo")}});this.addView(e)}if(this._canRedo()){var t=new o({el:this.$(".js-redo"),gravity:"s",title:function title(){return _t("components.undo-redo.redo")}});this.addView(t)}},_initBinds:function _initBinds(){this.listenTo(this._trackModel,"undo redo",this.render),this.listenTo(this._trackModel,"unredoChanged",this.render),this.listenTo(this._editorModel,"change:edition",this._checkButtonsStyle),this._overlayModel&&this.listenTo(this._overlayModel,"change:visible",this.render),this._clearModel&&this.listenTo(this._clearModel,"change",this.render),this._applyStatusModel&&this.listenTo(this._applyStatusModel,"change:loading",this._applyStatusChanged)},_isDisabled:function _isDisabled(){return this._overlayModel&&this._overlayModel.get("visible")},_canRedo:function _canRedo(){return this._trackModel.canRedo()&&!this._isDisabled()},_canUndo:function _canUndo(){return this._trackModel.canUndo()&&!this._isDisabled()},_onUndoClick:function _onUndoClick(){this._trackModel.canUndo()&&this._trackModel.undo()},_onRedoClick:function _onRedoClick(){this._trackModel.canRedo()&&this._trackModel.redo()},_onApplyClick:function _onApplyClick(){this.options.applyButton&&this.options.onApplyClick&&!this._isDisabled()&&this.options.onApplyClick()},_onClearClick:function _onClearClick(){this.options.clearButton&&this.options.onClearClick&&this.options.onClearClick()},_checkButtonsStyle:function _checkButtonsStyle(e){var t=this._editorModel.isEditing();this._getIcons().toggleClass("u-actionTextColor",!t),this._getIcons().toggleClass("u-whiteTextColor",t)},_getIcons:function _getIcons(){return this.$(".js-theme")},_applyStatusChanged:function _applyStatusChanged(){this.render()}})},function(e,t,i){"use strict";var s=i(1),n=i(3),o=["infoboxModel","infoboxCollection"];e.exports=s.extend({initialize:function initialize(e){n(e,o,this),this._initBinds(),this._setSelectedModel()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function _initBinds(){this.listenTo(this._infoboxModel,"change:state",this._onChangeState),this.listenTo(this._infoboxModel,"change:visible",this.render)},_initViews:function _initViews(){var e;this._selectedModel&&(e=this._selectedModel.get("createContentView"),this.infoboxView=e(),this.$el.append(this.infoboxView.render().el),this.addView(this.infoboxView),this._initSubviewBinds())},_setSelectedModel:function _setSelectedModel(){var e=this._infoboxModel.get("state");this._selectedModel=this._infoboxCollection.setSelected(e)},_onChangeState:function _onChangeState(){this._setSelectedModel(),this.render()},_initSubviewBinds:function _initSubviewBinds(){this.listenTo(this.infoboxView,"action:main",this._onMainAction),this.listenTo(this.infoboxView,"action:second",this._onSecondAction),this.listenTo(this.infoboxView,"action:close",this._onClose)},_onMainAction:function _onMainAction(){var e=this._selectedModel.get("mainAction");e&&e()},_onSecondAction:function _onSecondAction(){var e=this._selectedModel.get("secondAction");e&&e()},_onClose:function _onClose(){var e=this._selectedModel.get("closeAction");e?e():this._infoboxModel.set("state",null)}})},function(e,t,i){"use strict";var s=i(0),n=i(10),o=s.template("<span class='CDB-Text u-errorTextColor'><%- title %></span>"),r={track:function track(e){this._notificationId="sql-notifications"},removeNotification:function removeNotification(){n.removeNotification(this._notificationId)},showNotification:function showNotification(e){this._addOrUpdateNotification(this._notificationId,e)},showErrorNotification:function showErrorNotification(e){var t={status:"error",info:_t("notifications.sql.error.body",{body:o({title:_t("notifications.sql.error.title")}),error:this._transformErrors(e)}),closable:!1};this._addOrUpdateNotification(this._notificationId,t)},_transformErrors:function _transformErrors(e){return s.map(e,function(e){return e.message},this).join(". ")},_addOrUpdateNotification:function _addOrUpdateNotification(e,t){var i=this._getNotification(e);i?i.set(t):this._addNotification(e,t)},_addNotification:function _addNotification(e,t){t=s.extend({id:e},t),n.addNotification(t)},_getNotification:function _getNotification(e){return n.getNotification(e)}};e.exports=r},function(e,t,i){"use strict";var s=i(4),n=i(0),o=i(1),r=i(11),a=i(186),l=i(811),h=i(3),c=i(179),d=i(1688),u=[{format:"csv",fetcher:"fetchCSV",geomRequired:!1},{format:"shp",fetcher:"fetch",geomRequired:!0},{format:"kml",fetcher:"fetch",geomRequired:!0},{format:"geojson",label:"geo json",fetcher:"fetch",geomRequired:!0},{format:"svg",fetcher:"fetchSVG",geomRequired:!0}],p=["configModel","queryGeometryModel","modalModel","fromView"];e.exports=o.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_close"},options:{autoClose:!0},initialize:function initialize(e){h(e,p,this),this._layerModel=e.layerModel,this._filename=e.filename,this._initBinds(),"unfetched"===this._queryGeometryModel.get("status")&&this._queryGeometryModel.fetch()},render:function render(){return this.clearSubViews(),this.$el.empty(),"fetched"===this._queryGeometryModel.get("status")||"unavailable"===this._queryGeometryModel.get("status")?this._renderFormats():this._renderLoadingContent(_t("components.modals.export-data.loading.geometry")),this},_renderFormats:function _renderFormats(){var e=this._queryGeometryModel.get("simple_geom"),t=!!e;this.$el.html(l({isGeoreferenced:t,url:this._configModel.getSqlApiUrl()}));var i=!0;n.each(u,function(s){var o=!1===t&&!0===s.geomRequired;!0!==t||null==s.geomRestricted||o||(o=!n.contains(s.geomRestricted,e)),this._renderFormat(s,o,!o&&i),o||(i=!1)},this)},_renderFormat:function _renderFormat(e,t,i){var s=new d({format:e,isDisabled:t,isChecked:i});this.$(".js-formats").append(s.render().el),this.addView(s)},_initBinds:function _initBinds(){this._queryGeometryModel.bind("change:status",function(){"unavailable"!==this._queryGeometryModel.get("status")?this.render():this.showError(_t("components.modals.export-data.error.geometry-error"))},this),this.add_related_model(this._queryGeometryModel)},_getFormat:function _getFormat(e){for(var t in u)if(u[t].format===e)return u[t]},_onConfirm:function _onConfirm(){this._form=this.$(".js-form");var e=s(".js-format[name=format]:checked",this._form).data("format"),t=this._getFormat(e);this._layerModel&&c.track("Downloaded layer",{format:e,layer_id:this._layerModel.get("id"),source:this._layerModel.get("source"),visible:this._layerModel.get("visible"),table_name:this._layerModel.get("table_name"),from_view:this._fromView}),this[t.fetcher](e)},getBaseOptions:function getBaseOptions(){return{filename:this._filename,apiKey:this._configModel.get("api_key")}},getGeomFilteredSql:function getGeomFilteredSql(){var e=this._queryGeometryModel.get("query");return this._queryGeometryModel.get("simple_geom")?"SELECT * FROM (%%sql%%) as subq ".replace(/%%sql%%/g,e):e},_fetch:function _fetch(e,t){this.$(".js-format").val(e.format),this.$(".js-q").val(t),this.$(".js-filename").val(e.filename),this.$(".js-apiKey").val(e.apiKey);var i=["the_geom_webmercator"];if("csv"!==e.format&&i.push("the_geom"),this.$(".js-skipfields").val(i.join(",")),t.length<1e3){var s=this.$(".js-form").attr("action")+"?"+this.$(".js-form").serialize();this._fetchGET(s)}else this.submit();this.$(".js-skipfields").attr("disabled","disabled"),this.options.autoClose?this._close():this._renderLoadingContent(_t("components.modals.export-data.loading.preparing"))},showError:function showError(e){var t=new a({title:_t("hello"),desc:e});this.$el.html(t.render().el),this.addView(t)},_fetchGET:function _fetchGET(e){var t,i=this,s=window.open(e);s.onload=function(){clearInterval(t);var e=function getError(e){var t=null;try{t=JSON.parse(e).error[0]}catch(i){e&&-1!==e.indexOf("error")&&(t=_t("components.modals.export-data.error.unknown"))}return t}(s.document.body.textContent);e?i.showError(e):i._close(),s.close()},window.focus(),t=setInterval(function check(){(s.closed||s.document&&0===s.document.body.textContent.length)&&(i._close(),clearInterval(t))},100)},fetch:function fetch(e){var t=this.getBaseOptions();t.format=e;var i=this._queryGeometryModel.get("query");this._fetch(t,i)},fetchCSV:function fetchCSV(){var e=this.getBaseOptions();e.format="csv";var t=this.getGeomFilteredSql();this.$(".js-skipfields").removeAttr("disabled"),this._fetch(e,t)},fetchSVG:function fetchSVG(){this.fetch("svg")},submit:function submit(){this.$(".js-form").submit()},_renderLoadingContent:function _renderLoadingContent(e){this.$el.html(r({title:e}))},_close:function _close(){this._modalModel.destroy()}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o={number:["date"],boolean:["date"],date:["boolean"]},r={string:{string:!1,number:!0,date:!0,boolean:!0},number:{string:!1,number:!1,date:!0,boolean:!0},date:{string:!1,number:!0,date:!1,boolean:!0},boolean:{string:!1,number:!1,date:!0,boolean:!1}},a=["the_geom_webmercator","cartodb_id","the_geom"];e.exports=n.Model.extend({url:function url(){if(this._tableName){var url=this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("column")+"/tables/"+this._tableName+"/columns/";return this.isNew()||(url+=this.previous("name")||this.get("name")),url}return!1},parse:function parse(e){return{name:e.name,type:e.cartodb_type||e.type,isNew:!1}},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._tableName=t.tableName,this._configModel=t.configModel},isNew:function isNew(){return this.get("isNew")},isEditable:function isEditable(){return!s.contains(a,this.get("name"))},isCartoDBIDColumn:function isCartoDBIDColumn(){return"cartodb_id"===this.get("name")&&"number"===this.get("type")},isGeometryColumn:function isGeometryColumn(){return"geometry"===this.get("type")}},{isTypeChangeDestructive:function isTypeChangeDestructive(e,t){return r[e][t]},isTypeChangeAllowed:function isTypeChangeAllowed(e,t){var i=o[e]||[];return i=i.concat([e]),!s.contains(i,t)}})},function(e,t,i){"use strict";e.exports=" | CARTO"},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(835),r=i(3),a=["visDefinitionModel","userModel"];e.exports=n.extend({className:"Share-with u-flex u-alignCenter",events:{click:"_onClick"},initialize:function initialize(e){r(e,a,this),this.separationClass=e.separationClass||"",this.avatarClass=e.avatarClass||"",this.options.clickPrivacyAction&&(this._clickPrivacyAction=this.options.clickPrivacyAction),this._acl=this._visDefinitionModel.getPermissionModel().acl,this._initBinds()},render:function render(){var e=this._getPeople();return this.clearSubViews(),this.$el.html(o({avatar:this._userModel.get("avatar_url"),people:e,avatarClass:this.avatarClass,separationClass:this.separationClass,hasAction:!!this._clickPrivacyAction})),this.$el.toggleClass("is-pointer",!!this._clickPrivacyAction),this},_getPeople:function _getPeople(){if(this._acl.pluck("type").indexOf("org")>-1)return this._userModel.getOrganization().get("user_count")-1;var e=[];return s.each(this._acl.where({type:"group"}),function(t){var i=t.get("entity");Array.prototype.push.apply(e,i.users.pluck("id"))},this),s.each(this._acl.where({type:"user"}),function(t){var i=t.get("entity");e.push(i.get("id"))},this),e=s.without(e,this._userModel.id),s.unique(e).length},_initBinds:function _initBinds(){this._acl.on("fetch",this.render,this),this.add_related_model(this._acl)},_onClick:function _onClick(){this._clickPrivacyAction&&this._clickPrivacyAction()}})},function(e,t,i){"use strict";var s=i(4),n=i(2),o=i(1),r=i(1729),a=i(578),l=i(1728),h=i(182),c=i(177),d=i(174),u=i(55),p=i(838),g=i(837),m=i(6),f=i(233),_=i(3),v=["visDefinitionModel","userModel","privacyCollection","configModel","isOwner"],y={public:"green",link:"orange",password:"orange-dark",private:"red"};e.exports=o.extend({events:{"click .js-toggle":"_onToggleDialogClicked"},initialize:function initialize(e){if(_(e,v,this),this._visDefinitionModel.isVisualization()&&!this.options.mapcapsCollection)throw new Error("mapcapsCollection is required for visualizations");this._triggerElementID="toggle"+this.cid,this._modals=new u,this.model=new n.Model({privacy:e.visDefinitionModel.get("privacy"),state:"show"}),this._onEscapePressed=this._onEscapePressed.bind(this),this._onDocumentElementClicked=this._onDocumentElementClicked.bind(this),this.options.ownerName&&(this._ownerName=this.options.ownerName),this.options.mapcapsCollection&&(this._mapcapsCollection=this.options.mapcapsCollection),this._configPrivacyCollection(),this._configPanes(),this._initBinds()},render:function render(){var e=this.model.get("privacy"),t=y[e.toLowerCase()];return this.clearSubViews(),this._hideDialog(),this.$el.html(p({privacy:e,cssClass:t,isLoading:"loading"===this.model.get("state"),isOwner:this._isOwner})),this._initViews(),this},_initBinds:function _initBinds(){this._customCollection.on("change:selected",function(e){e.get("disabled")||("password"===e.get("val")?this._showPasswordDialog():(this._onToggleDialogClicked(),this._setPrivacy(e.get("val"))))},this),this.add_related_model(this._customCollection),this.model.on("change:state",this.render,this),this.add_related_model(this.model)},_makePrivacyDialog:function _makePrivacyDialog(){return new r({model:this.model,collection:this._customCollection,userModel:this._userModel,configModel:this._configModel})},_makePasswordDialog:function _makePasswordDialog(){return new l({onBack:this._showPrivacyDialog.bind(this),onEdit:this._setPassword.bind(this)})},_setPassword:function _setPassword(e){""!==e&&(this._privacyCollection.passwordOption().set({password:e}),this.model.set({password:e}),this._setPrivacy("password"))},_setPrivacy:function _setPrivacy(e){var t=e.toUpperCase();this.model.set({privacy:t},{silent:!0}),this._shouldShowPrivacyWarning(t)?this._checkPrivacyChange(t,this._savePrivacy.bind(this),this._discardPrivacyChange.bind(this)):this._savePrivacy()},_savePrivacy:function _savePrivacy(){var e=this,t=this._visDefinitionModel;this.model.set({state:"loading"}),this._privacyCollection.searchByPrivacy(this.model.get("privacy")).saveToVis(t,{success:function success(){e.model.set({state:"show"})},error:function error(){e.model.set({state:"error"})}})},_checkPrivacyChange:function _checkPrivacyChange(e,t,i){var s=this;this._modals.create(function(n){return new a({modalModel:n,privacyType:e,type:s._visDefinitionModel.isVisualization()?"visualization":"dataset",onConfirm:t,onDismiss:i})})},_discardPrivacyChange:function _discardPrivacyChange(){var e=this.model.previous("privacy");this.model.set("privacy",e,{silent:!0}),this.model.set("state","show")},_shouldShowPrivacyWarning:function _shouldShowPrivacyWarning(e){if(!this._userModel.canSelectPremiumOptions(this._visDefinitionModel))return!1;var t=f.isPubliclyAvailable(e);return this._visDefinitionModel.isVisualization()?!!this._mapcapsCollection.length&&t:t},_transformPrivacyOptions:function _transformPrivacyOptions(){return this._privacyCollection.map(function(e){return{label:e.get("title"),val:e.get("privacy").toLowerCase(),disabled:e.get("disabled"),selected:e.get("selected"),renderOptions:{cssClass:e.get("cssClass")}}}).filter(Boolean)},_configPrivacyCollection:function _configPrivacyCollection(){var e=this._transformPrivacyOptions();this._customCollection=new d(e)},_configPanes:function _configPanes(){var e=[{createContentView:this._showNoneDialog},{createContentView:this._makePrivacyDialog.bind(this)},{createContentView:this._makePasswordDialog.bind(this)}];this._collectionPane=new c(e)},_showNoneDialog:function _showNoneDialog(){return!1},_showPasswordDialog:function _showPasswordDialog(){this._collectionPane.at(2).set({selected:!0})},_showPrivacyDialog:function _showPrivacyDialog(){this._customCollection.each(function(e){e.set({selected:!1},{silent:!0})}),this._collectionPane.at(1).set({selected:!0})},_onToggleDialogClicked:function _onToggleDialogClicked(){this._isDialogVisible()?this._hideDialog():(this._onMouseClick(),this._initDocumentBinds(),this._showPrivacyDialog())},_isDialogVisible:function _isDialogVisible(){return!1===this._collectionPane.at(0).get("selected")},_hideDialog:function _hideDialog(){this._destroyDocumentBinds(),this._collectionPane.at(0).set({selected:!0})},_showDialog:function _showDialog(){this._showPrivacyDialog()},_initViews:function _initViews(){var e=new h({collection:this._collectionPane,template:g,mouseOverAction:this._onMouseClick.bind(this)});this.$(".js-dialog").append(e.render().$el),this.addView(e),this._privacyTooltip=new m({el:this.$(".js-tooltip"),gravity:"w",html:!0,title:function(){return this._getPrivacyInfo()}.bind(this)}),this.addView(this._privacyTooltip)},_getPrivacyInfo:function _getPrivacyInfo(){var e=_t("change-privacy");return this._ownerName&&(e=_t("dataset.privacy.info",{name:this._ownerName})),e},_initDocumentBinds:function _initDocumentBinds(){s(document).on("keydown",this._onEscapePressed),s(document).on("mousedown",this._onDocumentElementClicked)},_destroyDocumentBinds:function _destroyDocumentBinds(){s(document).off("keydown",this._onEscapePressed),s(document).off("mousedown",this._onDocumentElementClicked)},_onEscapePressed:function _onEscapePressed(e){27===e.which&&this._hideDialog()},_onDocumentElementClicked:function _onDocumentElementClicked(e){var t=s(e.target);0===t.closest(this.$el).length&&0===t.closest(s("#"+this._triggerElementID)).length&&this._hideDialog()},_onMouseClick:function _onMouseClick(){this._privacyTooltip.hideTipsy()},clean:function clean(){this._destroyDocumentBinds(),o.prototype.clean.apply(this)}})},function(e,t,i){"use strict";var s=i(5),n=i(1),o=i(847),r=i(846),a=i(320),l=i(1734),h=i(961),c=i(533),d=i(1727),u=i(532),p=i(1726),g=i(3),m=["modalModel","visDefinitionModel","privacyCollection","userModel","configModel","isOwner"];e.exports=n.extend({className:"Publish-modal",events:{"click .js-done":"_onDone"},initialize:function initialize(e){g(e,m,this),this._mapcapsCollection=e.mapcapsCollection,this.mode=e.mode||"full"},render:function render(){return this.clearSubViews(),this.$el.html(o({name:this._visDefinitionModel.get("name"),isSimple:!this._hasTabs(),hasShareStats:this._hasShareStats()})),this._initViews(),"full"===this.mode?this._hasOrganization()?this._initTabsViews():this._makePublishView():"share"===this.mode?this._makeShareView():"publish"===this.mode&&this._makePublishView(),this},_hasShareStats:function _hasShareStats(){return"publish"!==this.mode&&this._hasOrganization()},_hasOrganization:function _hasOrganization(){return this._userModel.isInsideOrg()},_hasTabs:function _hasTabs(){return this._hasOrganization()&&"full"===this.mode},_makePublishView:function _makePublishView(){var e=this._createPublishView();this.$(".js-panes").append(e.render().el),this.addView(e)},_makeShareView:function _makeShareView(){var e=this._createShareView();this.$(".js-panes").append(e.render().el),this.addView(e)},_initViews:function _initViews(){var e,t,i,n,o;e=new c({privacyCollection:this._privacyCollection,visDefinitionModel:this._visDefinitionModel,mapcapsCollection:this._mapcapsCollection,userModel:this._userModel,configModel:this._configModel,isOwner:this._isOwner}),this.$(".js-dropdown").append(e.render().el),this.addView(e),void 0!==this._mapcapsCollection?(t=new d({visDefinitionModel:this._visDefinitionModel,mapcapsCollection:this._mapcapsCollection,configModel:this._configModel,userModel:this._userModel}),this.$(".js-update").append(t.render().el),this.addView(t)):(o=_t("components.modals.publish.share.last-published",{date:s(this._visDefinitionModel.get("updated_at")).format("Do MMMM YYYY, HH:mm")}),this.$(".js-update").html(o)),this._hasShareStats()&&(i=new u({visDefinitionModel:this._visDefinitionModel,userModel:this._userModel,avatarClass:"Share-user--big",separationClass:"u-rSpace--xl"}),this.$(".js-share-users").append(i.render().el),this.addView(i)),this._hasOrganization()||(n=new p,this.$(".js-upgrade").append(n.render().el),this.addView(n))},_initTabsViews:function _initTabsViews(){var e=[{name:"share",label:_t("components.modals.publish.menu.share"),createContentView:this._createShareView.bind(this)},{name:"publish",label:_t("components.modals.publish.menu.publish"),createContentView:this._createPublishView.bind(this)}],t={tabPaneOptions:{template:r,tabPaneItemOptions:{tagName:"li",klassName:"CDB-NavSubmenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavSubmenu-link u-upperCase Publish-modalLink"}};this._layerTabPaneView=a(e,t),this.$(".js-panes").append(this._layerTabPaneView.render().$el),this.addView(this._layerTabPaneView)},_createShareView:function _createShareView(){return new h({className:"Share-wrapper",currentUserId:this._userModel.id,visDefinitionModel:this._visDefinitionModel,organization:this._userModel._organizationModel,configModel:this._configModel})},_createPublishView:function _createPublishView(){return new l({visDefinitionModel:this._visDefinitionModel,mapcapsCollection:this._mapcapsCollection,userModel:this._userModel})},_onDone:function _onDone(){this._modalModel.destroy()}})},,function(e,t,i){"use strict";e.exports=function(e){if(!e)throw new Error("all query objects are required");if(!e.querySchemaModel)throw new Error("querySchemaModel is required");if(!e.queryGeometryModel)throw new Error("queryGeometryModel is required");if(!e.queryRowsCollection)throw new Error("queryRowsCollection is required");function fetchModel(e){return new Promise(function(t,i){var s=!1;e.shouldFetch()?(e.fetch(),s=!0):e.isInFinalStatus()?t():s=!0,s&&e.once("inFinalStatus",function(){t()})})}var t=fetchModel(e.querySchemaModel),i=fetchModel(e.queryGeometryModel);return Promise.all([t,i]).then(function(){return fetchModel(e.queryRowsCollection)})}},,,,,,,,function(e,t,i){var s=i(4),n={_isViewport:function(e){return s(window).width()<e},isMobileViewport:function(){return this._isViewport(480)},isTabletViewport:function(){return this._isViewport(760)}};e.exports=n},,,,function(e,t,i){var s=i(1831),n=i(0);e.exports={getURLFromState:function(e){var t=new s(this.getLocalURL());if(t.removeQuery("state"),!n.isEmpty(e)){var i=JSON.stringify(e);t.setQuery("state",i)}return t.toString()},getStateFromCurrentURL:function(){var e=this.getLocalURL();return this.getStateFromURL(e)},getStateFromURL:function(e){var t,i=new s(e),o={};return i.hasQuery("state")&&(t=i.query(!0).state,n.isEmpty(t)||(o=JSON.parse(decodeURIComponent(t)))),o},getLocalURL:n.constant(window.location.href)}},function(e,t,i){"use strict";var s=i(2),n=i(0);e.exports=s.Model.extend({defaults:{base_url:"/CHANGEME"},urlVersion:function urlVersion(e,t,i){return t=t||"",this.get(e+"_"+t+"_url_version")||i||"v1"},getSqlApiUrl:function getSqlApiUrl(e){return e=e||"v2",this._getSqlApiBaseUrl()+"/api/"+e+"/sql"},_getSqlApiBaseUrl:function _getSqlApiBaseUrl(){return this.get("sql_api_template")?this.get("sql_api_template").replace("{user}",this.get("user_name")):this.get("sql_api_protocol")+"://"+this.get("user_name")+"."+this.get("sql_api_domain")+":"+this.get("sql_api_port")},dataServiceEnabled:function dataServiceEnabled(e){var t=this.get("dataservices_enabled");return!!(t&&n.size(t)&&e)&&!!t[e]},dataLibraryEnabled:function dataLibraryEnabled(){return this.get("data_library_enabled")},isHosted:function isHosted(){return this.get("cartodb_com_hosted")}})},,,,,,,,function(e,t,i){"use strict";var s=i(1),n=i(556),o=i(3),r=["model"];e.exports=s.extend({initialize:function initialize(e){o(e,r,this),this.listenTo(this.model,"change",this.render)},render:function render(){return this.$el.toggle(this.model.shouldDisplay()),this.$el.html(n({str:this.model.get("msg"),type:this.model.get("type")})),this}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({defaults:{msg:"",type:"error",display:!1},shouldDisplay:function shouldDisplay(){return this.get("display")&&!!this.get("msg")&&!!this.get("type")},show:function show(e,t){return this.set({display:!0,msg:e,type:t})},hide:function hide(){this.set("display",!1)}})},,,function(e,t,i){"use strict";var s=i(4),n=i(1),o=i(560),r=i(3),a=["notification"];e.exports=n.extend({className:"js-builderNotification",events:{"click .js-close":"_onClose"},initialize:function initialize(e){r(e,a,this),this.render()},render:function render(){return this.$el.html(o()),s("body").prepend(this.$el),this},_onClose:function _onClose(){this._notification.setKey("builder_activated",!0),this._notification.save(),this.clean()}})},,,,,,function(e,t,i){"use strict";var s=i(1),n=i(566),o=i(3),r=["configModel","userModel","assetsVersion"];e.exports=s.extend({initialize:function initialize(e){o(e,r,this)},render:function render(){return this.$el.html(n({assetsVersion:this._assetsVersion,googleAnalyticsDomain:this._configModel.get("google_analytics_domain"),googleAnalyticsMemberType:this._userModel.get("account_type").toUpperCase(),googleAnalyticsUa:this._configModel.get("google_analytics_ua"),googleTagManagerId:this._configModel.get("google_tag_manager_id"),hubspotEnabled:!!this._configModel.get("hubspot_enabled"),hubspotIds:this._configModel.get("hubspot_ids"),hubspotToken:this._configModel.get("hubspot_token"),intercomAppId:this._configModel.get("intercom_app_id"),intercomEnabled:!!this._userModel.featureEnabled("intercom"),trackjsAppKey:this._configModel.get("trackjs_app_key"),trackjsCustomer:this._configModel.get("trackjs_customer"),trackjsEnabled:!!this._configModel.get("trackjs_enabled"),fullstoryEnabled:!!this._configModel.get("fullstory_enabled"),fullstoryOrg:this._configModel.get("fullstoryOrg"),userEmail:this._userModel.get("email"),userName:this._userModel.get("username"),userId:this._userModel.get("id"),userAccountType:this._userModel.get("account_type"),userCreatedAtInSeconds:Date.parse(this._userModel.get("created_at"))/1e3})),this}})},function(e,t,i){"use strict";e.exports={getAssetsVersion:function getAssetsVersion(e){for(var t=window.location.search.substring(1).split("&"),i=0;i<t.length;i++){var s=t[i].split("=");if("v"===s[0])return s[1]}return window.StaticConfig.assetVersion||window.CartoConfig.data.user_frontend_version||e},getAssetsBaseUrl:function getAssetsBaseUrl(){var e=window.CartoConfig.data,t=e.asset_host&&e.asset_host+"/assets";return(window.StaticConfig.assetsBaseUrl||t||e.config.app_assets_base_url)+"/"},getAssetsUrl:function getAssetsUrl(e){return this.getAssetsBaseUrl()+this.getAssetsVersion(e)}}},,,,,,,,,function(e,t,i){"use strict";var s=i(4),n=i(1),o={};!function importAllIconTemplates(){var e=i(576);e.keys().forEach(function(t){o[t]=e(t)})}(),e.exports=n.extend({constructor:function constructor(e){this.placeholder=this._preinitializeWithPlaceholder(e&&e.placeholder),n.prototype.constructor.call(this,e)},initialize:function initialize(e){if(!e||!e.icon)throw new Error("An icon is required to render IconView");if(this.icon=e.icon,this.iconTemplate=this._getIconTemplate(this.icon),!this.iconTemplate)throw new Error("The selected icon does not have any available template")},render:function render(){return this.$el.html(this.iconTemplate),this.placeholder&&this.placeholder.replaceWith(this.$el),this},_getIconTemplate:function _getIconTemplate(e){var t="./"+this.icon+".tpl";return o[t]},_preinitializeWithPlaceholder:function _preinitializeWithPlaceholder(e){if(e){var t=s(e);return this.tagName=t.prop("tagName"),this.className=t.attr("class"),t}}})},function(e,t,i){"use strict";var s=i(231),n=i(577),o=i(575),r=i(3),a=["modalModel","privacyType"];e.exports=s.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_onDismiss"},initialize:function initialize(e){r(e,a,this),this.options.onConfirm&&(this._onConfirmCallback=this.options.onConfirm),this.options.onDismiss&&(this._onDismissCallback=this.options.onDismiss)},render:function render(){this.clearSubViews(),this.$el.html(o({type:this.options.type||"visualization",selectedPrivacyType:this._privacyType}));var e=new n({placeholder:this.$el.find(".js-icon-warning"),icon:"warning"});return e.render(),this.addView(e),this},_onConfirm:function _onConfirm(){this._modalModel.destroy(),this._onConfirmCallback&&this._onConfirmCallback()},_onDismiss:function _onDismiss(){this._modalModel.destroy(),this._onDismissCallback&&this._onDismissCallback()}})},,,function(e,t,i){"use strict";var s=i(1),n=i(580),o=i(3),r=["configModel"];e.exports=s.extend({tagName:"footer",className:function className(){var e="CDB-Text CDB-FontSize-medium Footer";return this.options&&this.options.light&&(e+=" Footer--light"),e},initialize:function initialize(e){o(e,r,this)},render:function render(){return this.$el.html(n({onpremiseVersion:this._configModel.get("onpremise_version"),isHosted:this._configModel.get("cartodb_com_hosted")})),this}})},,function(e,t,i){"use strict";var s=i(403),n=i(582),o=i(3),r=["viewModel","configModel"];e.exports=s.extend({className:"Header CDB-Text",initialize:function initialize(e){o(e,r,this),this.router=this.options.router,this._initBinds()},_initBinds:function _initBinds(){s.prototype._initBinds.apply(this),this.model.bind("change",this.render,this)},render:function render(){this.clearSubViews();var e=this.model.isInsideOrg();return this.$el.html(n({organizationName:e&&this.model.organization.get("name"),nameOrUsername:this.model.nameOrUsername(),avatar:this.model.get("avatar_url"),homeUrl:this.model.viewUrl().dashboard(),isCartoDBHosted:this._configModel.get("cartodb_com_hosted")})),this._renderBreadcrumbsDropdownLink(),this._renderNotifications(),this._renderLogoLink(),this}})},,,,,function(e,t,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=i(0),o=i(2),r=i(9).SQL,a=i(981),l=i(3),h=["configModel"],c="the_geom the_geom_webmercator cartodb_id created_at updated_at".split(" ");e.exports=o.Model.extend({_GEOMETRY_TYPES:{point:"st_point",multipoint:"st_multipoint",linestring:"st_linestring",multilinestring:"st_multilinestring",polygon:"st_polygon",multipolygon:"st_multipolygon"},initialize:function initialize(e,t){l(t,h,this)},url:function url(e){var t=this._configModel.urlVersion("record",e),i=this.table||this.collection.table;i||console.error("row has no table assigned");var s="/api/"+t+"/tables/"+i.get("name")+"/records/";return this.isNew()?s:s+this.id},fetch:function fetch(e){e=e||{};var t=this.options&&this.options.user_data?this.options.user_data.username:window.user_data?window.user_data.username:window.user_name,i=this.options&&this.options.user_data?this.options.user_data.api_key:window.user_data?window.user_data.api_key:window.api_key,s=this.table||this.collection.table,o=new r({user:t,version:"v2",api_key:i,sql_api_template:this._configModel.getSqlApiBaseUrl(),extra_params:["skipfields"]}),a=null,l=s.columnNames();a="SELECT "+(l=e.no_geom?n.without(l,"the_geom","the_geom_webmercator"):n.without(l,"the_geom")).join(",")+" ",s.containsColumn("the_geom")&&!e.no_geom&&(a+=",ST_AsGeoJSON(the_geom, 8) as the_geom "),a+=" from ("+s.data().getSQL()+") _table_sql WHERE cartodb_id = "+this.get("cartodb_id"),e.no_geom?e.skipfields="the_geom,the_geom_webmercator":e.skipfields="the_geom_webmercator",o.execute(a,{},e).done(function(e){this.parse(e.rows[0])&&(this.set(e.rows[0]),this.trigger("sync"))})},toJSON:function toJSON(){var e=n.clone(this.attributes);return delete e.updated_at,delete e.created_at,delete e.the_geom_webmercator,this.isGeometryGeoJSON()||delete e.the_geom,e},isGeomLoaded:function isGeomLoaded(){var e=this.get("the_geom"),t=a.types;return"GeoJSON"!==e&&-1!==e&&!n.contains(t,e)},hasGeometry:function hasGeometry(){var e=this.get("the_geom");return!(null==e||void 0==e||""==e)},isGeometryGeoJSON:function isGeometryGeoJSON(){var e=this.get("the_geom");if(e&&"object"===(void 0===e?"undefined":s(e)))return!!e.coordinates;if("string"!=typeof e)return!1;if("GeoJSON"===e)return!0;try{return!!JSON.parse(e).coordinates}catch(e){return!1}},getFeatureType:function getFeatureType(){if(this.isGeomLoaded())try{return JSON.parse(this.get("the_geom")).type.toLowerCase()}catch(e){console.info("Not possible to parse geometry type")}return null},getGeomType:function getGeomType(){try{return this._GEOMETRY_TYPES[this.getFeatureType()]}catch(e){console.info("Not possible to parse geometry type")}}},{RESERVED_COLUMNS:c,isReservedColumn:function isReservedColumn(e){return-1!==n(c).indexOf(e)}})},function(e,t,i){"use strict";var s=i(4),n=i(2),o=i(0),r=i(2248),a=i(588),l=i(3),h=i(981),c=i(983),d=i(982),u=["configModel"];e.exports=r.extend({_ADDED_ROW_TEXT:"Row added correctly",_ADDING_ROW_TEXT:"Adding a new row",_GEOMETRY_UPDATED:"Table geometry updated",model:function model(e,t){var i=t.collection._configModel;return new a(e,{configModel:i,collection:t.collection})},initialize:function initialize(e,t){l(t,u,this),this.table=t?t.table:null,this.model.prototype.idAttribute="cartodb_id",this.initOptions(),this.filter=null,this._fetching=!1,this.pages=[],this.lastPage=!1,this.bind("newPage",this.newPage,this),this.bind("reset",function(){var e=Math.floor(this.size()/this.options.get("rows_per_page"));this.pages=[];for(var t=0;t<e;++t)this.pages.push(t)},this),this.table&&this.bind("add change:the_geom",function(e){var t=this.table.get("geometry_types");t&&t.length>0||e.get("the_geom")&&this.table.addGeomColumnType(e.getGeomType())},this),r.prototype.initialize.call(this)},initOptions:function initOptions(){var e=this;this.options=new n.Model({rows_per_page:40,page:0,sort_order:"asc",order_by:"cartodb_id",filter_column:"",filter_value:""}),this.options.bind("change",function(){if(!e._fetching){e._fetching=!0;var t={},i=e.options.previous("page");e.options.hasChanged("page")?(t.add=!0,t.changingPage=!0,i>e.options.get("page")&&(t.at=0)):e.options.hasChanged("mode")&&e.options.set({page:0},{silent:!0}),t.success=function(s,n){e.trigger("loaded"),n.rows&&0!==n.rows.length?t.changingPage&&e.trigger("newPage",e.options.get("page"),0===t.at?"up":"down"):e.options.set({page:i}),e.trigger("endLoadingRows",e.options.get("page"),0===t.at?"up":"down"),e._fetching=!1},t.error=function(){console.error("there was some problem fetching rows"),e.trigger("endLoadingRows"),e._fetching=!1},e.trigger("loadingRows",0===t.at?"up":"down"),e.fetch(t)}},this)},parse:function parse(e){return this.modify_rows=0===e.rows.length&&0===o.size(e.fields),this.affected_rows=e.affected_rows,this.lastPage=!1,e.rows.length<this.options.get("rows_per_page")&&(this.lastPage=!0),e.rows},_schemaFromQueryFields:function _schemaFromQueryFields(e){var t={};for(var i in e)t[i]=e[i].type;return t},_createUrlOptions:function _createUrlOptions(e){var t;if(e){var i={};for(var s in this.options.attributes)e(s)&&(i[s]=this.options.attributes[s]);t=o(i)}else t=o(this.options.attributes);var n=t.map(function(e,t){return t+"="+encodeURIComponent(e)}).join("&");return n+="&api_key="+this._configModel.get("api_key")},_geometryColumnSQL:function _geometryColumnSQL(e){return["CASE","WHEN GeometryType("+e+") = 'POINT' THEN","ST_AsGeoJSON("+e+",8)","WHEN ("+e+" IS NULL) THEN","NULL","ELSE","GeometryType("+e+")","END "+e].join(" ")},wrappedSQL:function wrappedSQL(e,t,i){var s=this;t=t||["the_geom_webmercator"],e=o.clone(e);var n=o.chain(e).omit(t).map(function(e,t){return"geometry"===e?i?'st_astext("'+t+'") as '+t:s._geometryColumnSQL(t):'"'+t+'"'}).value();n=n.join(",");var r="desc"===this.options.get("sort_order")?"desc":"asc",a="select "+n+" from ("+this.getSQL()+") __wrapped",l=this.options.get("order_by");return l&&l.length>0&&(a+=" order by "+l+" "+r),a},url:function url(){return this.sqlApiUrl()},sync:function sync(e,t,i){if(i||(i={}),i.data=this._createUrlOptions(function(e){return"sql"!==e}),d.alterTableData(this.options.get("sql")||""))i.data+="&q="+encodeURIComponent(this.options.get("sql")),i.type="POST";else{var s="cartodb_id"in this.query_schema;i.data+="&q="+encodeURIComponent(this.wrappedSQL(this.query_schema,[],!s)),i.data.length>2048&&(i.type="POST")}return n.sync.call(this,e,this,i)},sqlApiUrl:function sqlApiUrl(){return this._configModel.getSqlApiUrl()},setOptions:function setOptions(e){this.options.set(e)},refresh:function refresh(){this.fetch()},isFetchingPage:function isFetchingPage(){return this._fetching},loadPageAtTop:function loadPageAtTop(){if(!this._fetching){var e=this.pages[0];e>0&&this.options.set("page",e-1)}},loadPageAtBottom:function loadPageAtBottom(){if(!this._fetching){var e=this.pages[this.pages.length-1];this.lastPage||this.options.set("page",e+1)}},newPage:function newPage(e,t){this.pages.indexOf(e)<0&&this.pages.push(e),this.pages.sort(function(e,t){return Number(e)>Number(t)});var i=this.options.get("rows_per_page"),s=4*i;this.size()>s&&("up"==t?(this.pages.pop(),this.remove(this.models.slice(s,this.size()))):(this.pages.shift(),this.remove(this.models.slice(0,i))))},addRow:function addRow(e){var t=this;return this.table.notice(this._ADDING_ROW_TEXT,"load",0),e=e||{},o.extend(e,{wait:!0,success:function success(){t.table.notice(t._ADDED_ROW_TEXT)},error:function error(e,i){t.table.error(t._ADDING_ROW_TEXT,i)}}),this.create(null,e)},newRow:function newRow(e){var t=new a(e,{configModel:this._configModel});return t.table=this.table,t.bind("saved",function _saved(){0===t.table.data().length&&(t.table.data().fetch(),t.unbind("saved",_saved,t.table))},t.table),t},getRow:function getRow(e,t){t=t||{};var i=this.get(e);return i||(i=new a({cartodb_id:e},{configModel:this._configModel})),t.no_add||this.table._data.add(i),i.table=this.table,i},getRowAt:function getRowAt(e){var t=this.at(e);return t.table=this.table,t},deleteRow:function deleteRow(e){},isReadOnly:function isReadOnly(){return!1},quartiles:function quartiles(e,t,i,s){var n=o.template("select quartile, max(<%= column %>) as maxamount from (select <%= column %>, ntile(<%= slots %>) over (order by <%= column %>) as quartile from (<%= sql %>) _table_sql where <%= column %> is not null) x group by quartile order by quartile");this._sqlQuery(n({slots:e,sql:this.getSQL(),column:t}),function(e){i(o(e.rows).pluck("maxamount"))},s)},equalInterval:function equalInterval(e,t,i,s){var n=o.template("\n      with params as (select min(a), max(a) from ( select <%= column %> as a from (<%= sql %>) _table_sql where <%= column %> is not null ) as foo )\n      select (max-min)/<%= slots %> as s, min, max from params");this._sqlQuery(n({slots:e,sql:this.getSQL(),column:t}),function(t){for(var s=t.rows[0].min,n=t.rows[0].max,o=t.rows[0].s,r=[],a=1,l=e;a<l;a++)r.push(o*a+s);r.push(n),i(r)},s)},_quantificationMethod:function _quantificationMethod(e,t,i,s,n,r){var a=o.template("select unnest(<%= functionName %>(array_agg(<%= simplify_fn %>((<%= column %>::numeric))), <%= slots %>)) as buckets from (<%= sql %>) _table_sql where <%= column %> is not null");this._sqlQuery(a({slots:t,sql:this.getSQL(),column:i,functionName:e,simplify_fn:"distinct"}),function(e){n(o(e.rows).pluck("buckets"))},r)},discreteHistogram:function discreteHistogram(e,t,i,s){var n=o.template("SELECT DISTINCT(<%= column %>) AS bucket, count(*) AS value FROM (<%= sql %>) _table_sql GROUP BY <%= column %> ORDER BY value DESC LIMIT <%= nbuckets %> + 1",{column:t,nbuckets:e,sql:this.getSQL()});this._sqlQuery(n,function(t){var s=!1;t.rows.length>e&&(t.rows=t.rows.slice(0,e),s=!0),i({rows:t.rows,reached_limit:s})})},date_histogram:function date_histogram(e,t,i,s){t="EXTRACT(EPOCH FROM "+t+"::TIMESTAMP WITH TIME ZONE )";var n=o.template("with bounds as ( SELECT  current_timestamp as tz, min(<%= column %>) as lower,  max(<%= column %>) as upper,  (max(<%= column %>) - min(<%= column %>)) as span,  CASE WHEN ABS((max(<%= column %>) - min(<%= column %>))/<%= nbuckets %>) <= 0 THEN 1 ELSE GREATEST(1.0, pow(10,ceil(log((max(<%= column %>) - min(<%= column %>))/<%= nbuckets %>)))) END as bucket_size FROM  (<%= sql %>) _table_sql )  select array_agg(v) val, array_agg(bucket) buckets, tz, bounds.upper, bounds.lower, bounds.span, bounds.bucket_size from ( select  count(<%= column %>) as v,   round((<%= column %> - bounds.lower)/bounds.bucket_size) as bucket  from (<%= sql %>) _table_sql, bounds  where <%= column %> is not null group by bucket order by bucket ) a, bounds group by bounds.upper, bounds.lower, bounds.span, bounds.bucket_size, bounds.tz ");function agg_array(e){return e.map(function(e){return parseFloat(e)})}this._sqlQuery(n({nbuckets:e,sql:this.getSQL(),column:t}),function(e){if(e.rows&&0!==e.rows.length){(e=e.rows[0]).val=agg_array(e.val),e.buckets=agg_array(e.buckets);var t,s=[],n={},o=e.upper,r=e.lower,a=e.tz,l=e.bucket_size;t=e.val[0];for(var h=0;h<e.buckets.length;++h){var c=s[e.buckets[h]]=e.val[h];t=Math.max(t,c)}for(var d=0;d<s.length;++d)void 0===s[d]?s[d]=0:s[d]=s[d]/t;n.upper=parseFloat(o),n.lower=parseFloat(r),n.bucket_size=parseFloat(l),n.tz=a,i(s,n)}else i(null,null)},s)},histogram:function histogram(e,t,i,s){var n=o.template("with bounds as ( SELECT  min(<%= column %>) as lower,  max(<%= column %>) as upper,  (max(<%= column %>) - min(<%= column %>)) as span,  CASE WHEN ABS((max(<%= column %>) - min(<%= column %>))/<%= nbuckets %>) <= 0 THEN 1 ELSE GREATEST(1.0, pow(10,ceil(log((max(<%= column %>) - min(<%= column %>))/<%= nbuckets %>)))) END as bucket_size FROM  (<%= sql %>) _table_sql  )  select array_agg(v) val, array_agg(bucket) buckets, bounds.upper, bounds.lower, bounds.span, bounds.bucket_size from ( select  count(<%= column %>) as v,   round((<%= column %> - bounds.lower)/bounds.bucket_size) as bucket  from (<%= sql %>) _table_sql, bounds  where <%= column %> is not null group by bucket order by bucket ) a, bounds group by bounds.upper, bounds.lower, bounds.span, bounds.bucket_size ");function agg_array(e){return e.map(function(e){return parseFloat(e)})}this._sqlQuery(n({nbuckets:e,sql:this.getSQL(),column:t}),function(e){if(e.rows&&0!==e.rows.length){(e=e.rows[0]).val=agg_array(e.val),e.buckets=agg_array(e.buckets);var t,s=[],n={},o=e.upper,r=e.lower,a=e.bucket_size;t=e.val[0];for(var l=0;l<e.buckets.length;++l){var h=s[e.buckets[l]]=e.val[l];t=Math.max(t,h)}for(var c=0;c<s.length;++c)void 0===s[c]?s[c]=0:s[c]=s[c]/t;n.upper=parseFloat(o),n.lower=parseFloat(r),n.bucket_size=parseFloat(a),i(s,n)}else i(null,null)},s)},jenkBins:function jenkBins(e,t,i,s){this._quantificationMethod("CDB_JenksBins",e,t,!0,i,s)},headTails:function headTails(e,t,i,s){this._quantificationMethod("CDB_HeadsTailsBins",e,t,!1,i,s)},quantileBins:function quantileBins(e,t,i,s){this._quantificationMethod("CDB_QuantileBins",e,t,!1,i,s)},categoriesForColumn:function categoriesForColumn(e,t,i,s){var n=o.template("SELECT <%= column %>, count(<%= column %>) FROM (<%= sql %>) _table_sql GROUP BY <%= column %> ORDER BY count DESC LIMIT <%= max_values %> ");this._sqlQuery(n({sql:this.getSQL(),column:t,max_values:e+1}),function(e){i({type:e.fields[t].type||"string",categories:o(e.rows).pluck(t)})},s)},geometryBounds:function geometryBounds(e){var t=o.template("SELECT ST_XMin(ST_Extent(the_geom)) as minx,ST_YMin(ST_Extent(the_geom)) as miny, ST_XMax(ST_Extent(the_geom)) as maxx,ST_YMax(ST_Extent(the_geom)) as maxy from (<%= sql %>) _table_sql");this._sqlQuery(t({sql:this.getSQL()}),function(t){var i=t.rows[0],s=i.maxx,n=i.maxy,o=i.minx,r=i.miny,a=function clampNum(e,t,i){return e<t?t:e>i?i:e};s=a(s,-179,179),o=a(o,-179,179),n=a(n,-85.0511,85.0511),r=a(r,-85.0511,85.0511),e([[n,s],[r,o]])})},_sqlQuery:function _sqlQuery(e,t,i,n){var o=encodeURIComponent(e);return s.ajax({type:n||"POST",data:"q="+o+"&api_key="+this._configModel.get("api_key"),url:this.url(),success:t,error:i})},getSQL:function getSQL(){return"select * from "+c(this.table.get("id"))},fetch:function fetch(e){var t=this,i=arguments;(e=e||{})&&e.add||(this.options.attributes.page=0,this.options._previousAttributes.page=0,this.pages=[]);var s=e.error;e.error=function(e,i){t.fetched=!0,t.trigger("error",e,i),s&&s(e,i)};var n=e.success;e.success=function(e,s){t.fetched=!0,n&&n.apply(t,i)},this._fetch(e)},_fetch:function _fetch(e){var t=this;this.trigger("loading",e);var i=this.getSQL();d.alterTableData(i)?r.prototype.fetch.call(this,e):this._sqlQuery(o.template("select * from (<%= sql %>) __wrapped limit 0")({sql:i}),function(i){t.query_schema=t._schemaFromQueryFields(i.fields),t.table.isInSQLView()||"the_geom"in t.query_schema&&delete t.query_schema.the_geom_webmercator,r.prototype.fetch.call(t,e)},function(e){t.trigger("error",t,e)},i.length>1024?"POST":"GET")},schemaFromData:function schemaFromData(e){return d.sortSchema(o(this.query_schema).map(function(e,t){return[t,e]}))},geometryTypeFromGeoJSON:function geometryTypeFromGeoJSON(e){try{return JSON.parse(e).type}catch(e){}},geometryTypeFromWKT:function geometryTypeFromWKT(e){if(!e)return null;var t=h.types;e=e.toUpperCase();for(var i=0;i<t.length;++i){var s=t[i];if(-1!==e.indexOf(s))return s}},geometryTypeFromWKB:function geometryTypeFromWKB(e){if(!e)return null;var t="0"===e[0]&&"0"===e[1],i=e.substring(2,6);return t||(i=i[2]+i[3]+i[0]+i[1]),{"0001":"Point","0002":"LineString","0003":"Polygon","0004":"MultiPoint","0005":"MultiLineString","0006":"MultiPolygon"}[i]},getGeometryTypes:function getGeometryTypes(){for(var e=null,t=this.size();t--&&(!e||!e.get("the_geom"));)e=this.at(t);if(!e)return[];var i=e.get("the_geom")||e.get("the_geom_webmercator"),s=this.geometryTypeFromWKB(i)||this.geometryTypeFromWKT(i);return s?["ST_"+s[0].toUpperCase()+s.substring(1).toLowerCase()]:[]}})},function(e,t,i){"use strict";var s=i(2),n=i(2256),o=i(3),r=["configModel"];e.exports=s.Model.extend({defaults:{display_name:""},initialize:function initialize(e,t){o(t,r,this),this.parse(e||{})},parse:function parse(e,t){return this.users=new n(e.users,{group:this,configModel:this._configModel}),e},getModelType:function getModelType(){return"group"}})},,function(e,t,i){"use strict";var s=i(2),n=i(986);e.exports=s.Model.extend({defaults:{display_name:""},initialize:function initialize(e,t){this.parse(e||{},t)},parse:function parse(e,t){return this.users=new n(e.users,{group:this,configModel:t.configModel,organization:t.organization}),e}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(2264),r=i(410);e.exports=n.Model.extend({idAttribute:"item_queue_id",initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,this._initBinds(),this.poller=new o(this)},urlRoot:function urlRoot(){var e=this._configModel.urlVersion("import");return this._configModel.get("base_url")+"/api/"+e+"/imports"},_initBinds:function _initBinds(){this.bind("change:item_queue_id",this._checkQueueId,this)},createImport:function createImport(e){var t=this._prepareData(e);this[0===t.interval?"_createRegularImport":"_createSyncImport"](t)},_checkQueueId:function _checkQueueId(){this.get("item_queue_id")&&this.pollCheck()},_prepareData:function _prepareData(e){var t={create_vis:e.create_vis,privacy:e.privacy},i=e.type;"remote"!==i&&s.extend(t,{type_guessing:e.type_guessing,content_guessing:e.content_guessing,interval:e.interval});var n=e.service_name;if("url"===i&&s.extend(t,{url:e.value}),"remote"===i&&s.extend(t,{type:"remote",interval:null,remote_visualization_id:e.remote_visualization_id,create_vis:!1,value:e.value}),"sql"===i&&s.extend(t,{table_name:e.table_name,sql:e.value}),"duplication"===i&&s.extend(t,{table_name:e.table_name,table_copy:e.value}),"service"===i){var o="twitter_search"===n?JSON.stringify(e.service_item_id):e.service_item_id;e.user_defined_limits&&(t.user_defined_limits=e.user_defined_limits),s.extend(t,{value:e.value,service_name:e.service_name,service_item_id:o})}return t},_createSyncImport:function _createSyncImport(e){var t=this;this._synchronizationModel=new r(e,{configModel:this._configModel}),this._synchronizationModel.save(null,{success:function success(e){t.set("item_queue_id",e.get("data_import").item_queue_id)},error:function error(e,i,s){t._setErrorState(i)}})},_createRegularImport:function _createRegularImport(e){var t=this;this.save(e,{error:function error(e,i,s){t._setErrorState(i)}})},_setErrorState:function _setErrorState(e){var t;try{t=e&&JSON.parse(e.responseText).errors.imports}catch(e){t=_t("data.import-model.error-starting-import")}this.set({state:"failure",get_error_text:{title:_t("data.import-model.error-title"),what_about:t}})},pollCheck:function pollCheck(){this.poller.start()},destroyCheck:function destroyCheck(){this.poller.stop()}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(593),r=i(284),a=i(233),l=i(348);e.exports=n.Model.extend({defaults:{step:"upload",state:""},initialize:function initialize(e,t){if(!t.userModel)throw new Error("userModel is required");if(!t.configModel)throw new Error("configModel is required");this._userModel=t.userModel,this._configModel=t.configModel,this._uploadModel=new r(t.upload,{userModel:this._userModel,configModel:this._configModel}),s.isEmpty(t)&&(t={}),this._importModel=new o(t.import,{configModel:this._configModel}),this._initBinds(),this._checkStatus()},_initBinds:function _initBinds(){this.bind("change:import",this._onImportChange,this),this.bind("change:upload",this._onUploadChange,this),this.bind("change:id",this._onIdChange,this),this._importModel.bind("change",function(){this.trigger("change:import",this),this.trigger("change",this)},this),this._uploadModel.bind("change",function(){this.trigger("change:upload",this),this.trigger("change",this)},this)},_destroyBinds:function _destroyBinds(){this._uploadModel.unbind(null,null,this),this._importModel.unbind(null,null,this)},_onIdChange:function _onIdChange(){var e=this.get("id");e&&this._importModel.set("item_queue_id",e),this.set("step","import")},_onUploadChange:function _onUploadChange(e,t){if("upload"===this.get("step")){var i=this._uploadModel.get("item_queue_id"),s=this._uploadModel.get("state");i&&this.set("id",i),s&&this.set("state",s)}},_onImportChange:function _onImportChange(){if("import"===this.get("step")){var e=this._importModel.get("state");e&&this.set("state",e)}},_checkStatus:function _checkStatus(){this.get("id")||this._uploadModel.isValid()?"file"===this._uploadModel.get("type")?this._uploadModel.upload():this.get("id")?(this.set("step","import"),this._importModel.set("item_queue_id",this.get("id"))):this._importModel.get("item_queue_id")||""===this._uploadModel.get("type")||(this.set("step","import"),this._importModel.createImport(this._uploadModel.toJSON())):this.trigger("change:upload")},getImportModel:function getImportModel(){return this._importModel},pause:function pause(){this.stopUpload(),this.stopImport()},hasFailed:function hasFailed(){var e=this.get("state"),t=this.get("step");return"import"===t&&"failure"===e||"upload"===t&&"error"===e},hasCompleted:function hasCompleted(){return"import"===this.get("step")&&this._importModel&&"complete"===this._importModel.get("state")},getWarnings:function getWarnings(){return"import"===this.get("step")?this._importModel.get("warnings"):""},getError:function getError(){if(this.hasFailed()){var e=this.get("step");return s.extend({errorCode:this["upload"===e?"_uploadModel":"_importModel"].get("error_code"),itemQueueId:"import"===e?this._importModel.get("id"):"",originalUrl:"import"===e?this._importModel.get("original_url"):"",dataType:"import"===e?this._importModel.get("data_type"):"",httpResponseCode:"import"===e?this._importModel.get("http_response_code"):"",httpResponseCodeMessage:"import"===e?this._importModel.get("http_response_code_message"):""},this["upload"===e?"_uploadModel":"_importModel"].get("get_error_text"))}return{title:"",what_about:"",error_code:""}},importedVis:function importedVis(){return this.get("import").derived_visualization_id?this._getMapVis():this._getDatasetVis()},getNumberOfTablesCreated:function getNumberOfTablesCreated(){return this._importModel.get("tables_created_count")},_getServiceName:function _getServiceName(){return this._importModel.get("service_name")},isTwitterImport:function isTwitterImport(){return"twitter_search"===this._getServiceName()},isCartoImport:function isCartoImport(){return this._getDisplayName()&&this._getDisplayName().match(/\.carto$/i)},_getDisplayName:function _getDisplayName(){return this._importModel.get("display_name")},_getMapVis:function _getMapVis(){var e=this._importModel.get("derived_visualization_id");return!!e&&this._createVis({type:"derived",id:e})},_getDatasetVis:function _getDatasetVis(){var e=this._importModel.get("table_name");return!!e&&this._createVis({type:"table",table:{name:e}})},_createVis:function _createVis(e){var t=new a(e,{configModel:this._configModel});return t.permission=new l({owner:this._userModel.attributes},{configModel:this._configModel,userModel:this._userModel}),t},setError:function setError(e){var t=this["upload"===this.get("step")?"_uploadModel":"_importModel"];this.stopUpload(),this.stopImport(),t.set(e),this.set("state","error")},stopUpload:function stopUpload(){this._uploadModel.stopUpload()},stopImport:function stopImport(){this._importModel.destroyCheck()},get:function get(e){return"upload"===e?this._uploadModel.toJSON():"import"===e?this._importModel.toJSON():n.Model.prototype.get.call(this,e)},getRedirectUrl:function getRedirectUrl(e){var t=this.importedVis();if(t)return encodeURI(t.viewUrl(e).edit())},toJSON:function toJSON(){return{step:this.get("step"),id:this.get("id"),state:this.get("state"),upload:this._uploadModel.toJSON(),import:this._importModel.toJSON()}}})},function(e,t,i){(function(e){!function(e){e.widget("ui.tagit",{options:{allowDuplicates:!1,caseSensitive:!0,fieldName:"tags",placeholderText:null,readOnly:!1,removeConfirmation:!1,tagLimit:null,availableTags:[],autocomplete:{},showAutocompleteOnFocus:!1,allowSpaces:!1,singleField:!1,singleFieldDelimiter:",",singleFieldNode:null,animate:!0,tabIndex:null,beforeTagAdded:null,afterTagAdded:null,beforeTagRemoved:null,afterTagRemoved:null,onTagClicked:null,onTagLimitExceeded:null,onTagAdded:null,onTagRemoved:null,tagSource:null,onSubmitTags:null,onFocus:null,onBlur:null},_create:function(){var t=this;this.element.is("input")?(this.tagList=e("<ul></ul>").insertAfter(this.element),this.options.singleField=!0,this.options.singleFieldNode=this.element,this.element.addClass("tagit-hidden-field")):this.tagList=this.element.find("ul, ol").andSelf().last(),this.tagInput=e('<input type="text" />').addClass("ui-widget-content"),this.options.readOnly&&this.tagInput.attr("disabled","disabled"),this.options.tabIndex&&this.tagInput.attr("tabindex",this.options.tabIndex),this.options.placeholderText&&this.tagInput.attr("placeholder",this.options.placeholderText),this.options.autocomplete.source||(this.options.autocomplete.source=function(t,i){var s=t.term.toLowerCase(),n=e.grep(this.options.availableTags,function(e){return 0===e.toLowerCase().indexOf(s)});this.options.allowDuplicates||(n=this._subtractArray(n,this.assignedTags())),i(n)}),this.options.showAutocompleteOnFocus&&(this.tagInput.focus(function(e,i){t._showAutocomplete()}),void 0===this.options.autocomplete.minLength&&(this.options.autocomplete.minLength=0)),e.isFunction(this.options.autocomplete.source)&&(this.options.autocomplete.source=e.proxy(this.options.autocomplete.source,this)),e.isFunction(this.options.tagSource)&&(this.options.tagSource=e.proxy(this.options.tagSource,this)),this.tagList.addClass("tagit").addClass("ui-widget ui-widget-content ui-corner-all").append(e('<li class="tagit-new"></li>').append(this.tagInput)).click(function(i){var s=e(i.target);if(s.hasClass("tagit-label")){var n=s.closest(".tagit-choice");n.hasClass("removed")||t._trigger("onTagClicked",i,{tag:n,tagLabel:t.tagLabel(n)})}else t.tagInput.focus()});var i=!1;if(this.options.singleField)if(this.options.singleFieldNode){var s=e(this.options.singleFieldNode),n=s.val().split(this.options.singleFieldDelimiter);s.val(""),e.each(n,function(e,s){t.createTag(s,null,!0),i=!0})}else this.options.singleFieldNode=e('<input type="hidden" style="display:none;" value="" name="'+this.options.fieldName+'" />'),this.tagList.after(this.options.singleFieldNode);if(i||this.tagList.children("li").each(function(){e(this).hasClass("tagit-new")||(t.createTag(e(this).text(),e(this).attr("class"),!0),e(this).remove())}),this.tagInput.keydown(function(i){if(i.which==e.ui.keyCode.BACKSPACE&&""===t.tagInput.val()){var s=t._lastTag();!t.options.removeConfirmation||s.hasClass("remove")?t.removeTag(s):t.options.removeConfirmation&&s.addClass("remove ui-state-highlight")}else t.options.removeConfirmation?t._lastTag().removeClass("remove ui-state-highlight"):i.which==e.ui.keyCode.ENTER&&""===t.tagInput.val()&&t._trigger("onSubmitTags",null,t.tagList);(i.which===e.ui.keyCode.COMMA&&!1===i.shiftKey||i.which===e.ui.keyCode.ENTER||i.which==e.ui.keyCode.TAB&&""!==t.tagInput.val()||i.which==e.ui.keyCode.SPACE&&!0!==t.options.allowSpaces&&('"'!=e.trim(t.tagInput.val()).replace(/^s*/,"").charAt(0)||'"'==e.trim(t.tagInput.val()).charAt(0)&&'"'==e.trim(t.tagInput.val()).charAt(e.trim(t.tagInput.val()).length-1)&&e.trim(t.tagInput.val()).length-1!=0))&&(i.which===e.ui.keyCode.ENTER&&""===t.tagInput.val()||i.preventDefault(),t.options.autocomplete.autoFocus&&t.tagInput.data("autocomplete-open")||(t.tagInput.autocomplete("close"),t.createTag(t._cleanedInput())))}).blur(function(e){t._trigger("onBlur",null,null),t.tagInput.data("autocomplete-open")||t.createTag(t._cleanedInput())}).focus(function(e){t._trigger("onFocus",null,null)}),this.options.availableTags||this.options.tagSource||this.options.autocomplete.source){var o={select:function(e,i){return t.createTag(i.item.value),!1}};e.extend(o,this.options.autocomplete),o.source=this.options.tagSource||o.source,this.tagInput.autocomplete(o).bind("autocompleteopen.tagit",function(e,i){t.tagInput.data("autocomplete-open",!0)}).bind("autocompleteclose.tagit",function(e,i){t.tagInput.data("autocomplete-open",!1)}),this.tagInput.autocomplete("widget").addClass("tagit-autocomplete")}},destroy:function(){return e.Widget.prototype.destroy.call(this),this.element.unbind(".tagit"),this.tagList.unbind(".tagit"),this.tagInput.removeData("autocomplete-open"),this.tagList.removeClass(["tagit","ui-widget","ui-widget-content","ui-corner-all","tagit-hidden-field"].join(" ")),this.element.is("input")?(this.element.removeClass("tagit-hidden-field"),this.tagList.remove()):(this.element.children("li").each(function(){e(this).hasClass("tagit-new")?e(this).remove():(e(this).removeClass(["tagit-choice","ui-widget-content","ui-state-default","ui-state-highlight","ui-corner-all","remove","tagit-choice-editable","tagit-choice-read-only"].join(" ")),e(this).text(e(this).children(".tagit-label").text()))}),this.singleFieldNode&&this.singleFieldNode.remove()),this},_cleanedInput:function(){return e.trim(this.tagInput.val().replace(/^"(.*)"$/,"$1"))},_lastTag:function(){return this.tagList.find(".tagit-choice:last:not(.removed)")},_tags:function(){return this.tagList.find(".tagit-choice:not(.removed)")},assignedTags:function(){var t=this,i=[];return this.options.singleField?""===(i=e(this.options.singleFieldNode).val().split(this.options.singleFieldDelimiter))[0]&&(i=[]):this._tags().each(function(){i.push(t.tagLabel(this))}),i},_updateSingleTagsField:function(t){e(this.options.singleFieldNode).val(t.join(this.options.singleFieldDelimiter)).trigger("change")},_subtractArray:function(t,i){for(var s=[],n=0;n<t.length;n++)-1==e.inArray(t[n],i)&&s.push(t[n]);return s},tagLabel:function(t){return this.options.singleField?e(t).find(".tagit-label:first").text():e(t).find("input:first").val()},_showAutocomplete:function(){this.tagInput.autocomplete("search","")},_findTagByLabel:function(t){var i=this,s=null;return this._tags().each(function(n){if(i._formatStr(t)==i._formatStr(i.tagLabel(this)))return s=e(this),!1}),s},_isNew:function(e){return!this._findTagByLabel(e)},_formatStr:function(t){return this.options.caseSensitive?t:e.trim(t.toLowerCase())},_effectExists:function(t){return Boolean(e.effects&&(e.effects[t]||e.effects.effect&&e.effects.effect[t]))},createTag:function(t,i,s){var n=this;if(t=e.trim(t),this.options.preprocessTag&&(t=this.options.preprocessTag(t)),""===t)return!1;if(!this.options.allowDuplicates&&!this._isNew(t)){var o=this._findTagByLabel(t);return!1!==this._trigger("onTagExists",null,{existingTag:o,duringInitialization:s})&&this._effectExists("highlight")&&o.effect("highlight"),!1}if(this.options.tagLimit&&this._tags().length>=this.options.tagLimit)return this._trigger("onTagLimitExceeded",null,{duringInitialization:s}),!1;var r=e(this.options.onTagClicked?'<a class="tagit-label"></a>':'<span class="tagit-label"></span>').text(t),a=e("<li></li>").addClass("tagit-choice ui-widget-content ui-state-default ui-corner-all").addClass(i).append(r);if(this.options.readOnly)a.addClass("tagit-choice-read-only");else{a.addClass("tagit-choice-editable");var l=e("<span></span>").addClass("ui-icon ui-icon-close"),h=e('<a><span class="text-icon">\xd7</span></a>').addClass("tagit-close").append(l).click(function(e){n.removeTag(a)});a.append(h)}if(!this.options.singleField){var c=r.html();a.append('<input type="hidden" value="'+c+'" name="'+this.options.fieldName+'" class="tagit-hidden-field" />')}if(!1!==this._trigger("beforeTagAdded",null,{tag:a,tagLabel:this.tagLabel(a),duringInitialization:s})){if(this.options.singleField){var d=this.assignedTags();d.push(t),this._updateSingleTagsField(d)}this._trigger("onTagAdded",null,a),this.tagInput.val(""),this.tagInput.parent().before(a),this._trigger("afterTagAdded",null,{tag:a,tagLabel:this.tagLabel(a),duringInitialization:s}),this.options.showAutocompleteOnFocus&&!s&&setTimeout(function(){n._showAutocomplete()},0)}},removeTag:function(t,i){if(i=void 0===i?this.options.animate:i,t=e(t),this._trigger("onTagRemoved",null,t),!1!==this._trigger("beforeTagRemoved",null,{tag:t,tagLabel:this.tagLabel(t)})){if(this.options.singleField){var s=this.assignedTags(),n=this.tagLabel(t);s=e.grep(s,function(e){return e!=n}),this._updateSingleTagsField(s)}if(i){t.addClass("removed");var o=this._effectExists("blind")?["blind",{direction:"horizontal"},"fast"]:["fast"],r=this;o.push(function(){t.remove(),r._trigger("afterTagRemoved",null,{tag:t,tagLabel:r.tagLabel(t)})}),t.fadeOut("fast").hide.apply(t,o).dequeue()}else t.remove(),this._trigger("afterTagRemoved",null,{tag:t,tagLabel:this.tagLabel(t)})}},removeTagByLabel:function(e,t){var i=this._findTagByLabel(e);if(!i)throw"No such tag exists with the name '"+e+"'";this.removeTag(i,t)},removeAll:function(){var e=this;this._tags().each(function(t,i){e.removeTag(i,!1)})}})}(e)}).call(this,i(4))},function(e,t,i){"use strict";var s=i(2),n=i(597),o=i(3),r=["configModel","userModel"];e.exports=s.Collection.extend({model:n,url:function url(e){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("asset",e)+"/users/"+this._userModel.get("id")+"/assets"},initialize:function initialize(e,t){o(t,r,this)},parse:function parse(e,t){return e.assets},selectAll:function selectAll(){this.each(function(e){e.set("state","selected")})},deselectAll:function deselectAll(e){this.each(function(t){t!==e&&"selected"===t.get("state")&&t.set("state","")})}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(7);i(605),e.exports=n.Model.extend({fileAttribute:"filename",defaults:{type:"",filename:"",interval:0,progress:0,state:"idle",option:""},_initBinds:function _initBinds(){this.bind("progress",function(e){this.set({progress:100*e,state:"uploading"})},this),this.bind("change:filename change:url",function(){"error"===this.get("state")&&(this.set({state:"idle"}),this.unset("get_error_text",{silent:!0}))},this),this.bind("error invalid",function(e,t){this.set({state:"error",error_code:t&&t.error_code||"",get_error_text:{title:_t("componentes.data.asset-model.invalid-import"),what_about:t&&t.msg||""}},{silent:!0}),this.trigger("change")},this)},validate:function validate(e){if(e){if("filename"===e.type){if(e.filename&&e.filename.length)return{msg:_t("componentes.data.asset-model.one-file-per-upload")};var t=e.filename.name,i=t.substr(t.lastIndexOf(".")+1);if(i&&(i=i.toLowerCase()),!s.contains(["jpg","png","gif","svg"],i))return{msg:_t("componentes.data.asset-model.invalid-extension")}}return"url"!==e.type||o.isURL(e.url)?void 0:{msg:_t("componentes.data.asset-model.invalid-url")}}},isValid:function isValid(){return(this.get("filename")||this.get("url"))&&"error"!==this.get("state")},upload:function upload(){var e=this,t={kind:this.get("kind")};"file"===this.get("type")?t.filename=this.get("filename"):"url"===this.get("type")&&(t.filename=this.get("filename")),this.xhr=this.save(t,{success:function success(e){e.set("state","uploaded")},error:function error(t,i){var s=_t("componentes.data.asset-model.connection-error");i&&429===i.status?s=JSON.parse(i.responseText).error:i&&400===i.status&&(s=JSON.parse(i.responseText).error),e.set({state:"error",get_error_text:{title:_t("componentes.data.asset-model.error"),what_about:s}})},complete:function complete(){delete e.xhr}})},stopUpload:function stopUpload(){this.xhr&&this.xhr.abort()}})},function(e,t,i){"use strict";var s=i(1),n=i(461),o=i(2346),r=i(318),a=i(282),l=i(1010),h=i(1009),c=i(351),d=i(450),u=i(1012);e.exports=s.extend({events:{"click .js-show-collection":"_onClickShowCollection"},initialize:function initialize(e){if(!e.configModel)throw new Error("configModel is required");if(!e.userModel)throw new Error("userModel is required");if(!e.modals)throw new Error("modals is required");this._configModel=e.configModel,this._userModel=e.userModel,this._modals=e.modals,this._initCarouselCollection(),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(n()),this._renderAssets(),this},_initBinds:function _initBinds(){this.listenTo(this._carouselCollection,"change:selected",this._onSelectAsset),this.listenTo(this._carouselCollection,"reset",this.render)},_resetCarouselCollection:function _resetCarouselCollection(e){this._icons.reset(u.icons);var t=this._carouselCollection.find(function(t){return t.get("url")===e});t&&t.set("selected",!0),this._icons.unshift(this._resetAsset),this._carouselCollection.reset(this._getIcons())},_initCarouselCollection:function _initCarouselCollection(){this._icons=new l(u.icons),this.add_related_model(this._icons),this._resetAsset=new h({type:"none",selected:!this._getIconSelected(),name:_t("form-components.editors.fill.image.none"),action:function(e){this._resetImage(e)}.bind(this)}),this._icons.unshift(this._resetAsset),this._carouselCollection=new a(this._getIcons()),this.add_related_model(this._carouselCollection)},_getIcons:function _getIcons(){var e=function(e){this._changeIcon(e)}.bind(this);return this._icons.map(function(t){var i=t.get("type")?t.get("type"):"icon",s=t.get("action")?t.get("action"):e,n=this._getIconSelected();return{selected:t.get("selected")||t.getURLFor(t.get("icon"))===n,icon:t,type:i,name:t.get("name"),url:t.get("public_url"),action:s,template:function template(){return c({type:i,public_url:t.get("public_url")+"?req=markup",name:t.get("name")})}}},this)},_getIconSelected:function _getIconSelected(){if(this.model.get("ramp")){var e=this.model.get("index")||0;return this.model.get("ramp")[e].image||""}return this.model.get("image")||""},_renderAssets:function _renderAssets(){this.clearSubViews(),this.$el.html(n());var e=new r({collection:this._carouselCollection,template:d,listItemOptions:{className:"Carousel-item AssetListItem"},itemOptions:{className:"AssetItem-button"}});this.addView(e),this.$(".js-assets").append(e.render().el)},_onSelectAsset:function _onSelectAsset(e){e.get("action")(e)},_changeIcon:function _changeIcon(e){var t=e.get("icon");this.trigger("change",{url:t.get("public_url"),kind:t.get("kind")},this)},_resetImage:function _resetImage(){this.trigger("change",null,this)},_onClickShowCollection:function _onClickShowCollection(e){this.killEvent(e);var t=this;this._modals.create(function(e){return t._assetsView=new o({model:t.model,modalModel:e,configModel:t._configModel,userModel:t._userModel}),t._assetsView.bind("change",t._resetAssetsView,t),t._assetsView},{breadcrumbsEnabled:!0})},_resetAssetsView:function _resetAssetsView(e){this._resetCarouselCollection(e.url),this.trigger("change",e,this)},_destroyDocumentBinds:function _destroyDocumentBinds(){this._assetsView&&this._assetsView.unbind("change",self._resetAssetsView,self)},clean:function clean(){this._destroyDocumentBinds(),this.trigger("onClean",this),s.prototype.clean.apply(this)}})},function(e,t,i){"use strict";var s=i(1),n=i(353);e.exports=s.extend({className:"Editor-boxModal Editor-FormDialog js-formDialog is-opening",initialize:function initialize(){this._initBinds()},render:function render(){return this.clearSubViews(),this._renderContentView(),this},_renderContentView:function _renderContentView(){var e=this.model.createContentView();this.addView(e),this.$el.append(e.render().$el),this.dropdownOverlay=new n({onClickAction:this.hide.bind(this),visible:!0}),this.addView(this.dropdownOverlay)},_initBinds:function _initBinds(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy)},_onShowChange:function _onShowChange(e,t){t?(this.$el.show(),this.$el.removeClass("is-closing").addClass("is-opening")):(this.$el.removeClass("is-opening").addClass("is-closing"),this.$el.hide())},show:function show(){this.model.show()},hide:function hide(){this.model.hide()},_onDestroy:function _onDestroy(){this.hide(),this.dropdownOverlay&&this.dropdownOverlay.clean(),this.clean()}})},function(e,t,i){"use strict";var s=i(2),n=i(1);e.exports=s.Model.extend({defaults:{visible:!0,createContentView:function createContentView(){return new n}},createContentView:function createContentView(){return this.get("createContentView")(this)},show:function show(){this.set("visible",!0)},hide:function hide(){this.set("visible",!1)},isHidden:function isHidden(){return!this.get("visible")},destroy:function destroy(){var e=Array.prototype.slice.call(arguments);this.trigger.apply(this,["destroy"].concat(e))}})},,,function(e,t,i){"use strict";var s=i(1),n=i(0),o=i(7),r=i(602);e.exports=s.extend({className:"DatasetSelected",_FORMATTERS:{size:o.readablizeBytes,number:o.formatNumber},options:{acceptSync:!1,fileAttrs:{ext:!1,title:"",description:{content:[{name:"id",format:""}],itemName:"",separator:""}}},events:{"click .js-interval-0":"_onIntervalZero","click .js-interval-1":"_onIntervalHour","click .js-interval-2":"_onIntervalDay","click .js-interval-3":"_onIntervalWeek","click .js-interval-4":"_onIntervalMonth"},initialize:function initialize(e){if(!e.userModel)throw new TypeError("userModel is required");if(!e.configModel)throw new TypeError("configModel is required");this._configModel=e.configModel,this._userModel=e.userModel,this._initBinds(),this._checkVisibility()},render:function render(){var e=this.options.fileAttrs.title&&this.model.get("value")[this.options.fileAttrs.title]||this.model.get("value"),t=this._genDescription(),i=this.options.fileAttrs.ext?o.getFileExtension(e):"";this.options.fileAttrs.ext&&(e=e&&e.replace("."+i,""));var s=window.upgrade_url,n=this._userModel.isActionEnabled("sync_tables"),a=this._configModel.get("cartodb_com_hosted");return this.$el.html(r({title:e,description:t,ext:i,interval:this.model.get("interval"),importCanSync:this.options.acceptSync,userCanSync:n,showTrial:this._userModel.canStartTrial(),showUpgrade:!n&&!a&&s&&!this._userModel.isInsideOrg(),upgradeUrl:s})),this},_initBinds:function _initBinds(){this.model.bind("change:value",this.render,this),this.model.bind("change:interval",this.render,this),this.model.bind("change:state",this._checkVisibility,this)},_genDescription:function _genDescription(){if(this.options.fileAttrs&&this.options.fileAttrs.description){var e=this.options.fileAttrs.description,t="",i="",s=this;return e.content&&e.content.length>0&&n.each(e.content,function(n,o){o>0&&e.separator&&(i+=" "+e.separator+" ");var r=s.model.get("value")[n.name],a=n.format&&s._FORMATTERS[n.format];i+=a&&a(r)||r,n.key&&(t=n.name)}),e.itemName&&t&&(i+=" "+(e.itemName&&_t("components.modals.add-layer.imports."+e.itemName+"-pluralize",{smart_count:t})||"")),i}return""},_onIntervalZero:function _onIntervalZero(){this.model.set("interval",0)},_onIntervalHour:function _onIntervalHour(){this.options.acceptSync&&this._userModel.isActionEnabled("sync_tables")&&this.model.set("interval",3600)},_onIntervalDay:function _onIntervalDay(){this.options.acceptSync&&this._userModel.isActionEnabled("sync_tables")&&this.model.set("interval",86400)},_onIntervalWeek:function _onIntervalWeek(){this.options.acceptSync&&this._userModel.isActionEnabled("sync_tables")&&this.model.set("interval",604800)},_onIntervalMonth:function _onIntervalMonth(){this.options.acceptSync&&this._userModel.isActionEnabled("sync_tables")&&this.model.set("interval",2592e3)},setOptions:function setOptions(e){e&&!n.isEmpty(e)&&n.extend(this.options,e)},_checkVisibility:function _checkVisibility(){"selected"===this.model.get("state")?this.show():this.hide()}})},function(e,t,i){(function(e,t){(function(){var i,s,n,o,r,a,l,h,c=[].slice,d={}.hasOwnProperty;l=function(){},s=function(){function Emitter(){}return Emitter.prototype.addEventListener=Emitter.prototype.on,Emitter.prototype.on=function(e,t){return this._callbacks=this._callbacks||{},this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),this},Emitter.prototype.emit=function(){var e,t,i,s,n;if(i=arguments[0],e=2<=arguments.length?c.call(arguments,1):[],this._callbacks=this._callbacks||{},t=this._callbacks[i])for(s=0,n=t.length;s<n;s++)t[s].apply(this,e);return this},Emitter.prototype.removeListener=Emitter.prototype.off,Emitter.prototype.removeAllListeners=Emitter.prototype.off,Emitter.prototype.removeEventListener=Emitter.prototype.off,Emitter.prototype.off=function(e,t){var i,s,n,o;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(!(i=this._callbacks[e]))return this;if(1===arguments.length)return delete this._callbacks[e],this;for(s=n=0,o=i.length;n<o;s=++n)if(i[s]===t){i.splice(s,1);break}return this},Emitter}(),(i=function(e){var t,i;function Dropzone(e,i){var s,n,o;if(this.element=e,this.version=Dropzone.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(Dropzone.instances.push(this),this.element.dropzone=this,s=null!=(o=Dropzone.optionsForElement(this.element))?o:{},this.options=t({},this.defaultOptions,s,null!=i?i:{}),this.options.forceFallback||!Dropzone.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(n=this.getExistingFallback())&&n.parentNode&&n.parentNode.removeChild(n),!1!==this.options.previewsContainer&&(this.options.previewsContainer?this.previewsContainer=Dropzone.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(!0===this.options.clickable?this.clickableElements=[this.element]:this.clickableElements=Dropzone.getElements(this.options.clickable,"clickable")),this.init()}return function(e,t){for(var i in t)d.call(t,i)&&(e[i]=t[i]);function ctor(){this.constructor=e}ctor.prototype=t.prototype,e.prototype=new ctor,e.__super__=t.prototype}(Dropzone,s),Dropzone.prototype.Emitter=s,Dropzone.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],Dropzone.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,filesizeBase:1e3,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,capture:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(e,t){return t()},init:function(){return l},forceFallback:!1,fallback:function(){var e,t,i,s,n,o;for(this.element.className=this.element.className+" dz-browser-not-supported",s=0,n=(o=this.element.getElementsByTagName("div")).length;s<n;s++)e=o[s],/(^| )dz-message($| )/.test(e.className)&&(t=e,e.className="dz-message");return t||(t=Dropzone.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(t)),(i=t.getElementsByTagName("span")[0])&&(i.textContent=this.options.dictFallbackMessage),this.element.appendChild(this.getFallbackForm())},resize:function(e){var t,i,s;return t={srcX:0,srcY:0,srcWidth:e.width,srcHeight:e.height},i=e.width/e.height,t.optWidth=this.options.thumbnailWidth,t.optHeight=this.options.thumbnailHeight,null==t.optWidth&&null==t.optHeight?(t.optWidth=t.srcWidth,t.optHeight=t.srcHeight):null==t.optWidth?t.optWidth=i*t.optHeight:null==t.optHeight&&(t.optHeight=1/i*t.optWidth),s=t.optWidth/t.optHeight,e.height<t.optHeight||e.width<t.optWidth?(t.trgHeight=t.srcHeight,t.trgWidth=t.srcWidth):i>s?(t.srcHeight=e.height,t.srcWidth=t.srcHeight*s):(t.srcWidth=e.width,t.srcHeight=t.srcWidth/s),t.srcX=(e.width-t.srcWidth)/2,t.srcY=(e.height-t.srcHeight)/2,t},drop:function(e){return this.element.classList.remove("dz-drag-hover")},dragstart:l,dragend:function(e){return this.element.classList.remove("dz-drag-hover")},dragenter:function(e){return this.element.classList.add("dz-drag-hover")},dragover:function(e){return this.element.classList.add("dz-drag-hover")},dragleave:function(e){return this.element.classList.remove("dz-drag-hover")},paste:l,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(e){var t,i,s,n,o,r,a,l,h,c,d,u;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(e.previewElement=Dropzone.createElement(this.options.previewTemplate.trim()),e.previewTemplate=e.previewElement,this.previewsContainer.appendChild(e.previewElement),s=0,r=(h=e.previewElement.querySelectorAll("[data-dz-name]")).length;s<r;s++)h[s].textContent=e.name;for(n=0,a=(c=e.previewElement.querySelectorAll("[data-dz-size]")).length;n<a;n++)c[n].innerHTML=this.filesize(e.size);for(this.options.addRemoveLinks&&(e._removeLink=Dropzone.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),e.previewElement.appendChild(e._removeLink)),t=function(t){return function(i){return i.preventDefault(),i.stopPropagation(),e.status===Dropzone.UPLOADING?Dropzone.confirm(t.options.dictCancelUploadConfirmation,function(){return t.removeFile(e)}):t.options.dictRemoveFileConfirmation?Dropzone.confirm(t.options.dictRemoveFileConfirmation,function(){return t.removeFile(e)}):t.removeFile(e)}}(this),u=[],o=0,l=(d=e.previewElement.querySelectorAll("[data-dz-remove]")).length;o<l;o++)i=d[o],u.push(i.addEventListener("click",t));return u}},removedfile:function(e){var t;return e.previewElement&&null!=(t=e.previewElement)&&t.parentNode.removeChild(e.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(e,t){var i,s,n,o;if(e.previewElement){for(e.previewElement.classList.remove("dz-file-preview"),s=0,n=(o=e.previewElement.querySelectorAll("[data-dz-thumbnail]")).length;s<n;s++)(i=o[s]).alt=e.name,i.src=t;return setTimeout(function(){return e.previewElement.classList.add("dz-image-preview")},1)}},error:function(e,t){var i,s,n,o,r;if(e.previewElement){for(e.previewElement.classList.add("dz-error"),"String"!=typeof t&&t.error&&(t=t.error),r=[],s=0,n=(o=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;s<n;s++)i=o[s],r.push(i.textContent=t);return r}},errormultiple:l,processing:function(e){if(e.previewElement&&(e.previewElement.classList.add("dz-processing"),e._removeLink))return e._removeLink.textContent=this.options.dictCancelUpload},processingmultiple:l,uploadprogress:function(e,t,i){var s,n,o,r,a;if(e.previewElement){for(a=[],n=0,o=(r=e.previewElement.querySelectorAll("[data-dz-uploadprogress]")).length;n<o;n++)"PROGRESS"===(s=r[n]).nodeName?a.push(s.value=t):a.push(s.style.width=t+"%");return a}},totaluploadprogress:l,sending:l,sendingmultiple:l,success:function(e){if(e.previewElement)return e.previewElement.classList.add("dz-success")},successmultiple:l,canceled:function(e){return this.emit("error",e,"Upload canceled.")},canceledmultiple:l,complete:function(e){if(e._removeLink&&(e._removeLink.textContent=this.options.dictRemoveFile),e.previewElement)return e.previewElement.classList.add("dz-complete")},completemultiple:l,maxfilesexceeded:l,maxfilesreached:l,queuecomplete:l,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>'},t=function(){var e,t,i,s,n,o,r;for(s=arguments[0],o=0,r=(i=2<=arguments.length?c.call(arguments,1):[]).length;o<r;o++)for(e in t=i[o])n=t[e],s[e]=n;return s},Dropzone.prototype.getAcceptedFiles=function(){var e,t,i,s,n;for(n=[],t=0,i=(s=this.files).length;t<i;t++)(e=s[t]).accepted&&n.push(e);return n},Dropzone.prototype.getRejectedFiles=function(){var e,t,i,s,n;for(n=[],t=0,i=(s=this.files).length;t<i;t++)(e=s[t]).accepted||n.push(e);return n},Dropzone.prototype.getFilesWithStatus=function(e){var t,i,s,n,o;for(o=[],i=0,s=(n=this.files).length;i<s;i++)(t=n[i]).status===e&&o.push(t);return o},Dropzone.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(Dropzone.QUEUED)},Dropzone.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(Dropzone.UPLOADING)},Dropzone.prototype.getActiveFiles=function(){var e,t,i,s,n;for(n=[],t=0,i=(s=this.files).length;t<i;t++)(e=s[t]).status!==Dropzone.UPLOADING&&e.status!==Dropzone.QUEUED||n.push(e);return n},Dropzone.prototype.init=function(){var e,t,i,s,n,o,r;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(Dropzone.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(i=function(e){return function(){return e.hiddenFileInput&&document.body.removeChild(e.hiddenFileInput),e.hiddenFileInput=document.createElement("input"),e.hiddenFileInput.setAttribute("type","file"),(null==e.options.maxFiles||e.options.maxFiles>1)&&e.hiddenFileInput.setAttribute("multiple","multiple"),e.hiddenFileInput.className="dz-hidden-input",null!=e.options.acceptedFiles&&e.hiddenFileInput.setAttribute("accept",e.options.acceptedFiles),null!=e.options.capture&&e.hiddenFileInput.setAttribute("capture",e.options.capture),e.hiddenFileInput.style.visibility="hidden",e.hiddenFileInput.style.position="absolute",e.hiddenFileInput.style.top="0",e.hiddenFileInput.style.left="0",e.hiddenFileInput.style.height="0",e.hiddenFileInput.style.width="0",document.body.appendChild(e.hiddenFileInput),e.hiddenFileInput.addEventListener("change",function(){var t,s,n,o;if((s=e.hiddenFileInput.files).length)for(n=0,o=s.length;n<o;n++)t=s[n],e.addFile(t);return i()})}}(this))(),this.URL=null!=(o=window.URL)?o:window.webkitURL,s=0,n=(r=this.events).length;s<n;s++)e=r[s],this.on(e,this.options[e]);return this.on("uploadprogress",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("canceled",function(e){return function(t){return e.emit("complete",t)}}(this)),this.on("complete",function(e){return function(t){if(0===e.getUploadingFiles().length&&0===e.getQueuedFiles().length)return setTimeout(function(){return e.emit("queuecomplete")},0)}}(this)),t=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(e){return function(t){return e.emit("dragstart",t)}}(this),dragenter:function(e){return function(i){return t(i),e.emit("dragenter",i)}}(this),dragover:function(e){return function(i){var s;try{s=i.dataTransfer.effectAllowed}catch(e){}return i.dataTransfer.dropEffect="move"===s||"linkMove"===s?"move":"copy",t(i),e.emit("dragover",i)}}(this),dragleave:function(e){return function(t){return e.emit("dragleave",t)}}(this),drop:function(e){return function(i){return t(i),e.drop(i)}}(this),dragend:function(e){return function(t){return e.emit("dragend",t)}}(this)}}],this.clickableElements.forEach(function(e){return function(t){return e.listeners.push({element:t,events:{click:function(i){if(t!==e.element||i.target===e.element||Dropzone.elementInside(i.target,e.element.querySelector(".dz-message")))return e.hiddenFileInput.click()}}})}}(this)),this.enable(),this.options.init.call(this)},Dropzone.prototype.destroy=function(){var e;return this.disable(),this.removeAllFiles(!0),(null!=(e=this.hiddenFileInput)?e.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,Dropzone.instances.splice(Dropzone.instances.indexOf(this),1)},Dropzone.prototype.updateTotalUploadProgress=function(){var e,t,i,s,n,o,r;if(i=0,t=0,this.getActiveFiles().length){for(n=0,o=(r=this.getActiveFiles()).length;n<o;n++)i+=(e=r[n]).upload.bytesSent,t+=e.upload.total;s=100*i/t}else s=100;return this.emit("totaluploadprogress",s,t,i)},Dropzone.prototype._getParamName=function(e){return"function"==typeof this.options.paramName?this.options.paramName(e):this.options.paramName+(this.options.uploadMultiple?"["+e+"]":"")},Dropzone.prototype.getFallbackForm=function(){var e,t,i,s;return(e=this.getExistingFallback())?e:(i='<div class="dz-fallback">',this.options.dictFallbackText&&(i+="<p>"+this.options.dictFallbackText+"</p>"),i+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',t=Dropzone.createElement(i),"FORM"!==this.element.tagName?(s=Dropzone.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>')).appendChild(t):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=s?s:t)},Dropzone.prototype.getExistingFallback=function(){var e,t,i,s,n,o;for(t=function(e){var t,i,s;for(i=0,s=e.length;i<s;i++)if(t=e[i],/(^| )fallback($| )/.test(t.className))return t},s=0,n=(o=["div","form"]).length;s<n;s++)if(i=o[s],e=t(this.element.getElementsByTagName(i)))return e},Dropzone.prototype.setupEventListeners=function(){var e,t,i,s,n,o,r;for(r=[],s=0,n=(o=this.listeners).length;s<n;s++)e=o[s],r.push(function(){var s,n;for(t in n=[],s=e.events)i=s[t],n.push(e.element.addEventListener(t,i,!1));return n}());return r},Dropzone.prototype.removeEventListeners=function(){var e,t,i,s,n,o,r;for(r=[],s=0,n=(o=this.listeners).length;s<n;s++)e=o[s],r.push(function(){var s,n;for(t in n=[],s=e.events)i=s[t],n.push(e.element.removeEventListener(t,i,!1));return n}());return r},Dropzone.prototype.disable=function(){var e,t,i,s,n;for(this.clickableElements.forEach(function(e){return e.classList.remove("dz-clickable")}),this.removeEventListeners(),n=[],t=0,i=(s=this.files).length;t<i;t++)e=s[t],n.push(this.cancelUpload(e));return n},Dropzone.prototype.enable=function(){return this.clickableElements.forEach(function(e){return e.classList.add("dz-clickable")}),this.setupEventListeners()},Dropzone.prototype.filesize=function(e){var t,i,s,n,o,r,a;for(i=s=null,t=r=0,a=(o=["TB","GB","MB","KB","b"]).length;r<a;t=++r)if(n=o[t],e>=Math.pow(this.options.filesizeBase,4-t)/10){i=e/Math.pow(this.options.filesizeBase,4-t),s=n;break}return"<strong>"+(i=Math.round(10*i)/10)+"</strong> "+s},Dropzone.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},Dropzone.prototype.drop=function(e){var t,i;e.dataTransfer&&(this.emit("drop",e),(t=e.dataTransfer.files).length&&((i=e.dataTransfer.items)&&i.length&&null!=i[0].webkitGetAsEntry?this._addFilesFromItems(i):this.handleFiles(t)))},Dropzone.prototype.paste=function(e){var t,i;if(null!=(null!=e&&null!=(i=e.clipboardData)?i.items:void 0))return this.emit("paste",e),(t=e.clipboardData.items).length?this._addFilesFromItems(t):void 0},Dropzone.prototype.handleFiles=function(e){var t,i,s,n;for(n=[],i=0,s=e.length;i<s;i++)t=e[i],n.push(this.addFile(t));return n},Dropzone.prototype._addFilesFromItems=function(e){var t,i,s,n,o;for(o=[],s=0,n=e.length;s<n;s++)null!=(i=e[s]).webkitGetAsEntry&&(t=i.webkitGetAsEntry())?t.isFile?o.push(this.addFile(i.getAsFile())):t.isDirectory?o.push(this._addFilesFromDirectory(t,t.name)):o.push(void 0):null!=i.getAsFile&&(null==i.kind||"file"===i.kind)?o.push(this.addFile(i.getAsFile())):o.push(void 0);return o},Dropzone.prototype._addFilesFromDirectory=function(e,t){var i,s;return i=e.createReader(),s=function(e){return function(i){var s,n,o;for(n=0,o=i.length;n<o;n++)(s=i[n]).isFile?s.file(function(i){if(!e.options.ignoreHiddenFiles||"."!==i.name.substring(0,1))return i.fullPath=t+"/"+i.name,e.addFile(i)}):s.isDirectory&&e._addFilesFromDirectory(s,t+"/"+s.name)}}(this),i.readEntries(s,function(e){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(e):void 0})},Dropzone.prototype.accept=function(e,t){return e.size>1024*this.options.maxFilesize*1024?t(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(e.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):Dropzone.isValidFile(e,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(t(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",e)):this.options.accept.call(this,e,t):t(this.options.dictInvalidFileType)},Dropzone.prototype.addFile=function(e){return e.upload={progress:0,total:e.size,bytesSent:0},this.files.push(e),e.status=Dropzone.ADDED,this.emit("addedfile",e),this._enqueueThumbnail(e),this.accept(e,function(t){return function(i){return i?(e.accepted=!1,t._errorProcessing([e],i)):(e.accepted=!0,t.options.autoQueue&&t.enqueueFile(e)),t._updateMaxFilesReachedClass()}}(this))},Dropzone.prototype.enqueueFiles=function(e){var t,i,s;for(i=0,s=e.length;i<s;i++)t=e[i],this.enqueueFile(t);return null},Dropzone.prototype.enqueueFile=function(e){if(e.status!==Dropzone.ADDED||!0!==e.accepted)throw new Error("This file can't be queued because it has already been processed or was rejected.");if(e.status=Dropzone.QUEUED,this.options.autoProcessQueue)return setTimeout(function(e){return function(){return e.processQueue()}}(this),0)},Dropzone.prototype._thumbnailQueue=[],Dropzone.prototype._processingThumbnail=!1,Dropzone.prototype._enqueueThumbnail=function(e){if(this.options.createImageThumbnails&&e.type.match(/image.*/)&&e.size<=1024*this.options.maxThumbnailFilesize*1024)return this._thumbnailQueue.push(e),setTimeout(function(e){return function(){return e._processThumbnailQueue()}}(this),0)},Dropzone.prototype._processThumbnailQueue=function(){if(!this._processingThumbnail&&0!==this._thumbnailQueue.length)return this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(e){return function(){return e._processingThumbnail=!1,e._processThumbnailQueue()}}(this))},Dropzone.prototype.removeFile=function(e){if(e.status===Dropzone.UPLOADING&&this.cancelUpload(e),this.files=h(this.files,e),this.emit("removedfile",e),0===this.files.length)return this.emit("reset")},Dropzone.prototype.removeAllFiles=function(e){var t,i,s,n;for(null==e&&(e=!1),i=0,s=(n=this.files.slice()).length;i<s;i++)((t=n[i]).status!==Dropzone.UPLOADING||e)&&this.removeFile(t);return null},Dropzone.prototype.createThumbnail=function(e,t){var i;return(i=new FileReader).onload=function(s){return function(){return"image/svg+xml"===e.type?(s.emit("thumbnail",e,i.result),void(null!=t&&t())):s.createThumbnailFromUrl(e,i.result,t)}}(this),i.readAsDataURL(e)},Dropzone.prototype.createThumbnailFromUrl=function(e,t,i){var s;return(s=document.createElement("img")).onload=function(t){return function(){var n,o,r,l,h,c,d,u;if(e.width=s.width,e.height=s.height,null==(r=t.options.resize.call(t,e)).trgWidth&&(r.trgWidth=r.optWidth),null==r.trgHeight&&(r.trgHeight=r.optHeight),o=(n=document.createElement("canvas")).getContext("2d"),n.width=r.trgWidth,n.height=r.trgHeight,a(o,s,null!=(h=r.srcX)?h:0,null!=(c=r.srcY)?c:0,r.srcWidth,r.srcHeight,null!=(d=r.trgX)?d:0,null!=(u=r.trgY)?u:0,r.trgWidth,r.trgHeight),l=n.toDataURL("image/png"),t.emit("thumbnail",e,l),null!=i)return i()}}(this),null!=i&&(s.onerror=i),s.src=t},Dropzone.prototype.processQueue=function(){var e,t,i,s;if(t=this.options.parallelUploads,e=i=this.getUploadingFiles().length,!(i>=t)&&(s=this.getQueuedFiles()).length>0){if(this.options.uploadMultiple)return this.processFiles(s.slice(0,t-i));for(;e<t;){if(!s.length)return;this.processFile(s.shift()),e++}}},Dropzone.prototype.processFile=function(e){return this.processFiles([e])},Dropzone.prototype.processFiles=function(e){var t,i,s;for(i=0,s=e.length;i<s;i++)(t=e[i]).processing=!0,t.status=Dropzone.UPLOADING,this.emit("processing",t);return this.options.uploadMultiple&&this.emit("processingmultiple",e),this.uploadFiles(e)},Dropzone.prototype._getFilesWithXhr=function(e){var t;return function(){var i,s,n,o;for(o=[],i=0,s=(n=this.files).length;i<s;i++)(t=n[i]).xhr===e&&o.push(t);return o}.call(this)},Dropzone.prototype.cancelUpload=function(e){var t,i,s,n,o,r,a;if(e.status===Dropzone.UPLOADING){for(s=0,o=(i=this._getFilesWithXhr(e.xhr)).length;s<o;s++)(t=i[s]).status=Dropzone.CANCELED;for(e.xhr.abort(),n=0,r=i.length;n<r;n++)t=i[n],this.emit("canceled",t);this.options.uploadMultiple&&this.emit("canceledmultiple",i)}else(a=e.status)!==Dropzone.ADDED&&a!==Dropzone.QUEUED||(e.status=Dropzone.CANCELED,this.emit("canceled",e),this.options.uploadMultiple&&this.emit("canceledmultiple",[e]));if(this.options.autoProcessQueue)return this.processQueue()},i=function(){var e,t;return t=arguments[0],e=2<=arguments.length?c.call(arguments,1):[],"function"==typeof t?t.apply(this,e):t},Dropzone.prototype.uploadFile=function(e){return this.uploadFiles([e])},Dropzone.prototype.uploadFiles=function(e){var s,n,o,r,a,l,h,c,d,u,p,g,m,f,_,v,y,b,w,C,M,k,S,x,T,D,V,E,A,B,I,z,F;for(b=new XMLHttpRequest,w=0,S=e.length;w<S;w++)(s=e[w]).xhr=b;for(r in g=i(this.options.method,e),v=i(this.options.url,e),b.open(g,v,!0),b.withCredentials=!!this.options.withCredentials,f=null,o=function(t){return function(){var i,n,o;for(o=[],i=0,n=e.length;i<n;i++)s=e[i],o.push(t._errorProcessing(e,f||t.options.dictResponseError.replace("{{statusCode}}",b.status),b));return o}}(this),_=function(t){return function(i){var n,o,r,a,l,h,c,d,u;if(null!=i)for(o=100*i.loaded/i.total,r=0,h=e.length;r<h;r++)(s=e[r]).upload={progress:o,total:i.total,bytesSent:i.loaded};else{for(n=!0,o=100,a=0,c=e.length;a<c;a++)100===(s=e[a]).upload.progress&&s.upload.bytesSent===s.upload.total||(n=!1),s.upload.progress=o,s.upload.bytesSent=s.upload.total;if(n)return}for(u=[],l=0,d=e.length;l<d;l++)s=e[l],u.push(t.emit("uploadprogress",s,o,s.upload.bytesSent));return u}}(this),b.onload=function(t){return function(i){var s;if(e[0].status!==Dropzone.CANCELED&&4===b.readyState){if(f=b.responseText,b.getResponseHeader("content-type")&&~b.getResponseHeader("content-type").indexOf("application/json"))try{f=JSON.parse(f)}catch(e){i=e,f="Invalid JSON response from server."}return _(),200<=(s=b.status)&&s<300?t._finished(e,f,i):o()}}}(this),b.onerror=function(){if(e[0].status!==Dropzone.CANCELED)return o()},(null!=(E=b.upload)?E:b).onprogress=_,l={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&t(l,this.options.headers),l)a=l[r],b.setRequestHeader(r,a);if(n=new FormData,this.options.params)for(p in A=this.options.params)y=A[p],n.append(p,y);for(C=0,x=e.length;C<x;C++)s=e[C],this.emit("sending",s,b,n);if(this.options.uploadMultiple&&this.emit("sendingmultiple",e,b,n),"FORM"===this.element.tagName)for(M=0,T=(B=this.element.querySelectorAll("input, textarea, select, button")).length;M<T;M++)if(d=(c=B[M]).getAttribute("name"),u=c.getAttribute("type"),"SELECT"===c.tagName&&c.hasAttribute("multiple"))for(k=0,D=(I=c.options).length;k<D;k++)(m=I[k]).selected&&n.append(d,m.value);else(!u||"checkbox"!==(z=u.toLowerCase())&&"radio"!==z||c.checked)&&n.append(d,c.value);for(h=V=0,F=e.length-1;0<=F?V<=F:V>=F;h=0<=F?++V:--V)n.append(this._getParamName(h),e[h],e[h].name);return b.send(n)},Dropzone.prototype._finished=function(e,t,i){var s,n,o;for(n=0,o=e.length;n<o;n++)(s=e[n]).status=Dropzone.SUCCESS,this.emit("success",s,t,i),this.emit("complete",s);if(this.options.uploadMultiple&&(this.emit("successmultiple",e,t,i),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()},Dropzone.prototype._errorProcessing=function(e,t,i){var s,n,o;for(n=0,o=e.length;n<o;n++)(s=e[n]).status=Dropzone.ERROR,this.emit("error",s,t,i),this.emit("complete",s);if(this.options.uploadMultiple&&(this.emit("errormultiple",e,t,i),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()},Dropzone}()).version="4.0.1",i.options={},i.optionsForElement=function(e){return e.getAttribute("id")?i.options[n(e.getAttribute("id"))]:void 0},i.instances=[],i.forElement=function(e){if("string"==typeof e&&(e=document.querySelector(e)),null==(null!=e?e.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return e.dropzone},i.autoDiscover=!0,i.discover=function(){var e,t,s,n,o,r;for(document.querySelectorAll?s=document.querySelectorAll(".dropzone"):(s=[],(e=function(e){var t,i,n,o;for(o=[],i=0,n=e.length;i<n;i++)t=e[i],/(^| )dropzone($| )/.test(t.className)?o.push(s.push(t)):o.push(void 0);return o})(document.getElementsByTagName("div")),e(document.getElementsByTagName("form"))),r=[],n=0,o=s.length;n<o;n++)t=s[n],!1!==i.optionsForElement(t)?r.push(new i(t)):r.push(void 0);return r},i.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],i.isBrowserSupported=function(){var e,t,s,n;if(e=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(t=0,s=(n=i.blacklistedBrowsers).length;t<s;t++)n[t].test(navigator.userAgent)&&(e=!1);else e=!1;else e=!1;return e},h=function(e,t){var i,s,n,o;for(o=[],s=0,n=e.length;s<n;s++)(i=e[s])!==t&&o.push(i);return o},n=function(e){return e.replace(/[\-_](\w)/g,function(e){return e.charAt(1).toUpperCase()})},i.createElement=function(e){var t;return(t=document.createElement("div")).innerHTML=e,t.childNodes[0]},i.elementInside=function(e,t){if(e===t)return!0;for(;e=e.parentNode;)if(e===t)return!0;return!1},i.getElement=function(e,t){var i;if("string"==typeof e?i=document.querySelector(e):null!=e.nodeType&&(i=e),null==i)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector or a plain HTML element.");return i},i.getElements=function(e,t){var i,s,n,o,r,a,l;if(e instanceof Array){s=[];try{for(n=0,r=e.length;n<r;n++)i=e[n],s.push(this.getElement(i,t))}catch(e){e,s=null}}else if("string"==typeof e)for(s=[],o=0,a=(l=document.querySelectorAll(e)).length;o<a;o++)i=l[o],s.push(i);else null!=e.nodeType&&(s=[e]);if(null==s||!s.length)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return s},i.confirm=function(e,t,i){return window.confirm(e)?t():null!=i?i():void 0},i.isValidFile=function(e,t){var i,s,n,o,r;if(!t)return!0;for(t=t.split(","),i=(s=e.type).replace(/\/.*$/,""),o=0,r=t.length;o<r;o++)if("."===(n=(n=t[o]).trim()).charAt(0)){if(-1!==e.name.toLowerCase().indexOf(n.toLowerCase(),e.name.length-n.length))return!0}else if(/\/\*$/.test(n)){if(i===n.replace(/\/.*$/,""))return!0}else if(s===n)return!0;return!1},void 0!==e&&null!==e&&(e.fn.dropzone=function(e){return this.each(function(){return new i(this,e)})}),void 0!==t&&null!==t?t.exports=i:window.Dropzone=i,i.ADDED="added",i.QUEUED="queued",i.ACCEPTED=i.QUEUED,i.UPLOADING="uploading",i.PROCESSING=i.UPLOADING,i.CANCELED="canceled",i.ERROR="error",i.SUCCESS="success",r=function(e){var t,i,s,n,o,r,a,l;for(e.naturalWidth,o=e.naturalHeight,(t=document.createElement("canvas")).width=1,t.height=o,(i=t.getContext("2d")).drawImage(e,0,0),s=i.getImageData(0,0,1,o).data,l=0,n=o,r=o;r>l;)0===s[4*(r-1)+3]?n=r:l=r,r=n+l>>1;return 0===(a=r/o)?1:a},a=function(e,t,i,s,n,o,a,l,h,c){var d;return d=r(t),e.drawImage(t,i,s,n,o,a,l,h,c/d)},o=function(e,t){var i,s,n,o,r,a,l,h,c;if(n=!1,c=!0,s=e.document,h=s.documentElement,i=s.addEventListener?"addEventListener":"attachEvent",l=s.addEventListener?"removeEventListener":"detachEvent",a=s.addEventListener?"":"on",o=function(i){if("readystatechange"!==i.type||"complete"===s.readyState)return("load"===i.type?e:s)[l](a+i.type,o,!1),!n&&(n=!0)?t.call(e,i.type||i):void 0},r=function(){try{h.doScroll("left")}catch(e){return e,void setTimeout(r,50)}return o("poll")},"complete"!==s.readyState){if(s.createEventObject&&h.doScroll){try{c=!e.frameElement}catch(e){}c&&r()}return s[i](a+"DOMContentLoaded",o,!1),s[i](a+"readystatechange",o,!1),e[i](a+"load",o,!1)}},i._autoDiscoverFunction=function(){if(i.autoDiscover)return i.discover()},o(window,i._autoDiscoverFunction)}).call(this)}).call(this,i(4),i(496)(e))},,function(e,t,i){"use strict";var s=i(1),n=i(284);e.exports=s.extend({initialize:function initialize(e){if(!e.userModel)throw new Error("userModel is required");if(!e.configModel)throw new Error("configModel is required");this._configModel=e.configModel,this._userModel=e.userModel,this.model=new n(null,{configModel:this._configModel,userModel:this._userModel}),this._initBinds()},_initBinds:function _initBinds(){this.model.bind("change",this._triggerChange,this)},_triggerChange:function _triggerChange(){this.trigger("change",this.model.toJSON(),this)},getModelData:function getModelData(){return this.model?this.model.toJSON():{}}})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";e.exports=[{keywords:"alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit",type:"Sql"},{keywords:"ST_GeometryType ST_polygon ST_multipolygon ST_multilinestring ST_linestring ST_multipoint ST_point",type:"Postgis"}]},,,function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(1),r=i(528),a=i(276),l=i(10),h=i(9),c=i(3),d=["configModel","editorModel","layerDefinitionModel","querySchemaModel"];e.exports=o.extend({initialize:function initialize(e){c(e,d,this),this._clearSQLModel=new n.Model({visible:!1}),this._sqlModel=this._layerDefinitionModel.sqlModel,this._SQL=new h.SQL({user:this._configModel.get("user_name"),sql_api_template:this._configModel.get("sql_api_template"),api_key:this._configModel.get("api_key")}),this._codemirrorModel=new n.Model({content:this._querySchemaModel.get("query"),readonly:!1}),this._applyButtonStatusModel=new n.Model({loading:!1}),r.track(this)},_internalParseSQL:function _internalParseSQL(e){var t=this._querySchemaModel.get("query"),i=this._codemirrorModel.get("content");i&&";"===i.slice(-1)&&(i=i.slice(0,i.length-1),this._codemirrorModel.set("content",i));var s=a.isSameQuery(i,t),n=a.altersData(i);if(""===i||s)return r.removeNotification(),!1;n?(r.showNotification({status:"loading",info:_t("notifications.sql.alter-loading"),closable:!1}),this._applyButtonStatusModel.set("loading",!0),this._sqlModel.set("content",i),this._SQL.execute(i,null,{success:function(){r.showNotification({status:"success",info:_t("notifications.sql.alter-success"),closable:!0,delay:l.DEFAULT_DELAY}),this._applyButtonStatusModel.set("loading",!1),this._applyDefaultSQLAfterAlteringData(),"function"==typeof e&&e.call(this)}.bind(this),error:function(e){var t=this._parseErrors(e.responseJSON&&e.responseJSON.error);this._applyButtonStatusModel.set("loading",!1),this._codemirrorModel.set("errors",t),r.showErrorNotification(t),this._checkClearButton()}.bind(this)})):this._runQuery(i,this._saveSQL.bind(this))},_checkClearButton:function _checkClearButton(){var e=this._codemirrorModel.get("content"),t=a.isSameQuery(e,this._defaultSQL());this._clearSQLModel.set({visible:!t})},_applyDefaultSQLAfterAlteringData:function _applyDefaultSQLAfterAlteringData(){var e=this._defaultSQL();this._codemirrorModel.set({content:e,errors:[]}),this._sqlModel.set("content",e),this._querySchemaModel.set("query_errors",[]),this._clearSQLModel.set({visible:!1}),this._querySchemaModel.resetDueToAlteredData(),this._clearSQL()},_clearSQL:function _clearSQL(){var e=this._defaultSQL();this._codemirrorModel.set({content:e,errors:[]}),this._runQuery(e,this._saveSQL.bind(this))},_showErrors:function _showErrors(e){var t=this._querySchemaModel.get("query_errors");this._forceErrors(t),this._checkClearButton()},_forceErrors:function _forceErrors(e,t){var i=e&&e.length>0,s=i&&this._parseErrors(e),n=t&&!1===t.showEditorError?[]:s;this._codemirrorModel.set("errors",n),this._editorModel.set("disabled",i),i&&r.showErrorNotification(s)},_parseErrors:function _parseErrors(e){return e?(e=s.isArray(e)?e:[e]).map(function(e){return{message:e}}):[]}})},,function(e,t,i){"use strict";var s=i(1),n=i(808),o=i(11),r=i(186),a=i(13);e.exports=s.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_onCancel"},initialize:function initialize(e){if(!e.modalModel)throw new Error("modalModel is required");if(!e.syncModel)throw new Error("syncModel is required");if(!e.tableName)throw new Error("tableName is required");this._syncModel=e.syncModel,this._modalModel=e.modalModel,this._tableName=e.tableName},render:function render(){this.clearSubViews(),this.$el.html(n({interval:this._syncModel.get("interval"),service:this._syncModel.get("service_name")||"",isExternalSource:this._syncModel.get("from_external_source"),url:this._getServiceURL()}))},_renderErrorView:function _renderErrorView(e){var t=new r({title:_t("dataset.sync.error"),desc:e});this.$el.html(t.render().el),this.addView(t)},_renderLoadingView:function _renderLoadingView(){this.$el.html(o({title:_t("dataset.sync.loading",{tableName:this._tableName})}))},_getServiceURL:function _getServiceURL(){return this._syncModel.get("service_name")||this._syncModel.get("service_item_id")?this._syncModel.get("service_item_id"):this._syncModel.get("url")},_onConfirm:function _onConfirm(){var e=parseInt(this.$('[name="interval"]:checked').val(),10),t={wait:!0,success:function(){this._modalModel.destroy()}.bind(this),error:function(e,t){this._renderErrorView(a(t))}.bind(this)};this._renderLoadingView(),this._syncModel.get("interval")!==e?e?this._syncModel.save({interval:e},t):this._syncModel.destroy(t):this._modalModel.destroy()},_onCancel:function _onCancel(){this._modalModel.destroy()}})},,,,,function(e,t,i){"use strict";var s=i(385);e.exports=s.extend({tagName:"textarea",className:"Table-editorTextarea CDB-Textarea CDB-Text",_onKeyPressed:function _onKeyPressed(e){e.shiftKey||13!==e.which||(this._onValueChange(),this._editorModel.confirm())}})},,,,,function(e,t,i){"use strict";var s=i(10),n=i(13);e.exports=function(e){if(!e.rowsCollection)throw new Error("rowsCollection is required");var t=e.rowsCollection,i=e.onSuccess,o=e.onError,r=s.addNotification({status:"loading",info:_t("components.table.rows.create.loading"),closable:!1});t.addRow({success:function success(e,t){i&&i(e,t),r.set({status:"success",info:_t("components.table.rows.create.success"),closable:!0})},error:function error(e,t){o&&o(e,t),r.set({status:"error",info:_t("components.table.rows.create.error",{error:n(t)}),closable:!0})}})}},,,,,,function(e,t,i){"use strict";var s=i(10),n=i(13);e.exports=function(e){if(!e.columnsCollection)throw new Error("columnsCollection is required");var t=e.columnsCollection,i=e.onSuccess,o=e.onError,r=s.addNotification({status:"loading",info:_t("components.table.columns.create.loading"),closable:!1});t.addColumn({success:function success(e,t){i&&i(e,t),r.set({status:"success",info:_t("components.table.columns.create.success",{columnName:t.name}),closable:!0})},error:function error(e,t){o&&o(e,t),r.set({status:"error",info:_t("components.table.columns.create.error",{error:n(t)}),closable:!0})}})}},,,function(e,t,i){"use strict";var s=i(1712),n=i(1690),o=i(281),r=i(3),a=["analysisDefinitionNodeModel","configModel","modals","userModel"];e.exports={create:function create(e){r(e,a,this);var t=this._analysisDefinitionNodeModel.get("table_name"),i=o.getUsername(t)||this._userModel.get("username");t=o.getQualifiedTableName(t,i,this._userModel.isInsideOrg());var l=this._analysisDefinitionNodeModel.querySchemaModel,h=new n(l.columnsCollection.toJSON(),{configModel:this._configModel,tableName:t,querySchemaModel:l});return new s({relativePositionated:e.relativePositionated,modals:this._modals,analysisDefinitionNodeModel:this._analysisDefinitionNodeModel,columnsCollection:h,tableName:t})},destroy:function destroy(e){if(!e)throw new Error("tableView object is needed");e.clean()}}},function(e,t,i){"use strict";var s=i(0),n={top:0,left:0};e.exports=function MagicPositioner(e){if(!e.parentView)throw new Error("parentView within params is required");if(!s.isNumber(e.posX))throw new Error("posX within params is required");if(!s.isNumber(e.posY))throw new Error("posY within params is required");var t=e.parentView,i=t.outerHeight(),o=t.outerWidth(),r=e.posX,a=e.posY,l=e.offsetX||0,h=e.offsetY||0,c=e.elementWidth||244,d=e.elementHeight||205,u=n;return r-c>10?(u.left="auto",u.right=o-r+l+"px"):r+c>c&&(u.right="auto",u.left=r+l+"px"),a+d<i?(u.bottom="auto",u.top=a+h+"px"):a+d>i&&(u.top="auto",u.bottom=i-a+h+"px"),u}},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({defaults:{name:""},validate:function validate(e){if(e)return e.name?void 0:_t("components.modals.maps-metadata.validation.error.name")}})},function(e,t,i){"use strict";var s=i(0),n=[{privacy:"PUBLIC",title:_t("components.modals.publish.privacy.public.title"),desc:_t("components.modals.publish.privacy.public.body"),alwaysEnabled:!0,cssClass:"green"},{privacy:"LINK",title:_t("components.modals.publish.privacy.link.title"),desc:_t("components.modals.publish.privacy.link.body"),cssClass:"orange"},{privacy:"PASSWORD",title:_t("components.modals.publish.privacy.password.title"),desc:_t("components.modals.publish.privacy.password.body"),cssClass:"orange-dark"},{privacy:"PRIVATE",title:_t("components.modals.publish.privacy.private.title"),desc:_t("components.modals.publish.privacy.private.body"),cssClass:"red"}];e.exports=function(e,t){var i=e.isVisualization(),o=t.get("actions")[i?"private_maps":"private_tables"],r=e.get("privacy"),a=e.privacyOptions();return s.chain(n).filter(function(e){return s.contains(a,e.privacy)}).map(function(e){return s.defaults({selected:e.privacy===r,disabled:!(e.alwaysEnabled||o)},e)}).value()}},function(e,t,i){"use strict";var s=i(2),n=i(0);e.exports=s.Model.extend({defaults:{privacy:"PUBLIC",disabled:!1,selected:!1,password:void 0},validate:function validate(e){if(e.disabled&&e.selected)return"Option can not be disabled and selected at the same time"},classNames:function classNames(){return n.chain(["disabled","selected"]).map(function(e){return void 0!==this.attributes[e]?"is-"+e:void 0},this).compact().value().join(" ")},canSave:function canSave(){return!this.get("disabled")},isPassword:function isPassword(){return!1},isSelected:function isSelected(){return!0===this.get("selected")},saveToVis:function saveToVis(e,t){return e.save(this._attrsToSave(),n.extend({wait:!0},t))},_attrsToSave:function _attrsToSave(){return n.pick(this.attributes,"privacy","password")}})},function(e,t,i){"use strict";var s=i(2),n=i(832),o=i(1725);e.exports=s.Collection.extend({model:function model(e,t){return"PASSWORD"===e.privacy?new o(e,t):new n(e,t)},initialize:function initialize(){this.bind("change:selected",this._deselectLastSelected,this)},searchByPrivacy:function searchByPrivacy(e){return this.findWhere({privacy:e})},selectedOption:function selectedOption(){return this.find(function(e){return e.get("selected")})},passwordOption:function passwordOption(){return this.find(function(e){return"PASSWORD"===e.get("privacy")})},_deselectLastSelected:function _deselectLastSelected(e,t){t&&this.each(function(t){t!==e&&t.set({selected:!1})})}})},,,,,,,,,function(e,t,i){"use strict";e.exports=function(){var e,t=navigator.userAgent,i=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(i[1])?{name:"IE ",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:"Chrome"===i[1]&&null!=(e=t.match(/\bOPR\/(\d+)/))?{name:"Opera",version:e[1]}:(i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&i.splice(1,1,e[1]),{name:i[0],version:i[1]})}},,,,,,function(e,t,i){"use strict";var s=i(0),n=i(2),o=n.Model.extend({sync:function sync(e,t,i){return n.sync("update",t,i)},url:function url(){return this._configModel.get("base_url")+"/api/v3/notifications/"+this.get("key")},initialize:function initialize(e,t){if(!t.key)throw new Error("key is required");if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,this.attributes=s.extend({notifications:e},{key:t.key})},getKey:function getKey(e){return(this.get("notifications")||{})[e]},setKey:function setKey(e,t){var i=this.get("notifications")||{};i[e]=t,this.set("notifications",i)}});e.exports=o},,function(e,t,i){"use strict";var s=i(1),n=i(4),o=i(849);e.exports=s.extend({className:"js-builderNotification",events:{"click .js-close":"_onClose"},initialize:function initialize(){if(!this.options.builderActivatedNotification)throw new Error("builderActivatedNotification is required");this._notification=this.options.builderActivatedNotification,this.render()},render:function render(){return this.$el.html(o()),n("body").prepend(this.$el),this},_onClose:function _onClose(){this._notification.setKey("builder_activated",!0),this._notification.save(),this.clean()},clean:function clean(){this.constructor.__super__.clean.apply(this)}})},function(e,t,i){"use strict";var s=i(4),n=i(0),o=i(986);e.exports={track:function track(e){this.acl=e.acl,this.configModel=e.configModel,this.userModel=e.userModel,this.acl.on("reset",this.fetchUsers,this),this.fetchUsers()},fetchUsers:function fetchUsers(){var e,t=this;e=n.map(this.acl.where({type:"group"}),function(e){var i=e.get("entity"),n=new s.Deferred;return i.users&&0!==i.users.length?n.resolve():(i.users=new o([],{group:i,configModel:t.configModel,organization:t.userModel.getOrganization()}),i.users.fetch({success:function success(){n.resolve()}})),n.promise()},this),s.when.apply(s,e).done(function(){t.acl.trigger("fetch")})}}},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({defaults:{edition:!1,disabled:!1},isEditing:function isEditing(){return!!this.get("edition")},isDisabled:function isDisabled(){return!!this.get("disabled")}})},,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(4);e.exports=s.Model.extend({SYSTEM_COLUMNS:["the_geom","the_geom_webmercator","created_at","updated_at","cartodb_id","cartodb_georef_status"],TEMPLATES:{},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel},clearFields:function clearFields(){this.set({fields:[]})},saveFields:function saveFields(e){e=e||"old_fields",this.set(e,n.clone(this.get("fields")))},fieldCount:function fieldCount(){var e=this.get("fields");return e?e.length:0},restoreFields:function restoreFields(e,t){t=t||"old_fields";var i=this.get(t);e&&(i=i.filter(function(t){return n.contains(e,t.name)})),i&&i.length&&this._setFields(i),this.unset(t)},containsField:function containsField(e){var t=this.get("fields")||[];return n.contains(n(t).pluck("name"),e)},getFieldProperty:function getFieldProperty(e,t){if(this.containsField(e)){var i=this.get("fields")||[];return i[n.indexOf(n(i).pluck("name"),e)][t]}return null},setFieldProperty:function setFieldProperty(e,t,i){if(this.containsField(e)){var s=this._cloneFields()||[];s[n.indexOf(n(s).pluck("name"),e)][t]=i,this._setFields(s)}return this},_cloneFields:function _cloneFields(){return n(this.get("fields")).map(function(e){return n.clone(e)})},_setFields:function _setFields(e){e.sort(function(e,t){return e.position-t.position}),this.set({fields:e})},sortFields:function sortFields(){this.get("fields").sort(function(e,t){return e.position-t.position})},_addField:function _addField(e,t){var i=o.Deferred();if(!this.containsField(e)){var s=this.get("fields");s?(t=void 0===t?s.length:t,s.push({name:e,title:!0,position:t})):(t=void 0===t?0:t,this.set("fields",[{name:e,title:!0,position:t}],{silent:!0}))}return i.resolve(),i.promise()},addField:function addField(e,t){var i=this;return o.when(this._addField(e,t)).then(function(){i.sortFields(),i.trigger("add:fields"),i.trigger("change:fields",i,i.get("fields")),i.trigger("change",i)}),this},removeField:function removeField(e){if(this.containsField(e)){var t=this._cloneFields()||[],i=n.indexOf(n(t).pluck("name"),e);i>=0&&t.splice(i,1),this._setFields(t),this.trigger("remove:fields")}return this},getAlternativeName:function getAlternativeName(e){return this.get("alternative_names")&&this.get("alternative_names")[e]},setAlternativeName:function setAlternativeName(e,t){var i=n.clone(this.get("alternative_names")||{});i[e]=t,this.set({alternative_names:i}),this.trigger("change:alternative_names")},getFieldPos:function getFieldPos(e){var t=this.getFieldProperty(e,"position");return void 0===t?Number.MAX_VALUE:t},unsetTemplate:function unsetTemplate(){this.setTemplate("")},setTemplate:function setTemplate(e){var t={template_name:e,template:void 0===this.TEMPLATES[e]?"":this.TEMPLATES[e],template_type:"mustache"};""===e&&(t.fields=[]),this.set(t)},getTemplate:function getTemplate(){var e=this.get("template_name");return""!==e?this.TEMPLATES["custom_"+e]:this.get("template")},hasTemplate:function hasTemplate(){return!!this.get("template_name")&&this.TEMPLATES[this.get("template_name")]},isCustomTemplate:function isCustomTemplate(){return""===this.get("template_name")&&""!==this.get("template")}})},,,,,,,function(e,t,i){"use strict";var s=i(0),n=i(294),o=i(535),r=i(7),a=i(236);e.exports=s.defaults({_getAggrAttrs:function _getAggrAttrs(e){return{aggregation:{size:10,value:{operator:"count",attribute:""}}}},_getStrokeAttrs:function _getStrokeAttrs(e){var t=o.stroke;return{stroke:r.cloneObject(t)}},_getFillAttrs:function _getFillAttrs(e){var t=a.ag_GrnYl[5];return{fill:{color:{attribute:"agg_value",bins:"5",quantification:"quantiles",range:r.cloneObject(t)}}}}},n)},function(e,t,i){"use strict";e.exports={generateAttributes:function generateAttributes(e){return{fill:null,stroke:null,blending:null,aggregation:{},labels:{}}}}},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(245),r=i(1756),a=i(1750),l=i(1749),h=i(274),c=i(1748),d=i(1747),u=i(281),p=i(275),g=["id","order","infowindow","tooltip","error","from_layer_id","from_letter"];e.exports=s.Model.extend({sync:o,parse:function parse(e,t){e.options=e.options||{};var i=n.defaults(n.pick(e,g),n.omit(e.options,["query","tile_style"]));return i.type=i.type||h.getType(e.kind),e.options.tile_style&&(i.cartocss=e.options.tile_style),e.options.query&&(i.sql=e.options.query),e.infowindow&&(this.infowindowModel||(this.infowindowModel=new c(e.infowindow,{configModel:t.configModel||this._configModel}))),e.tooltip&&(this.tooltipModel||(this.tooltipModel=new d(e.tooltip,{configModel:t.configModel||this._configModel}))),e.options.table_name&&(i.autoStyle=i.autoStyle||!1,this.styleModel||(this.styleModel=new r(e.options.style_properties,{parse:!0}),this.cartocssModel=new a({content:i.cartocss},{history:e.options.cartocss_history||e.options.tile_style_history})),this.sqlModel||(this.sqlModel=new l({content:i.sql},{history:e.options.sql_history}))),i},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,this.on("change:source change:sql",this._onPosibleLayerSchemaChanged,this),this.styleModel&&this.styleModel.bind("change:type change:animated",function(){(this.styleModel.isAggregatedType()||this.styleModel.isAnimation())&&(this.infowindowModel&&this.infowindowModel.unsetTemplate(),this.tooltipModel&&this.tooltipModel.unsetTemplate())},this)},save:function save(e,t){e=e||{};var i={autoStyle:!1};return(t=t||{})&&t.shouldPreserveAutoStyle?delete i.autoStyle:this.get("autoStyle")&&this.styleModel&&this.styleModel.resetPropertiesFromAutoStyle(),e=n.extend({},i,e),s.Model.prototype.save.call(this,e,t)},toJSON:function toJSON(){var e=n.omit(this.attributes,g.concat(["cartocss","sql","autoStyle"])),t=this.get("cartocss");t&&(e.tile_style=t);var i=this.get("sql");i&&(e.query=i);var s={kind:h.getKind(this.get("type")),options:e},o=this.infowindowModel&&this.infowindowModel.toJSON();n.isEmpty(o)||(s.infowindow=this.infowindowModel.toJSON());var r=this.tooltipModel&&this.tooltipModel.toJSON();n.isEmpty(r)||(s.tooltip=this.tooltipModel.toJSON()),this.styleModel&&!this.styleModel.isAutogenerated()&&(s.options.style_properties=this.styleModel.toJSON()),this.cartocssModel&&(s.options.cartocss_history=this.cartocssModel.getHistory()),this.sqlModel&&(s.options.sql_history=this.sqlModel.getHistory());var a=n.omit(this.attributes,"infowindow","tooltip","options","error","autoStyle");return n.defaults(s,n.pick(a,g))},canBeDeletedByUser:function canBeDeletedByUser(){return this.collection.getNumberOfDataLayers()>1&&this.isDataLayer()&&(this._canBeFoldedUnderAnotherLayer()||!this._isAllDataLayersDependingOnAnyAnalysisOfThisLayer())},isOwnerOfAnalysisNode:function isOwnerOfAnalysisNode(e){return e&&e.letter()===this.get("letter")},ownedPrimaryAnalysisNodes:function ownedPrimaryAnalysisNodes(){var e=this.getAnalysisDefinitionNodeModel();return this.isOwnerOfAnalysisNode(e)?e.linkedListBySameLetter():[]},getName:function getName(){return this.get("name")||this.get("table_name_alias")||this.get("table_name")},getTableName:function getTableName(){return this.get("table_name")||""},getColor:function getColor(){return p.getColorForLetter(this.get("letter"))},containsNode:function containsNode(e){var t=this.getAnalysisDefinitionNodeModel();return t&&t.containsNode(e)},getAnalysisDefinitionNodeModel:function getAnalysisDefinitionNodeModel(){return this.findAnalysisDefinitionNodeModel(this.get("source"))},findAnalysisDefinitionNodeModel:function findAnalysisDefinitionNodeModel(e){return this.collection&&this.collection.findAnalysisDefinitionNodeModel(e)},_onPosibleLayerSchemaChanged:function _onPosibleLayerSchemaChanged(e,t,i){i&&i.ignoreSchemaChange||(this.infowindowModel&&this.infowindowModel.clearFields(),this.tooltipModel&&this.tooltipModel.clearFields(),this.styleModel&&this.styleModel.resetStyles())},toggleVisible:function toggleVisible(){this.set("visible",!this.get("visible"))},toggleCollapse:function toggleCollapse(){this.set("collapsed",!this.get("collapsed"))},hasAnalyses:function hasAnalyses(){return this.getNumberOfAnalyses()>0},hasAggregatedStyles:function hasAggregatedStyles(){return this.styleModel&&this.styleModel.isAggregatedType()},getNumberOfAnalyses:function getNumberOfAnalyses(){for(var e=this.getAnalysisDefinitionNodeModel(),t=0;e&&this.isOwnerOfAnalysisNode(e);)(e=e.getPrimarySource())&&(t+=1);return t},getQualifiedTableName:function getQualifiedTableName(){var e=this.get("user_name")||this.collection.userModel.get("username");return u.getQualifiedTableName(this.getTableName(),e,this.collection.userModel.isInsideOrg())},getColumnNamesFromSchema:function getColumnNamesFromSchema(){return this._getQuerySchemaModel().getColumnNames()},_getQuerySchemaModel:function _getQuerySchemaModel(){return this.getAnalysisDefinitionNodeModel().querySchemaModel},isDataLayer:function isDataLayer(){var e=this.get("type");return h.isCartoDBType(e)||h.isTorqueType(e)},isTorqueLayer:function isTorqueLayer(){return"torque"===this.get("type")},_canBeFoldedUnderAnotherLayer:function _canBeFoldedUnderAnotherLayer(){var e=this.getAnalysisDefinitionNodeModel();return this.collection.any(function(t){if(t!==this&&t.isDataLayer()){var i=t.getAnalysisDefinitionNodeModel();return i===e||n.last(i.linkedListBySameLetter()).getPrimarySource()===e}},this)},_isAllDataLayersDependingOnAnyAnalysisOfThisLayer:function _isAllDataLayersDependingOnAnyAnalysisOfThisLayer(){var e=this.getAnalysisDefinitionNodeModel();if(!e)return!1;if(!this.isOwnerOfAnalysisNode(e))return!1;var t=e.linkedListBySameLetter();return this.collection.chain().filter(function(e){return e!==this&&!!e.get("source")},this).all(function(e){return n.any(t,function(t){return e.containsNode(t)})},this).value()},getAllDependentLayers:function getAllDependentLayers(){for(var e=0,t=this.collection.models,i=0;i<t.length;i++){var s=t[i],n=!1;if(s!==this){for(var o=s.getAnalysisDefinitionNodeModel();o;)this.isOwnerOfAnalysisNode(o)&&(n=!0),o=o.getPrimarySource();n&&(e+=1)}}return e},matchesAttrs:function matchesAttrs(e){return this.get("type")===e.type&&(h.isTiledType(e.type)?this.get("name")===e.name&&this.get("urlTemplate")===e.urlTemplate:h.isGMapsBase(e.type)?this.get("name")===e.name&&this.get("baseType")===e.baseType&&this.get("style")===e.style:!!h.isPlainType(e.type)&&this.get("color")===e.color)},hasGeocodingAnalysisApplied:function hasGeocodingAnalysisApplied(){var e=this.getAnalysisDefinitionNodeModel();if(e&&"geocoding"===e.get("type"))return!0;for(;e&&this.isOwnerOfAnalysisNode(e);)if((e=e.getPrimarySource())&&"geocoding"===e.get("type"))return!0;return!1},_hasAnyAnalysisApplied:function _hasAnyAnalysisApplied(){return"source"!==this.getAnalysisDefinitionNodeModel().get("type")},isEmpty:function isEmpty(){throw new Error("LayerDefinitionModel.isEmpty() is an async operation. Use `.isEmptyAsync` instead.")},isEmptyAsync:function isEmptyAsync(){var e=this.getAnalysisDefinitionNodeModel(),t=this._hasAnyAnalysisApplied(),i=e.isCustomQueryApplied();return new Promise(function(s,n){e.queryRowsCollection.isEmptyAsync().then(function(e){s(!t&&!i&&e)})})},isDataFiltered:function isDataFiltered(){var e=this.getAnalysisDefinitionNodeModel(),t=this._hasAnyAnalysisApplied(),i=e.isCustomQueryApplied();return new Promise(function(s,n){e.queryRowsCollection.isEmptyAsync().then(function(e){s((t||i)&&e)})})},isDone:function isDone(){var e=this.getAnalysisDefinitionNodeModel();return e.queryRowsCollection.isDone()&&e.queryGeometryModel.isDone()&&e.querySchemaModel.isDone()},canBeGeoreferenced:function canBeGeoreferenced(){var e=this,t=this.getAnalysisDefinitionNodeModel(),i=e.isEmptyAsync(),s=t.queryGeometryModel.hasValueAsync();return Promise.all([i,s]).then(function(i){var s=i[0],n=i[1];return!(s||n||e.hasGeocodingAnalysisApplied()||e._hasAnyAnalysisApplied()||t.isCustomQueryApplied())})},fetchQueryRowsIfRequired:function fetchQueryRowsIfRequired(){var e=this,t=this.getAnalysisDefinitionNodeModel();t.queryGeometryModel.hasValueAsync().then(function(i){e.hasGeocodingAnalysisApplied()||i||t.isCustomQueryApplied()||!t.queryRowsCollection.isUnavailable()||t.queryRowsCollection.fetch()})}})},function(e,t,i){"use strict";var s=i(2),n=i(0);e.exports=s.Model.extend({idAttribute:"__id",url:function url(){if(this._tableName&&this._configModel){var url=this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("record")+"/tables/";if(this.hasWriteAccess(this._userModel)&&!this.isOwner(this._userModel))url+=this._permissionModel.getOwner().get("username")+"."+this._tableName+"/records";else url+=this._tableName+"/records";return this.isNew()||(url+="/"+this.get("cartodb_id")),url}return!1},initialize:function initialize(e,t){this.collection=this.collection||{},this._tableName=t.tableName||this.collection._tableName,this._configModel=t.configModel||this.collection._configModel,this._permissionModel=t.permissionModel||this.collection._permissionModel,this._userModel=t.userModel||this.collection._userModel,this._initBinds()},_initBinds:function _initBinds(){this.bind("error",this._onError,this)},hasWriteAccess:function hasWriteAccess(e){return!(!e||!this._permissionModel)&&this._permissionModel.hasWriteAccess(e)},isOwner:function isOwner(e){return!(!e||!this._permissionModel)&&this._permissionModel.isOwner(e)},isNew:function isNew(){return!this.has("cartodb_id")},isGeomLoaded:function isGeomLoaded(){try{return JSON.parse(this.get("the_geom")),!0}catch(e){return!1}},fetchRowIfGeomIsNotLoaded:function fetchRowIfGeomIsNotLoaded(e){this.isGeomLoaded()?e():this.fetch({success:e})},_onError:function _onError(){this.set(this.previousAttributes())},sync:function sync(){this.trigger("loading",this),s.Model.prototype.sync.apply(this,arguments)},parse:function parse(e){return e.__id||(e.__id=n.uniqueId()),e},toJSON:function toJSON(){return n.omit(this.attributes,"__id","the_geom_webmercator")}})},function(e,t,i){"use strict";var s=i(2),n=i(875),o=i(245),r=i(0),a=i(277);e.exports=s.Collection.extend({defaults:{empty:!0},DEFAULT_FETCH_OPTIONS:{rows_per_page:40,sort_order:"asc",page:0},model:n,sync:o,url:function url(){return this._configModel.getSqlApiUrl()},initialize:function initialize(e,t){t=t||{},this._repeatedErrors=0,this._tableName=t.tableName,this._querySchemaModel=t.querySchemaModel,this._configModel=t.configModel,this.statusModel=new s.Model({status:a.initial}),this._initBinds()},_initBinds:function _initBinds(){this.listenTo(this._querySchemaModel,"change:query",this._onQuerySchemaQueryChange),this._querySchemaModel&&this._querySchemaModel.columnsCollection&&this.listenTo(this._querySchemaModel.columnsCollection,"reset",this._onColumnsCollectionReset),this.listenTo(this.statusModel,"change:status",this._onStatusChanged)},_onColumnsCollectionReset:function _onColumnsCollectionReset(){this._onQuerySchemaQueryChange(),this.shouldFetch()&&this.fetch()},getStatusValue:function getStatusValue(){return this.statusModel.get("status")},isInInitialStatus:function isInInitialStatus(){return this.getStatusValue()===a.initial},isFetched:function isFetched(){return this.getStatusValue()===a.fetched},isErrored:function isErrored(){return this.getStatusValue()===a.errored},isFetching:function isFetching(){return this.getStatusValue()===a.fetching},isDone:function isDone(){return this.isFetched()||this.isErrored()},isInFinalStatus:function isInFinalStatus(){var e=[a.unavailable,a.fetched,a.errored];return r.contains(e,this.getStatusValue())},isUnavailable:function isUnavailable(){return this.getStatusValue()===a.unavailable},canFetch:function canFetch(){var e=!!this._querySchemaModel.get("query"),t=this._querySchemaModel.get("ready"),i=this._querySchemaModel.isFetched(),s=this._querySchemaModel.isErrored();return e&&t&&i&&!s},shouldFetch:function shouldFetch(){return!this.isFetched()&&!this.isFetching()&&this.canFetch()&&!this.isErrored()},resetFetch:function resetFetch(){this.statusModel.set("status",a.unfetched)},isEmpty:function isEmpty(){throw new Error("QueryRowsCollection.isEmpty() is an async operation. Use `.isEmptyAsync` instead.")},isEmptyAsync:function isEmptyAsync(){return this.isInFinalStatus()?Promise.resolve(0===this.size()):new Promise(function(e){this.listenToOnce(this,"inFinalStatus",function(){e(0===this.size())})}.bind(this))},_onStatusChanged:function _onStatusChanged(){this.isInFinalStatus()&&this.trigger("inFinalStatus")},_onQuerySchemaQueryChange:function _onQuerySchemaQueryChange(){this.statusModel.set("status","unfetched"),this.reset([],{silent:!0})},_geometryColumnSQL:function _geometryColumnSQL(e){return["CASE","WHEN GeometryType("+e+") = 'POINT' THEN","ST_AsGeoJSON("+e+",8)","WHEN ("+e+" IS NULL) THEN","NULL","ELSE","GeometryType("+e+")","END "+e].join(" ")},_getWrappedSQL:function _getWrappedSQL(e){var t=this,i=this._querySchemaModel.columnsCollection.toJSON(),s=r.chain(i).omit(function(t){return r.contains(e,t.name)}).map(function(e,i){return"geometry"===e.type?t._geometryColumnSQL(e.name):'"'+e.name+'"'}).value().join(",");return r.template("select <%= selectedColumns %> from (<%= sql %>) __wrapped")({selectedColumns:s,sql:this._querySchemaModel.get("query")})},_httpMethod:function _httpMethod(){return this._querySchemaModel.get("query").length>1024?"POST":"GET"},_incrementRepeatedError:function _incrementRepeatedError(){this._repeatedErrors++},_resetRepeatedError:function _resetRepeatedError(){this._repeatedErrors=0},hasRepeatedErrors:function hasRepeatedErrors(){return this._repeatedErrors>=3},fetch:function fetch(e){e=e||{};var t=this.getStatusValue();this.statusModel.set("status",a.fetching);var i=e.data&&e.data.exclude||[];(e=e||{}).data=r.extend({},this.DEFAULT_FETCH_OPTIONS,e.data&&r.omit(e.data,"exclude")||{},{api_key:this._configModel.get("api_key"),q:this._getWrappedSQL(i)}),e.method=this._httpMethod();var n=e.error;e.error=function(e,i){t===a.unavailable&&this._incrementRepeatedError(),i&&i.error&&this._querySchemaModel.setError(i.error),this.trigger("fail",e,i),this.statusModel.set("status",this.hasRepeatedErrors()?a.errored:a.unavailable),n&&n(e,i)}.bind(this);var o=e.success;return e.success=function(t,i,s){if(i&&i.error)return e.error.apply(this,arguments);this._resetRepeatedError(),this.statusModel.set("status",a.fetched),o&&o(t,i)}.bind(this),e.reset=!0,s.Collection.prototype.fetch.call(this,e)},parse:function parse(e){return this._parseWithID(e.rows)},reset:function reset(e,t){var i=[];i=e&&e.rows?e.rows:e,s.Collection.prototype.reset.apply(this,[this._parseWithID(i)])},_parseWithID:function _parseWithID(e){return r.map(e,function(e){return e.__id=r.uniqueId(),e})},addRow:function addRow(e){e=e||{},this.create({__id:r.uniqueId()},r.extend(e,{wait:!0,parse:!0}))},setTableName:function setTableName(e){e&&this._tableName&&(this._tableName=e,this.each(function(t){t._tableName=e}))}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(245),r=i(277);e.exports=n.Model.extend({initialize:function initialize(e,t){this.repeatedErrors=0,this.listenTo(this,"change:status",this._onStatusChanged),this.listenTo(this,"change:ready",this._onReadyChanged)},sync:o,getStatusValue:function getStatusValue(){return this.get("status")},isInInitialStatus:function isInInitialStatus(){return this.get("status")===r.initial},isFetched:function isFetched(){return this.get("status")===r.fetched},isFetching:function isFetching(){return this.get("status")===r.fetching},isErrored:function isErrored(){return this.get("status")===r.errored},isUnavailable:function isUnavailable(){return this.get("status")===r.unavailable},isDone:function isDone(){return this.isFetched()||this.isErrored()},isInFinalStatus:function isInFinalStatus(){var e=[r.unavailable,r.fetched,r.errored];return s.contains(e,this.get("status"))},canFetch:function canFetch(){var e=this.hasQuery(),t=this.get("ready");return e&&t},hasQuery:function hasQuery(){return!!this.get("query")},shouldFetch:function shouldFetch(){return this.canFetch()&&!this.isFetched()&&!this.isFetching()&&!this.isErrored()},resetFetch:function resetFetch(){this.set("status",r.unfetched)},isNew:function isNew(){return!0},hasRepeatedErrors:function hasRepeatedErrors(){return this.repeatedErrors>=3},_onStatusChanged:function _onStatusChanged(){this.isInFinalStatus()&&this.trigger("inFinalStatus")},_addChangeListener:function _addChangeListener(){this.bind("change",this._onChange,this)},_removeChangeListener:function _removeChangeListener(){this.unbind("change",this._onChange,this)},_httpMethod:function _httpMethod(){return this._getSqlApiQueryParam().length>1024?"POST":"GET"},_incrementRepeatedError:function _incrementRepeatedError(){this.repeatedErrors++},_resetRepeatedError:function _resetRepeatedError(){this.repeatedErrors=0},_onReadyChanged:function _onReadyChanged(){this.get("ready")&&this.shouldFetch()&&this.fetch()}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(240),r=i(1758),a=i(1757),l=i(262),h=i(3),c=i(876),d=i(536),u=i(275),p=["configModel"];e.exports=n.Model.extend({initialize:function initialize(e,t){if(!this.id)throw new Error("id is required");h(t,p,this);var i={configModel:this._configModel,userModel:t.userModel},s=this.get("simple_geom");this.querySchemaModel=new a(void 0,i),this.queryGeometryModel=new r({simple_geom:s,status:s?"fetched":"unfetched"},i),this.queryRowsCollection=new c([],{configModel:this._configModel,userModel:t.userModel,tableName:"",querySchemaModel:this.querySchemaModel}),this.listenTo(this.queryGeometryModel,"change:simple_geom",this._onGeometryTypeChanged)},fetchQueryObjects:function fetchQueryObjects(){"ready"!==this.get("status")||this.get("error")||d({queryGeometryModel:this.queryGeometryModel,querySchemaModel:this.querySchemaModel,queryRowsCollection:this.queryRowsCollection})},parse:function parse(e,t){var i=!e.type&&t.merge?[]:o.getSourceNamesForAnalysisType(e.type),n=s.reduce(e.params,function(e,s,n){return i[i.indexOf(n)]?(this.collection.add(s,t),e[n]=s.id):e[n]=s,e},{},this),r=s.reduce(e.options,function(e,t,i){return e[i]=t,e},{},this);return s.defaults(s.omit(e,"params","options"),r,n)},toJSON:function toJSON(e){e=e||{};var t=[],i={},n=o.paramsForType(this.get("type"));for(var r in n){var a=n[r],l=this.get(r),h=!0;if("node"===a.type){var c=this.collection.get(l);if(c)l=c.toJSON(e);else{if(!a.optional)throw new Error('no node found for param "'+r+'" with id "'+l+'" in node '+JSON.stringify(this.attributes));h=!1}}h&&(i[r]=l,t.push(r))}var d={id:this.get("id"),type:this.get("type"),params:i},u=s.omit(this.attributes,t.concat("id","type","status","style_history"));return e.skipOptions||s.isEmpty(u)||(d.options=u),d},isNew:function isNew(){return!0},isReadOnly:function isReadOnly(){return!0},isCustomQueryApplied:function isCustomQueryApplied(){return!1},canBeDeletedByUser:function canBeDeletedByUser(){return this.hasPrimarySource()},hasFailed:function hasFailed(){return"failed"===this.get("status")},isDone:function isDone(){return"ready"===this.get("status")},destroy:function destroy(){return this.querySchemaModel&&(this.querySchemaModel.destroy(),this.querySchemaModel=null),n.Model.prototype.destroy.apply(this,arguments)},clone:function clone(e){if(!e)throw new Error("newId is required");if(!s.isString(e)||e.length<2)throw new Error("newId is required as a non-empty string");if(e===this.id)throw new Error("newId must be different from current id, "+this.id);var t=this.toJSON();return t.id=e,this.collection.add(t)},linkedListBySameLetter:function linkedListBySameLetter(){for(var e=[this],t=this,i=this.letter();;){var s=t.getPrimarySource();if(!s||s.letter()!==i)break;e.push(s),t=s}return e},isValidAsInputForType:function isValidAsInputForType(e){if("source"===e)return!1;var t=this.queryGeometryModel.get("simple_geom");return t?o.isValidInputGeometryForType(t,e):null},containsNode:function containsNode(e){return!!e&&(this.id===e.id||this._sourcesContains(e))},hasPrimarySource:function hasPrimarySource(){return!!this.getPrimarySource()},hasSecondarySource:function hasSecondarySource(){return!!this.getSecondarySource()},getPrimarySource:function getPrimarySource(){return this.collection.get(this._getPrimarySourceId())},getSecondarySource:function getSecondarySource(){var e=this._getPrimarySourceId(),t=s.find(this.sourceIds(),function(t){return t!==e});return this.collection.get(t)},getDefaultQuery:function getDefaultQuery(){return this.get("query")},sourceIds:function sourceIds(){return s.map(this._sourceNames(),function(e){return this.get(e)},this)},changeSourceIds:function changeSourceIds(e,t,i){this._sourceNames().forEach(function(s){this.get(s)===e&&this.set(s,t,{silent:i})},this)},isSourceType:function isSourceType(){return"source"===this.get("type")},letter:function letter(){return l.letter(this.id)},getColor:function getColor(){var e=l.letter(this.id);return u.getColorForLetter(e)},getStyleHistoryForLayer:function getStyleHistoryForLayer(e){var t=this.get("style_history");return t&&t[e]},_sourcesContains:function _sourcesContains(e){var t=this.getPrimarySource(),i=this.getSecondarySource();return!!(t&&t.containsNode(e)||i&&i.containsNode(e))},_getPrimarySourceId:function _getPrimarySourceId(){var e=this.get("primary_source_name")||this._sourceNames()[0];return this.get(e)},_sourceNames:function _sourceNames(){return o.getSourceNamesForAnalysisType(this.get("type"))},_onGeometryTypeChanged:function _onGeometryTypeChanged(e,t){this.set("simple_geom",t)}})},function(e,t,i){"use strict";var s=i(878),n=i(312),o=i(276);e.exports=s.extend({defaults:{status:"ready"},initialize:function initialize(e,t){if(!t.userModel)throw new Error("userModel is required");this._userModel=t.userModel,s.prototype.initialize.apply(this,arguments);var i=this.get("query");this.querySchemaModel.set({query:i,ready:!0},{silent:!0}),this.queryGeometryModel.set({query:i,ready:!0},{silent:!0}),this.queryRowsCollection._tableName=this.get("table_name");var o=t.tableData||{name:this.get("table_name")};this.tableModel=new n(o,{configModel:t.configModel,parse:!0})},getDefaultQuery:function getDefaultQuery(){return o.getDefaultSQL(this.get("table_name"),this.tableModel.getOwnerName(),this._userModel.isInsideOrg())},isCustomQueryApplied:function isCustomQueryApplied(){return!o.isSameQuery(this.querySchemaModel.get("query"),this.getDefaultQuery())},isReadOnly:function isReadOnly(){var e=this.tableModel.isReadOnly(this._userModel),t=this.isCustomQueryApplied();return e||t},getTableModel:function getTableModel(){return this.tableModel},fetchTable:function fetchTable(){this.tableModel.get("id")||this.tableModel.fetch()},setTableName:function setTableName(e){if(!e)throw new Error("name is required");this.set("table_name",e),this.tableModel.set("name",e),this.queryRowsCollection.setTableName(e),this.querySchemaModel.set({status:"unfetched",query:this.getDefaultQuery()})}})},function(e,t,i){"use strict";e.exports={bubble:{legendType:"size"},category:{legendType:"color"},choropleth:{legendType:"color"},custom:{legendType:"color"},custom_choropleth:{legendType:"color"}}},,,,,,,,,,,,function(e,t,i){var s=i(0),n=i(327),o=i(1797),r=i(1796),a=["line-color","line-opacity"];function generateCSSTreeFromCartoCSS(e){return n().use(o).process(e,{syntax:r})}function isSelectorRule(e){return"rule"===e.type&&-1!==e.selector.search(/\[(.)+\]/g)}e.exports={changeStyle:s.memoize(function changeStyle(e,t,i){if(s.isUndefined(i))return e;var n=generateCSSTreeFromCartoCSS(e),o=n.result.root,r=!1;return o?(o.walkDecls(t,function(e){var n=e.parent;(function isOutlineRule(e){return"rule"===e.type&&-1!==e.selector.search("::outline")})(n)&&s.contains(a,t)||(isSelectorRule(n)||r?e.remove():(e.value=i,r=!0))}),n.css):e},function(e,t,i){return e+t+i}),isPropertyIncluded:function isPropertyIncluded(e,t){var i=generateCSSTreeFromCartoCSS(e).result.root,s=!1;return i&&i.walkDecls(t,function(e){var t=e.parent;isSelectorRule(t)&&!function isMapnikGeometrySelectorRule(e){return isSelectorRule(e)&&-1!==e.selector.search("mapnik::geometry_type")}(t)||(s=!0)}),s},replaceWrongSpaceChar:function replaceWrongSpaceChar(e){return e.replace(new RegExp(String.fromCharCode(160),"g")," ")}}},function(e,t,i){var s=i(9),n=i(892),o=i(1777),r=i(392),a=s.core.Model.extend({initialize:function(e,t,i){this.options=i||{},this.styles=i&&i.auto_style,this.dataviewModel=e,this.colors=new o(this.styles),this.layer=t},getStyle:function(){var e=this.layer.get("initialStyle");if(e)return a.FILL_SELECTORS.forEach(function(t){e=n.changeStyle(e,t,this._getFillColor(t))}.bind(this)),a.OPACITY_SELECTORS.forEach(function(t){e=n.changeStyle(e,t,this._getOpacity())}.bind(this)),n.replaceWrongSpaceChar(e)},_getColor:function(){return r(this.styles,"definition.color")},_getOpacity:function(){return r(this.styles,"definition.color.opacity")}});a.FILL_SELECTORS=["marker-fill","polygon-fill","line-color"],a.OPACITY_SELECTORS=["marker-fill-opacity","polygon-opacity","line-opacity"],e.exports=a},,,,,,,,,,,,function(e,t,i){var s=i(4),n=i(1),o=i(3),r=i(904),a=i(543),l=["dataviewModel","widgetModel","paginatorModel"];e.exports=n.extend({options:{itemsPerPage:6,template:r,paginator:!1},className:"CDB-Widget-nav CDB-Widget-contentSpaced",events:{"click .js-searchToggle":"_onSearchClicked","click .js-next":"_onNextPage","click .js-prev":"_onPrevPage"},initialize:function(e){o(e,l,this),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this.listenTo(this._paginatorModel,"change:page",this.render),this.listenTo(this._dataviewModel,"change:categoriesCount",this.render),this.listenTo(this._dataviewModel,"change:data change:searchData",this._onDataChanged),this.listenTo(this._widgetModel,"change:search",this.toggle)},_initViews:function(){var e=this._dataviewModel.getCount();if(e>5){var t=this.options.template;this.$el.html(t({categoriesCount:e})),this.options.paginator&&this.$el.append(a({currentPage:this._paginatorModel.get("page"),pages:this._totalPages()}))}else this._paginatorModel.set("page",1)},_setPage:function(){var e=this._totalPages();(this._paginatorModel.get("page")>e||this._paginatorModel.get("page")<1)&&this._paginatorModel.set({page:1},{silent:!0})},_onSearchClicked:function(){this._widgetModel.setupSearch()},_onDataChanged:function(){this._setPage(),this.render()},_onPrevPage:function(){this._changePage(-1)},_onNextPage:function(){this._changePage(1)},_changePage:function(e){var t=this._totalPages(),i=this._paginatorModel.get("page")+e;i>t&&(i=1),i<1&&(i=t),this._paginatorModel.set("page",i)},_totalPages:function(){return Math.ceil(this._dataviewModel.getSize()/this.options.itemsPerPage)},toggle:function(){this[this._widgetModel.isSearchEnabled()?"hide":"show"]()},hide:function(){this.$el.addClass("is-hidden")},show:function(){this.$el.removeClass("is-hidden")},clean:function(){s(window).unbind("resize."+this.cid),n.prototype.clean.call(this)}})},,,,,function(e,t,i){var s=i(0),n=i(1),o=i(3),r=i(1810),a=i(547),l=["dataviewModel","widgetModel","paginatorModel"];e.exports=n.extend({options:{paginator:!1,itemsPerPage:6},className:"CDB-Widget-list js-list",tagName:"ul",initialize:function(e){o(e,l,this),this._dataviewModel.get("sync_on_bbox_change")||this.$el.addClass("CDB-Widget-list--nodynamic"),this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty();var e=this._dataviewModel.getData();return s.isEmpty(e)||0===s.size(e)?this._renderPlaceholder():this._renderList(),this},_initBinds:function(){this.listenTo(this._paginatorModel,"change:page",this.render),this.listenTo(this._widgetModel,"change:search",this.toggle),this.listenTo(this._widgetModel,"change:style change:autoStyle",this.render),this.listenTo(this._dataviewModel,"change:data",this.render),this.listenTo(this._dataviewModel,"change:sync_on_bbox_change",this.blockFiltering)},_renderPlaceholder:function(){this.$el.addClass("CDB-Widget-list--withBorders CDB-Widget-list--fake"),this.$el.append(a())},_renderList:function(){this._createList(),this.$el.removeClass("CDB-Widget-list--withBorders CDB-Widget-list--fake CDB-Widget-list--noresults"),this._renderItems()},_renderItems:function(){var e=this._paginatorModel.get("page")-1,t=this.pagesData[e];s.each(t,function(e){this._addItem(e)}.bind(this))},_createList:function(){this.pagesData={};var e=0;this._getData().each(function(t,i){i%this.options.itemsPerPage==0&&(0!==i&&(e+=1),this.pagesData[e]=[]),this.pagesData[e].push(t)},this)},_getData:function(){return this._dataviewModel.getData()},_addItem:function(e){var t=new r({model:e,widgetModel:this._widgetModel,dataviewModel:this._dataviewModel});t.bind("itemClicked",this._setFilters,this),this.addView(t),this.$el.append(t.render().el)},_setFilters:function(e){var t=e.get("selected"),i=this._dataviewModel.filter,s=e.get("name");t?0===i.rejectedCategories.size()&&0===i.acceptedCategories.size()?(this._dataviewModel.getData().each(function(e){e.get("name")!==s&&e.set("selected",!1)}),i.accept(e.get("name"))):(e.set("selected",!1),i.reject(s)):(e.set("selected",!0),i.accept(s));this._widgetModel.set("acceptedCategories",this._widgetModel._acceptedCategories().pluck("name"))},blockFiltering:function(e){e.changed.sync_on_bbox_change?this.$el.removeClass("CDB-Widget-list--nodynamic"):(this.$el.addClass("CDB-Widget-list--nodynamic"),this._dataviewModel.filter.acceptAll())},removeSelections:function(){this._dataviewModel.filter.acceptAll()},toggle:function(){this[this._widgetModel.isSearchEnabled()?"hide":"show"]()},show:function(){this.$el.removeClass("is-hidden")},hide:function(){this.$el.addClass("is-hidden")}})},,,,,,,,,,,function(e,t,i){var s=i(9),n=i(1),o=i(250),r=i(920),a=i(242),l=i(390),h=i(919),c=i(6);e.exports=n.extend({className:"CDB-Widget-contentSpaced CDB-Widget-contentFull",events:{"click .js-clear":"_onClick"},options:{showClearButton:!0},initialize:function(e){if(!e.dataviewModel)throw new Error("dataviewModel is required");if(!e.layerModel)throw new Error("layerModel is required");if(!e.rangeFilter)throw new Error("rangeFilter is required");if(!e.timeSeriesModel)throw new Error("timeSeriesModel is required");if(void 0===e.selectedAmount)throw new Error("selectedAmount is required");this._timeSeriesModel=e.timeSeriesModel,this._dataviewModel=e.dataviewModel,this._rangeFilter=e.rangeFilter,this._selectedAmount=e.selectedAmount,this._layerModel=e.layerModel,this.model=new s.core.Model,this._createFormatter(),this._initBinds()},render:function(){var e=this._timeSeriesModel.get("title"),t=!this._rangeFilter.isEmpty();return this.$el.html(r({start:this.model.get("left_axis_tip")||this.formatter(this._rangeFilter.get("min")),end:this.model.get("right_axis_tip")||this.formatter(this._rangeFilter.get("max")),title:e,showClearButton:this.options.showClearButton&&t,showSelection:t})),this._animateValue(),this._initViews(),this},_initViews:function(){var e=new c({el:this.$el.find(".js-actions"),gravity:"auto"});this.addView(e)},_createFormatter:function(){this.formatter=a.formatNumber,"date"===this._dataviewModel.getColumnType()&&(this.formatter=a.timestampFactory(this._dataviewModel.get("aggregation"),this._dataviewModel.getCurrentOffset()))},_onLocalTimezoneChanged:function(){this._createFormatter(),this.render()},_animateValue:function(){var e=new l({el:this.$el}),t=this._rangeFilter.isEmpty()?"totalAmount":"filteredAmount",i=this._dataviewModel.get(t);e.animateFromValues.call(this,this._selectedAmount,i,".js-val",h,{formatter:a.formatNumber,templateData:{suffix:" Selected"}}),this._selectedAmount=i},_initBinds:function(){this.listenTo(this.model,"change:left_axis_tip change:right_axis_tip",this.render),this.listenTo(this._timeSeriesModel,"change:title",this.render),this.listenTo(this._timeSeriesModel,"change:local_timezone",this._onLocalTimezoneChanged),this.listenTo(this._dataviewModel,"change:totalAmount",this._animateValue),this.listenTo(this._dataviewModel,"on_update_axis_tip",this._onUpdateAxisTip),this.listenTo(this._rangeFilter,"change",this.render)},_onUpdateAxisTip:function(e){this.model.set(e.attr,e.text)},_setupScales:function(){var e=this._dataviewModel.get("data"),t=this._dataviewModel.getColumnType();this._scale="date"===t?o.time.scale().domain([1e3*e[0].start,1e3*e[e.length-1].end]).range([this._dataviewModel.get("start"),this._dataviewModel.get("end")]):o.scale.linear().domain([e[0].start,e[e.length-1].end]).range([this._dataviewModel.get("start"),this._dataviewModel.get("end")])},_onClick:function(){this.trigger("resetFilter",this)}})},function(e,t,i){var s=i(4),n=i(0),o=i(250),r=i(1106),a=i(1823),l=i(1),h=i(242),c=i(1822),d=i(544),u=function(e,t,i,s,n,o,r){var a=o+1*r;return"M "+e+" "+t+" L "+i+" "+s+" C "+(n+.1)+" "+a+" "+(n-.1)+" "+a+" "+e+" "+t+" z"};e.exports=l.extend({options:{showOnWidthChange:!0,chartBarColor:"#F2CC8F",labelsMargin:16,hasAxisTip:!1,minimumBarHeight:2,animationSpeed:750,handleWidth:8,handleRadius:3,divisionWidth:80,animationBarDelay:function(e,t){return Math.random()*(100+10*t)},transitionType:"elastic"},initialize:function(){if(this._originalData=this.options.originalData,!n.isNumber(this.options.height))throw new Error("height is required");if(!this.options.dataviewModel)throw new Error("dataviewModel is required");if(!this.options.layerModel)throw new Error("layerModel is required");if(!this.options.type)throw new Error("type is required");n.bindAll(this,"_selectBars","_adjustBrushHandles","_onBrushMove","_onBrushEnd","_onMouseMove","_onMouseOut"),this.forceResize=n.debounce(this._resizeToParentElement.bind(this),50),this.setElement(s('<svg class=""></svg>')[0]),this._widgetModel=this.options.widgetModel,this._dataviewModel=this.options.dataviewModel,this._layerModel=this.options.layerModel,this.canvas=o.select(this.el).style("overflow","visible").attr("width",0).attr("height",this.options.height),this.canvas.append("g").attr("class","CDB-WidgetCanvas"),this._setupModel(),this._setupBindings(),this._setupDimensions(),this._setupD3Bindings(),this._setupFillColor(),this.hide(),this._tooltipFormatter=h.formatNumber,this._createFormatter()},render:function(){return this._generateChart(),this._generateChartContent(),this},replaceData:function(e){this.model.set({data:e})},toggleLabels:function(e){this.model.set("showLabels",e)},chartWidth:function(){var e=this.model.get("margin");return Math.max(0,this.model.get("width")-e.left-e.right)},chartHeight:function(){var e=this.model.get("margin"),t=this.model.get("showLabels")?this.options.labelsMargin:0;return this.model.get("height")-e.top-e.bottom-t},getSelectionExtent:function(){if(this.brush&&this.brush.extent()){var e=this.brush.extent();return e[1]-e[0]}return 0},_resizeToParentElement:function(){if(this.$el.parent()){var e=this.isHidden();this.hide();var t=this.$el.parent(),i=t.parent&&t.parent()&&t.parent().length>0?t.parent():null,n=t.width()||0;this.model.get("animated")&&this.$el.siblings().each(function(){n-=s(this).width()}),i&&i.outerWidth&&this._isTabletViewport()&&(n-=i.outerWidth(!0)-i.width()),e?this.hide():this.show(),this.model.set("width",n)}},_onChangeLeftAxisTip:function(){this._updateAxisTip("left")},_onChangeRightAxisTip:function(){this._updateAxisTip("right")},_overlap:function(e,t){var i=e.node().getBoundingClientRect(),s=t.node().getBoundingClientRect();return!(i.right<s.left||i.left>s.right||i.bottom<s.top||i.top>s.bottom)},_updateTriangle:function(e,t,i,s,n){var r=!e||this._isTabletViewport()&&this._isTimeSeries()?1:-1,a=o.transform(t.attr("transform")),l=Math.min(14,n),h=s-l/2,c=e?Math.min(i+n-(h+l),0):Math.abs(Math.min(h-i,0)),d=[0,0],p=[l,0],g=[l/2-c,7*r];t.attr("d",u(d[0],d[1],p[0],p[1],g[0],g[1],r)),a.translate[0]=s-l/2+c,t.attr("transform",a.toString())},_updateAxisTip:function(e){var t=e+"_axis_tip",i="right"===e,s=!i,n="week"===this._dataviewModel.get("aggregation"),r=this.model.get(t);if(void 0!==r){var a=this.model.get("left_axis_tip"),l=this.model.get("right_axis_tip"),h=this.chart.select(".CDB-Chart-axisTipText.CDB-Chart-axisTip-"+e),c=this.chart.select(".CDB-Chart-axisTip.CDB-Chart-axisTip-"+e),d=this.chart.select(".CDB-Chart-axisTipRect.CDB-Chart-axisTip-"+e),u=this.chart.select(".CDB-Chart-handle.CDB-Chart-handle-"+e),p=u.select(".CDB-Chart-axisTipTriangle");if(h.data([r]).text(function(e){var i=this.formatter(e);return this._dataviewModel.trigger("on_update_axis_tip",{attr:t,text:i}),i}.bind(this)),h.node()){var g=h.node().getBBox(),m=g.width+6,f=this.options.handleWidth,_=this.barWidth,v=this.chartWidth();d.attr("width",m),h.attr("dx",3),h.attr("dy",g.height-Math.abs((g.height-17)/2));var y=+o.transform(u.attr("transform")).translate[0]+this.options.handleWidth/2,b=!i||this._isMobileViewport()&&this._isTimeSeries()?-26:this.chartHeight()+9.1-1;b=Math.floor(b);var w=m/2,C=(f+_)/2;C-=i?_:0,this._isDateTimeSeries()&&!n||(C=f/2);var M=C-w,k=y+M,S=M+w,x=k+m-(v+f);k<0&&(M-=k),x>0&&(M-=x);var T=s?a<=l:a<=l&&!(a===l&&this._isDateTimeSeries());this._showAxisTip(e,T),c.attr("transform","translate("+M+", "+b+")"),this._updateTriangle(i,p,M,S,m),this.model.get("dragging")&&this._isMobileViewport()&&this._isTimeSeries()&&this._showAxisTip(e,!0)}}},_onChangeData:function(){this.model.previous("data").length!==this.model.get("data").length?this.reset():this.refresh(),this._setupFillColor(),this._refreshBarsColor()},_onChangeRange:function(){var e=this.model.get("lo_index"),t=this.model.get("hi_index");0===e&&0===t||null===e&&null===t||(this.selectRange(e,t),this._adjustBrushHandles(),this._setAxisTipAccordingToBins(),this._selectBars(),this.trigger("on_brush_end",e,t))},_onChangeWidth:function(){var e=this.model.get("width");this.canvas.attr("width",e),this.chart.attr("width",e),this.options.showOnWidthChange&&e>0&&this.show(),this.reset();var t=this.model.get("lo_index"),i=this.model.get("hi_index");this.selectRange(t,i),this._updateAxisTip("left"),this._updateAxisTip("right")},_onChangeNormalized:function(){this.model.set("show_shadow_bars",!this.model.get("normalized")),this._generateShadowBars(),this.updateYScale(),this.refresh()},_onChangeHeight:function(){var e=this.model.get("height");this.$el.height(e),this.chart.attr("height",e),this.leftHandle.attr("height",e),this.rightHandle.attr("height",e),this.updateYScale(),this.reset()},_onChangeShowLabels:function(){this._axis.style("opacity",this.model.get("showLabels")?1:0)},_onChangePos:function(){var e=this.model.get("pos"),t=this.model.get("margin"),i=+e.x,s=+e.y;this.chart.transition().duration(150).attr("transform","translate("+(t.left+i)+", "+(t.top+s)+")")},_onChangeDragging:function(){this.chart.classed("is-dragging",this.model.get("dragging")),!this.model.get("dragging")&&this._isMobileViewport()&&this._isTimeSeries()&&(this._showAxisTip("right",!1),this._showAxisTip("left",!1))},_toggleAxisTip:function(e,t){var i=this.chart.select(".CDB-Chart-axisTipText.CDB-Chart-axisTip-"+e),s=this.chart.select(".CDB-Chart-axisTipRect.CDB-Chart-axisTip-"+e),n=this.chart.select(".CDB-Chart-handle.CDB-Chart-handle-"+e).select(".CDB-Chart-axisTipTriangle");i&&i.transition().duration(60).attr("opacity",t),s&&s.transition().duration(60).attr("opacity",t),n&&n.transition().duration(60).style("opacity",t)},_showAxisTip:function(e,t){this._toggleAxisTip(e,t?1:0)},_setAxisTipAccordingToBins:function(){var e=this._getValueFromBinIndex(this._getLoBarIndex()),t=this._getValueFromBinIndex(this._getHiBarIndex());this._isDateTimeSeries()&&(t=c.substractOneUnit(t,this._dataviewModel.get("aggregation"))),this._setAxisTip(e,t)},_setAxisTip:function(e,t){this.options.hasAxisTip&&this.model.set({left_axis_tip:e,right_axis_tip:t})},reset:function(){this._removeChartContent(),this._setupDimensions(),this._calcBarWidth(),this._generateChartContent(),this._generateShadowBars()},refresh:function(){this._createFormatter(),this._setupDimensions(),this._removeAxis(),this._generateAxis(),this._updateChart(),this._refreshBarsColor(),this.chart.select(".CDB-Chart-handles").moveToFront(),this.chart.select(".Brush").moveToFront()},resetIndexes:function(){this.model.set({lo_index:null,hi_index:null})},removeShadowBars:function(){this.model.set("show_shadow_bars",!1)},_removeShadowBars:function(){this.chart.selectAll(".CDB-Chart-shadowBars").remove()},_removeBars:function(){this.chart.selectAll(".CDB-Chart-bars").remove()},_removeBrush:function(){this.chart.selectAll(".Brush").remove(),this.chart.classed("is-selectable",!1),this._axis.classed("is-disabled",!1)},_removeLines:function(){this.chart.select(".CDB-Chart-lines").remove(),this.chart.select(".CDB-Chart-line--bottom").remove()},_removeChartContent:function(){this._removeBrush(),this._removeHandles(),this._removeBars(),this._removeAxis(),this._removeLines()},_generateChartContent:function(){this._generateAxis(),this._isTabletViewport()&&this._isTimeSeries()||this._generateLines(),this._generateBars(),this._isMobileViewport()&&this._isTimeSeries()||this._generateBottomLine(),this._generateHandles(),this._setupBrush()},_generateLines:function(){this._generateHorizontalLines(),this._generateVerticalLines()},_generateVerticalLines:function(){this.chart.select(".CDB-Chart-lines").append("g").selectAll(".CDB-Chart-line").data(this.verticalRange.slice(1,this.verticalRange.length-1)).enter().append("svg:line").attr("class","CDB-Chart-line").attr("y1",0).attr("x1",function(e){return e}).attr("y2",this.chartHeight()).attr("x2",function(e){return e})},_generateHorizontalLines:function(){this.chart.append("g").attr("class","CDB-Chart-lines").append("g").attr("class","y").selectAll(".CDB-Chart-line").data(this.horizontalRange.slice(0,this.horizontalRange.length-1)).enter().append("svg:line").attr("class","CDB-Chart-line").attr("x1",0).attr("y1",function(e){return e}).attr("x2",this.chartWidth()).attr("y2",function(e){return e})},_generateBottomLine:function(){this.chart.append("line").attr("class","CDB-Chart-line CDB-Chart-line--bottom").attr("x1",0).attr("y1",this.chartHeight()-1).attr("x2",this.chartWidth()-1).attr("y2",this.chartHeight()-1)},_setupD3Bindings:function(){o.selection.prototype.moveToBack=function(){return this.each(function(){var e=this.parentNode.firstChild;e&&this.parentNode.insertBefore(this,e)})},o.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})}},_setupModel:function(){this.model=new a({bounded:!1,showLabels:!0,data:this.options.data,height:this.options.height,display:!0,show_shadow_bars:this.options.displayShadowBars,margin:n.clone(this.options.margin),width:0,pos:{x:0,y:0},normalized:this.options.normalized,local_timezone:this.options.local_timezone})},_setupBindings:function(){this.listenTo(this.model,"change:data",this._onChangeData),this.listenTo(this.model,"change:display",this._onChangeDisplay),this.listenTo(this.model,"change:dragging",this._onChangeDragging),this.listenTo(this.model,"change:height",this._onChangeHeight),this.listenTo(this.model,"change:left_axis_tip",this._onChangeLeftAxisTip),this.listenTo(this.model,"change:lo_index change:hi_index",this._onChangeRange),this.listenTo(this.model,"change:pos",this._onChangePos),this.listenTo(this.model,"change:right_axis_tip",this._onChangeRightAxisTip),this.listenTo(this.model,"change:showLabels",this._onChangeShowLabels),this.listenTo(this.model,"change:show_shadow_bars",this._onChangeShowShadowBars),this.listenTo(this.model,"change:width",this._onChangeWidth),this.listenTo(this.model,"change:normalized",this._onChangeNormalized),this._widgetModel&&(this.listenTo(this._widgetModel,"change:autoStyle",this._refreshBarsColor),this.listenTo(this._widgetModel,"change:style",function(){this._setupFillColor(),this._refreshBarsColor()})),this._dataviewModel&&this.listenTo(this._dataviewModel,"change:offset change:localTimezone",function(){this.refresh()}),this.listenTo(this._layerModel,"change:cartocss",function(){this._areGradientsAlreadyGenerated()||this._setupFillColor()}),this._originalData&&this.listenTo(this._originalData,"change:data",function(){this.updateYScale(),this._removeShadowBars(),this._generateShadowBars()})},_setupDimensions:function(){this._setupScales(),this._setupRanges(),this.forceResize()},_getData:function(){return this._originalData&&this._originalData.getData()||this.model.get("data")},_getMaxData:function(e){return o.max(e,function(e){return n.isEmpty(e)?0:e.freq})},_getXScale:function(){return o.scale.linear().domain([0,100]).range([0,this.chartWidth()])},_getYScale:function(){var e=this.model.get("normalized")?this.model.get("data"):this._getData();return o.scale.linear().domain([0,this._getMaxData(e)]).range([this.chartHeight(),0])},updateXScale:function(){this.xScale=this._getXScale()},updateYScale:function(){this.yScale=this._getYScale()},resetYScale:function(){this.yScale=this._originalYScale},_getDataForScales:function(){return!this.model.get("bounded")&&this._originalData?this._originalData.getData():this.model.get("data")},_setupScales:function(){var e=this._getDataForScales();if(this.updateXScale(),this._originalYScale&&!this.model.get("normalized")||(this._originalYScale=this.yScale=this._getYScale()),e&&e.length){var t=e[0].start,i=e[e.length-1].end;this.xAxisScale=o.scale.linear().range([t,i]).domain([0,this.chartWidth()])}},_setupRanges:function(){this.verticalRange=this._calculateVerticalRangeDivisions(),this.horizontalRange=o.range(0,this.chartHeight()+this.chartHeight()/2,this.chartHeight()/2)},_calculateVerticalRangeDivisions:function(){return this._isDateTimeSeries()&&this.model.get("data").length>0?this._calculateTimelySpacedDivisions():this._calculateEvenlySpacedDivisions()},_calculateTimelySpacedDivisions:function(){this._calcBarWidth();for(var e=Math.round(this.chartWidth()/this.options.divisionWidth),t=Math.ceil(this.model.get("data").length/e),i=[0],s=0,o=0;o<e;o++)s=o<e-1?s+t:this.model.get("data").length,i.push(Math.ceil(this.xAxisScale.invert(this._getValueFromBinIndex(s))));if((i=n.uniq(i)).length>=3){var r=n.last(i,2);r[1]-r[0]<this.options.divisionWidth&&(i=n.without(i,r[0]))}return i},_calculateEvenlySpacedDivisions:function(){var e=Math.round(this.chartWidth()/this.options.divisionWidth),t=this.chartWidth()/e,i=this.chartWidth()+t;return o.range(0,i,t).slice(0,e+1)},_calcBarWidth:function(){this.barWidth=this.chartWidth()/this.model.get("data").length},_generateChart:function(){var e=this.model.get("margin");this.chart=o.select(this.el).selectAll(".CDB-WidgetCanvas").append("g").attr("class","CDB-Chart").attr("transform","translate("+e.left+", "+e.top+")"),this.chart.classed(this.options.className||"",!0)},_onChangeShowShadowBars:function(){this.model.get("show_shadow_bars")?this._generateShadowBars():this._removeShadowBars()},_onChangeDisplay:function(){this.model.get("display")?this._show():this._hide()},hide:function(){this.model.set("display",!1)},show:function(){this.model.set("display",!0)},_hide:function(){this.$el.hide()},_show:function(){this.$el.show()},isHidden:function(){return!this.model.get("display")},_selectBars:function(){this.chart.selectAll(".CDB-Chart-bar").classed({"is-selected":function(e,t){return this._isBarChartWithinFilter(t)}.bind(this),"is-filtered":function(e,t){return!this._isBarChartWithinFilter(t)}.bind(this)})},_isBarChartWithinFilter:function(e){var t=this.brush.extent(),i=t[0],s=t[1],n=Math.floor(e*this.barWidth),o=Math.floor(n+this.barWidth),r=Math.floor(this.xScale(i)),a=Math.floor(this.xScale(s));return n>r&&n<a||o>r&&o<a||n<=r&&o>=a},_isDragging:function(){return this.model.get("dragging")},setAnimated:function(){return this.model.set("animated",!0)},_isAnimated:function(){return this.model.get("animated")},_move:function(e){this.model.set({pos:e})},expand:function(e){this.canvas.attr("height",this.model.get("height")+e),this._move({x:0,y:e})},contract:function(e){this.canvas.attr("height",e),this._move({x:0,y:0})},resizeHeight:function(e){this.model.set("height",e)},setNormalized:function(e){return this.model.set("normalized",!!e),this},removeSelection:function(){this.resetIndexes(),this.chart.selectAll(".CDB-Chart-bar").classed({"is-selected":!1,"is-filtered":!1}),this._refreshBarsColor(),this._removeBrush(),this._setupBrush()},selectRange:function(e,t){if(e||t){var i=this._dataviewModel.get("data");if(!i[e]||!i[t-1])return this.trigger("on_reset_filter");var s=this._getBarPosition(e),n=this._getBarPosition(t);this.model.set({lo_index:e,hi_index:t}),this._selectRange(s,n)}},_selectRange:function(e,t){this.chart.select(".Brush").transition().duration(this.brush.empty()?0:150).call(this.brush.extent([e,t])).call(this.brush.event)},_getLoBarIndex:function(){var e=this.brush.extent();return Math.round(this.xScale(e[0])/this.barWidth)},_getHiBarIndex:function(){var e=this.brush.extent();return Math.round(this.xScale(e[1])/this.barWidth)},_getBarIndex:function(){var e=o.event.sourceEvent.layerX;return Math.floor(e/this.barWidth)},_getBarPosition:function(e){return e*(100/this.model.get("data").length)},_setupBrush:function(){var e=o.svg.brush().x(this.xScale).on("brush",this._onBrushMove).on("brushend",this._onBrushEnd),t=this.chart.append("g").attr("class","Brush").call(e),i=this._isTabletViewport()&&this._isTimeSeries()?2*this.chartHeight():this.chartHeight();t.selectAll("rect").attr("y",0).attr("height",i),t.selectAll("rect.background").on("mouseout",this._onMouseOut).on("mousemove",this._onMouseMove),t.selectAll("rect").classed("ps-prevent-touchmove",!0),t.selectAll("g").classed("ps-prevent-touchmove",!0),this.brush=e,this.chart.selectAll("g.resize rect").attr("width",this.options.handleWidth).attr("x",-this.options.handleWidth/2)},_onBrushMove:function(){this.brush.empty()||(this.chart.classed("is-selectable",!0),this._axis.classed("is-disabled",!0),this.model.set({dragging:!0}),this._selectBars(),this._setupFillColor(),this._refreshBarsColor(),this._adjustBrushHandles(),this._updateAxisTip("left"),this._updateAxisTip("right"))},_onBrushEnd:function(){var e,t,i=this.model.get("data"),s=this.brush,n=this._getLoBarIndex(),r=this._getHiBarIndex();if(this.model.set({dragging:!1}),s.empty()&&this._isAnimated())this.trigger("on_brush_click",s.extent()[0]/100);else if(e=this._getBarPosition(n),t=this._getBarPosition(r),o.event.sourceEvent){if(n===r&&(r>=i.length?(n=i.length-1,r=i.length):r+=1),this.model.set({lo_index:n,hi_index:r},{silent:!0}),this.model.trigger("change:lo_index"),o.event.sourceEvent&&void 0===e&&void 0===t){var a=this._getBarIndex();this.model.set({lo_index:a,hi_index:a+1})}this._setupFillColor(),this._refreshBarsColor()}},_onMouseOut:function(){this.chart.selectAll(".CDB-Chart-bar").classed("is-highlighted",!1).attr("fill",this._getFillColor.bind(this)),this.trigger("hover",{target:null})},_onMouseMove:function(){var e=o.event.offsetX-this.model.get("margin").left,t=Math.floor(e/this.barWidth),i=this.model.get("data");if(void 0!==i[t]&&null!==i[t]){var s=i[t].freq,n={},r=this.chart.select(".CDB-Chart-bar:nth-child("+(t+1)+")");if(r&&r.node()&&!r.classed("is-selected")){var a=t*this.barWidth+this.barWidth/2,l=this.yScale(s),h=this.chartHeight()-this.yScale(s);if(h<this.options.minimumBarHeight&&h>0&&(l=this.chartHeight()-this.options.minimumBarHeight),!this._isDragging()&&s>0){var c=this.formatter(s);n={target:r[0][0],top:l,left:a,data:c}}else n=null}else n=null;this.trigger("hover",n),this.chart.selectAll(".CDB-Chart-bar").classed("is-highlighted",!1).attr("fill",this._getFillColor.bind(this)),r&&r.node()&&(r.attr("fill",function(){return this._getHoverFillColor(i[t],t)}.bind(this)),r.classed("is-highlighted",!0))}},_adjustBrushHandles:function(){var e=this.brush.extent(),t=e[0],i=e[1];this._moveHandle(t,"left"),this._moveHandle(i,"right"),this._setAxisTipAccordingToBins()},_moveHandle:function(e,t){var i=this.chart.select(".CDB-Chart-handle-"+t),s=e.toFixed(5),n=this.xScale(s)-this.options.handleWidth/2,o=s>=0&&s<=100?"inline":"none";i.style("display",o).attr("transform","translate("+n+", 0)")},_generateAxisTip:function(e){var t=this.chart.select(".CDB-Chart-handle.CDB-Chart-handle-"+e),i="right"!==e||this._isMobileViewport()&&this._isTimeSeries()?-26:this.chartHeight()+9.1;i=Math.floor(i);var s="right"!==e||this._isMobileViewport()&&this._isTimeSeries()?-11:this.chartHeight()+9.1+2,n="right"===e?-1:1,o=7*n,r=t.selectAll("g").data([""]).enter().append("g").attr("class","CDB-Chart-axisTip CDB-Chart-axisTip-"+e).attr("transform","translate(0,"+i+")");t.append("path").attr("class","CDB-Chart-axisTipRect CDB-Chart-axisTipTriangle").attr("transform","translate("+(this.options.handleWidth/2-7)+", "+s+")").attr("d",u(0,0,14,0,7,o,n)).style("opacity","1"),r.append("rect").attr("class","CDB-Chart-axisTipRect CDB-Chart-axisTip-"+e).attr("rx","2").attr("ry","2").attr("opacity","1").attr("height",17),r.append("text").attr("class","CDB-Text CDB-Size-small CDB-Chart-axisTipText CDB-Chart-axisTip-"+e).attr("dy","11").attr("dx","0").attr("opacity","1").text(function(e){return e})},_isTabletViewport:function(){return d.isTabletViewport()},_generateHandle:function(e){var t=this._isTabletViewport()&&this._isTimeSeries()?2*this.chartHeight():this.chartHeight(),i={width:this.options.handleWidth,height:t,radius:this.options.handleRadius},s=this.chart.select(".CDB-Chart-handles").append("g").attr("class","CDB-Chart-handle CDB-Chart-handle-"+e);if(this.options.hasAxisTip&&this._generateAxisTip(e),this.options.hasHandles){s.append("rect").attr("class","CDB-Chart-handleRect").attr("width",i.width).attr("height",i.height).attr("rx",i.radius).attr("ry",i.radius);var n=this._isTabletViewport()&&this._isTimeSeries()?this.chartHeight():this.chartHeight()/2;n-=3;for(var o=(i.width-2)/2,r=0;r<3;r++)s.append("line").attr("class","CDB-Chart-handleGrip").attr("x1",o).attr("y1",n+3*r).attr("x2",o+2).attr("y2",n+3*r)}return s},_generateHandles:function(){this.chart.append("g").attr("class","CDB-Chart-handles"),this.leftHandle=this._generateHandle("left"),this.rightHandle=this._generateHandle("right")},_removeHandles:function(){this.chart.select(".CDB-Chart-handles").remove()},_removeAxis:function(){this.canvas.select(".CDB-Chart-axis").remove()},_generateAdjustAnchorMethod:function(e){return function(t,i){return 0===i?"start":i===e.length-1?"end":"middle"}},_generateAxis:function(){this._axis=this._generateNumericAxis(),this._onChangeShowLabels()},_generateNumericAxis:function(){var e=this,t=this._generateAdjustAnchorMethod(this.verticalRange),i=this.chart.append("g").attr("class","CDB-Chart-axis CDB-Text CDB-Size-small");return i.append("g").selectAll(".Label").data(this.verticalRange).enter().append("text").attr("x",function(e){return e}).attr("y",function(){return e.chartHeight()+15}).attr("text-anchor",t).text(function(t){var i=function verticalToValue(t){return e.xAxisScale?e.xAxisScale(t):null}(t);if(n.isFinite(i))return e.formatter(i)}),i},_getMinValueFromBinIndex:function(e){var t=this.model.get("data")[e];return t?null!=t.min?t.min:t.start:null},_getMaxValueFromBinIndex:function(e){var t=null,i=this.model.get("data")[e];return i&&(t=this._isDateTimeSeries()&&!n.isUndefined(i.next)?i.next:null!=i.min?i.max:i.end),t},_getValueFromBinIndex:function(e){if(!n.isNumber(e))return null;var t=null,i=!0,s=this.model.get("data");e>=s.length&&(e=s.length-1,i=!1);var o=s[e];return o&&(t=i?o.start:n.isFinite(o.next)?o.next:o.end),t},_getIndexFromValue:function(e){return n.findIndex(this.model.get("data"),function(t){return t.start<=e&&e<=t.end})},_getMaxFromData:function(){return this.model.get("data").length>0?n.last(this.model.get("data")).end:null},_calculateDataDomain:function(){var e,t,i,s,o=n.clone(this.model.get("data"));if(this._hasFilterApplied()){var r=this._getLoBarIndex(),a=this._getHiBarIndex()-1,l=o.slice(r,a);if(n.isNaN(r)||n.isNaN(a))return[0,0];if(i=this._getMinValueFromBinIndex(r),s=this._getMaxValueFromBinIndex(a),o[r]&&0===o[r].freq&&(e=n.find(l,function(e){return 0!==e.freq},this)),o[a]&&0===o[a].freq){var h=l.reverse();t=n.find(h,function(e){return 0!==e.freq},this)}}else i=this._getMinValueFromBinIndex(0),s=this._getMaxValueFromBinIndex(o.length-1),e=n.find(o,function(e){return 0!==e.freq}),t=n.find(o.reverse(),function(e){return 0!==e.freq});return[i=e?null!=e.min?e.min:e.start:i,s=t?null!=t.max?t.max:t.end:s]},_removeFillGradients:function(){o.select(this.el).select("defs").remove(),delete this._linearGradients},_areGradientsAlreadyGenerated:function(){return!!this._linearGradients},_generateFillGradients:function(){if(!this._widgetModel||!this._widgetModel.isAutoStyleEnabled())return!1;var e=this._widgetModel.getAutoStyle();if(n.isEmpty(e)||n.isEmpty(e.definition))return!1;var t=this,i=e.definition[Object.keys(e.definition)[0]],s=i&&i.color&&i.color.range,a=r.interpolateRgbBasis(s),l=n.map(s,function(e){return o.rgb(e).darker(.3).toString()}),h=r.interpolateRgbBasis(l),c=this.model.get("data"),d=this._calculateDataDomain(),u=o.scale.linear().domain(d).range([0,1]),p=o.select(this.el).append("defs");this._linearGradients=p.selectAll(".gradient").data(c).enter().append("linearGradient").attr("class","gradient").attr("id",function(e,i){return this.__scale__=o.scale.linear().range([t._getMinValueFromBinIndex(i),t._getMaxValueFromBinIndex(i)]).domain([0,1]),"bar-"+t.cid+"-"+i}).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),this._linearGradientsHover=p.selectAll(".gradient-hover").data(c).enter().append("linearGradient").attr("class","gradient-hover").attr("id",function(e,i){return this.__scale__=o.scale.linear().range([t._getMinValueFromBinIndex(i),t._getMaxValueFromBinIndex(i)]).domain([0,1]),"bar-"+t.cid+"-"+i+"-hover"}).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),this._linearGradients.selectAll("stop").data(o.range(5)).enter().append("stop").attr("offset",function(e,t){return(this.__offset__=Math.floor(t/4*100))+"%"}).attr("stop-color",function(){var e=this.parentNode.__scale__,t=u(e(this.__offset__/100));return a(t)}),this._linearGradientsHover.selectAll("stop").data(o.range(5)).enter().append("stop").attr("offset",function(e,t){return(this.__offset__=Math.floor(t/4*100))+"%"}).attr("stop-color",function(){var e=this.parentNode.__scale__,t=u(e(this.__offset__/100));return h(t)})},_setupFillColor:function(){this._removeFillGradients(),this._generateFillGradients()},_getFillColor:function(e,t){return this._widgetModel?this._widgetModel.isAutoStyle()?this._hasFilterApplied()&&!this._isBarChartWithinFilter(t)?"rgba(0, 0, 0, 0.06)":"url(#bar-"+this.cid+"-"+t+")":this._hasFilterApplied()?this._isBarChartWithinFilter(t)?"#2E3C43":"rgba(0, 0, 0, 0.06)":this._widgetModel.getWidgetColor()||this.options.chartBarColor:this.options.chartBarColor},_getHoverFillColor:function(e,t){var i=this._getFillColor(e,t);return this._widgetModel&&this._widgetModel.isAutoStyle()?"url(#bar-"+this.cid+"-"+t+"-hover)":o.rgb(i).darker(.3).toString()},_updateChart:function(){var e=this,t=this.model.get("data"),i=this.chart.selectAll(".CDB-Chart-bar").data(t);i.enter().append("rect").attr("class","CDB-Chart-bar").attr("fill",this._getFillColor.bind(this)).attr("x",function(t,i){return i*e.barWidth}).attr("y",e.chartHeight()).attr("height",0).attr("width",Math.max(0,this.barWidth-1)),i.transition().duration(200).attr("height",function(t){if(n.isEmpty(t))return 0;if(e._isMobileViewport()&&e._isTimeSeries())return 3;var i=e.chartHeight()-e.yScale(t.freq);return i<e.options.minimumBarHeight&&i>0&&(i=e.options.minimumBarHeight),i}).attr("y",function(t){if(n.isEmpty(t))return e.chartHeight();if(e._isMobileViewport()&&e._isTimeSeries())return e.chartHeight()/2+3;var i=e.chartHeight()-e.yScale(t.freq);return i<e.options.minimumBarHeight&&i>0?e.chartHeight()-e.options.minimumBarHeight:e.yScale(t.freq)}),i.exit().transition().duration(200).attr("height",function(){return 0}).attr("y",function(){return e.chartHeight()})},_refreshBarsColor:function(){this.chart.selectAll(".CDB-Chart-bar").classed("is-highlighted",!1).attr("fill",this._getFillColor.bind(this))},_isMobileViewport:function(){return d.isMobileViewport()},_generateBars:function(){var e=this,t=this.model.get("data");this._calcBarWidth();var i=(2*t.length-1>this.chartWidth()||this._isMobileViewport())&&this._isDateTimeSeries()?0:1,s=this.chart.append("g").attr("transform","translate(0, 0)").attr("class","CDB-Chart-bars").selectAll(".CDB-Chart-bar").data(t);s.enter().append("rect").attr("class","CDB-Chart-bar").attr("fill",this._getFillColor.bind(e)).attr("x",function(t,i){return i*e.barWidth}).attr("y",e.chartHeight()).attr("height",0).attr("data-tooltip",function(t){return e._tooltipFormatter(t.freq)}).attr("width",Math.max(1,this.barWidth-i)),s.transition().ease(this.options.transitionType).duration(this.options.animationSpeed).delay(this.options.animationBarDelay).transition().attr("height",function(t){if(n.isEmpty(t))return 0;if(e._isMobileViewport()&&e._isTimeSeries())return 3;var i=e.chartHeight()-e.yScale(t.freq);return i<e.options.minimumBarHeight&&i>0&&(i=e.options.minimumBarHeight),i}).attr("y",function(t){if(n.isEmpty(t))return e.chartHeight();if(e._isMobileViewport()&&e._isTimeSeries())return e.chartHeight()/2+3;var i=e.chartHeight()-e.yScale(t.freq);return i<e.options.minimumBarHeight&&i>0?e.chartHeight()-e.options.minimumBarHeight:e.yScale(t.freq)})},showShadowBars:function(){this.options.displayShadowBars&&this.model.set("show_shadow_bars",!0)},_generateShadowBars:function(){var e=this._getData();if(e&&e.length&&this.model.get("show_shadow_bars")&&!this.model.get("normalized")){this._removeShadowBars();var t=this,i=o.scale.linear().domain([0,this._getMaxData(e)]).range([this.chartHeight(),0]),s=this.chartWidth()/e.length;this.chart.append("g").attr("transform","translate(0, 0)").attr("class","CDB-Chart-shadowBars").selectAll(".CDB-Chart-shadowBar").data(e).enter().append("rect").attr("class","CDB-Chart-shadowBar").attr("x",function(e,t){return t*s}).attr("y",function(e){if(n.isEmpty(e))return t.chartHeight();var s=t.chartHeight()-i(e.freq);return s<t.options.minimumBarHeight&&s>0?t.chartHeight()-t.options.minimumBarHeight:i(e.freq)}).attr("width",Math.max(.5,s-1)).attr("height",function(e){if(n.isEmpty(e))return 0;var s=t.chartHeight()-i(e.freq);return s<t.options.minimumBarHeight&&s>0&&(s=t.options.minimumBarHeight),s}),this.chart.selectAll(".CDB-Chart-shadowBars").moveToBack(),this.chart.selectAll(".CDB-Chart-lines").moveToBack()}else this._removeShadowBars()},_hasFilterApplied:function(){return null!=this.model.get("lo_index")&&null!=this.model.get("hi_index")},_isTimeSeries:function(){return 0===this.options.type.indexOf("time")},_isDateTimeSeries:function(){return"time-date"===this.options.type},_calculateDivisionWithByAggregation:function(e){switch(e){case"year":return 50;case"quarter":case"month":return 80;case"week":case"day":return 120;default:return 140}},_createFormatter:function(){this.formatter=h.formatNumber,this._isDateTimeSeries()&&(this.formatter=h.timestampFactory(this._dataviewModel.get("aggregation"),this._dataviewModel.getCurrentOffset()),this.options.divisionWidth=this._calculateDivisionWithByAggregation(this._dataviewModel.get("aggregation")))},unsetBounds:function(){this.model.set("bounded",!1),this.updateYScale(),this.contract(this.options.height),this.resetIndexes(),this.removeSelection(),this._setupFillColor()},setBounds:function(){this.model.set("bounded",!0),this.updateYScale(),this.expand(4),this.removeShadowBars()}})},function(e,t,i){var s=i(4),n=i(1),o=i(922),r=i(544),a=i(6);e.exports=n.extend({className:"CDB-Chart--histogram",options:{tooltipDataAttribute:"data-tooltip"},defaults:{histogramChartHeight:72,histogramChartMobileHeight:16},initialize:function(){if(!this.options.dataviewModel)throw new Error("dataviewModel is required");if(!this.options.layerModel)throw new Error("layerModel is required");this._timeSeriesModel=this.options.timeSeriesModel,this._dataviewModel=this.options.dataviewModel,this._layerModel=this.options.layerModel,this._rangeFilter=this.options.rangeFilter,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this._initBinds()},render:function(){return this.clearSubViews(),this._createHistogramView(),this},selectRange:function(e,t){this._chartView.selectRange(e,t)},resetFilter:function(){this._rangeFilter.unsetRange()},_initBinds:function(){this.listenTo(this._dataviewModel,"change:data",this._onChangeData,this),this.listenTo(this._dataviewModel,"change:column",this.resetFilter,this),this.listenTo(this._timeSeriesModel,"change:normalized",this._onNormalizedChanged),this.listenTo(this._timeSeriesModel,"change:local_timezone",this._onChangeLocalTimezone),this.listenTo(this._timeSeriesModel,"forceResize",this._onForceResize),this.listenTo(this._rangeFilter,"change",this._onFilterChanged)},_toggleTooltip:function(e){if(!e||!e.target)return this._clearTooltip();this._showTooltip(e)},_showTooltip:function(e){this.tooltip&&e&&this.tooltip.getElement()===e.target||(this._clearTooltip(),this.tooltip=new a({el:e.target,title:function(){return this._getTooltipTitle(e)}.bind(this),trigger:"manual"}),this.tooltip.showTipsy(),this.addView(this.tooltip))},_getTooltipTitle:function(e){return s(e.target).attr(this.options.tooltipDataAttribute)},_clearTooltip:function(){this.tooltip&&(this.tooltip.hideTipsy(),this.removeView(this.tooltip),this.tooltip=void 0)},_createHistogramView:function(){this._chartView=this._instantiateChartView(),this.addView(this._chartView),this.$el.append(this._chartView.render().el),this._chartView.show(),this.listenTo(this._chartView,"on_brush_end",this._onBrushEnd,this),this.listenTo(this._chartView,"on_reset_filter",this.resetFilter,this),this.listenTo(this._chartView,"hover",this._toggleTooltip,this),this.listenTo(this._chartView.model,"change:width",this._onChangeChartWidth,this)},_instantiateChartView:function(){return new o({type:this._getChartType(),chartBarColor:this._timeSeriesModel.getWidgetColor()||"#F2CC8F",animationSpeed:100,margin:{top:this._getMarginTop(),right:4,bottom:4,left:this._getMarginLeft()},hasHandles:!0,handleWidth:8,hasAxisTip:!0,animationBarDelay:function(e,t){return 3*t},height:this.defaults.histogramChartHeight,dataviewModel:this._dataviewModel,layerModel:this._layerModel,data:this._dataviewModel.getData(),originalData:this._originalData,displayShadowBars:!this._timeSeriesModel.get("normalized"),normalized:!!this._timeSeriesModel.get("normalized"),widgetModel:this._timeSeriesModel,local_timezone:!!this._timeSeriesModel.get("local_timezone")})},_getChartType:function(){return"time-"+this._dataviewModel.getColumnType()},_onChangeData:function(){this._chartView&&(this._chartView.replaceData(this._dataviewModel.getData()),this._chartView.updateXScale(),this._chartView.updateYScale())},_onBrushEnd:function(e,t){var i=this._dataviewModel.getData();this._rangeFilter.setRange(i[e].start,i[t-1].end),this._timeSeriesModel.set({lo_index:e,hi_index:t})},_onChangeChartWidth:function(){var e=r.isTabletViewport();this._chartView.toggleLabels(!e);var t=e?this.defaults.histogramChartMobileHeight:this.defaults.histogramChartHeight;this._chartView.model.set("height",t)},_onNormalizedChanged:function(){this._chartView&&this._chartView.setNormalized(this._timeSeriesModel.get("normalized"))},_onChangeLocalTimezone:function(){this._dataviewModel.set("localTimezone",this._timeSeriesModel.get("local_timezone"))},_onForceResize:function(){this._chartView.forceResize()},_resetFilterInDI:function(){this._timeSeriesModel.set({min:void 0,max:void 0,lo_index:void 0,hi_index:void 0}),this._chartView.removeSelection()},_onFilterChanged:function(){this._rangeFilter.has("min")||this._rangeFilter.has("max")||this._resetFilterInDI()},_getMarginLeft:function(){return 4},_getMarginTop:function(){return r.isTabletViewport()?0:4}})},,,,,function(e,t,i){var s=i(0),n=i(1828),o=function(e){this.defs=[],s.each(e,function(e){this.addType(e)},this)};o.prototype.DEFAULT_CLASS_NAMES="CDB-Widget CDB-Widget--light",o.prototype.addType=function(e){if(!e.match){if(!e.type)throw new Error("def.type or def.match must be provided for createContentView to work");e.match=function(e){return e.get("type")===this.type}}if(!s.isFunction(e.createContentView))throw new Error("def.createContentView must be a function");this.defs.push(e)},o.prototype.createWidgetView=function(e){var t=s.find(this.defs,function(t){return t.match(e)});if(t){var i={className:this.DEFAULT_CLASS_NAMES,model:e,contentView:t.createContentView(e)};return new n(s.isFunction(t.customizeWidgetAttrs)?t.customizeWidgetAttrs(i):i)}},e.exports=o},,,,,function(e,t,i){e.exports={VERSION:"",createDashboard:i(1833)}},,,,,,,function(e,t,i){"use strict";var s=i(949),n=i(939);e.exports=s.extend({options:{acceptedExtensions:["jpeg","jpg","png","gif"],imageKind:"orgavatar",imageURLAttribute:"avatar_url"},render:function render(){return this._destroyFileInput(),this.clearSubViews(),this.$el.html(n({state:this._model.get("state"),name:this._renderModel.get("name"),inputName:this._renderModel.get("inputName"),avatarURL:this._renderModel.get("avatar_url"),username:this._renderModel.get("username"),avatarAcceptedExtensions:this._formatAcceptedExtensions(this.options.acceptedExtensions)})),this._renderFileInput(),this}})},,function(e,t,i){"use strict";var s=i(1),n=i(941),o=i(3),r=["modalModel","userModel","client"];e.exports=s.extend({events:{"click .js-ok":"_onClickDelete","click .js-cancel":"_closeDialog","submit .js-form":"_closeDialog"},initialize:function initialize(e){o(e,r,this),s.prototype.initialize.apply(this),this._onError=e.onError,this._error="",this._isLoading=!1},render:function render(){return this.$el.html(n({passwordNeeded:!!this._userModel.get("needs_password_confirmation"),isLoading:this._isLoading,error:this._error})),this},_onClickDelete:function _onClickDelete(e){var t=this;this.killEvent(e);var i={deletion_password_confirmation:this.$("#deletion_password_confirmation").val()};this._isLoading=!0,this._error="",this.render(),this._client.deleteUser(i,function(e,i,s){t._isLoading=!1,t.render(),e?t._handleError(s,e):t._onSuccess(s)})},_handleError:function _handleError(e,t){if(this._onError)this._closeDialog(),this._onError(e,t);else{var i=e&&e.responseJSON||{};this._error=i.message,this.render()}},_setHref:function _setHref(e){window.location.href=e},_onSuccess:function _onSuccess(e){this._setHref(e.logout_url),this._closeDialog()},_onFormError:function _onFormError(e,t){this._onError(e,t),this._closeDialog()},_closeDialog:function _closeDialog(){this._modalModel.destroy()}})},,function(e,t,i){"use strict";var s=i(1),n=i(943),o=i(3),r=i(1979),a=["userModel","configModel"];e.exports=s.extend({initialize:function initialize(e){o(e,a,this)},render:function render(){var e=this._userModel.get("db_size_in_bytes"),t=this._userModel.get("quota_in_bytes"),i=Math.round(e/t*100),s="";return i>80&&i<90?s="caution":i>89&&(s="danger"),this.$el.html(n({isCartoDBHosted:this._configModel.get("cartodb_com_hosted"),usedDataStr:r(e).toString(2),usedDataPct:i,progressBarClass:s,availableDataStr:r(t).toString(2),profileUrl:this._userModel.viewUrl().accountProfile().pathname(),accountUrl:this._userModel.viewUrl().accountSettings().pathname(),apiKeysUrl:this._userModel.viewUrl().apiKeys().pathname(),isInsideOrg:this._userModel.isInsideOrg(),planUrl:this._userModel.get("plan_url"),isOrgAdmin:this._userModel.isOrgAdmin(),organizationUrl:this._userModel.viewUrl().organization().pathname(),isOrgOwner:this._userModel.isOrgOwner(),upgradeContactEmail:this._userModel.upgradeContactEmail(),path:this.getPath()})),this},getPath:function getPath(){return window.location.pathname}})},,function(e,t,i){"use strict";var s=i(1),n=i(945),o=i(3),r=["userModel","accountUpdateUrl"];e.exports=s.extend({initialize:function initialize(e){o(e,r,this),this.userAccount=this._userModel.get("account_type")},render:function render(){var e=window.location.protocol+"//"+this._accountUpdateUrl;return this.clearSubViews(),this.$el.html(n({accountUpdateUrl:e})),this}})},function(e,t,i){"use strict";var s=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();var n=i(4);window.StaticConfig=window.StaticConfig||{};var o=function(){function PublicClient(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,PublicClient),this.apiURI=e}return s(PublicClient,[{key:"get",value:function get(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.request.apply(this,["get"].concat(t))}},{key:"put",value:function put(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.request.apply(this,["put"].concat(t))}},{key:"post",value:function post(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.request.apply(this,["post"].concat(t))}},{key:"delete",value:function _delete(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.request.apply(this,["delete"].concat(t))}},{key:"addHeaders",value:function addHeaders(e,t){return Object.assign({},e.headers,t)}},{key:"paramsToURI",value:function paramsToURI(e){return this.checkParams(e)?"?"+Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&"):""}},{key:"checkParams",value:function checkParams(e){return e&&"[object Object]"===Object.prototype.toString.call(e)&&Object.keys(e).length}},{key:"makeRelativeURI",value:function makeRelativeURI(e){return"/"+e.join("/")}},{key:"makeAbsoluteURI",value:function makeAbsoluteURI(e){return""+this.apiURI+e}},{key:"successCallback",value:function successCallback(e){return function(t,i,s){try{t=JSON.parse(JSON.stringify(t))}catch(e){t=null}e(null,i,t)}}},{key:"errorCallback",value:function errorCallback(e){return function(t,i,s){var n=s||new Error("Failed to fetch");e(n,i,t)}}},{key:"getAssetsBaseUrl",value:function getAssetsBaseUrl(){var e=window.location,t=e.host,i=e.protocol,s=window.location.href.match(/(\/(u|user)\/[a-z0-9\-]+)\//),n=s&&s[1]||"";return window.StaticConfig.baseUrl||i+"//"+t+n}},{key:"request",value:function request(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments[3];s||"function"!=typeof i||(s=i,i={}),Object.assign(i,{contentType:"application/json; charset=utf-8",method:e.toUpperCase()}),this.addHeaders(i);var o=this.getAssetsBaseUrl(),r=0!==t.length?this.makeAbsoluteURI(this.makeRelativeURI(t)):"";n.ajax(""+o+r,i).done(this.successCallback(s)).fail(this.errorCallback(s))}}]),PublicClient}();e.exports=o},function(e,t,i){"use strict";e.exports={PublicClient:i(947),AuthenticatedClient:i(1983)}},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(1),r=i(559),a=i(3);i(1995);var l=i(1994),h=["configModel","renderModel"];e.exports=o.extend({options:{acceptedExtensions:["jpeg","jpg","png","gif"],imageKind:"mobileAppIcon",imageURLAttribute:"icon_url"},initialize:function initialize(e){a(e,h,this),this._model=new n.Model({state:"idle"}),this._initBinds()},render:function render(){return this._destroyFileInput(),this.clearSubViews(),this.$el.html(r({state:this._model.get("state"),name:this._renderModel.get("name"),inputName:this._renderModel.get("inputName"),iconURL:this._renderModel.get("icon_url"),iconAcceptedExtensions:this._formatAcceptedExtensions(this.options.acceptedExtensions)})),this._renderFileInput(),this},_initBinds:function _initBinds(){s.bindAll(this,"_onInputChange","_onSuccess","_onError"),this.listenTo(this._model,"change",this.render)},_destroyFileInput:function _destroyFileInput(){var e=this.$(":file");e.unbind("change",this._onInputChange,this),e.filestyle("destroy")},_renderFileInput:function _renderFileInput(){var e=this.$(":file"),t={buttonText:"Choose image"};"loading"===this._model.get("state")&&(t.disabled=!0),e.filestyle(t),e.bind("change",this._onInputChange)},_onInputChange:function _onInputChange(){var e=this.$(":file").prop("files");new l(null,{userId:this._renderModel.get("id"),configModel:this._configModel}).save({kind:this.options.imageKind,filename:e},{success:this._onSuccess,error:this._onError}),this._model.set("state","loading")},_onSuccess:function _onSuccess(e,t){this._renderModel.set(this.options.imageURLAttribute,t.public_url),this._model.set("state","success")},_onError:function _onError(){this._model.set("state","error")},clean:function clean(){this._destroyFileInput(),o.prototype.clean.apply(this)},_formatAcceptedExtensions:function _formatAcceptedExtensions(e){for(var t=[],i=0;i<e.length;i++)t[i]="image/"+e[i];return t.join(",")}})},,function(e,t,i){"use strict";var s=i(4),n=i(1),o=i(3),r=["el"];e.exports=n.extend({events:{"click .js-foo":"_fooHandler"},initialize:function initialize(e){o(e,r,this),this._onWindowScroll=this._onWindowScroll.bind(this),this._topBoundary=this.$el.offset().top,this._initBinds()},_initBinds:function _initBinds(){this._bindScroll()},_onWindowScroll:function _onWindowScroll(){this.$el.toggleClass("is-fixed",s(window).scrollTop()>this._topBoundary)},_unbindScroll:function _unbindScroll(){s(window).unbind("scroll",this._onWindowScroll)},_bindScroll:function _bindScroll(){this._unbindScroll(),s(window).bind("scroll",this._onWindowScroll)},clean:function clean(){this._unbindScroll()}})},function(e,t,i){"use strict";var s=i(4),n=i(1),o=i(2078);e.exports=n.extend({events:{"click .js-breadcrumb-dropdown-target":"_createBreadcrumbDropdown"},_previousDropDown:null,_createBreadcrumbDropdown:function _createBreadcrumbDropdown(e){if(e.preventDefault(),this._previousDropDown)this._previousDropDown.open();else{var t=new o({target:s(e.target),el:s(".js-breadcrumb-dropdown-content"),horizontal_offset:3,horizontal_position:"right",tick:"right"});this._previousDropDown=t,this.addView(t),t.on("onDropdownHidden",function(){t.clean()},this),t.render(),t.open()}},_closeAnyOtherOpenDialogs:function _closeAnyOtherOpenDialogs(){this._previousDropDown&&this._previousDropDown.hide()}})},function(e,t,i){"use strict";var s=i(9),n=i(0),o=i(1),r=i(956);e.exports=o.extend({render:function render(){this.$el.removeClass("is-pre-loading").addClass("is-loading");var e=this;return(this.options.createVis?this._createVisMap(this.options.createVis):this._createFallbackMap()).done(function(){e.$el.removeClass("is-loading"),e.$(".js-spinner").remove()}),this},_createVisMap:function _createVisMap(e){return s.createVis(this.el,e.url||e.vizJson,n.defaults(e.opts,{authToken:"default_public",title:!1,header:!1,description:!1,searchControl:!1,layer_selector:!1,text:!1,image:!1,zoomControl:!1,logo:!1,scrollwheel:!1,mobile_layout:!0,legends:!1,loader:!1,fullscreen:!1,no_cdn:!1}))},_createFallbackMap:function _createFallbackMap(){return r({el:this.el,basemap:this.options.fallbackBaselayer}),{done:function done(e){e()}}}})},,,function(e,t,i){"use strict";var s=i(513),n=[40.7127837,-74.0059413];e.exports=function(e){if(e.basemap.urlTemplate){var t=s.map(e.el,{zoomControl:!1,minZoom:6,maxZoom:6,scrollWheelZoom:!1});t.setView(n,6),t.dragging.disable(),t.touchZoom.disable(),t.doubleClickZoom.disable(),t.attributionControl.setPrefix("");var i=e.basemap.urlTemplate;window.devicePixelRatio>1&&(i=e.basemap.urlTemplate2x||i),s.tileLayer(i,{attribution:e.basemap.attribution}).addTo(t)}else if("googlemaps"===e.basemap.className&&void 0!==google.maps)new google.maps.Map(e.el,{center:{lat:n[0],lng:n[1]},zoom:6,draggable:!1,scrollwheel:!1,panControl:!1,zoomControl:!1,streetViewControl:!1,maxZoom:6,minZoom:6,mapTypeControl:!1,mapTypeId:e.basemap.baseType||google.maps.MapTypeId.ROADMAP,styles:[{featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{visibility:"off"}]}]})}},,,,function(e,t,i){"use strict";var s=i(343);e.exports=function(e){return s({icon:e.icon||"CDB-IconFont-cockroach",title:e.title||"",desc:e.desc})}},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(574),r=i(2191),a=i(2190),l=i(2188),h=["configModel","currentUserId","organization","visDefinitionModel"];e.exports=n.extend({initialize:function initialize(e){s.each(h,function(t){if(!e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),this._grantablesCollection=new r([],{currentUserId:this._currentUserId,organization:this._organization,configModel:this._configModel}),this._sharePermissionModel=this._visDefinitionModel.getPermissionModel().clone(),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(o({name:this._visDefinitionModel.get("name")})),this._initViews(),this},_initBinds:function _initBinds(){this._sharePermissionModel.acl.on("add remove reset change",this._onSave,this),this.add_related_model(this._sharePermissionModel.acl)},_initViews:function _initViews(){var e=this;this._searchPaginationView=new a({className:"u-inner",listCollection:this._grantablesCollection,createContentView:function createContentView(t){return new l(s.extend({},t,{collection:e._grantablesCollection,currentUserId:e._currentUserId,sharePermissionModel:e._sharePermissionModel,organization:e._organization,isVisualization:e._visDefinitionModel.isVisualization()}))}}),this.addView(this._searchPaginationView),this.$(".js-body").html(this._searchPaginationView.render().el)},_onCancel:function _onCancel(){this._modalModel.destroy()},_onBack:function _onBack(){this._modalModel.destroy(),this._onBack()},_onSave:function _onSave(){var e=this._visDefinitionModel.getPermissionModel();e.overwriteAcl(this._sharePermissionModel),e.save().fail(this._searchPaginationView.showError.bind(this._searchPaginationView))}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Collection.extend({initialize:function initialize(e,t){if(!t.visDefinitionModel)throw new Error("visDefinitionModel is required");this.url=t.visDefinitionModel.mapcapsURL()}})},,,function(e,t,i){"use strict";var s=i(0),n=i(2),o=n.Router.extend({navigate:function navigate(){throw new Error("router.enableAfterMainView({ ... }) must be called before you can navigate")},enableAfterMainView:function enableAfterMainView(){this.navigate=function(e,t){n.Router.prototype.navigate.call(this,this.normalizeFragmentOrUrl(e),t)},n.history.start({pushState:!0,root:this.rootPath()+"/"})},rootPath:function rootPath(){throw new Error("implement rootPath in child router (no trailing slash)")},normalizeFragmentOrUrl:function normalizeFragmentOrUrl(e){throw new Error("implement normalizeFragmentOrUrl in child router")}});o.supportTrailingSlashes=function(e){return s.reduce(e,function(e,t,i){return e[i]=t,e[i+"/"]=t,e},{})},e.exports=o},,,function(e,t,i){"use strict";var s=i(1),n=i(967),o=i(10);e.exports=s.extend({initialize:function initialize(e){if(!e.userModel)throw new Error("userModel is required");if(!e.configModel)throw new Error("configModel is required");this._userModel=e.userModel,this._configModel=e.configModel,this._notification=o.addNotification({status:"error",closable:!0,button:!1,info:this._getInfo()}),this._initBinds()},_initBinds:function _initBinds(){this._notification.on("notification:close",this._closeHandler,this),this.add_related_model(this._notification)},_closeHandler:function _closeHandler(){this.clean()},_getInfo:function _getInfo(){var e=this._userModel.getMaxConcurrentImports(),t=!this._configModel.get("cartodb_com_hosted")&&1===e;return n({upgradeUrl:window.upgrade_url,isUpgradeable:t,importQuota:e})}})},,function(e,t,i){"use strict";var s=i(1),n=i(7),o=i(969),r=i(3),a=["userModel","modalModel"];e.exports=s.extend({className:"TwitterImportDetails",events:{"click .js-close":"_onCloseClick"},initialize:function initialize(e){r(e,a,this)},render:function render(){var e=this.model.get("import"),t=this._userModel.get("twitter"),i=t.quota-t.monthly_use;return this.$el.html(o({datasetTotalRows:e.tweets_georeferenced,datasetTotalRowsFormatted:n.formatNumber(e.tweets_georeferenced),tweetsCost:e.tweets_cost,tweetsCostFormatted:n.formatNumber(e.tweets_cost),availableTweets:i,availableTweetsFormatted:n.formatNumber(i),tweetsOverquota:e.tweets_overquota,tweetsOverquotaFormatted:n.formatNumber(e.tweets_overquota),blockSizeFormatted:n.formatNumber(t.block_size),blockPriceFormatted:n.formatNumber(t.block_price)})),this},_onCloseClick:function _onCloseClick(){this._modalModel.destroy()}})},,,,function(e,t,i){"use strict";var s=i(1),n=i(973),o=i(972),r=i(971);e.exports=s.extend({initialize:function initialize(e){if(!e.userModel)throw new Error("userModel is required");if(!e.warnings)throw new Error("warnings is required");this._userModel=this.options.userModel,this._warnings=this.options.warnings},render:function render(){var e=this._warnings,t=this._getTemplate(e);return this.$el.html(t({userMaxLayers:e.user_max_layers,maxTablesPerImport:e.max_tables_per_import,maxRowsPerConnectorImport:e.max_rows_per_connection})),this},_getTemplate:function _getTemplate(e){return e.user_max_layers&&e.max_tables_per_import?e.user_max_layers<e.max_tables_per_import?n:o:e.user_max_layers?n:e.max_tables_per_import?o:e.max_rows_per_connection?r:void 0}})},,,function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({defaults:{type:"",message:"",opened:!1}})},function(e,t,i){"use strict";var s=i(4),n=i(5),o=i(1),r=i(2239),a=i(2237),l=i(310),h=i(309),c=i(405),d=i(3),u={tryTrial:i(308),limitsExceeded:i(307),closeLimits:i(306),upgradedMessage:i(305),trialEndsSoon:i(304)},p=["configModel","user"];e.exports=o.extend({attributes:{href:"#/notifications"},tagName:"a",className:"UserNotifications",events:{click:"_openNotifications"},initialize:function initialize(e){d(e,p,this),this.localStorage=new c,this.collection=new r({configModel:e.configModel}),this.collection.reset(this._generateCollection(),{userId:this._user.get("id"),apiKey:this._user.get("api_key"),silent:!0}),this._initBinds()},render:function render(){var e=this.collection.filter(function(e){return!e.get("opened")}).length;return this.$el.html(l({notificationsCount:e})),this.$el.toggleClass("has--alerts",e>0),this},_initBinds:function _initBinds(){this._user.bind("change",this._onUserChange,this),this.collection.bind("reset",this.render,this),this.collection.bind("remove",this.render,this),this.add_related_model(this._user),this.add_related_model(this.collection)},_onUserChange:function _onUserChange(){this.collection.reset(this._generateCollection(),{userId:this._user.get("id"),apiKey:this._user.get("api_key")}),this.render()},_generateCollection:function _generateCollection(){var e=[],t={},i=this._user.viewUrl(),s=this._configModel.get("cartodb_com_hosted");t.isInsideOrg=this._user.isInsideOrg(),t.isOrgOwner=this._user.isOrgOwner(),t.accountType=this._user.get("account_type").toLowerCase(),t.remainingQuota=this._user.get("remaining_byte_quota"),t.publicProfileUrl=i.publicProfile(),t.bytesQuota=this._user.get("quota_in_bytes"),t.userType="regular",t.upgradeUrl=window.upgrade_url||"",t.upgradeContactEmail=this._user.upgradeContactEmail(),t.trialEnd=this._user.get("trial_ends_at")&&n(this._user.get("trial_ends_at")).format("YYYY-MM-DD"),t.userName=this._user.get("name")||this._user.get("username"),t.isInsideOrg&&!t.isOrgOwner?t.userType="org":t.isOrgOwner?t.userType="admin":"internal"!==t.accountType&&"partner"!==t.accountType&&"ambassador"!==t.accountType||(t.userType="internal"),!s&&!t.isInsideOrg&&"free"===t.accountType&&this._user.get("table_count")>0?e.push({iconFont:"CDB-IconFont-gift",severity:"NotificationsDropdown-itemIcon--positive",type:"try_trial",msg:u.tryTrial(t),opened:this.localStorage.get("notification.try_trial")}):this.localStorage.remove("notification.try_trial"),!s&&t.remainingQuota<=0?e.push({iconFont:"CDB-IconFont-barometer",severity:"NotificationsDropdown-itemIcon--negative",type:"limits_exceeded",msg:u.limitsExceeded(t),opened:this.localStorage.get("notification.limits_exceeded")}):this.localStorage.remove("notification.limits_exceeded"),!s&&100*t.remainingQuota/t.bytesQuota<20?e.push({iconFont:"CDB-IconFont-barometer",severity:"NotificationsDropdown-itemIcon--alert",type:"close_limits",msg:u.closeLimits(t),opened:this.localStorage.get("notification.close_limits")}):this.localStorage.remove("notification.close_limits"),!s&&this._user.get("show_upgraded_message")?e.push({iconFont:"CDB-IconFont-heartFill",severity:"NotificationsDropdown-itemIcon--positive",type:"upgraded_message",msg:u.upgradedMessage(t),opened:this.localStorage.get("notification.upgraded_message")}):this.localStorage.remove("notification.upgraded_message"),this._user.get("show_trial_reminder")?e.push({iconFont:"CDB-IconFont-clock",severity:"NotificationsDropdown-itemIcon--alert",type:"trial_ends_soon",msg:u.trialEndsSoon(t),opened:this.localStorage.get("notification.trial_ends_soon")}):this.localStorage.remove("notification.trial_ends_soon");var o=window.organization_notifications||this.options.organizationNotifications;if(o)for(var r=0;r<o.length;r++){var a=o[r],l=a.icon?"CDB-IconFont-"+a.icon:"CDB-IconFont-alert";e.push({iconFont:l,severity:"NotificationsDropdown-itemIcon--alert",id:a.id,msg:a.html_body,read_at:a.read_at,type:"org_notification"})}return e},_openNotifications:function _openNotifications(e){var t=this;if(e&&this.killEvent(e),this.notification)return this.notification.hide(),delete this.notification,this;var i=this.notification=new a({target:this.$el,collection:this.collection,horizontal_offset:5,vertical_offset:-5,template:h});s(i.options.target).unbind("click",i._handleClick),this._closeAnyOtherOpenDialogs(),i.on("onDropdownHidden",function(){return t._onDropdownHidden(i)}),i.render(),i.open(),this.addView(i)},_onDropdownHidden:function _onDropdownHidden(e){var t=this;this.collection.each(function(e){var i=e.get("type");"org_notification"===i?e.markAsRead():i&&(e.set("opened",!0),t.localStorage.set(function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}({},"notification."+i,!0)))}),this.collection.reset(),e.clean(),this.removeView(e),this.$el.removeClass("has--alerts"),delete this.notification},_closeAnyOtherOpenDialogs:function _closeAnyOtherOpenDialogs(){}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(280),r=i(233);e.exports=n.Collection.extend({DEFAULT_FETCH_OPTIONS:{type:"table",order:"updated_at",page:1,per_page:20,exclude_shared:!1,exclude_raster:!0,tags:"",q:""},model:function model(e,t){var i=t.collection._configModel;return new("derived"!==e.type?o:r)(e,{configModel:i})},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,this._stats={}},url:function url(){var e=this._configModel.urlVersion("visualization");return this._configModel.get("base_url")+"/api/"+e+"/viz"},fetch:function fetch(e){return this.trigger("loading",this),(e=e||{data:{per_page:1e3}}).data=s.extend({},this.DEFAULT_FETCH_OPTIONS,e.data),n.Collection.prototype.fetch.call(this,e)},getDefaultParam:function getDefaultParam(e){return this.DEFAULT_FETCH_OPTIONS[e]},getTotalStat:function getTotalStat(e){return this._stats[e]||0},parse:function parse(e){return this._stats=s.omit(e,"visualizations"),e.visualizations}})},function(e,t,i){"use strict";var s={st_multipolygon:"polygon",st_polygon:"polygon",st_multilinestring:"line",st_linestring:"line",st_multipoint:"point",st_point:"point"};e.exports=function(e){return s[e.toLowerCase()]}},function(e,t,i){"use strict";e.exports={types:["POINT","LINESTRING","POLYGON","MULTIPOINT","MULTILINESTRING","MULTIPOLYGON"]}},function(e,t,i){"use strict";var s=i(0);e.exports={sortSchema:function sortSchema(e){var t={cartodb_id:1,the_geom:2,__default__:3,created_at:4,updated_at:5};function priority(e){return t[e]||t.__default__}return s.chain(e).clone().sort(function(e,t){var i=priority(e[0]),s=priority(t[0]);return i<s?-1:i>s?1:e[0]<t[0]?-1:1}).value()},alterTable:function alterTable(e){return-1!==(e=e.trim()).search(/alter\s+[\w\."]+\s+/i)||-1!==e.search(/drop\s+[\w\.\"]+/i)||-1!==e.search(/^vacuum\s+[\w\.\"]+/i)||-1!==e.search(/^create\s+[\w\.\"]+/i)||-1!==e.search(/^reindex\s+[\w\.\"]+/i)||-1!==e.search(/^grant\s+[\w\.\"]+/i)||-1!==e.search(/^revoke\s+[\w\.\"]+/i)||-1!==e.search(/^cluster\s+[\w\.\"]+/i)||-1!==e.search(/^comment\s+on\s+[\w\.\"]+/i)||-1!==e.search(/^explain\s+[\w\.\"]+/i)},alterTableData:function alterTableData(e){return this.alterTable(e)||-1!==e.search(/^refresh\s+materialized\s+view\s+[\w\.\"]+/i)||-1!==e.search(/^truncate\s+[\w\.\"]+/i)||-1!==e.search(/insert\s+into/i)||-1!==e.search(/update\s+[\w\.\-"]+\s+.*set/i)||-1!==e.search(/delete\s+from/i)}}},function(e,t,i){"use strict";e.exports=function(e){return void 0===e||-1===e.indexOf("-")||'"'===e[0]||'"'===e[e.length-1]?e:'"'+e+'"'}},function(e,t,i){"use strict";var s=i(2),n=i(590),o=i(3),r=["configModel"];e.exports=s.Collection.extend({model:function model(e,t){var i=t.collection;return new n(e,{collection:i,configModel:i._configModel})},url:function url(e){return"/api/"+this._configModel.urlVersion("organizationGroups",e)+"/organization/"+this.organization.id+"/groups"},initialize:function initialize(e,t){if(o(t,r,this),!t.organization)throw new Error("organization is required");this.organization=t.organization},parse:function parse(e){return this.total_entries=e.total_entries,e.groups},newGroupById:function newGroupById(e){var t=this.get(e);return t||(t=new n({id:e},{configModel:this._configModel,collection:this})),t},totalCount:function totalCount(){return this.total_entries}})},function(e,t,i){"use strict";var s=i(2);e.exports=function(e,t,i){this._xhr&&this._xhr.abort();var n=this._xhr=s.Model.prototype.sync.apply(this,arguments);return n.always(function(){t._xhr=null}),n}},function(e,t,i){"use strict";var s=i(2),n=i(245);e.exports=s.Collection.extend({sync:n,initialize:function initialize(e,t){if(!t.group)throw new Error("group is required");this.group=t.group,this.configModel=t.configModel,this.organization=t.organization},url:function url(e){return this.configModel.get("base_url")+"/api/"+this.configModel.urlVersion("organizationGroups",e)+"/organization/"+this.organization.id+"/groups/"+this.group.id+"/users"},parse:function parse(e){return this.total_entries=e.total_entries,this.total_user_entries=e.total_user_entries,e.users},totalCount:function totalCount(){return this.total_user_entries}})},function(e,t,i){"use strict";var s=i(2),n=i(0);e.exports=s.Model.extend({url:function url(){return this._configModel.get("base_url")+"/api/v1/org"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,n.isEmpty(this.get("owner"))||(this._ownerModel=new s.Model(n.omit(this.get("owner"),"organization")))},getOwnerId:function getOwnerId(){return this._ownerModel&&this._ownerModel.get("id")},getOwnerEmail:function getOwnerEmail(){return this._ownerModel&&this._ownerModel.get("email")},isOrgAdmin:function isOrgAdmin(e){return this.getOwnerId()===e.get("id")||!!n.find(this.get("admins"),function(t){return t.id===e.get("id")})}})},,,,,,,,,,,,function(e,t,i){"use strict";var s=i(2),n=i(0);e.exports=s.Model.extend({_MAX_COUNTER:1014,_CHAR_MAP:{" ":2,"-":2,_:2,".":2},defaults:{terms:[],category:"",counter:1014},initialize:function initialize(){this._initBinds()},_initBinds:function _initBinds(){this.bind("change:terms",this._setCounter,this)},_setCounter:function _setCounter(){var e=this._MAX_COUNTER,t=this;this.get("terms").length>1&&(e-=4*(this.get("terms").length-1)),n.each(this.get("terms"),function(i){n.each(i,function(i){void 0!==t._CHAR_MAP[i]?e-=t._CHAR_MAP[i]:e--})}),this.set("counter",Math.max(0,e))}})},,,function(e,t,i){(function(e){!function(e){var t=function(){var t={years:"datepickerViewYears",moths:"datepickerViewMonths",days:"datepickerViewDays"},i={wrapper:'<div class="datepicker"><div class="datepickerBorderT" /><div class="datepickerBorderB" /><div class="datepickerBorderL" /><div class="datepickerBorderR" /><div class="datepickerBorderTL" /><div class="datepickerBorderTR" /><div class="datepickerBorderBL" /><div class="datepickerBorderBR" /><div class="datepickerContainer"><table cellspacing="0" cellpadding="0"><tbody><tr></tr></tbody></table></div></div>',head:["<td>",'<table cellspacing="0" cellpadding="0">',"<thead>","<tr>",'<th class="datepickerGoPrev"><a href="#"><span><%=prev%></span></a></th>','<th colspan="5" class="datepickerMonth"><a href="#"><span></span></a></th>','<th class="datepickerGoNext"><a href="#"><span><%=next%></span></a></th>',"</tr>",'<tr class="datepickerDoW">',"<th><span><%=week%></span></th>","<th><span><%=day1%></span></th>","<th><span><%=day2%></span></th>","<th><span><%=day3%></span></th>","<th><span><%=day4%></span></th>","<th><span><%=day5%></span></th>","<th><span><%=day6%></span></th>","<th><span><%=day7%></span></th>","</tr>","</thead>","</table></td>"],space:'<td class="datepickerSpace"><div></div></td>',days:['<tbody class="datepickerDays">',"<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[0].week%></span></a></th>','<td class="<%=weeks[0].days[0].classname%>"><a href="#"><span><%=weeks[0].days[0].text%></span></a></td>','<td class="<%=weeks[0].days[1].classname%>"><a href="#"><span><%=weeks[0].days[1].text%></span></a></td>','<td class="<%=weeks[0].days[2].classname%>"><a href="#"><span><%=weeks[0].days[2].text%></span></a></td>','<td class="<%=weeks[0].days[3].classname%>"><a href="#"><span><%=weeks[0].days[3].text%></span></a></td>','<td class="<%=weeks[0].days[4].classname%>"><a href="#"><span><%=weeks[0].days[4].text%></span></a></td>','<td class="<%=weeks[0].days[5].classname%>"><a href="#"><span><%=weeks[0].days[5].text%></span></a></td>','<td class="<%=weeks[0].days[6].classname%>"><a href="#"><span><%=weeks[0].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[1].week%></span></a></th>','<td class="<%=weeks[1].days[0].classname%>"><a href="#"><span><%=weeks[1].days[0].text%></span></a></td>','<td class="<%=weeks[1].days[1].classname%>"><a href="#"><span><%=weeks[1].days[1].text%></span></a></td>','<td class="<%=weeks[1].days[2].classname%>"><a href="#"><span><%=weeks[1].days[2].text%></span></a></td>','<td class="<%=weeks[1].days[3].classname%>"><a href="#"><span><%=weeks[1].days[3].text%></span></a></td>','<td class="<%=weeks[1].days[4].classname%>"><a href="#"><span><%=weeks[1].days[4].text%></span></a></td>','<td class="<%=weeks[1].days[5].classname%>"><a href="#"><span><%=weeks[1].days[5].text%></span></a></td>','<td class="<%=weeks[1].days[6].classname%>"><a href="#"><span><%=weeks[1].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[2].week%></span></a></th>','<td class="<%=weeks[2].days[0].classname%>"><a href="#"><span><%=weeks[2].days[0].text%></span></a></td>','<td class="<%=weeks[2].days[1].classname%>"><a href="#"><span><%=weeks[2].days[1].text%></span></a></td>','<td class="<%=weeks[2].days[2].classname%>"><a href="#"><span><%=weeks[2].days[2].text%></span></a></td>','<td class="<%=weeks[2].days[3].classname%>"><a href="#"><span><%=weeks[2].days[3].text%></span></a></td>','<td class="<%=weeks[2].days[4].classname%>"><a href="#"><span><%=weeks[2].days[4].text%></span></a></td>','<td class="<%=weeks[2].days[5].classname%>"><a href="#"><span><%=weeks[2].days[5].text%></span></a></td>','<td class="<%=weeks[2].days[6].classname%>"><a href="#"><span><%=weeks[2].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[3].week%></span></a></th>','<td class="<%=weeks[3].days[0].classname%>"><a href="#"><span><%=weeks[3].days[0].text%></span></a></td>','<td class="<%=weeks[3].days[1].classname%>"><a href="#"><span><%=weeks[3].days[1].text%></span></a></td>','<td class="<%=weeks[3].days[2].classname%>"><a href="#"><span><%=weeks[3].days[2].text%></span></a></td>','<td class="<%=weeks[3].days[3].classname%>"><a href="#"><span><%=weeks[3].days[3].text%></span></a></td>','<td class="<%=weeks[3].days[4].classname%>"><a href="#"><span><%=weeks[3].days[4].text%></span></a></td>','<td class="<%=weeks[3].days[5].classname%>"><a href="#"><span><%=weeks[3].days[5].text%></span></a></td>','<td class="<%=weeks[3].days[6].classname%>"><a href="#"><span><%=weeks[3].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[4].week%></span></a></th>','<td class="<%=weeks[4].days[0].classname%>"><a href="#"><span><%=weeks[4].days[0].text%></span></a></td>','<td class="<%=weeks[4].days[1].classname%>"><a href="#"><span><%=weeks[4].days[1].text%></span></a></td>','<td class="<%=weeks[4].days[2].classname%>"><a href="#"><span><%=weeks[4].days[2].text%></span></a></td>','<td class="<%=weeks[4].days[3].classname%>"><a href="#"><span><%=weeks[4].days[3].text%></span></a></td>','<td class="<%=weeks[4].days[4].classname%>"><a href="#"><span><%=weeks[4].days[4].text%></span></a></td>','<td class="<%=weeks[4].days[5].classname%>"><a href="#"><span><%=weeks[4].days[5].text%></span></a></td>','<td class="<%=weeks[4].days[6].classname%>"><a href="#"><span><%=weeks[4].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[5].week%></span></a></th>','<td class="<%=weeks[5].days[0].classname%>"><a href="#"><span><%=weeks[5].days[0].text%></span></a></td>','<td class="<%=weeks[5].days[1].classname%>"><a href="#"><span><%=weeks[5].days[1].text%></span></a></td>','<td class="<%=weeks[5].days[2].classname%>"><a href="#"><span><%=weeks[5].days[2].text%></span></a></td>','<td class="<%=weeks[5].days[3].classname%>"><a href="#"><span><%=weeks[5].days[3].text%></span></a></td>','<td class="<%=weeks[5].days[4].classname%>"><a href="#"><span><%=weeks[5].days[4].text%></span></a></td>','<td class="<%=weeks[5].days[5].classname%>"><a href="#"><span><%=weeks[5].days[5].text%></span></a></td>','<td class="<%=weeks[5].days[6].classname%>"><a href="#"><span><%=weeks[5].days[6].text%></span></a></td>',"</tr>","</tbody>"],months:['<tbody class="<%=className%>">',"<tr>",'<td colspan="2"><a href="#"><span><%=data[0]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[1]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[2]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[3]%></span></a></td>',"</tr>","<tr>",'<td colspan="2"><a href="#"><span><%=data[4]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[5]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[6]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[7]%></span></a></td>',"</tr>","<tr>",'<td colspan="2"><a href="#"><span><%=data[8]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[9]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[10]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[11]%></span></a></td>',"</tr>","</tbody>"]},s={flat:!1,starts:1,prev:"&#9664;",next:"&#9654;",lastSel:!1,mode:"single",view:"days",calendars:1,format:"Y-m-d",position:"bottom",eventName:"click",onRender:function(){return{}},onChange:function(){return!0},onShow:function(){return!0},onBeforeShow:function(){return!0},onHide:function(){return!0},locale:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekMin:"wk"}},n=function(t){var s,n,o,a,l,h,c,d,u=e(t).data("datepicker"),p=e(t),g=Math.floor(u.calendars/2),m=0;p.find("td>table tbody").remove();for(var f=0;f<u.calendars;f++){switch((s=new Date(u.current)).addMonths(-g+f),(d=p.find("table").eq(f+1))[0].className){case"datepickerViewDays":v=r(s,"B, Y");break;case"datepickerViewMonths":v=s.getFullYear();break;case"datepickerViewYears":v=s.getFullYear()-6+" - "+(s.getFullYear()+5)}d.find("thead tr:first th:eq(1) span").text(v),v=s.getFullYear()-6,n={data:[],className:"datepickerYears"};for(var _=0;_<12;_++)n.data.push(v+_);c=tmpl(i.months.join(""),n),s.setDate(1),n={weeks:[],test:10},o=s.getMonth();var v=(s.getDay()-u.starts)%7;for(s.addDays(-(v+(v<0?7:0))),a=-1,m=0;m<42;){l=parseInt(m/7,10),h=m%7,n.weeks[l]||(a=s.getWeekNumber(),n.weeks[l]={week:a,days:[]}),n.weeks[l].days[h]={text:s.getDate(),classname:[]},o!=s.getMonth()&&n.weeks[l].days[h].classname.push("datepickerNotInMonth"),0==s.getDay()&&n.weeks[l].days[h].classname.push("datepickerSunday"),6==s.getDay()&&n.weeks[l].days[h].classname.push("datepickerSaturday");var y=u.onRender(s),b=s.valueOf();b===u.date[0]&&n.weeks[l].days[h].classname.push("datepickerSelectedFirst"),b+86399e3===u.date[1]&&n.weeks[l].days[h].classname.push("datepickerSelectedLast"),(y.selected||u.date==b||e.inArray(b,u.date)>-1||"range"==u.mode&&b>=u.date[0]&&b<=u.date[1])&&n.weeks[l].days[h].classname.push("datepickerSelected"),y.disabled&&n.weeks[l].days[h].classname.push("datepickerDisabled"),y.className&&n.weeks[l].days[h].classname.push(y.className),n.weeks[l].days[h].classname=n.weeks[l].days[h].classname.join(" "),m++,s.addDays(1)}c=tmpl(i.days.join(""),n)+c,n={data:u.locale.monthsShort,className:"datepickerMonths"},c=tmpl(i.months.join(""),n)+c,d.append(c)}},o=function(e,t){if(e.constructor==Date)return new Date(e);for(var i,s,n,o,r,a=e.split(/\W+/),l=t.split(/\W+/),h=new Date,c=0;c<a.length;c++)switch(l[c]){case"d":case"e":i=parseInt(a[c],10);break;case"m":s=parseInt(a[c],10)-1;break;case"Y":case"y":n=parseInt(a[c],10),n+=n>100?0:n<29?2e3:1900;break;case"H":case"I":case"k":case"l":o=parseInt(a[c],10);break;case"P":case"p":/pm/i.test(a[c])&&o<12?o+=12:/am/i.test(a[c])&&o>=12&&(o-=12);break;case"M":r=parseInt(a[c],10)}return new Date(void 0===n?h.getFullYear():n,void 0===s?h.getMonth():s,void 0===i?h.getDate():i,void 0===o?h.getHours():o,void 0===r?h.getMinutes():r,0)},r=function(e,t){var i=e.getMonth(),s=e.getDate(),n=e.getFullYear(),o=(e.getWeekNumber(),e.getDay()),r=e.getHours(),a=r>=12,l=a?r-12:r,h=e.getDayOfYear();0==l&&(l=12);for(var c,d=e.getMinutes(),u=e.getSeconds(),p=t.split(""),g=0;g<p.length;g++){switch(c=p[g],p[g]){case"a":c=e.getDayName();break;case"A":c=e.getDayName(!0);break;case"b":c=e.getMonthName();break;case"B":c=e.getMonthName(!0);break;case"C":c=1+Math.floor(n/100);break;case"d":c=s<10?"0"+s:s;break;case"e":c=s;break;case"H":c=r<10?"0"+r:r;break;case"I":c=l<10?"0"+l:l;break;case"j":c=h<100?h<10?"00"+h:"0"+h:h;break;case"k":c=r;break;case"l":c=l;break;case"m":c=i<9?"0"+(1+i):1+i;break;case"M":c=d<10?"0"+d:d;break;case"p":case"P":c=a?"PM":"AM";break;case"s":c=Math.floor(e.getTime()/1e3);break;case"S":c=u<10?"0"+u:u;break;case"u":c=o+1;break;case"w":c=o;break;case"y":c=(""+n).substr(2,2);break;case"Y":c=n}p[g]=c}return p.join("")},a=function(t){var i=e(t).data("datepicker"),s=e("#"+i.id);if(!i.extraHeight){var n=e(t).find("div");i.extraHeight=n.get(0).offsetHeight+n.get(1).offsetHeight,i.extraWidth=n.get(2).offsetWidth+n.get(3).offsetWidth}var o=s.find("table:first").get(0),r=o.offsetWidth,a=o.offsetHeight;s.css({width:r+i.extraWidth+"px",height:a+i.extraHeight+"px"}).find("div.datepickerContainer").css({width:r+"px",height:a+"px"})},l=function(t){e(t.target).is("span")&&(t.target=t.target.parentNode);var i=e(t.target);if(i.is("a")){if(t.target.blur(),i.hasClass("datepickerDisabled"))return!1;var s=e(this).data("datepicker"),o=i.parent(),r=o.parent().parent().parent(),a=e("table",this).index(r.get(0))-1,l=new Date(s.current),c=!1,d=!1;if(o.is("th"))if(o.hasClass("datepickerWeek")&&"range"==s.mode&&!o.next().hasClass("datepickerDisabled")){var u=parseInt(o.next().text(),10);l.addMonths(a-Math.floor(s.calendars/2)),o.next().hasClass("datepickerNotInMonth")&&l.addMonths(u>15?-1:1),l.setDate(u),s.date[0]=l.setHours(0,0,0,0).valueOf(),l.setHours(23,59,59,0),l.addDays(6),s.date[1]=l.valueOf(),d=!0,c=!0,s.lastSel=!1}else{if(o.hasClass("datepickerMonth"))return!1;if(o.parent().parent().is("thead")){switch(r.get(0).className){case"datepickerViewDays":s.current.addMonths(o.hasClass("datepickerGoPrev")?-1:1);break;case"datepickerViewMonths":s.current.addYears(o.hasClass("datepickerGoPrev")?-1:1);break;case"datepickerViewYears":s.current.addYears(o.hasClass("datepickerGoPrev")?-12:12)}d=!0}}else if(o.is("td")&&!o.hasClass("datepickerDisabled")){switch(r.get(0).className){case"datepickerViewMonths":s.current.setMonth(r.find("tbody.datepickerMonths td").index(o)),s.current.setFullYear(parseInt(r.find("thead th.datepickerMonth span").text(),10)),s.current.addMonths(Math.floor(s.calendars/2)-a),r.get(0).className="datepickerViewDays";break;case"datepickerViewYears":s.current.setFullYear(parseInt(i.text(),10)),r.get(0).className="datepickerViewMonths";break;default:u=parseInt(i.text(),10);switch(l.addMonths(a-Math.floor(s.calendars/2)),o.hasClass("datepickerNotInMonth")&&l.addMonths(u>15?-1:1),l.setDate(u),s.mode){case"multiple":u=l.setHours(0,0,0,0).valueOf(),e.inArray(u,s.date)>-1?e.each(s.date,function(e,t){if(t==u)return s.date.splice(e,1),!1}):s.date.push(u);break;case"range":s.lastSel||(s.date[0]=l.setHours(0,0,0,0).valueOf()),(u=l.setHours(23,59,59,0).valueOf())<s.date[0]?(s.date[1]=s.date[0]+86399e3,s.date[0]=u-86399e3):s.date[1]=u,s.lastSel=!s.lastSel;break;default:s.date=l.valueOf()}}d=!0,c=!0}d&&n(this),c&&s.onChange.apply(this,h(s))}return!1},h=function(t){var i;return"single"==t.mode?(i=new Date(t.date),[r(i,t.format),i,t.el]):(i=[[],[],t.el],e.each(t.date,function(e,s){var n=new Date(s);i[0].push(r(n,t.format)),i[1].push(n)}),i)},c=function(t){var i=e("#"+e(this).data("datepickerId"));if(!i.is(":visible")){var s=i.get(0);n(s);var o=i.data("datepicker");o.onBeforeShow.apply(this,[i.get(0)]);var r=e(this).offset(),l=function(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}}(),h=r.top,c=r.left;e.curCSS(s,"display");switch(i.css({visibility:"hidden",display:"block"}),a(s),o.position){case"top":h-=s.offsetHeight;break;case"left":c-=s.offsetWidth;break;case"right":c+=this.offsetWidth;break;case"bottom":h+=this.offsetHeight}h+s.offsetHeight>l.t+l.h&&(h=r.top-s.offsetHeight),h<l.t&&(h=r.top+this.offsetHeight+s.offsetHeight),c+s.offsetWidth>l.l+l.w&&(c=r.left-s.offsetWidth),c<l.l&&(c=r.left+this.offsetWidth),i.css({visibility:"visible",display:"block",top:h+"px",left:c+"px"}),0!=o.onShow.apply(this,[i.get(0)])&&i.show(),e(document).bind("mousedown",{cal:i,trigger:this},d)}return!1},d=function(t){t.target==t.data.trigger||function(e,t,i){if(e==t)return!0;if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));for(var s=t.parentNode;s&&s!=i;){if(s==e)return!0;s=s.parentNode}return!1}(t.data.cal.get(0),t.target,t.data.cal.get(0))||(0!=t.data.cal.data("datepicker").onHide.apply(this,[t.data.cal.get(0)])&&t.data.cal.hide(),e(document).unbind("mousedown",d))};return{init:function(r){return function(e){Date.prototype.tempDate||(Date.prototype.tempDate=null,Date.prototype.months=e.months,Date.prototype.monthsShort=e.monthsShort,Date.prototype.days=e.days,Date.prototype.daysShort=e.daysShort,Date.prototype.getMonthName=function(e){return this[e?"months":"monthsShort"][this.getMonth()]},Date.prototype.getDayName=function(e){return this[e?"days":"daysShort"][this.getDay()]},Date.prototype.addDays=function(e){this.setDate(this.getDate()+e),this.tempDate=this.getDate()},Date.prototype.addMonths=function(e){null==this.tempDate&&(this.tempDate=this.getDate()),this.setDate(1),this.setMonth(this.getMonth()+e),this.setDate(Math.min(this.tempDate,this.getMaxDays()))},Date.prototype.addYears=function(e){null==this.tempDate&&(this.tempDate=this.getDate()),this.setDate(1),this.setFullYear(this.getFullYear()+e),this.setDate(Math.min(this.tempDate,this.getMaxDays()))},Date.prototype.getMaxDays=function(){var e,t=new Date(Date.parse(this)),i=28;for(e=t.getMonth(),i=28;t.getMonth()==e;)i++,t.setDate(i);return i-1},Date.prototype.getFirstDay=function(){var e=new Date(Date.parse(this));return e.setDate(1),e.getDay()},Date.prototype.getWeekNumber=function(){var e=new Date(this);e.setDate(e.getDate()-(e.getDay()+6)%7+3);var t=e.valueOf();return e.setMonth(0),e.setDate(4),Math.round((t-e.valueOf())/6048e5)+1},Date.prototype.getDayOfYear=function(){var e=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0)-new Date(this.getFullYear(),0,0,0,0,0);return Math.floor(e/24*60*60*1e3)})}((r=e.extend({},s,r||{})).locale),r.calendars=Math.max(1,parseInt(r.calendars,10)||1),r.mode=/single|multiple|range/.test(r.mode)?r.mode:"single",this.each(function(){if(!e(this).data("datepicker")){if(r.el=this,r.date.constructor==String&&(r.date=o(r.date,r.format),r.date.setHours(0,0,0,0)),"single"!=r.mode)if(r.date.constructor!=Array)r.date=[r.date.valueOf()],"range"==r.mode&&r.date.push(new Date(r.date[0]).setHours(23,59,59,0).valueOf());else{for(var s=0;s<r.date.length;s++)r.date[s]=o(r.date[s],r.format).setHours(0,0,0,0).valueOf();"range"==r.mode&&(r.date[1]=new Date(r.date[1]).setHours(23,59,59,0).valueOf())}else r.date=r.date.valueOf();r.current?r.current=o(r.current,r.format):r.current=new Date,r.current.setDate(1),r.current.setHours(0,0,0,0);var h,d="datepicker_"+parseInt(1e3*Math.random());r.id=d,e(this).data("datepickerId",r.id);var u=e(i.wrapper).attr("id",d).bind("click",l).data("datepicker",r);r.className&&u.addClass(r.className);var p="";for(s=0;s<r.calendars;s++)h=r.starts,s>0&&(p+=i.space),p+=tmpl(i.head.join(""),{week:r.locale.weekMin,prev:r.prev,next:r.next,day1:r.locale.daysMin[h++%7],day2:r.locale.daysMin[h++%7],day3:r.locale.daysMin[h++%7],day4:r.locale.daysMin[h++%7],day5:r.locale.daysMin[h++%7],day6:r.locale.daysMin[h++%7],day7:r.locale.daysMin[h++%7]});u.find("tr:first").append(p).find("table").addClass(t[r.view]),n(u.get(0)),r.flat?(u.appendTo(this).show().css("position","relative"),a(u.get(0))):(u.appendTo(document.body),e(this).bind(r.eventName,c))}})},showPicker:function(){return this.each(function(){e(this).data("datepickerId")&&c.apply(this)})},hidePicker:function(){return this.each(function(){e(this).data("datepickerId")&&e("#"+e(this).data("datepickerId")).hide()})},setDate:function(t,i){return this.each(function(){if(e(this).data("datepickerId")){var s=e("#"+e(this).data("datepickerId")),r=s.data("datepicker");if(r.date=t,r.date.constructor==String&&(r.date=o(r.date,r.format),r.date.setHours(0,0,0,0)),"single"!=r.mode)if(r.date.constructor!=Array)r.date=[r.date.valueOf()],"range"==r.mode&&r.date.push(new Date(r.date[0]).setHours(23,59,59,0).valueOf());else{for(var a=0;a<r.date.length;a++)r.date[a]=o(r.date[a],r.format).setHours(0,0,0,0).valueOf();"range"==r.mode&&(r.date[1]=new Date(r.date[1]).setHours(23,59,59,0).valueOf())}else r.date=r.date.valueOf();i&&(r.current=new Date("single"!=r.mode?r.date[0]:r.date)),n(s.get(0))}})},getDate:function(t){if(this.size()>0)return h(e("#"+e(this).data("datepickerId")).data("datepicker"))[t?0:1]},clear:function(){return this.each(function(){if(e(this).data("datepickerId")){var t=e("#"+e(this).data("datepickerId")),i=t.data("datepicker");"single"!=i.mode&&(i.date=[],n(t.get(0)))}})},fixLayout:function(){return this.each(function(){if(e(this).data("datepickerId")){var t=e("#"+e(this).data("datepickerId"));t.data("datepicker").flat&&a(t.get(0))}})}}}();e.fn.extend({DatePicker:t.init,DatePickerHide:t.hidePicker,DatePickerShow:t.showPicker,DatePickerSetDate:t.setDate,DatePickerGetDate:t.getDate,DatePickerClear:t.clear,DatePickerLayout:t.fixLayout})}(e),function(){var e={};this.tmpl=function tmpl(t,i){var s=/\W/.test(t)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):e[t]=e[t]||tmpl(document.getElementById(t).innerHTML);return i?s(i):s}}()}).call(this,i(4))},function(e,t,i){"use strict";e.exports=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(182),r=i(177),a=i(2311);e.exports=function(e,t){var i=(t=t||{}).tabPaneItemLabelOptions,l=e.map(function(e){return["label","createContentView"].forEach(function(t){if(!e[t])throw new Error(t+" should be provided")}),{name:e.name,selected:e.selected,disabled:e.disabled,tooltip:e.tooltip,label:e.label,selectedChild:e.selectedChild,createButtonView:function createButtonView(){return new a(s.extend({model:this},i))},createContentView:function createContentView(){return e.createContentView&&e.createContentView()||new n}}}),h=new r(l),c=t.tabPaneOptions;return new o(s.extend({collection:h},c))}},function(e,t,i){"use strict";var s=i(1),n=i(246),o=i(350),r=i(600),a=i(599),l=i(2316),h=i(3),c=["columns","query","configModel","userModel","editorAttrs","modals","dialogMode","popupConfig"];e.exports=s.extend({className:"Form-InputFill CDB-OptionInput CDB-Text js-input",events:{focus:function focus(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},focus:function focus(){this.hasFocus||this.$(".js-fillInput").focus()},blur:function blur(){this.hasFocus&&this.$(".js-fillInput").blur()},initialize:function initialize(e){h(e,c,this),this._initViews()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},clean:function clean(){this.removeDialog(),this._popupManager.destroy(),s.prototype.clean.call(this)},removeDialog:function removeDialog(){this._popupManager.untrack(),this._inputCollection.unselect(),this._dialogView.clean()},_initViews:function _initViews(){this.$el.append(o()),this.options.editorAttrs&&this.options.editorAttrs.disabled&&this.$el.addClass("is-disabled"),this._initFillDialog(),this._initInputFields(),this._popupManager=new n(this._popupConfig.cid,this._popupConfig.$el,this._dialogView.$el)},_initInputFields:function _initInputFields(){this._inputCollection=new l,this._inputCollection.bind("onInputChanged",this._onInputChanged,this)},_onInputChanged:function _onInputChanged(){this.trigger("onInputChanged",this)},_initFillDialog:function _initFillDialog(){var e=new r;this.listenToOnce(e,"destroy",function(){this._dialogView=null,this.stopListening(e)}),this._dialogView=new a({model:e})},_onInputClick:function _onInputClick(e){e.get("selected")?this.removeDialog():(e.set("selected",!0),this._dialogView.model.set("createContentView",e.get("createContentView")),this._dialogView.render(),this._dialogView.show(),this._popupManager.append(this._dialogMode),this._popupManager.track())}})},function(e,t,i){"use strict";var s=i(0),n=i(9),o=i(2),r=i(1),a=i(444),l=i(222),h=i(2329),c=i(2327),d=i(2324),u=i(1007),p=i(56),g=i(236),m=s.clone(g.Prism[11]),f=s.template("SELECT <%= column %>, count(<%= column %>) FROM (<%= sql %>) _table_sql GROUP BY <%= column %> ORDER BY count DESC, <%= column %> ASC LIMIT <%= max_values %>"),_=i(3),v=["columns","configModel","modals","query","userModel"],y=0,b=1,w=2,C=3;function _quote(e){return e&&!0!==e?'"'+e.toString().replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':e}e.exports=r.extend({module:"components:form-components:editors:fill:input-color:input-qualitative-ramps:main-view",events:{"click .js-back":"_onClickBack","click .js-quantification":"_onClickQuantification"},initialize:function initialize(e){_(e,v,this),this._imageEnabled=e.imageEnabled,this._hideTabs=e.hideTabs,this._query=e.query,this._viewModel=new o.Model({step:0,status:"idle"}),this.listenTo(this.model,"change:attribute",this._fetchColumns),this.listenTo(this._viewModel,"change:status",this.render),this.model.hasChanged("quantification")&&this._fetchColumns()},render:function render(){this.clearSubViews(),this.$el.empty();var e=this._getColumn(),t=e&&e.type,i=!(!this._hideTabs||!s.contains(this._hideTabs,p.Tabs.QUANTIFICATION));return this.$el.append(a({status:this._viewModel.get("status"),columnType:t,attribute:this.model.get("attribute"),quantification:this.model.get("quantification")||"category",hideQuantification:i})),this._generateStackLayoutView(),this},_generateStackLayoutView:function _generateStackLayoutView(){var e=this._viewModel.get("step"),t=new o.Collection([{selected:e===y,createStackView:this._createCategoriesRampsListView.bind(this)},{selected:e===b,createStackView:this._createRangeListView.bind(this)},{selected:e===w,createStackView:this._createColorPickerView.bind(this)}]);this._iconStylingEnabled()&&t.add({selected:e===C,createStackView:this._createImagePickerView.bind(this)}),this._stackLayoutView=new l({collection:t}),this._stackLayoutView.bind("positionChanged",this._onStackLayoutPositionChange,this),this.$(".js-content").append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_computeRequiredNumberOfColors:function _computeRequiredNumberOfColors(){return this.model.get("domain")?Math.min(this.model.get("domain").length,11):11},_onStackLayoutPositionChange:function _onStackLayoutPositionChange(){this.$(".js-prevStep").toggle(0===this._stackLayoutView.getCurrentPosition())},_iconStylingEnabled:function _iconStylingEnabled(){return this._imageEnabled},_getColumn:function _getColumn(){return s.find(this._columns,function(e){return e.label===this.model.get("attribute")},this)},_fetchColumns:function _fetchColumns(){this.model.get("attribute")&&(this._query?(this._setViewStatus("loading"),new n.SQL({user:this._configModel.get("user_name"),sql_api_template:this._configModel.get("sql_api_template"),api_key:this._configModel.get("api_key")}).execute(f({sql:this._query,column:this.model.get("attribute"),max_values:11}),null,{success:this._onQueryDone.bind(this),error:function(){this._setViewStatus("error")}.bind(this)})):this._onQueryDone())},_onQueryDone:function _onQueryDone(e){e=e||{},this._updateRangeAndDomain(e.rows),this._setViewStatus("idle")},_updateRangeAndDomain:function _updateRangeAndDomain(e){e=e||[];var t=s.pluck(e,this.model.get("attribute")),i=s.map(t,function(e,t){return e}).slice(0,10);"number"!==this.model.get("attribute_type")&&(i=i.filter(function(e,t,i){return i.indexOf(e)===t}).map(_quote));var n=s.map(t,function(e,t){return t<10?m[t]:m[11]});if(this._iconStylingEnabled()){var o=s.map(t,function(){return""});this.model.attributes.images=o}this.model.set({range:n,domain:i})},_setViewStatus:function _setViewStatus(e){var t={status:e};"loading"===e&&(t.step=0),this._viewModel.set(t)},_getRange:function _getRange(){return s.map(this.model.get("range"),function(e,t){var i={val:e,color:e,title:this.model.get("domain")[t]};return this._iconStylingEnabled()&&(i.image=this.model.get("images")[t]),i},this)},_updateRange:function _updateRange(e){var t=s.clone(this.model.get("range"));t[this._index]=e[this._index].color,this.model.set("range",t)},_createColorPickerView:function _createColorPickerView(e,t){var i=this._getRange(),s=void 0!==this.model.get("opacity")?this.model.get("opacity"):1,n=this.options.imageEnabled&&this._index<10,o=new u({index:this._index,ramp:i,opacity:s,imageEnabled:n});return o.bind("back",function(t){e.prevStep()},this),o.bind("goToAssetPicker",function(){e.nextStep()},this),o.bind("change",this._updateRange,this),o.bind("changeIndex",function(e){this._index=e,this.model.set("index",e)},this),o.bind("change:opacity",function(e){this.model.set("opacity",e)},this),o},_createRangeListView:function _createRangeListView(e,t){var i=new d({model:this.model,maxValues:10,imageEnabled:this._iconStylingEnabled(),requiredNumberOfColors:this._computeRequiredNumberOfColors()});return i.bind("back",function(t){e.prevStep()},this),i.bind("selectItem",function(t){this._index=t.index,"asset"===t.target?e.goToStep(C):e.goToStep(w)},this),i},_createCategoriesRampsListView:function _createCategoriesRampsListView(e,t){var i=new c({model:this.model,maxValues:10,requiredNumberOfColors:this._computeRequiredNumberOfColors()}),s=[c.EVENTS.RAMP_SELECTED,c.EVENTS.CUSTOMIZE,c.EVENTS.CUSTOM_COLOR].join(" ");return i.on(s,function(){e.goToStep(b)},this),i},_createImagePickerView:function _createImagePickerView(e,t){var i=this._getRange(),s=new h({userModel:this._userModel,configModel:this._configModel,index:this._index,ramp:i,modals:this._modals,imageEnabled:this._iconStylingEnabled()});return s.bind("back",function(t){e.goToStep(b)},this),s.bind("goToColorPicker",function(){e.prevStep()},this),s.bind("changeIndex",function(e){this._index=e},this),this._iconStylingEnabled()&&s.bind("change:image",this._onImageChanged,this),s},_onImageChanged:function _onImageChanged(e){var t=s.clone(this.model.get("images"));t[this._index]=e.url,this.model.set("images",t)},_onClickQuantification:function _onClickQuantification(e){this.killEvent(e),this.trigger("selectQuantification",this)},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)}},{MAX_VALUES:10})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(1),r=i(464),a=i(446),l=i(2330),h=i(3),c=["ramp","opacity"];e.exports=o.extend({events:{"click .js-back":"_onClickBack"},initialize:function initialize(e){h(e,c,this),this.model=new n.Model({index:this.options.index,ramp:e.ramp,opacity:e.opacity}),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(a()),this._initViews(),this},_initBinds:function _initBinds(){this.listenTo(this.model,"change:index",this._onChangeIndex),this.listenTo(this.model,"change:opacity",this._onOpacityChanged)},_initViews:function _initViews(){this._headerView=new l({model:this.model,imageEnabled:this.options.imageEnabled}),this.addView(this._headerView),this._headerView.bind("goToAssetPicker",this._onGoToAssetPicker,this),this.$(".js-header").append(this._headerView.render().$el),this._colorPicker=new r({value:this._getColor(),opacity:1,disableOpacity:!0}),this.addView(this._colorPicker),this._colorPicker.bind("change",this._onChangeValue,this),this.$(".js-content").append(this._colorPicker.render().$el)},_setColor:function _setColor(e){var t=s.clone(this.model.get("ramp"));t[this.model.get("index")].color=e,this.model.set("ramp",t),this.model.trigger("change",t),this.trigger("change",t)},_getColor:function _getColor(){return this.model.get("ramp")[this.model.get("index")||0].color},_onChangeIndex:function _onChangeIndex(){this._colorPicker.setColor(this._getColor()),this.trigger("changeIndex",this.model.get("index"),this)},_onChangeValue:function _onChangeValue(e){this._setColor(e.hex)},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onOpacityChanged:function _onOpacityChanged(){var e=this.model.get("opacity");this.trigger("change:opacity",e)},_onGoToAssetPicker:function _onGoToAssetPicker(){this.trigger("goToAssetPicker")}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(1),r=i(222),a=i(470),l=i(283),h=i(2334),c=i(1006),d=i(56),u=i(3),p=i(179),g=0,m=1,f=2,_=["the_geom","the_geom_webmercator"],v=["columns","configModel","modals","query","userModel"];e.exports=o.extend({module:"components:form-components:editors:fill:input-color:input-color-value-content-view",initialize:function initialize(e){u(e,v,this),this._settings=s.clone(d.Settings.COLOR),this.options.removeByValueCategory&&this._removeCategoryFrom(this._settings.quantifications.items),this._categorizeColumns=e.categorizeColumns,this._imageEnabled=e.imageEnabled,this._hideTabs=e.hideTabs,this._column=this._getColumn(),this._columnType=this._column&&this._column.type,this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function _initBinds(){this.listenTo(this.model,"change:quantification",function(){"category"===this.model.previous("quantification")&&delete this.model.attributes.range,"category"!==this.model.get("quantification")&&this.model.unset("domain")})},_initViews:function _initViews(){var e=new n.Collection([{createStackView:this._createColumnListView.bind(this)},{createStackView:this._createInputQuantitativeRamps.bind(this)},{createStackView:this._createInputQualitativeRamps.bind(this)}]);if(this._hideTabs&&s.contains(this._hideTabs,d.Tabs.QUANTIFICATION)||e.push({createStackView:this._createQuantificationListView.bind(this)}),this._stackLayoutView=new r({collection:e}),this.model.get("attribute")){var t=this.model.get("domain")&&this.model.get("domain").length,i=this.model.get("range")&&this.model.get("range").length;"string"===this._columnType||t&&i?this._stackLayoutView.model.set("position",f):this._stackLayoutView.model.set("position",m)}this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_createInputQualitativeRamps:function _createInputQualitativeRamps(e,t){var i=new c({model:this.model,query:this._query,columns:this._columns,configModel:this._configModel,userModel:this._userModel,modals:this._modals,hideTabs:this._hideTabs,imageEnabled:this._imageEnabled});return i.bind("back",function(t){e.goToStep(g)},this),i},_createQuantificationListView:function _createQuantificationListView(e,t){var i=new a({headerTitle:_t("form-components.editors.fill.quantification.title"),stackLayoutModel:e,itemTemplate:l,columns:this._settings.quantifications.items,showSearch:!1});return i.bind("selectItem",function(t){this.model.set("quantification",t.get("val")),e.goToStep(m)},this),i.bind("back",function(t){e.goToStep(g)},this),i},_removeCategoryFrom:function _removeCategoryFrom(e){var t=e.indexOf("category");-1!==t&&e.splice(t,1)},_createInputQuantitativeRamps:function _createInputQuantitativeRamps(e,t){var i=s.clone(d.Settings.COLOR_RAMPS);this.options.removeByValueCategory&&this._removeCategoryFrom(i.quantifications.items);var n=new h({hideTabs:this.options.hideTabs,model:this.model,settings:i});return n.bind("switch",function(){e.goToStep(f)},this),n.bind("back",function(t){e.prevStep()},this),n},_getColumn:function _getColumn(e){return s.find(this._columns,function(t){return t.label===(e||this.model.get("attribute"))},this)},_createColumnListView:function _createColumnListView(e,t){var i=new a({stackLayoutModel:e,columns:this._filteredColumns(),showSearch:!0,typeLabel:"column"});return i.bind("selectItem",function(t){this._onChangeAttribute(t.get("val"),e)},this),i},_filteredColumns:function _filteredColumns(){var e=s.reject(this._columns,function(e){return"geometry"===e.type||"date"===e.type||s.contains(_,e.label)},this);return this.options.hideNumericColumns&&(e=s.reject(e,function(e){return"number"===e.type})),e},_onChangeAttribute:function _onChangeAttribute(e,t){var i="category"===this.model.get("quantification");this._column=this._getColumn(e),this._columnType=this._column&&this._column.type,s.each(["image","fixed","quantification","opacity"],function(e){this.model.unset(e,{silent:!0})},this),s.contains(["string","boolean"],this._columnType)||this._categorizeColumns?(this.model.unset("bins",{silent:!0}),t.goToStep(f)):"number"===this._columnType&&(this.model.unset("images",{silent:!0}),this.model.unset("domain",{silent:!0}),i&&this.model.unset("range",{silent:!0}),t.goToStep(m));var n={attribute:e,attribute_type:this._columnType};this.model.set(n),p.track("Styled by value",n)}})},function(e,t,i){"use strict";var s=i(0),n=i(597);e.exports=n.extend({defaults:{ext:"svg",folder:"maki-icons",host:"https://s3.amazonaws.com",bucket:"com.cartodb.users-assets.production",kind:"marker",name:"",public_url:"",size:"18",state:"idle"},getURLFor:function getURLFor(e){return this.get("host")+"/"+this.get("bucket")+"/"+this.get("folder")+"/"+e+(this.get("size")?"-"+this.get("size"):"")+"."+this.get("ext")},toJSON:function toJSON(){var e=s.clone(this.attributes);return e.public_url=this.getURLFor(e.icon),e},get:function get(e){var t=this.attributes[e];return"public_url"===e&&(t=this.getURLFor(this.attributes.icon)),t}})},function(e,t,i){"use strict";var s=i(1009),n=i(596);e.exports=n.extend({model:s,url:function url(){return""},initialize:function initialize(e,t){},parse:function parse(e,t){return[]}})},function(e,t,i){"use strict";var s=i(1),n=i(460);e.exports=s.extend({tagName:"li",className:"AssetsList-item AssetsList-item--medium",events:{"click .js-asset":"_onClick"},initialize:function initialize(e){this.listenTo(this.model,"change:state",this._changeState)},render:function render(){this.clearSubViews(),this.$el.attr("id",this.model.get("id"));var e=this.model.get("type")||"icon";return this.$el.append(n({type:e,height:this.options.assetHeight||24,name:this.model.get("name"),public_url:this.model.get("public_url")})),this.$el.addClass("AssetsList-item--"+e),this},_onClick:function _onClick(e){this.killEvent(e),this.trigger("selected",this.model)},_changeState:function _changeState(){this.$el.toggleClass("is-selected","selected"===this.model.get("state"))}})},function(e,t,i){"use strict";e.exports={disclaimer:_t("assets.maki-icons.disclaimer"),icons:[{name:"Square stroked",icon:"square-stroked"},{name:"Square solid",icon:"square"},{name:"Triangle stroked",icon:"triangle-stroked"},{name:"Triangle solid",icon:"triangle"},{name:"Star stroked",icon:"star-stroked"},{name:"Star solid",icon:"star"},{name:"Cross",icon:"cross"},{name:"Marker Stroke",icon:"marker-stroked"},{name:"Marker Solid",icon:"marker"},{name:"Religious Jewish",icon:"religious-jewish"},{name:"Religious Christian",icon:"religious-christian"},{name:"Religious Muslim",icon:"religious-muslim"},{name:"Cemetery",icon:"cemetery"},{name:"Rocket",icon:"rocket"},{name:"Airport",icon:"airport"},{name:"Heliport",icon:"heliport"},{name:"Rail",icon:"rail"},{name:"Rail Metro",icon:"rail-metro"},{name:"Rail Light",icon:"rail-light"},{name:"Bus",icon:"bus"},{name:"Fuel",icon:"fuel"},{name:"Parking",tags:["parking","transportation"],icon:"parking"},{name:"Parking Garage",tags:["parking","transportation","garage"],icon:"parking-garage"},{name:"Airfield",tags:["airfield","airport","plane","landing strip"],icon:"airfield"},{name:"Roadblock",tags:["roadblock","stop","warning","dead end"],icon:"roadblock"},{name:"Ferry",tags:["ship","boat","water","ferry","transportation"],icon:"ferry"},{name:"Harbor",tags:["marine","dock","water","wharf"],icon:"harbor"},{name:"Bicycle",tags:["cycling","cycle","transportation"],icon:"bicycle"},{name:"Park",tags:["recreation","park","forest","tree","green","woods","nature"],icon:"park"},{name:"Park 2",tags:["recreation","park","forest","tree","green","woods","nature"],icon:"park2"},{name:"Museum",tags:["recreation","museum","tourism"],icon:"museum"},{name:"Lodging",tags:["lodging","hotel","recreation","motel","tourism"],icon:"lodging"},{name:"Monument",tags:["recreation","statue","monument","tourism"],icon:"monument"},{name:"Zoo",tags:["recreation","zoo","animal","giraffe"],icon:"zoo"},{name:"Garden",tags:["recreation","garden","park","flower","nature"],icon:"garden"},{name:"Campsite",tags:["recreation","campsite","camp","camping","tent","nature"],icon:"campsite"},{name:"Theatre",tags:["recreation","theatre","theater","entertainment","play","performance"],icon:"theatre"},{name:"Art gallery",tags:["art","center","museum","gallery","creative","recreation","entertainment","studio"],icon:"art-gallery"},{name:"Pitch",tags:["pitch","track","athletic","sports","field"],icon:"pitch"},{name:"Soccer",tags:["soccer","sports"],icon:"soccer"},{name:"American Football",tags:["football","sports"],icon:"america-football"},{name:"Tennis",tags:["tennis","court","ball","sports"],icon:"tennis"},{name:"Basketball",tags:["basketball","ball","sports"],icon:"basketball"},{name:"Baseball",tags:["baseball","softball","ball","sports"],icon:"baseball"},{name:"Golf",tags:["golf","sports","course"],icon:"golf"},{name:"Swimming",tags:["swimming","water","swim","sports"],icon:"swimming"},{name:"Cricket",tags:["cricket","sports"],icon:"cricket"},{name:"Skiing",tags:["winter","skiing","ski","sports"],icon:"skiing"},{name:"School",tags:["school","highschool","elementary","children","amenity","middle"],icon:"school"},{name:"College",tags:["college","school","amenity","university"],icon:"college"},{name:"Library",tags:["library","books","amenity"],icon:"library"},{name:"Post",tags:["post","office","amenity","mail","letter"],icon:"post"},{name:"Fire station",tags:["fire","station","amenity"],icon:"fire-station"},{name:"Town hall",tags:["townhall","mayor","building","amenity","government"],icon:"town-hall"},{name:"Police",tags:["police","jail","arrest","amenity","station"],icon:"police"},{name:"Prison",tags:["prison","jail","amenity"],icon:"prison"},{name:"Embassy",tags:["embassy","diplomacy","consulate","amenity","flag"],icon:"embassy"},{name:"Beer",tags:["bar","beer","drink","commercial","biergarten","pub"],icon:"beer"},{name:"Restaurant",tags:["restaurant","commercial"],icon:"restaurant"},{name:"Cafe",tags:["cafe","coffee","commercial","tea"],icon:"cafe"},{name:"Shop",tags:["shop","mall","commercial","store"],icon:"shop"},{name:"Fast Food",tags:["food","fast","commercial","burger","drive-through"],icon:"fast-food"},{name:"Bar",tags:["bar","drink","commercial","club","martini","lounge"],icon:"bar"},{name:"Bank",tags:["bank","atm","commercial","money"],icon:"bank"},{name:"Grocery",tags:["food","grocery","commercial","store","market"],icon:"grocery"},{name:"Cinema",tags:["cinema","theatre","film","movie","commercial","theater","entertainment"],icon:"cinema"},{name:"Pharmacy",tags:["pharmacy","drugs","medication","social","medicine","prescription"],icon:"pharmacy"},{name:"Hospital",tags:["hospital","health","medication","social","medicine","medical","clinic"],icon:"hospital"},{name:"Danger",tags:["minefield","landmine","disaster","dangerous","hazard"],icon:"danger"},{name:"Industrial",tags:["industrial","factory","property","building"],icon:"industrial"},{name:"Warehouse",tags:["warehouse","property","storage","building"],icon:"warehouse"},{name:"Commercial",tags:["commercial","property","business","building"],icon:"commercial"},{name:"Building",tags:["building","property","structure","business","building"],icon:"building"},{name:"Place of worship",tags:["religion","ceremony","religious","nondenominational","church","temple"],icon:"place-of-worship"},{name:"Alcohol shop",tags:["alcohol","liquor","store","shop","beer","wine","vodka"],icon:"alcohol-shop"},{name:"Logging",tags:["logger","chainsaw","woods","industry"],icon:"logging"},{name:"Oil well",tags:["oil","natural","environment","industry","resources"],icon:"oil-well"},{name:"Slaughterhouse",tags:["cows","cattle","food","meat","industry","resources"],icon:"slaughterhouse"},{name:"Dam",tags:["water","natural","hydro","hydroelectric","energy","environment","industry","resources"],icon:"dam"},{name:"Water",tags:["water","natural","hydro","lake","river","ocean","resources"],icon:"water"},{name:"Wetland",tags:["water","swamp","natural"],icon:"wetland"},{name:"Disability",tags:["handicap","wheelchair","access"],icon:"disability"},{name:"Telephone",tags:["payphone","call"],icon:"telephone"},{name:"Emergency Telephone",tags:["payphone","danger","safety","call"],icon:"emergency-telephone"},{name:"Toilets",tags:["bathroom","men","women","sink","washroom","lavatory"],icon:"toilets"},{name:"Waste Basket",tags:["trash","rubbish","bin","garbage"],icon:"waste-basket"},{name:"Music",tags:["stage","performance","band","concert","venue"],icon:"music"},{name:"Land Use",tags:["zoning","usage","area"],icon:"land-use"},{name:"City",tags:["area","point","place","urban"],icon:"city"},{name:"Town",tags:["area","point","place","small"],icon:"town"},{name:"Village",tags:["area","point","place","small","rural"],icon:"village"},{name:"Farm",tags:["building","farming","crops","plants","agriculture","rural"],icon:"farm"},{name:"Bakery",tags:["bakery","pastry","croissant","food","shop","bread"],icon:"bakery"},{name:"Dog Park",tags:["dog","pet"],icon:"dog-park"},{name:"Lighthouse",tags:["building","navigation","nautical","ocean","logistics"],icon:"lighthouse"},{name:"Clothing Store",tags:["clothing","store","shop"],icon:"clothing-store"},{name:"Polling Place",icon:"polling-place"},{name:"Playground",icon:"playground"},{name:"Entrance",icon:"entrance"},{name:"Heart",icon:"heart"},{name:"London Underground",icon:"london-underground"},{name:"Minefield",icon:"minefield"},{name:"Rail Underground",icon:"rail-underground"},{name:"Rail Above",icon:"rail-above"},{name:"Camera",icon:"camera"},{name:"Laundry",icon:"laundry"},{name:"Car",icon:"car"},{name:"Suitcase",icon:"suitcase"},{name:"Hairdresser",icon:"hairdresser"},{name:"Chemist",icon:"chemist"},{name:"Mobile phone",icon:"mobilephone"},{name:"Scooter",icon:"scooter"}]}},function(e,t,i){"use strict";var s=i(1),n=i(471);e.exports=s.extend({className:"Label",initialize:function initialize(){if(!this.model)throw new Error("A model should be provided");this.model.on("change:label",this.render,this)},render:function render(){return this.$el.html(n({label:this.model.get("label"),selectedChild:this.model.get("selectedChild")||""})),this}})},function(e,t,i){"use strict";var s=i(247);e.exports=s.extend({_onClick:function _onClick(e){this.killEvent(e),this.model.set("selected",!this.model.get("selected"))}})},,,,,,,,,,function(e,t,i){"use strict";var s=i(1),n=i(1023);e.exports=s.extend({events:{"click .js-back":"_goToStart"},options:{fileEnabled:!1,acceptSync:!1},initialize:function initialize(e){if(!e.userModel)throw new Error("userModel is required");this._userModel=e.userModel,this.template=e.template||n,this._initBinds(),this._checkVisibility()},render:function render(){var e=this.options.acceptSync&&this._userModel.get("actions")&&this._userModel.isActionEnabled("sync_tables")&&"file"!==this.model.get("type");return this.$el.html(this.template({type:this.model.get("type"),fileEnabled:this.options.fileEnabled,acceptSync:e,state:this.model.get("state")})),this._checkVisibility(),this},_initBinds:function _initBinds(){this.model.bind("change:state",this.render,this)},_checkVisibility:function _checkVisibility(){this.show()},_goToStart:function _goToStart(){this.model.set("state","idle")}})},,function(e,t){(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function Dragster(e){this.el=e,this.dragleave=t(this.dragleave,this),this.dragenter=t(this.dragenter,this),this.first=!1,this.second=!1,this.el.addEventListener("dragenter",this.dragenter,!1),this.el.addEventListener("dragleave",this.dragleave,!1)}return Dragster.prototype.dragenter=function(e){return this.first?this.second=!0:(this.first=!0,this.customEvent=document.createEvent("CustomEvent"),this.customEvent.initCustomEvent("dragster:enter",!0,!0,{dataTransfer:e.dataTransfer,sourceEvent:e}),this.el.dispatchEvent(this.customEvent))},Dragster.prototype.dragleave=function(e){if(this.second?this.second=!1:this.first&&(this.first=!1),!this.first&&!this.second)return this.customEvent=document.createEvent("CustomEvent"),this.customEvent.initCustomEvent("dragster:leave",!0,!0,{dataTransfer:e.dataTransfer,sourceEvent:e}),this.el.dispatchEvent(this.customEvent)},Dragster.prototype.removeListeners=function(){return this.el.removeEventListener("dragenter",this.dragenter,!1),this.el.removeEventListener("dragleave",this.dragleave,!1)},Dragster.prototype.reset=function(){return this.first=!1,this.second=!1},Dragster}(),window.Dragster=e}).call(this)},function(e,t,i){"use strict";i(1026);var s=i(604),n=i(4),o=i(1),r=i(1025),a=i(3),l=["userModel"];e.exports=o.extend({options:{template:"",fileEnabled:!1},events:{"keyup .js-textInput":"_onTextChanged","submit .js-form":"_onSubmitForm"},initialize:function initialize(e){a(e,l,this),this.template=e.template||r,this._initBinds(),this._checkVisibility()},render:function render(){return this.$el.html(this.template(this.options)),this._initViews(),this},_initBinds:function _initBinds(){this.model.bind("change:state",this._checkVisibility,this)},_initViews:function _initViews(){if(this.options.fileEnabled){var e=this;this.$(".js-fileInput").bind("change",function(t){this.files&&this.files.length>0&&e._onFileChanged(this.files),this.value=""}),this._initDropzone()}},_initDropzone:function _initDropzone(){var e=n("html")[0],t=this;this.dragster=new Dragster(e),n(e).bind("dragster:enter",function(e){t._showDropzone()}),n(e).bind("dragster:leave",function(e){t._hideDropzone()}),e.dropzone&&e.dropzone.destroy(),this.dropzone=new s(e,{url:":)",autoProcessQueue:!1,previewsContainer:!1}),this.dropzone.on("dragover",function(){t._showDropzone()}),this.dropzone.on("drop",function(e){var i=e.dataTransfer.files;t._onFileChanged(i),t._hideDropzone()})},_destroyDropzone:function _destroyDropzone(){var e=n("html")[0];this.dragster&&(this.dragster.removeListeners(),this.dragster.reset(),n(e).unbind("dragster:enter dragster:leave")),this.dropzone&&this.dropzone.destroy()},_setValidFileExtensions:function _setValidFileExtensions(e){return RegExp("(.|/)("+e.join("|")+")$","i")},_onTextChanged:function _onTextChanged(){this.$(".js-textInput").val()||this._hideTextError()},_onFileChanged:function _onFileChanged(e){this.trigger("fileSelected",this),e&&1===e.length&&(e=e[0]),this.model.setUpload({type:"file",value:e}),"error"!==this.model.get("state")?(this._hideFileError(),this.model.set("state","selected")):this._showFileError()},_showTextError:function _showTextError(){this.$(".Form-inputError").addClass("is-visible")},_hideTextError:function _hideTextError(){this.$(".Form-inputError").removeClass("is-visible")},_showDropzone:function _showDropzone(){this.$(".Form-upload").addClass("is-dropping"),this._hideFileError()},_hideDropzone:function _hideDropzone(){this.$(".Form-upload").removeClass("is-dropping")},_showFileError:function _showFileError(){"error"===this.model.get("state")&&(this.$(".js-fileError").text(this.model.get("get_error_text").what_about).show(),this.$(".js-fileLabel").hide(),this.$(".js-fileButton").addClass("Button--negative"))},_hideFileError:function _hideFileError(){this.$(".js-fileError").hide(),this.$(".js-fileLabel").show(),this.$(".js-fileButton").removeClass("Button--negative")},_onSubmitForm:function _onSubmitForm(e){e&&this.killEvent(e);var t=this.$(".js-textInput").val();if(t){this.trigger("urlSelected",this);var i=this.model.get("service_name")?"service":"url";this.model.setUpload({type:i,value:t,service_item_id:t,state:"idle"}),"error"!==this.model.get("state")?(this._hideFileError(),this._hideTextError(),this.model.set("state","selected"),this.trigger("urlSubmitted",this)):this._showTextError()}else this._hideTextError()},_checkVisibility:function _checkVisibility(){this["selected"!==this.model.get("state")?"show":"hide"]()},clean:function clean(){this._destroyDropzone(),this.$(".js-fileInput").unbind("change"),o.prototype.clean.apply(this)}})},function(e,t,i){"use strict";var s=i(606),n=i(284),o=i(1027),r=i(1024),a=i(603),l=i(1022),h=i(3),c=["userModel","configModel","createModel","privacyModel","guessingModel"];e.exports=s.extend({options:{fileExtensions:[],type:"url",service:"",acceptSync:!1,fileEnabled:!1,formTemplate:"",headerTemplate:"",fileAttrs:{}},className:"ImportPanel ImportDataPanel",initialize:function initialize(e){h(e,c,this),this._initModels(),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(l()),this._initViews(),this._initBinds(),this},_initModels:function _initModels(){this.model=new n({type:this.options.type,service_name:this.options.service},{userModel:this._userModel,configModel:this._configModel})},_initViews:function _initViews(){this.model.setFresh();var e=new r({el:this.$(".ImportPanel-header"),model:this.model,userModel:this._userModel,fileEnabled:this.options.fileEnabled,acceptSync:this.options.acceptSync,template:this.options.headerTemplate});e.render(),this.addView(e);var t=new a({el:this.$(".DatasetSelected"),userModel:this._userModel,model:this.model,acceptSync:this.options.acceptSync,fileAttrs:this.options.fileAttrs,configModel:this._configModel});t.render(),this.addView(t);var i=new o({el:this.$(".ImportPanel-form"),userModel:this._userModel,model:this.model,template:this.options.formTemplate,fileEnabled:this.options.fileEnabled});i.bind("fileSelected",function(){t.setOptions({acceptSync:!1,fileAttrs:{ext:!0,title:"name",description:{content:[{name:"size",format:"size"}]}}})}),i.bind("urlSelected",function(){t.setOptions({acceptSync:!0,fileAttrs:{ext:!1,title:"",description:""}})}),i.bind("urlSubmitted",function(){this._finish()}.bind(this)),i.render(),this.addView(i)},_finish:function _finish(){this._createModel.canFinish()&&(this.model.setPrivacy(this._privacyModel.get("privacy")),this.model.setGuessing(this._guessingModel.get("guessing")),this._createModel.finish())},_initBinds:function _initBinds(){this.model.unbind("change:state",this._checkState,this),this.model.unbind("change",this._triggerChange,this),this.model.bind("change:state",this._checkState,this),this.model.bind("change",this._triggerChange,this)},_checkState:function _checkState(){"selected"===this.model.previous("state")&&this.model.set({type:void 0,value:"",service_name:"",service_item_id:"",interval:0})}})},function(e,t,i){"use strict";var s=i(1),n=i(0),o=i(6);e.exports=s.extend({module:"components:tab-pane:tab-pane-item-view",tagName:"button",className:function className(){var e=[this.options.klassName];return this.model.get("selected")&&e.push("is-selected"),this.model.get("disabled")&&e.push("is-disabled"),e.join(" ")},events:{click:"_onButtonClicked"},initialize:function initialize(){if(!this.model)throw new Error("A model should be provided");this.model.bind("change:selected",this._onChangeSelected,this)},render:function render(){var e=this.model.get("tooltip"),t=this.model.get("createButtonView").call(this.model);if(this.addView(t),this.$el.append(t.render().$el),e){var i=new o({el:this.$el,title:function title(){return _t(e)},gravity:"w"});this.addView(i)}return this},_onChangeSelected:function _onChangeSelected(){this.$el.toggleClass("is-selected",!!this.model.get("selected"))},_onButtonClicked:function _onButtonClicked(e){e.preventDefault(),this.model.get("disabled")||(this.model.set("selected",!0),n.isFunction(this.model.get("onClick"))&&this.model.get("onClick")())}})},,,,,,,,,,function(e,t,i){"use strict";var s=i(9),n=i(1),o=i(4),r=i(0),a=i(5),l=i(7),h=i(6),c=i(1038),d=i(2421);e.exports=n.extend({tagName:"li",className:"ModalBlockList-item ModalBlockList-item--full",events:{"click .js-tag-link":"_onTagClick",click:"_toggleSelected"},initialize:function initialize(e){if(!e.createModel)throw new Error("createModel is required");if(!e.userModel)throw new Error("userModel is required");this._createModel=e.createModel,this._userModel=e.userModel,this._routerModel=this._createModel.getVisualizationFetchModel(),this.model.on("change",this.render,this)},render:function render(){var e=this.model.getTableModel(),t=this.model.getPermissionModel(),i=this.model.getSynchronizationModel(),n=this.model.get("tags")||[],o=s.core.sanitize.html(this.model.get("description")),h=(e.getGeometryType?e.getGeometryType():e.geomColumnTypes())||[],d={isRaster:this.model.isRaster(),geometryType:h.length>0?h[0]:"",title:this.model.get("name"),isOwner:t.isOwner(this._userModel),owner:t.getOwner().renderData(this._userModel),showPermissionIndicator:!t.hasWriteAccess(this._userModel),description:o,privacy:this.model.get("privacy").toLowerCase(),likes:this.model.get("likes")||0,timeDiff:a(this.model.get("updated_at")).fromNow(),tags:n,tagsCount:n.length,maxTagsToShow:3,rowCount:void 0,datasetSize:void 0,syncStatus:void 0,syncRanAt:void 0},u=e.get("row_count");u>=0&&(d.rowCount=u,d.rowCountFormatted=u<1e4?l.formatNumber(u):l.readizableNumber(u));var p=e.get("size");return p>=0&&(d.datasetSize=l.readablizeBytes(p,!0)),r.isEmpty(i)||(d.syncRanAt=a(i.get("ran_at")||new Date).fromNow(),d.syncStatus=i.get("state")),this.$el.html(c(d)),this._renderLikesIndicator(),this._renderTooltips(),this.$el.toggleClass("is-selected",!!this.model.get("selected")),this},_renderLikesIndicator:function _renderLikesIndicator(){var e=new d({model:this.model.getLikesModel()});this.$(".js-likes-indicator").replaceWith(e.render().el),this.addView(e)},_renderTooltips:function _renderTooltips(){r.isEmpty(this.model.get("synchronization"))||this.addView(new h({el:this.$(".DatasetsList-itemStatus"),title:function title(e){return o(this).attr("data-title")}}))},_onTagClick:function _onTagClick(e){var t=o(e.target).val();t&&this._routerModel.set("tag",t)},_toggleSelected:function _toggleSelected(e){"A"!==e.target.tagName&&(this.killEvent(e),this._createModel.canSelect(this.model)&&this.model.set("selected",!this.model.get("selected")))}})},function(e,t,i){"use strict";var s=i(1),n=i(0),o=i(2424),r=i(2418),a=i(182),l=i(177),h=i(3),c=["createModel","userModel","configModel","privacyModel","guessingModel"];e.exports=s.extend({className:"CreateDialog-listing CreateDialog-listing--noPaddingTop",initialize:function initialize(e){h(e,c,this),this._initBinds(),this._onChangeListing()},render:function render(){return this.clearSubViews(),this._initViews(),this},_initBinds:function _initBinds(){this.listenTo(this._createModel,"change:listing",this._onChangeListing)},_initViews:function _initViews(){var e=this,t=[];t.push({name:"datasets",selected:!1,createContentView:function createContentView(){return new o({userModel:e._userModel,createModel:e._createModel})}}),this._userModel.canCreateDatasets()&&t.push({name:"import",selected:!1,createContentView:function createContentView(){return new r({userModel:e._userModel,configModel:e._configModel,createModel:e._createModel,privacyModel:e._privacyModel,guessingModel:e._guessingModel})}}),this._tabPaneCollection=new l(t);var i=new a({collection:this._tabPaneCollection});this.addView(i),this.$el.append(i.render().el)},_onChangeListing:function _onChangeListing(){if(this._tabPaneCollection){var e=this._createModel.get("listing");n.first(this._tabPaneCollection.where({name:e})).set("selected",!0)}}})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(9),n=i(2),o=i(1),r=i(4),a=i(0),l=i(3),h=i(1041),c=["configModel","createModel","userModel","routerModel","tablesCollection"];e.exports=o.extend({events:{"submit .js-search-form":"_submitSearch","keydown .js-search-form":"_onSearchKeyDown","click .js-search-form":"killEvent","click .js-search-link":"_onSearchClick","click .js-clean-search":"_onCleanSearchClick","click .js-shared":"_onSharedClick","click .js-library":"_onLibraryClick","click .js-connect":"_onConnectClick","click .js-datasets":"_onDatasetsClick","click .js-create-empty":"_onCreateEmptyClick"},initialize:function initialize(e){l(e,c,this),this.model=new n.Model,this._preRender(),this._initBinds()},_preRender:function _preRender(){var e=r("<div>").addClass("u-inner"),t=r("<div>").addClass("Filters-inner");this.$el.append(e.append(t))},render:function render(e,t){return this.clearSubViews(),this.$(".Filters-inner").html(h(a.extend({showDatasets:this._createModel.showDatasets(),createModelType:this._createModel.get("type"),canCreateDataset:this._userModel.canCreateDatasets(),listingType:this._createModel.get("listing"),isInsideOrg:this._userModel.isInsideOrg(),totalShared:this._tablesCollection.getTotalStat("total_shared"),selectedItemsCount:this._selectedItems().length,hasDataLibrary:this._configModel.dataLibraryEnabled()},this._routerModel.attributes))),this._animate(),this._routerModel.isSearching()&&this._focusSearchInput(),this},_initBinds:function _initBinds(){this.listenTo(this.model,"change:isSearchEnabled",this._onChangeIsSearchEnabled,this),this.listenTo(this._createModel,"change:listing",this.render,this),this.listenTo(this._routerModel,"change",this.render,this),this.listenTo(this._tablesCollection,"sync",this.render,this)},_onChangeIsSearchEnabled:function _onChangeIsSearchEnabled(e,t){this._enableSearchUI(t),this._routerModel.isSearching()?this._cleanSearch():t&&(this._$searchInput().val(""),this._focusSearchInput())},_$searchInput:function _$searchInput(){return this.$(".js-search-input")},_focusSearchInput:function _focusSearchInput(){this._$searchInput().select().focus()},_onSearchKeyDown:function _onSearchKeyDown(e){27===e.keyCode&&(this.killEvent(e),this._cleanSearch())},_selectedItems:function _selectedItems(){return this._tablesCollection.where({selected:!0})},_animate:function _animate(){this._enableSearchUI(!!this._routerModel.isSearching());var e=this._routerModel.get("library"),t="datasets"===this._createModel.get("listing"),i=this._tablesCollection.getTotalStat("total_user_entries")>0;this.$el.toggleClass("no-shadow",e&&!i&&t)},_enableSearchUI:function _enableSearchUI(e){this.$(".js-search-field").toggle(e),this.$(".js-links-list").toggleClass("is-hidden",e),this.$(".js-order-list").toggleClass("is-hidden",e)},_onDatasetsClick:function _onDatasetsClick(){this._routerModel.set({shared:"no",library:!1,page:1}),this._routerModel.trigger("change",this._routerModel),this._createModel.set("listing","datasets")},_onSharedClick:function _onSharedClick(){this._routerModel.set({shared:"only",library:!1,page:1}),this._routerModel.trigger("change",this._routerModel),this._createModel.set("listing","datasets")},_onLibraryClick:function _onLibraryClick(){this._routerModel.set({shared:"no",library:!0,page:1}),this._routerModel.trigger("change",this._routerModel),this._createModel.set("listing","datasets")},_onConnectClick:function _onConnectClick(){this._userModel.canCreateDatasets()&&this._createModel.set("listing","import")},_onCreateEmptyClick:function _onCreateEmptyClick(){this._userModel.canCreateDatasets()&&this._createModel.createFromScratch()},_onSearchClick:function _onSearchClick(e){this.killEvent(e),this.model.set("isSearchEnabled",!this.model.get("isSearchEnabled"))},_onCleanSearchClick:function _onCleanSearchClick(e){e&&e.preventDefault(),this._cleanSearch()},_cleanSearch:function _cleanSearch(){this._routerModel.set({q:"",tag:"",shared:"no",library:this._createModel.showLibrary()}),this.model.set("isSearchEnabled",!1)},_submitSearch:function _submitSearch(e){this.killEvent(e);var t=s.core.sanitize.html(this.$(".js-search-input").val().trim()),i=0===t.search(":")?t.replace(":",""):"",n=0!==t.search(":")?t:"";this._routerModel.set({page:1,tag:i,q:n,shared:"yes"}),this._createModel.set("listing","datasets")}})},,,function(e,t,i){"use strict";var s=i(1),n=i(4),o=i(1097),r=i(6),a=i(3),l=["createModel","privacyModel","configModel","userModel"];e.exports=s.extend({events:{click:"_onClick"},initialize:function initialize(e){a(e,l,this),this._initBinds()},render:function render(){if(this.clearSubViews(),this.$el.empty(),this._createModel.showPrivacyToggler()){var e=this._userModel.canCreatePrivateDatasets(),t=this._privacyModel.get("privacy"),i="PUBLIC"===t,s=i?"PRIVATE":"PUBLIC",n=i?"unlock":"lock",r=this._configModel.get("upgrade_url")||window.upgrade_url,a=!this._configModel.get("cartodb_com_hosted")&&!e&&r;this.$el.html(o({privacy:t,isDisabled:!e,canUpgrade:a,nextPrivacy:s,upgradeUrl:r,icon:n})),this._initViews()}return this},_initBinds:function _initBinds(){this._privacyModel.bind("change:privacy",this.render,this)},_initViews:function _initViews(){this.addView(new r({el:this.$(".js-toggler"),html:!0,title:function title(){return n(this).attr("data-title")}}))},_onClick:function _onClick(){if(this._userModel.canCreatePrivateDatasets()){var e=this._privacyModel.get("privacy");this._privacyModel.set("privacy","PUBLIC"===e?"PRIVATE":"PUBLIC")}}})},,function(e,t,i){"use strict";var s=i(1),n=i(1099),o=i(3),r=["createModel","guessingModel","configModel","userModel"];e.exports=s.extend({events:{"click .js-toggle":"_toggle"},initialize:function initialize(e){o(e,r,this),this._initBinds()},render:function render(){var e="";if(this._createModel.showGuessingToggler()){var t=this._createModel.getUploadModel();e=n({isGuessingEnabled:this._guessingModel.get("guessing"),importState:this._createModel.getImportState(),isUploadValid:t.isValidToUpload(),customHosted:this._configModel.get("cartodb_com_hosted"),isTwitterDeprecatedForUser:!this._userModel.hasOwnTwitterCredentials()})}return this.$el.html(e),this},_initBinds:function _initBinds(){this._createModel.bind("change",this.render,this),this._guessingModel.bind("change",this.render,this),this.add_related_model(this._createModel)},_toggle:function _toggle(){var e=!this._guessingModel.get("guessing");this._guessingModel.set("guessing",e)}})},function(e,t,i){"use strict";var s=i(290).extend({edit:function edit(e){if(!e)throw new Error("User is needed to create the url");return this.urlToPath(e.get("username")+"/edit")},create:function create(){return this.urlToPath("new")},groups:function groups(){return this.urlToPath("groups")}});e.exports=s},function(e,t,i){"use strict";var s=i(290).extend({lockedItems:function lockedItems(){return this.urlToPath("locked")},sharedItems:function sharedItems(){return this.urlToPath("shared")},likedItems:function likedItems(){return this.urlToPath("liked")}});e.exports=s},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(1),n=i(810),o=i(3),r=["format","isDisabled","isChecked"];e.exports=s.extend({tagName:"li",className:"Modal-listFormItem",initialize:function initialize(e){o(e,r,this)},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function _initViews(){this.$el.html(n({format:this._format,isDisabled:this._isDisabled,isChecked:this._isChecked})),this.$el.toggleClass("is-disabled",this._isDisabled)}})},,function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(530);e.exports=s.Collection.extend({model:function model(e,t){var i=t.collection;return new o(e,{configModel:i._configModel,tableName:i._tableName})},url:function url(){return!!this._tableName&&this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("column")+"/tables/"+this._tableName+"/columns"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");if(!t.querySchemaModel)throw new Error("querySchemaModel is required");this._tableName=t.tableName,this._querySchemaModel=t.querySchemaModel,this._configModel=t.configModel,this._initBinds()},_initBinds:function _initBinds(){this.bind("add remove change:type change:name",function(){this.reset(),this._querySchemaModel.set("status","unfetched"),this._querySchemaModel.fetch()},this),this._querySchemaModel.bind("change:status",function(e,t){"fetched"===t&&this.reset(this._querySchemaModel.columnsCollection.toJSON())},this)},setTableName:function setTableName(e){e&&this._tableName&&(this._tableName=e,this.each(function(t){t._tableName=e}))},addColumn:function addColumn(e){e=e||{},this.create({name:"column_"+(new Date).getTime(),type:"string",isNew:!0},n.extend(e,{wait:!0,parse:!1}))}})},function(e,t,i){"use strict";var s=i(2),n=i(5),o=i(7),r=[{val:0,label:_t("months.january")},{val:1,label:_t("months.february")},{val:2,label:_t("months.march")},{val:3,label:_t("months.april")},{val:4,label:_t("months.may")},{val:5,label:_t("months.june")},{val:6,label:_t("months.july")},{val:7,label:_t("months.august")},{val:8,label:_t("months.september")},{val:9,label:_t("months.october")},{val:10,label:_t("months.november")},{val:11,label:_t("months.december")}];e.exports=s.Model.extend({parse:function parse(e){var t;return{day:(t=e.date?n(e.date).utc():n().utc()).date(),month:t.month(),year:t.year(),time:t.format("HH:mm:ss"),utcOffset:t.utcOffset()}},initialize:function initialize(){this.schema={day:{title:"",type:"Text",validators:["required",/^([12]?\d{0,1}|3[01]{0,2})$/,function(e,t){if(!n(o.formatDate(t)).isValid())return{type:"date",message:_t("components.datepicker.invalid-date")}}]},month:{type:"Select",title:"",options:r},year:{title:"",type:"Text",validators:["required",/^([0-9]{0,4})$/]},time:{title:"",type:"Text",validators:["required",/^([01]{1}[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/]}}},getFormattedDate:function getFormattedDate(){return o.formatDate(this.toJSON())}})},function(e,t,i){"use strict";var s=i(2),n=i(385),o=i(1691);i(181),e.exports=n.extend({tagName:"div",className:"Table-editorDate",initialize:function initialize(e){n.prototype.initialize.apply(this,arguments),this._formModel=new o({date:this.model.get("value")},{parse:!0}),this._setValue(),this._formModel.bind("change",this._setValue,this),this.add_related_model(this._formModel)},render:function render(){return this._formView=new s.Form({model:this._formModel}),this._formView.bind("change",function(){this.commit()}),this.$el.html(this._formView.render().el),this},_setValue:function _setValue(){this.model.set("value",this._formModel.getFormattedDate())},clean:function clean(){this._formView.remove(),n.prototype.clean.apply(this)}})},function(e,t,i){"use strict";var s=i(385),n=i(4),o=i(813);e.exports=s.extend({tagName:"div",className:"u-flex",events:{"change input:radio":"_onRadioChanged"},render:function render(){var e=this.model.get("value");return this.$el.html(o({value:null!==e?e.toString():"null"})),this},_onRadioChanged:function _onRadioChanged(e){var t=n(e.target).val();switch(t){case"true":t=!0;break;case"false":t=!1;break;default:t=null}this.model.set("value",t),this._editorModel.confirm()}})},function(e,t,i){"use strict";var s=i(2),n=i(0);e.exports=s.Model.extend({validate:function validate(e,t){return"number"===e.type&&isNaN(e.value)?"Number not valid":"boolean"!==e.type||n.isBoolean(e.value)||null===e.value?void 0:"Boolean not valid"}})},function(e,t,i){"use strict";var s=i(2),n=i(1);e.exports=s.Model.extend({defaults:{show:!0,createContentView:function createContentView(){return new n}},createContentView:function createContentView(){return this.get("createContentView")(this)},show:function show(){this.set("show",!0)},hide:function hide(){this.set("show",!1)},isHidden:function isHidden(){return!this.get("show")},confirm:function confirm(){var e=Array.prototype.slice.call(arguments);this.trigger.apply(this,["confirm"].concat(e))},destroy:function destroy(){var e=Array.prototype.slice.call(arguments);this.trigger.apply(this,["destroy"].concat(e))}})},function(e,t,i){"use strict";var s=i(1);e.exports=s.extend({className:"CDB-Box-modal Table-editor",initialize:function initialize(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy)},render:function render(){this.clearSubViews();var e=this.model.createContentView();return this.addView(e),e.render(),this.$el.append(e.el),this.$el.css(this.options.position),this},show:function show(){this.model.show()},hide:function hide(){this.model.hide()},destroy:function destroy(){this.model.destroy()},_onShowChange:function _onShowChange(e,t){this.$el[t?"show":"hide"]()},_onClose:function _onClose(){this.destroy()},_onDestroy:function _onDestroy(){this.hide(),this.clean()}})},function(e,t,i){"use strict";var s=i(0),n=i(4),o=i(2),r=i(1696),a=i(1695),l="destroyedEditor",h="confirmedEditor";e.exports=o.Model.extend({create:function create(e,t){if(!s.isFunction(e))throw new Error("createContentView is required");return t=t||{left:"50%",top:"50%"},this._editorView||(this._editorView=this._newEditorView(t),document.body.appendChild(this._editorView.el)),this._editorView.model.set("createContentView",e),this._editorView.render(),this._editorView},confirm:function confirm(){this._editorView&&this._editorView.model.confirm()},destroy:function destroy(){this._editorView&&this._editorView.model.destroy()},_newEditorView:function _newEditorView(e){var t=new a;this._destroyOnEsc(t),this.listenToOnce(t,"destroy",function(){this._editorView=null,this.trigger.apply(this,[l].concat(Array.prototype.slice.call(arguments))),this.stopListening(t)}),this.listenToOnce(t,"confirm",function(){this.trigger.apply(this,[h].concat(Array.prototype.slice.call(arguments))),this.destroy()});var i=new r({model:t,position:e});return this._destroyOnClickOutside(i),i},_destroyOnClickOutside:function _destroyOnClickOutside(e){var t=function destroyOnClickOutside(t){0===n(t.target).closest(e.el).length&&e.model.confirm()};document.addEventListener("click",t),this.listenToOnce(e.model,"destroy",function(){document.removeEventListener("click",t)})},_destroyOnEsc:function _destroyOnEsc(e){var t=function destroyOnEsc(t){27===t.which&&e.destroy()};document.addEventListener("keydown",t),this.listenToOnce(e,"destroy",function(){document.removeEventListener("keydown",t)})}})},function(e,t,i){"use strict";var s=i(0),n=i(2);e.exports=n.Collection.extend({url:function url(){return this._configModel.getSqlApiUrl()},initialize:function initialize(e){e=e||{},this._tableName=e.tableName,this._configModel=e.configModel},fetchCount:function fetchCount(e){var t={},i=-1;return t.data={api_key:this._configModel.get("api_key"),q:this._getCountSQL()},t.method=this._httpMethod(),t.error=function(t,s){e&&e(i)},t.success=function(t,s,n){s.rows&&s.rows.length&&(i=s.rows[0].count),e&&e(i)},n.Collection.prototype.fetch.call(this,t)},_getCountSQL:function _getCountSQL(e){return s.template("select count(*) from <%= table %>")({table:this._tableName})},_httpMethod:function _httpMethod(){return"GET"}})},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(818),r=i(817),a=i(10),l=i(13),h=i(1698);e.exports=n.extend({tagName:"div",className:"Table-paginator js-tablePaginator",events:{"click .js-prev":"_onPrevPage","click .js-next":"_onNextPage"},initialize:function initialize(e){if(!e.rowsCollection)throw new Error("rowsCollection is required");if(!e.tableViewModel)throw new Error("tableViewModel is required");this._tableViewModel=e.tableViewModel,this._rowsCollection=e.rowsCollection,this._scrollToBottom=e.scrollToBottom,this._numRows=-1,this._queryUtilsModel=e.queryUtilsModel||new h({tableName:this._rowsCollection._tableName,configModel:this._rowsCollection._configModel}),this._queryUtilsModel.fetchCount(function(e){this._numRows=e,this.render()}.bind(this)),this._rowsCollection.bind("loading",function(e){e.models&&(this._isLoading=!0)},this),this._rowsCollection.bind("add",this._onRowAdded,this),this._rowsCollection.bind("remove",this._onRowRemoved,this),this._tableViewModel.bind("change:page",this._onTablePageChange,this),this.add_related_model(this._tableViewModel),this.add_related_model(this._rowsCollection)},render:function render(){var e=this._rowsCollection.size(),t=this._tableViewModel.get("page"),i=this._rowsCollection.DEFAULT_FETCH_OPTIONS.rows_per_page;return this.$el.html(o({page:this._tableViewModel.get("page"),size:e,isNextAvailable:this._numRows>(t+1)*i,isPrevAvailable:t>0})),this.$el.toggleClass("Table-paginator--relative",!!this._tableViewModel.get("relativePositionated")),this},_onRowAdded:function _onRowAdded(){this._queryUtilsModel.fetchCount(function(e){if(e>-1){var t=this._rowsCollection.DEFAULT_FETCH_OPTIONS.rows_per_page,i=Math.ceil(e/t)-1;i!==this._tableViewModel.get("page")?this._tableViewModel.set("page",i):this.render(),setTimeout(this._scrollToBottom,200)}}.bind(this))},_onRowRemoved:function _onRowRemoved(){this._rowsCollection.fetch({data:this._getData()})},_onTablePageChange:function _onTablePageChange(){this._rowsCollection.fetch({data:this._getData(),error:function(e,t){this._isLoading=!1,this.render(),a.addNotification({status:"error",info:_t("components.table.rows.paginator.error",{error:l(t)}),closable:!0})}.bind(this)})},_getData:function _getData(){return s.extend(this._tableViewModel.pick("page","order_by","sort_order"),{exclude:this._tableViewModel.isCustomQueryApplied()?[]:["the_geom_webmercator"]})},_onPrevPage:function _onPrevPage(e){this._isLoading||(this.$(".js-prev").html(r()),this._tableViewModel.set("page",this._tableViewModel.get("page")-1))},_onNextPage:function _onNextPage(e){this._isLoading||(this.$(".js-next").html(r()),this._tableViewModel.set("page",this._tableViewModel.get("page")+1))}})},function(e,t,i){"use strict";var s=i(10),n=i(13);e.exports=function(e){if(!e.rowModel)throw new Error("rowModel is required");if(void 0===e.newValue)throw new Error("newValue is required");if(!e.attribute)throw new Error("attribute is required");var t=e.rowModel,i=e.newValue,o=e.attribute,r=t.get("cartodb_id"),a=e.onSuccess,l=e.onError,h=s.addNotification({status:"loading",info:_t("components.table.rows.edit.loading",{attribute:o,cartodbId:r}),closable:!1});t.set(o,i),t.save(null,{success:function success(e,t){a&&a(e,t),h.set({status:"success",info:_t("components.table.rows.edit.success",{attribute:o,cartodbId:r}),closable:!0})},error:function error(e,t){l&&l(e,t),h.set({status:"error",info:_t("components.table.rows.edit.error",{attribute:o,cartodbId:r,error:n(t)}),closable:!0})}})}},function(e,t,i){"use strict";var s=i(10),n=i(13);e.exports=function(e){if(!e.rowModel)throw new Error("rowModel is required");var t=e.rowModel,i=e.onSuccess,o=e.onError,r=t.get("cartodb_id"),a=s.addNotification({status:"loading",info:_t("components.table.rows.destroy.loading",{cartodb_id:r}),closable:!1});t.destroy({wait:!0,success:function success(e,t){i&&i(e,t),a.set({status:"success",info:_t("components.table.rows.destroy.success",{cartodb_id:r}),closable:!0})},error:function error(e,t){o&&o(e,t),a.set({status:"error",info:_t("components.table.rows.destroy.error",{cartodb_id:r,error:n(t)}),closable:!0})}})}},function(e,t,i){"use strict";e.exports=function(e){try{return JSON.parse(e).coordinates.join(", ")}catch(e){return!1}}},function(e,t,i){"use strict";var s=i(1),n=i(0),o=i(820),r={geometry:i(1702)},a=["the_geom_webmercator"];e.exports=s.extend({className:"Table-row",tagName:"tr",options:{simpleGeometry:""},initialize:function initialize(e){if(!e.columnsCollection)throw new Error("columnsCollection is required");if(!e.tableViewModel)throw new Error("tableViewModel is required");this._columnsCollection=e.columnsCollection,this._tableViewModel=e.tableViewModel,this.el.setAttribute("data-model",this.model.cid),this._initBinds()},render:function render(){return this.$el.empty(),this._generateRowsHTML(),this},_initBinds:function _initBinds(){this.model.bind("change",this.render,this),this.model.bind("destroy",this.remove,this)},_generateRowsHTML:function _generateRowsHTML(){for(var e=[],t=0,i=this._columnsCollection.size();t<i;t++){var s=this._columnsCollection.at(t).get("name");n.contains(a,s)||(e[t]=this._generateCellHTML(s))}this.el.innerHTML=e.join("")},_generateCellHTML:function _generateCellHTML(e){var t=this.options.simpleGeometry,i=n.first(this._columnsCollection.where({name:e})).get("type"),s=this.model.get(e),a=s;return"geometry"===i?a="point"===t?r[i](s):t&&t.charAt(0).toUpperCase()+t.slice(1):r[i]&&(a=r[i](s)),o({value:s,formattedValue:a,type:i,columnName:e,geometry:t})}})},function(e,t,i){"use strict";var s=i(1),n=i(4),o=i(0),r=i(601),a=i(1703),l=i(273),h=i(174),c=i(819),d=i(1701),u=i(1700),p=i(231),g=i(1699),m=i(816),f=i(11),_=i(186),v=i(815),y=i(1697),b=i(1694),w=i(13),C=i(829),M=i(3),k={string:i(814),number:i(385),boolean:i(1693),date:i(1692),default:i(814)},S=["columnsCollection","modals","queryGeometryModel","querySchemaModel","rowsCollection","tableViewModel"];e.exports=s.extend({className:"Table-body",tagName:"div",events:{click:"_onClick",dblclick:"_onDblClick"},initialize:function initialize(e){M(e,S,this),this._editors=new y,this._closeEditor=this._closeEditor.bind(this),this._hideContextMenu=this._hideContextMenu.bind(this),this._initBinds()},render:function render(){return this.clearSubViews(),this._destroyScrollBinding(),this.$el.empty(),!this._querySchemaModel.isFetched()||this._queryGeometryModel.isFetching()||this._rowsCollection.isFetching()?this._renderQueryState():this._rowsCollection.size()?(this.$el.html(m()),this._rowsCollection.each(this._renderBodyRow,this),this._initPaginator()):this._renderNoRows(),this.$el.toggleClass("Table-body--relative",!!this._tableViewModel.get("relativePositionated")),this},_initBinds:function _initBinds(){this._queryGeometryModel.bind("change:status",this.render,this),this._querySchemaModel.bind("change:status",this.render,this),this._rowsCollection.bind("reset",o.debounce(this.render.bind(this),20),this),this._rowsCollection.bind("add",function(e){1===this._rowsCollection.size()?this.render():this._renderBodyRow(e)},this),this._rowsCollection.bind("remove",this._onRemoveRow,this),this._rowsCollection.bind("fail",function(e,t){(!t||t&&"abort"!==t.statusText)&&this._renderError(w(t))},this),this.add_related_model(this._queryGeometryModel),this.add_related_model(this._querySchemaModel),this.add_related_model(this._rowsCollection)},_renderQueryState:function _renderQueryState(){var e=this._querySchemaModel.get("status"),t=this._querySchemaModel.get("ready"),i=this._queryGeometryModel.get("status"),s=this._rowsCollection.getStatusValue();t&&("unavailable"===e&&"unavailable"===i||"unavailable"===s)?this._renderError(this._querySchemaModel.get("query_errors")):this._renderLoading()},_renderLoading:function _renderLoading(){this.$el.html(f({title:_t("components.table.rows.loading.title")}))},_renderError:function _renderError(e){var t=new _({title:_t("components.table.rows.error.title"),desc:e||_t("components.table.rows.error.desc")});this.addView(t),this.$el.html(t.render().el)},_renderNoRows:function _renderNoRows(){this.$el.html(v({page:this._tableViewModel.get("page"),customQuery:this._tableViewModel.isCustomQueryApplied()}))},_initPaginator:function _initPaginator(){var e=new g({rowsCollection:this._rowsCollection,tableViewModel:this._tableViewModel,scrollToBottom:this._scrollToBottom.bind(this)}),t=n("body");this._tableViewModel.get("relativePositionated")&&(t=this.$el.closest(".Table").parent()),t.append(e.render().el),this.addView(e)},_initScrollBinding:function _initScrollBinding(){n(".Table").scroll(this._hideContextMenu),this.$(".js-tbody").scroll(this._hideContextMenu)},_destroyScrollBinding:function _destroyScrollBinding(){n(".Table").off("scroll",this._hideContextMenu),this.$(".js-tbody").off("scroll",this._hideContextMenu)},_renderBodyRow:function _renderBodyRow(e){var t=new a({model:e,columnsCollection:this._columnsCollection,simpleGeometry:this._queryGeometryModel.get("simple_geom"),tableViewModel:this._tableViewModel});this.addView(t),this.$(".js-tbody").append(t.render().el)},_onRemoveRow:function _onRemoveRow(){if(!this._rowsCollection.size()){this._rowsCollection.resetFetch(),this._queryGeometryModel.resetFetch();var e=this._tableViewModel.get("page");e>0?this._tableViewModel.set("page",e-1):this.render()}},_hasContextMenu:function _hasContextMenu(){return this._menuView},_hideContextMenu:function _hideContextMenu(){this._unhighlightCell(),this._destroyScrollBinding(),this._menuView.collection.unbind(null,null,this),this.removeView(this._menuView),this._menuView.clean(),delete this._menuView},_highlightCell:function _highlightCell(e,t){e.addClass("is-highlighted"),t.addClass("is-highlighted")},_unhighlightCell:function _unhighlightCell(){this.$(".Table-cellItem.is-highlighted, .Table-row.is-highlighted").removeClass("is-highlighted")},_showContextMenu:function _showContextMenu(e){var t=this,i={x:e.clientX,y:e.clientY},s=n(e.target).closest(".Table-row"),o=n(e.target).closest(".Table-cellItem"),r=s.data("model"),a=o.data("attribute"),c=t._rowsCollection.get({cid:r}),d=[];if(d.push({label:_t("components.table.rows.options.copy"),val:"copy",action:function action(){t._copyValue(o)}}),this._tableViewModel.isDisabled()||(d=[{label:_t("components.table.rows.options.edit"),val:"edit",action:function action(){t._editCell(c,a)}},{label:_t("components.table.rows.options.create"),val:"create",action:function action(){t._addRow()}}].concat(d)).push({label:_t("components.table.rows.options.delete"),val:"delete",destructive:!0,action:function action(){t._removeRow(c)}}),!d.length)return!1;var u=new h(d);this._menuView=new l({className:"Table-rowMenu "+l.prototype.className,collection:u,triggerElementID:r,position:i}),this._menuView.$el.css(C({parentView:n("body"),posX:i.x,posY:i.y})),u.bind("change:selected",function(e){var t=e.get("action");t&&t()},this),this._menuView.model.bind("change:visible",function(e,t){this._hasContextMenu()&&!t&&this._hideContextMenu()},this),this._menuView.show(),this.addView(this._menuView),this._highlightCell(o,s),this._initScrollBinding()},_onClick:function _onClick(e){n(e.target).hasClass("js-cellOptions")&&(this._hasContextMenu()?this._hideContextMenu():this._showContextMenu(e))},_onDblClick:function _onDblClick(e){var t=n(e.target).closest(".Table-cellItem"),i=n(e.target).hasClass("js-cellOptions");if(t&&!i){var s=t.closest(".Table-row").data("model"),o=t.data("attribute"),r=this._rowsCollection.get({cid:s});!this._tableViewModel.isDisabled()&&r&&o&&"cartodb_id"!==o&&this._editCell(r,o)}},_copyValue:function _copyValue(e){this._clipboard=new r(e.get(0)),e.click(),this._clipboard.destroy()},_addRow:function _addRow(){c({rowsCollection:this._rowsCollection})},_initEditorScrollBinding:function _initEditorScrollBinding(){n(".Table").scroll(this._closeEditor),this.$(".js-tbody").scroll(this._closeEditor)},_destroyEditorScrollBinding:function _destroyEditorScrollBinding(){n(".Table").unbind("scroll",this._closeEditor),this.$(".js-tbody").unbind("scroll",this._closeEditor)},_closeEditor:function _closeEditor(){this._unhighlightCell(),this._destroyEditorScrollBinding(),this._editors.unbind(null,null,this),this._editors.destroy()},_saveValue:function _saveValue(e,t,i){e.get(t)!==i&&u({rowModel:e,attribute:t,newValue:i})},_doCellEdition:function _doCellEdition(e,t){var i=this.$('[data-model="'+e.cid+'"]'),s=i.find('[data-attribute="'+t+'"]'),n=s.find(".js-cellOptions"),r=o.first(this._columnsCollection.where({name:t})).get("type");this._highlightCell(s,i),this._initEditorScrollBinding();var a=new b({type:r,value:e.get(t)});this._editors.bind("destroyedEditor",this._closeEditor,this),this._editors.bind("confirmedEditor",function(){a.isValid()&&this._saveValue(e,t,a.get("value"))},this);var l=n.offset();s.index()>1&&(l.right=window.innerWidth-l.left,delete l.left),this._rowsCollection.size()>4&&i.index()+2>=this._rowsCollection.size()-1?(l.bottom=window.innerHeight-l.top,delete l.top):l.top=l.top+20;var h=k[r];h||(h=k.default),this._editors.create(function(e){return new h({editorModel:e,model:a})},l)},_editCell:function _editCell(e,t){var i=this._doCellEdition.bind(this,e,t);e.fetchRowIfGeomIsNotLoaded(i)},_removeRow:function _removeRow(e){var t=this;this._modals.create(function(s){return new p({modalModel:s,template:i(812),renderOpts:{cartodb_id:e.get("cartodb_id")},loadingTitle:_t("components.table.rows.destroy.loading",{cartodb_id:e.get("cartodb_id")}),runAction:function runAction(){d({tableViewModel:t._tableViewModel,rowModel:e,onSuccess:function onSuccess(){s.destroy()},onError:function onError(e){s.destroy()}})}})})},_scrollToBottom:function _scrollToBottom(){var e=this.$(".js-tbody").get(0).scrollHeight;this.$(".js-tbody").animate({scrollTop:e},"slow")},clean:function clean(){this._destroyScrollBinding(),s.prototype.clean.apply(this)}})},function(e,t,i){"use strict";var s=i(10),n=i(13);e.exports=function(e){if(!e.columnModel)throw new Error("columnModel is required");var t=e.columnModel,i=e.onSuccess,o=e.onError,r=s.addNotification({status:"loading",info:_t("components.table.columns.destroy.loading",{columnName:t.get("name")}),closable:!1});t.destroy({wait:!0,success:function success(e,s){i&&i(e,s),r.set({status:"success",info:_t("components.table.columns.destroy.success",{columnName:t.get("name")}),closable:!0})},error:function error(e,i){o&&o(e,i),r.set({status:"error",info:_t("components.table.columns.destroy.error",{columnName:t.get("name"),error:n(i)}),closable:!0})}})}},function(e,t,i){"use strict";var s=i(10),n=i(13);e.exports=function(e){if(!e.columnModel)throw new Error("columnModel is required");if(!e.newType)throw new Error("newType is required");var t=e.columnModel,i=e.newType,o=e.onSuccess,r=e.onError,a=s.addNotification({status:"loading",info:_t("components.table.columns.change-type.loading",{columnName:t.get("name")}),closable:!1});t.save({type:i},{wait:!0,success:function success(e,s){o&&o(e,s),a.set({status:"success",info:_t("components.table.columns.change-type.success",{columnName:t.get("name"),newType:i}),closable:!0})},error:function error(e,s){r&&r(e,s),a.set({status:"error",info:_t("components.table.columns.change-type.error",{columnName:t.get("name"),newType:i,error:n(s)}),closable:!0})}})}},function(e,t,i){"use strict";var s=i(10),n=i(13);e.exports=function(e){if(!e.columnModel)throw new Error("columnModel is required");if(!e.newName)throw new Error("newName is required");var t=e.columnModel,i=t.get("name"),o=e.newName,r=e.onSuccess,a=e.onError,l=s.addNotification({status:"loading",info:_t("components.table.columns.rename.loading",{oldName:i,newName:o}),closable:!1});t.save({new_name:o,old_name:t.get("name")},{wait:!0,success:function success(e,t){r&&r(e,t),l.set({status:"success",info:_t("components.table.columns.rename.success",{columnName:i,newName:o}),closable:!0})},error:function error(e,t){a&&a(e,t),l.set({status:"error",info:_t("components.table.columns.rename.error",{columnName:i,newName:o,error:n(t)}),closable:!0})}})}},function(e,t,i){"use strict";var s=i(0),n=i(247),o=i(223),r=i(530);e.exports=n.extend({events:s.extend(n.prototype.events,{"click .js-desc":"_onDescClick","click .js-asc":"_onAscClick","click .js-order":"killEvent"}),render:function render(){return this.$el.empty(),this.clearSubViews(),this.$el.append(this.options.template({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),isOrderBy:this.model.get("isOrderBy"),sortBy:this.model.get("sortBy"),name:this.model.getName(),val:this.model.getValue()})),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this},_onClick:function _onClick(e){this.killEvent(e),"change"===this.model.getValue()?this._openSubContextMenu(e):this.model.set("selected",!0)},_hideSubContextMenu:function _hideSubContextMenu(){this._subContextMenu&&(this._subContextMenu.clean(),this.removeView(this._subContextMenu),delete this.collection,delete this._subContextMenu)},_openSubContextMenu:function _openSubContextMenu(e){this._subContextMenu&&this._hideSubContextMenu();var t="Table-columnTypeMenu ";this.model.get("isLastColumns")&&(t+=" Table-columnTypeMenu--toLeft "),this._subContextMenu=new o({className:t+o.prototype.className,options:[{label:_t("components.table.columns.types.number"),disabled:!r.isTypeChangeAllowed(this.model.get("type"),"number"),val:"number"},{label:_t("components.table.columns.types.string"),disabled:!r.isTypeChangeAllowed(this.model.get("type"),"string"),val:"string"},{label:_t("components.table.columns.types.date"),disabled:!r.isTypeChangeAllowed(this.model.get("type"),"date"),val:"date"},{label:_t("components.table.columns.types.boolean"),disabled:!r.isTypeChangeAllowed(this.model.get("type"),"boolean"),val:"boolean"}],showSearch:!1,typeLabel:""}),this._subContextMenu.collection.bind("change:selected",function(e){e.get("disabled")||this.model.set({type:e.getValue(),selected:!0})},this),this.$el.closest(".Table-columnMenu").append(this._subContextMenu.render().el),this._subContextMenu.show(),this.addView(this._subContextMenu)},_onAscClick:function _onAscClick(e){this.killEvent(e),this.model.set({sort:"asc",selected:!0})},_onDescClick:function _onDescClick(e){this.killEvent(e),this.model.set({sort:"desc",selected:!0})}})},function(e,t,i){"use strict";var s=i(4),n=i(1),o=i(827),r=i(273),a=i(174),l=i(1708),h=i(826),c=i(231),d=i(530),u=i(825),p=i(1707),g=i(1706),m=i(1705);e.exports=n.extend({className:"Table-headItem",tagName:"th",events:{"dblclick .js-attribute":"_onAttributeDblClicked","focusout .js-attribute":"_saveNewName","click .js-columnOptions":"_showContextMenu"},initialize:function initialize(e){if(!e.tableViewModel)throw new Error("tableViewModel is required");if(!e.columnsCollection)throw new Error("columnsCollection is required");if(!e.modals)throw new Error("modals is required");this._tableViewModel=e.tableViewModel,this._columnsCollection=e.columnsCollection,this._modals=e.modals,this._hideContextMenu=this._hideContextMenu.bind(this),this._onKeyDown=this._onKeyDown.bind(this)},render:function render(){this.clearSubViews();var e=this.model.get("name");return this.$el.html(o({name:e,type:this.model.get("type"),isOrderBy:this._tableViewModel.get("order_by")===e,sortBy:this._tableViewModel.get("sort_order"),geometry:this.options.simpleGeometry})),this},_hasContextMenu:function _hasContextMenu(){return this._menuView},_hideContextMenu:function _hideContextMenu(){this._unhighlightHead(),this._destroyScrollBinding(),this._menuView.collection.unbind(null,null,this),this.removeView(this._menuView),this._menuView.clean(),delete this._menuView},_highlightHead:function _highlightHead(){this.$el.addClass("is-highlighted")},_unhighlightHead:function _unhighlightHead(){this.$el.removeClass("is-highlighted")},_initScrollBinding:function _initScrollBinding(){s(".Table").scroll(this._hideContextMenu)},_destroyScrollBinding:function _destroyScrollBinding(){s(".Table").off("scroll",this._hideContextMenu)},_showContextMenu:function _showContextMenu(e){var t=this,i={x:e.clientX,y:e.clientY},s=this.$el.index(),n=this.model.cid,o=this.model.get("name");this._highlightHead();var c=[{label:_t("components.table.columns.options.order"),val:"order",isOrderBy:this._tableViewModel.get("order_by")===o,sortBy:this._tableViewModel.get("sort_order"),action:function action(e){t._tableViewModel.set({sort_order:e.get("sort"),order_by:o})}}];this._tableViewModel.isDisabled()||(this.model.isCartoDBIDColumn()||this.model.isGeometryColumn()||(c=c.concat([{label:_t("components.table.columns.options.rename"),val:"rename",action:function action(){t._startEditing()}},{label:_t("components.table.columns.options.change"),type:this.model.get("type"),isLastColumns:this._columnsCollection.size()-s<3,val:"change",action:function action(e){t._changeColumnType(e.get("type"))}}])),c.push({label:_t("components.table.columns.options.create"),val:"create",action:function action(){t._addColumn()}}),this.model.isCartoDBIDColumn()||this.model.isGeometryColumn()||c.push({label:_t("components.table.columns.options.delete"),val:"delete",destructive:!0,action:function action(){t._removeColumn()}}));var d=new a(c);this._menuView=new r({className:r.prototype.className+" Table-columnMenu",collection:d,itemTemplate:h,itemView:l,triggerElementID:n,position:i}),d.bind("change:selected",function(e){var t=e.get("action");t&&t(e)},this),this._menuView.model.bind("change:visible",function(e,t){this._hasContextMenu()&&!t&&this._hideContextMenu()},this),this._menuView.show(),this.addView(this._menuView),this._initScrollBinding()},_addColumn:function _addColumn(){u({columnsCollection:this._columnsCollection})},_changeColumnType:function _changeColumnType(e){var t=this,s=this.model.get("type");d.isTypeChangeDestructive(s,e)?this._modals.create(function(s){return new c({modalModel:s,template:i(824),renderOpts:{columnName:t.model.get("name"),newType:e},loadingTitle:_t("components.table.columns.change-type.loading",{columnName:t.model.get("name")}),runAction:function runAction(){g({columnModel:t.model,newType:e,onSuccess:function onSuccess(){s.destroy()},onError:function onError(e){s.destroy()}})}})}):g({columnModel:this.model,newType:e})},_removeColumn:function _removeColumn(){var e=this;this._modals.create(function(t){return new c({modalModel:t,template:i(823),renderOpts:{name:e.model.get("name")},loadingTitle:_t("components.table.columns.destroy.loading",{columnName:e.model.get("name")}),runAction:function runAction(){m({columnModel:e.model,onSuccess:function onSuccess(){t.destroy()},onError:function onError(e){t.destroy()}})}})})},_onAttributeDblClicked:function _onAttributeDblClicked(){this.model.isEditable()&&!this._tableViewModel.isDisabled()&&this._startEditing()},_initRenameBinds:function _initRenameBinds(){s(document).bind("keydown",this._onKeyDown)},_destroyRenameBinds:function _destroyRenameBinds(){s(document).unbind("keydown",this._onKeyDown)},_onKeyDown:function _onKeyDown(e){var t=e.which;13===t?this._saveNewName():27===t&&this._finishEditing()},_startEditing:function _startEditing(){this.$(".js-attribute").addClass("is-active").removeAttr("readonly"),this._initRenameBinds()},_finishEditing:function _finishEditing(){this.$(".js-attribute").val(this.model.get("name")).removeClass("is-active").attr("readonly",""),this._destroyRenameBinds()},_saveNewName:function _saveNewName(){if(this.model.isEditable()){var e=this.$(".js-attribute").val(),t=this.model,s=t.get("name");s!==e&&""!==e&&this._modals.create(function(n){return new c({modalModel:n,template:i(822),renderOpts:{columnName:s,newName:e},loadingTitle:_t("components.table.columns.rename.loading",{columnName:s,newName:e}),runAction:function runAction(){p({columnModel:t,newName:e,onSuccess:function onSuccess(){n.destroy()},onError:function onError(e){n.destroy()}})}})})}this._finishEditing()},focusInput:function focusInput(){this._startEditing(),this.$(".js-attribute").select()},clean:function clean(){this._destroyRenameBinds(),this._destroyScrollBinding(),n.prototype.clean.apply(this)}})},function(e,t,i){"use strict";var s=i(4),n=i(0),o=i(1),r=i(1709),a=i(821),l=["the_geom_webmercator"];e.exports=o.extend({className:"Table-head",tagName:"table",initialize:function initialize(e){if(!e.columnsCollection)throw new Error("columnsCollection is required");if(!e.tableViewModel)throw new Error("tableViewModel is required");if(!e.queryGeometryModel)throw new Error("queryGeometryModel is required");if(!e.modals)throw new Error("modals is required");this._columnsCollection=e.columnsCollection,this._tableViewModel=e.tableViewModel,this._queryGeometryModel=e.queryGeometryModel,this._modals=e.modals,this._lastHeadItemView=null,this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.append(a()),this._columnsCollection.each(this._renderColumnHead,this),this},_initBinds:function _initBinds(){this._queryGeometryModel.bind("change:simple_geom",this.render,this),this.add_related_model(this._queryGeometryModel),this._tableViewModel.bind("change:sort_order change:order_by",this.render,this),this.add_related_model(this._tableViewModel),this._columnsCollection.bind("reset",function(){if(this.render(),this._newColumn){var e=this.$el.get(0).scrollWidth;setTimeout(function(){this._scrollToLeft({pos:e}),this._focusLastHeadItem()}.bind(this),500),delete this._newColumn}},this),this._columnsCollection.bind("add",function(e){this._newColumn=e},this),this.add_related_model(this._columnsCollection)},_renderColumnHead:function _renderColumnHead(e){var t=e.get("name");if(!n.contains(l,t)){var i=new r({model:e,modals:this._modals,columnsCollection:this._columnsCollection,tableViewModel:this._tableViewModel,simpleGeometry:this._queryGeometryModel.get("simple_geom")});this.$(".js-headRow").append(i.render().el),this.addView(i),this._lastHeadItemView=i}},_scrollToLeft:function _scrollToLeft(e){e=e||{},s(".Table").animate({scrollLeft:e.pos||0},e.speed||"slow")},_focusLastHeadItem:function _focusLastHeadItem(){this._lastHeadItemView&&this._lastHeadItemView.focusInput()}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({defaults:{page:0,order_by:"",sort_order:"",readonly:!1,tableName:""},initialize:function initialize(e,t){if(!t.analysisDefinitionNodeModel)throw new Error("analysisDefinitionNodeModel is required");if(!t.columnsCollection)throw new Error("columnsCollection is required");this._analysisDefinitionNodeModel=t.analysisDefinitionNodeModel,this._columnsCollection=t.columnsCollection,this._setOrderAndSort(),this.listenTo(this._columnsCollection,"reset",this._setOrderAndSort)},_setOrderAndSort:function _setOrderAndSort(){this._columnsCollection.where({name:"cartodb_id"}).length&&!this.isCustomQueryApplied()&&this.set({order_by:"cartodb_id",sort_order:"asc"},{silent:!0})},resetFetchDefaults:function resetFetchDefaults(){this.set({page:this.defaults.page,order_by:"",sort_order:""},{silent:!0})},isDisabled:function isDisabled(){return this._analysisDefinitionNodeModel.isReadOnly()},isCustomQueryApplied:function isCustomQueryApplied(){return this._analysisDefinitionNodeModel.isCustomQueryApplied()}})},function(e,t,i){"use strict";var s=i(1),n=i(0),o=i(4),r=i(1711),a=i(1710),l=i(1704),h=i(819),c=i(825),d=i(276),u=i(3),p=["analysisDefinitionNodeModel","columnsCollection","modals"];e.exports=s.extend({className:"Table-wrapper",tagName:"div",initialize:function initialize(e){u(e,p,this),this._rowsCollection=this._analysisDefinitionNodeModel.queryRowsCollection,this._queryGeometryModel=this._analysisDefinitionNodeModel.queryGeometryModel,this._querySchemaModel=this._analysisDefinitionNodeModel.querySchemaModel,this._tableModel=this._analysisDefinitionNodeModel.isSourceType()&&this._analysisDefinitionNodeModel.getTableModel(),this._tableViewModel=new r({relativePositionated:e.relativePositionated,tableName:e.tableName},{analysisDefinitionNodeModel:this._analysisDefinitionNodeModel,columnsCollection:this._columnsCollection}),this._initBinds(),this._querySchemaModel.shouldFetch()?this._querySchemaModel.fetch():this._rowsCollection.shouldFetch()&&this._fetchRowsData()},render:function render(){this.clearSubViews(),this.$el.empty();var e=o("<div>").addClass("Table js-table");return this.$el.append(e),this._initViews(),this.$(".js-table").toggleClass("Table--relative",!!this._tableViewModel.get("relativePositionated")),this._setDisableState(),this},_initBinds:function _initBinds(){if(this._onChangeQueryOrStatus=this._onChangeQueryOrStatus.bind(this),this.listenTo(this._querySchemaModel,"change:query change:status",n.debounce(this._onChangeQueryOrStatus,100)),this.listenTo(this._querySchemaModel,"change:status",this._setDisableState),this.listenTo(this._querySchemaModel,"change:query",this._onQueryChanged),this.listenTo(this._querySchemaModel,"change:status",this._fetchRowsData),this.listenTo(this._tableViewModel,"change:sort_order change:order_by",this._fetchRowsData),this._tableModel&&this._tableModel.isSync()){var e=this._tableModel.getSyncModel();this.listenTo(e,"destroy",this.render)}},_setDisableState:function _setDisableState(){this.$(".js-table").toggleClass("is-disabled",!!this._tableViewModel.isDisabled())},_fetchRowsData:function _fetchRowsData(e){var t=e&&n.keys(e.changed),i=d.altersData(this._querySchemaModel.get("query")),s=this._tableViewModel.isCustomQueryApplied(),o=!1;t&&(n.contains(t,"sort_order")||n.contains(t,"order_by"))&&(o=!0),this._querySchemaModel.isFetched()&&!i&&this._rowsCollection.fetch({data:{page:this._tableViewModel.get("page"),order_by:!s||o?this._tableViewModel.get("order_by"):"",sort_order:!s||o?this._tableViewModel.get("sort_order"):"",exclude:!s||o?["the_geom_webmercator"]:[]}})},_initViews:function _initViews(){var e=new a({modals:this._modals,queryGeometryModel:this._queryGeometryModel,columnsCollection:this._columnsCollection,tableViewModel:this._tableViewModel});this.addView(e),this.$(".js-table").append(e.render().el);var t=new l({modals:this._modals,columnsCollection:this._columnsCollection,rowsCollection:this._rowsCollection,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel,tableViewModel:this._tableViewModel});this.addView(t),this.$(".js-table").append(t.render().el)},_onChangeQueryOrStatus:function _onChangeQueryOrStatus(){var e=this._querySchemaModel.get("status"),t=this._queryGeometryModel.get("status");"unfetched"===e&&this._querySchemaModel.canFetch()&&this._querySchemaModel.fetch(),"unfetched"===t&&this._queryGeometryModel.canFetch()&&this._queryGeometryModel.fetch()},addRow:function addRow(){h({rowsCollection:this._rowsCollection})},addColumn:function addColumn(){c({columnsCollection:this._columnsCollection})},getColumnsCollection:function getColumnsCollection(){return this._columnsCollection},_onQueryChanged:function _onQueryChanged(){this._tableViewModel.resetFetchDefaults()},remove:function remove(){o(".Table-paginator").remove(),s.prototype.remove.apply(this)}})},,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(0),n=i(832);e.exports=n.extend({initialize:function initialize(){n.prototype.initialize.apply(this,arguments),this.set("password","!@#!@#")},_attrsToSave:function _attrsToSave(){var e=n.prototype._attrsToSave.call(this);return"!@#!@#"===e.password&&delete e.password,e},canSave:function canSave(){return!this.get("disabled")&&!s.isEmpty(this.get("password"))},isPassword:function isPassword(){return!0}})},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(834),r=s.template("<a href='mailto:<%- mail %>'><%- contact %></a>")({contact:_t("components.modals.publish.privacy.upgrade.contact"),mail:_t("components.modals.publish.privacy.upgrade.mail")});e.exports=n.extend({render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function _initViews(){var e=o({title:_t("components.modals.publish.privacy.upgrade.title"),desc:_t("components.modals.publish.privacy.upgrade.desc",{contact:r})});this.$el.html(e)}})},function(e,t,i){"use strict";var s=i(4),n=i(5),o=i(2),r=i(1),a=i(0),l=i(578),h=i(55),c=i(233),d=i(836),u=["visDefinitionModel","mapcapsCollection","configModel","userModel"];e.exports=r.extend({events:{"click .js-button":"_onUpdate"},initialize:function initialize(e){a.each(u,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),this._modals=new h,this.model=new o.Model({status:"idle"}),this._initBinds()},render:function render(){var e=this._mapcapsCollection.length>0?_t("components.modals.publish.share.last-published",{date:"updated"===this.model.get("status")?n(this._mapcapsCollection.first().get("created_at")).fromNow():n(this._mapcapsCollection.first().get("created_at")).format("Do MMMM YYYY, HH:mm")}):_t("components.modals.publish.share.unpublished");return this.clearSubViews(),this.$el.html(d({isPublished:this._isPublished(),isLoading:this._isLoading(),isDisabled:this._isDisabled(),publishedOn:e})),this},_initBinds:function _initBinds(){this._mapcapsCollection.on("reset",this.render,this),this.add_related_model(this._mapcapsCollection),this.model.on("change:status",this.render,this)},_isPublished:function _isPublished(){return this._mapcapsCollection.length>0},_isLoading:function _isLoading(){return"loading"===this.model.get("status")},_isDisabled:function _isDisabled(){return"updated"===this.model.get("status")},_onUpdate:function _onUpdate(){var e=this,t=this._visDefinitionModel.mapcapsURL(),i={api_key:this._configModel.get("api_key")};if(this._isDisabled())return!1;this._shouldShowPrivacyWarning()?this._checkPrivacyChange(this._visDefinitionModel.get("privacy"),function(){e._createMapCap(t,i)}):this._createMapCap(t,i)},_checkPrivacyChange:function _checkPrivacyChange(e,t,i){this._modals.create(function(s){return new l({modalModel:s,privacyType:e,onConfirm:t,onDismiss:i})})},_createMapCap:function _createMapCap(e,t){var i=this;this.model.set({status:"loading"}),s.post(e,t).done(function(e){i._visDefinitionModel.set("visChanges",0),i._mapcapsCollection.add(e,{at:0}),i.model.set({status:"updated"})}).fail(function(){i.model.set({status:"error"})})},_shouldShowPrivacyWarning:function _shouldShowPrivacyWarning(){return this._userModel.canSelectPremiumOptions(this._visDefinitionModel)&&!this._isPublished()&&c.isPubliclyAvailable(this._visDefinitionModel.get("privacy"))},clean:function clean(){this._modals.destroy(),r.prototype.clean.apply(this,arguments)}})},function(e,t,i){"use strict";var s=i(1),n=i(839),o=i(0),r=["onBack","onEdit"];e.exports=s.extend({className:"Editor-boxModal Editor-PrivacyDialog",events:{"click .js-back":"_onClickBack","keyup .js-input":"_onKeyUpInput"},initialize:function initialize(e){o.each(r,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this)},render:function render(){return this.$el.empty(),this.$el.html(n()),this},_onKeyUpInput:function _onKeyUpInput(e){27===e.which&&this._onBack(),13===e.which&&this._onEdit&&this._onEdit(this.getValue())},_onClickBack:function _onClickBack(){this._onBack()},getValue:function getValue(){return this.$(".js-input").val()}})},function(e,t,i){"use strict";var s=i(1),n=i(491),o=i(247),r=i(840),a=i(0),l=["model","collection","userModel","configModel"];e.exports=s.extend({className:"Editor-boxModal Privacy-dialog",initialize:function initialize(e){a.each(l,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this)},render:function render(){return this.$el.empty(),this.clearSubViews(),this._renderList(),this},_renderList:function _renderList(){var e=this._collection.where({disabled:!0}),t=this._configModel.get("cartodb_com_hosted"),i=this._configModel.get("upgrade_url"),s=new n({model:this._model,collection:this._collection,itemView:o});this.$el.append(s.render().el),this.addView(s),e.length>0&&!t&&i&&this.$el.append(r({upgradeURL:i,showTrial:this._userModel.canStartTrial()}))}})},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(601),r=i(843),a=i(842),l=s.template("<span class='CDB-Text CDB-Size-small is-semibold u-errorTextColor'><%- private %></span>.<br>")({private:_t("components.modals.publish.share.private")});e.exports=n.extend({className:"Card",tagName:"li",events:{"click .js-change-privacy":"_onChangePrivacyClick"},initialize:function initialize(e){if(!e.model)throw new Error("model is required");if(null==e.isPublished)throw new Error("isPublished is required");this._isPublished=e.isPublished,this._type=this.model.type(),this._hasOrganization=e.hasOrganization,this._title=_t("components.modals.publish.share."+this._type+".title"),this.model.isPrivate()?this._body=_t("components.modals.publish.share."+this._type+".private.body",{private:l}):this._body=_t("components.modals.publish.share."+this._type+".body"),this._link=_t("components.modals.publish.share."+this._type+".link"),this._copy=this._getButtonLabel(),this.$el.toggleClass("is-disabled",this.model.isPrivate())},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),!this.model.isPrivate()&&this._isPublished&&this._initClipboard(),this},_getButtonLabel:function _getButtonLabel(){var e=a(),t=_t("components.modals.publish.share."+this._type+".copy");return"Safari"===e.name&&(t=_t("components.modals.publish.share."+this._type+".select")),t},getValue:function getValue(){return this.$(".js-input").val()},_initViews:function _initViews(){var e=r({id:this.cid,isPrivate:this.model.isPrivate(),type:this._type,title:this._title,body:this._body,content:this.model.content(),link:this._link,copy:this._copy,url:this.model.url(),isPublished:this._isPublished});this.$el.append(e);var t=this.model.createIcon();this.$(".js-icon").append(t())},_initClipboard:function _initClipboard(){this._clipboard&&this._clipboard.destroy();var e=this.$(".js-copy");this._clipboard=new o(e.get(0))},_onChangePrivacyClick:function _onChangePrivacyClick(e){this.killEvent(e),this.options.onChangePrivacy&&this.options.onChangePrivacy()},clean:function clean(){this._clipboard&&this._clipboard.destroy(),n.prototype.clean.call(this)}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({createIcon:function createIcon(){return this.get("createIcon")},type:function type(){return this.get("type")},content:function content(){return this.get("content")},url:function url(){return this.get("url")},isPrivate:function isPrivate(){return this.get("private")}})},function(e,t,i){"use strict";var s=i(2),n=i(1731);e.exports=s.Collection.extend({model:n})},function(e,t,i){"use strict";var s=i(845),n=i(844);e.exports=function(e){return[{createIcon:function createIcon(){return s()},type:"get-link",content:e.embedURL(),private:"PRIVATE"===e.get("privacy")},{createIcon:function createIcon(){return n()},type:"embed",content:'<iframe width="100%" height="520" frameborder="0" src="'+encodeURI(e.embedURL())+'" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>',url:encodeURI(e.embedURL()),private:"PRIVATE"===e.get("privacy")}]}},function(e,t,i){"use strict";var s=i(1),n=i(1733),o=i(1732),r=i(1730),a=i(841),l=i(3),h=["visDefinitionModel","mapcapsCollection","userModel"];e.exports=s.extend({className:"Publish-modalShare u-inner",initialize:function initialize(e){l(e,h,this),this.hasOrganization=this._userModel.isInsideOrg();var t=n(this._visDefinitionModel);this._shareCollection=new o(t),this._initBinds()},render:function render(){var e=this._mapcapsCollection.length>0;return this.clearSubViews(),this.$el.html(a({isPublished:e})),this._initViews(),this},_initViews:function _initViews(){var e=this._renderItemView.bind(this);this._shareCollection.each(e)},_renderItemView:function _renderItemView(e){var t=this._mapcapsCollection.length>0,i=new r({model:e,isPublished:t,hasOrganization:this.hasOrganization});this.$(".js-list").append(i.render().el),this.addView(i)},_revampPrivacyOptions:function _revampPrivacyOptions(){var e=n(this._visDefinitionModel);this._shareCollection.reset(e)},_initBinds:function _initBinds(){this._visDefinitionModel.on("sync",this._revampPrivacyOptions,this),this.add_related_model(this._visDefinitionModel),this._shareCollection.on("reset",this.render,this),this.add_related_model(this._shareCollection),this._mapcapsCollection.on("reset add",this.render,this),this.add_related_model(this._mapcapsCollection)}})},,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(865);e.exports=s.extend({defaults:{vertical_offset:0,horizontal_offset:0,position:"top|center",template_name:"",template:""},TEMPLATES:{tooltip_dark:i(856),tooltip_light:i(855),custom_tooltip_dark:i(854),custom_tooltip_light:i(853)},setDefault:function setDefault(){this.setTemplate(this.defaults.template_name)}})},function(e,t,i){"use strict";var s=i(865);e.exports=s.extend({defaults:{template_name:"",latlng:[0,0],offset:[28,0],maxHeight:180,autoPan:!0,template:"",content:"",visibility:!1,alternative_names:{},fields:null,width:226,headerColor:{color:{fixed:"#35AAE5",opacity:1}}},TEMPLATES:{infowindow_light:i(864),infowindow_dark:i(863),infowindow_color:i(862),infowindow_header_with_image:i(861),custom_infowindow_light:i(860),custom_infowindow_dark:i(859),custom_infowindow_color:i(858),custom_infowindow_header_with_image:i(857)},_transformTemplate:function _transformTemplate(e){var t=this.get("headerColor").color.fixed;return e.replace("background: #35AAE5","background: "+t)},setTemplate:function setTemplate(e){var t=void 0===this.TEMPLATES[e]?"":this.TEMPLATES[e];"infowindow_color"===e&&(t=this._transformTemplate(t));var i={template_name:e,template:t,template_type:"mustache"};""===e&&(i.fields=[]),this.set(i)},isEmptyTemplate:function isEmptyTemplate(){var e=0===this.fieldCount();return this.hasTemplate()&&e},setDefault:function setDefault(){this.setTemplate(this.defaults.template_name)}})},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(386);e.exports=s.Model.extend({defaults:{content:""},initialize:function initialize(e,t){this._history=this._generateHistory(t&&t.history),o.init(this,{track:!0,history:this._history})},_generateHistory:function _generateHistory(e){return!(!e||!e.length)&&n.reduce(e,function(e,t){return e.push({content:t}),e},[],this)},getHistory:function getHistory(){return n.pluck(this.getUndoHistory(),"content")}})},function(e,t,i){"use strict";var s=i(2),n=i(386),o=i(0);e.exports=s.Model.extend({defaults:{content:""},initialize:function initialize(e,t){this._history=this._generateHistory(t&&t.history),n.init(this,{track:!0,history:this._history})},_generateHistory:function _generateHistory(e){return!(!e||!e.length)&&o.reduce(e,function(e,t){return e.push({content:t}),e},[],this)},getHistory:function getHistory(){return o.pluck(this.getUndoHistory(),"content")}})},,function(e,t,i){"use strict";var s=i(0),n=i(294),o=i(236);e.exports=s.defaults({_getAggrAttrs:function _getAggrAttrs(e){return{aggregation:{dataset:"countries",change:"manual",value:{operator:"count",attribute:""}}}},_getFillAttrs:function _getFillAttrs(e){return{fill:{color:{attribute:"agg_value_density",bins:"5",quantification:"quantiles",range:s.clone(o.Emrld[5])}}}}},n)},function(e,t,i){"use strict";var s=i(0),n=i(872);e.exports=s.defaults({_getAggrAttrs:function _getAggrAttrs(e){return{aggregation:{size:12,value:{operator:"count",attribute:""}}}}},n)},function(e,t,i){"use strict";var s=i(0),n=i(294);e.exports=s.defaults({generateAttributes:function generateAttributes(e){return s.extend(this._getStyleTypeAttrs(),this._getFillAttrs(e),this._getStrokeAttrs(e),{blending:"lighter"},this._getAggrAttrs(e),this._getAnimatedAttrs(e))},_getStyleTypeAttrs:function _getStyleTypeAttrs(){return{style:"simple"}},_getAnimatedAttrs:function _getAnimatedAttrs(e){return{animated:{attribute:null,overlap:!1,duration:30,steps:256,trails:2,resolution:4}}},_getAggrAttrs:function _getAggrAttrs(e){return{aggregation:{}}}},n)},function(e,t,i){"use strict";var s=i(0),n=i(294),o=i(236);e.exports=s.defaults({generateAttributes:function generateAttributes(e){return s.extend(this._getFillAttrs(e),this._getAggrAttrs(),this._getAnimatedAttrs(),this._getLabelsAttrs())},_getFillAttrs:function _getFillAttrs(e){return{fill:{size:{fixed:45},color:{attribute:"cartodb_id",range:o.ag_Sunset[7],bins:6}}}},_getAggrAttrs:function _getAggrAttrs(){return{aggregation:{}}},_getAnimatedAttrs:function _getAnimatedAttrs(e){return{animated:{attribute:"cartodb_id",overlap:!1,duration:30,steps:1,trails:0,resolution:4}}},_getLabelsAttrs:function _getLabelsAttrs(){return{labels:{}}}},n)},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(387),r=i(185),a=i(386);e.exports=s.Model.extend({parse:function parse(e){return e=e||{},n.extend({type:e.type,autogenerated:e&&e.autogenerated},e.properties)},initialize:function initialize(e,t){this.get("type")||this.setDefaultPropertiesByType(r.Type.SIMPLE,"point"),a.init(this,{track:!0})},resetPropertiesFromAutoStyle:function resetPropertiesFromAutoStyle(){this._stylesPreAutoStyle&&(delete this.attributes.autoStyle,this.set(this._stylesPreAutoStyle),this.removeStylesPreAutoStyle())},removeStylesPreAutoStyle:function removeStylesPreAutoStyle(){delete this._stylesPreAutoStyle},setPropertiesFromAutoStyle:function setPropertiesFromAutoStyle(e){if(!e.definition)throw new Error("definition is required");if(!e.geometryType)throw new Error("geometryType is required");if(!e.widgetId)throw new Error("widgetId is required");this._stylesPreAutoStyle||(this._stylesPreAutoStyle=JSON.parse(JSON.stringify(this.attributes))),delete this.attributes.autoStyle;var t=function(e,t){var i=this.get(e);if(t.color&&t.color.domain){var s=n.compact(n.map(t.color.domain,function(e){return e&&!0!==e?'"'+e.toString().replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':e}));t.color.static=!0,t.color.domain=s,t.color.quantification="category",t.color.attribute_type="string"}else t.color.bins=t.color.range.length,t.color.quantification="quantiles",t.color.attribute_type="number";return i=n.extend(i,t)}.bind(this),i=JSON.parse(JSON.stringify(this.attributes)),s=e.geometryType,o=e.definition[s];o&&("line"===s?i.stroke=t("stroke",o):i.fill=t("fill",o)),this.set(n.extend({type:r.Type.SIMPLE,autoStyle:e.widgetId},i))},setDefaultPropertiesByType:function setDefaultPropertiesByType(e,t,i){this.set(n.extend({type:e},o.getDefaultStyleAttrsByType(e,t)),{silently:!!i}),i&&this.trigger("style:update")},setFill:function setFill(e){var t=o.getDefaultStyleAttrsByType(e,"point");this.set("fill",t.fill)},applyLastState:function applyLastState(){this._undoManager.stopTracking(),this.trigger("change"),this._undoManager.startTracking()},resetStyles:function resetStyles(){this.setDefaultPropertiesByType(r.Type.NONE,"")},isAutogenerated:function isAutogenerated(){return this.get("autogenerated")},isAggregatedType:function isAggregatedType(){return n.contains(o.getAggregationTypes(),this.get("type"))},isAnimation:function isAnimation(){return this.get("type")===r.Type.ANIMATION},hasNoneStyles:function hasNoneStyles(){return this.get("type")===r.Type.NONE},canApplyAutoStyle:function canApplyAutoStyle(){return this.get("type")===r.Type.SIMPLE},getColumnsUsedForStyle:function getColumnsUsedForStyle(){var e=this._getFillColumns(),t=this._getStrokeColumns(),i=this._getLabelColumns(),s=this._getAggregationColumns();return[].concat(e,t,i,s)},toJSON:function toJSON(){return{type:this.get("type"),properties:n.omit(this.attributes,"type","autogenerated")}},_getFillColumns:function _getFillColumns(){var e=[],t=this.get("fill");return t&&t.color&&t.color.attribute&&e.push({name:t.color.attribute,type:t.color.attribute_type||"string"}),t&&t.size&&t.size.attribute&&e.push({name:t.size.attribute,type:"number"}),e},_getStrokeColumns:function _getStrokeColumns(){var e=[],t=this.get("stroke");return t&&t.color&&t.color.attribute&&e.push({name:t.color.attribute,type:t.color.attribute_type||"string"}),t&&t.size&&t.size.attribute&&e.push({name:t.size.attribute,type:"number"}),e},_getLabelColumns:function _getLabelColumns(){var e=[],t=this.get("labels");return t&&t.attribute&&t.enabled&&e.push({name:t.attribute}),e},_getAggregationColumns:function _getAggregationColumns(){var e=[],t=this.get("aggregation");return t&&t.value&&t.value.attribute&&e.push({name:t.value.attribute,type:t.value.attribute_type||"string"}),e}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(877),r=i(876),a=i(276),l=i(277),h=s.template("SELECT * FROM <%= tableName %>"),c=s.template("SELECT * FROM (<%= sql %>) __wrapped");e.exports=o.extend({defaults:{query:"",sort_order:"asc",rows_per_page:0,page:0,status:l.initial,ready:!1},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");o.prototype.initialize.call(this,e,t),this._configModel=t.configModel,this.columnsCollection=new n.Collection([]),this.rowsCollection=new r([]),this.get("status")===l.initial&&this._setStatusPerQueryValue(),this._addChangeListener()},url:function url(){return this._configModel.getSqlApiUrl()},fetch:function fetch(e){if(this.canFetch()){this.set("status",l.fetching),(e=e||{}).errorCallback=e&&(e.originalError||e.error);var t=e&&(e.success||e.complete);return e.data=s.extend(e.data||{},{sort_order:this.get("sort_order"),rows_per_page:this.get("rows_per_page"),page:this.get("page"),api_key:this._configModel.get("api_key"),q:this._getSqlApiQueryParam()}),e.method=this._httpMethod(),e.success=function(e,i){this._resetRepeatedError(),t&&t(i)}.bind(this),e.error=function(t,i){if(i&&"abort"!==i.statusText){var s=i.responseText?JSON.parse(i.responseText).error:[];this._incrementRepeatedError(),this.set({query_errors:s,status:this.hasRepeatedErrors()?l.errored:l.unavailable}),e.errorCallback&&e.errorCallback({status:i.status||"Unknown",error:s})}}.bind(this),n.Model.prototype.fetch.call(this,e)}},parse:function parse(e){return this.rowsCollection.reset(e.rows),this.columnsCollection.reset(s.map(e.fields,function(e,t){return{name:t,type:e.type}})),{status:l.fetched}},hasDefaultQueryFor:function hasDefaultQueryFor(e){if(!this.hasQuery())return!1;var t=h({tableName:e});return a.isSameQuery(this.get("query"),t)},getColumnNames:function getColumnNames(){return this.columnsCollection.pluck("name")},getColumnType:function getColumnType(e){return this.isFetched()?this.columnsCollection.findWhere({name:e}).get("type"):void 0},_onChange:function _onChange(){this._removeChangeListener(),this.hasChanged("status")||this.get("status")!==l.fetching?this.hasChanged("query")&&(this.columnsCollection.reset(),this._setStatusPerQueryValue()):this.fetch(),this._addChangeListener()},_setStatusPerQueryValue:function _setStatusPerQueryValue(){this.set("status",this.get("query")?l.unfetched:l.unavailable,{silent:!0})},setError:function setError(e){var t=this.get("query_errors");t&&t.length||(this._incrementRepeatedError(),this.set({query_errors:e,status:this.hasRepeatedErrors()?l.errored:l.unavailable}))},hasDifferentSchemaThan:function hasDifferentSchemaThan(e){return!s.every(e,function(e){var t=this.columnsCollection.findWhere({name:e.name});return t&&(t.get("type")===e.type||null==e.type)},this)},resetDueToAlteredData:function resetDueToAlteredData(){this.set("status",l.unfetched),this.trigger("resetDueToAlteredData"),this.fetch()},_getSqlApiQueryParam:function _getSqlApiQueryParam(){return c({sql:this.get("query")})}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(877),r=i(277),a=s.template("SELECT CASE LOWER(ST_GeometryType(<%= geom_column %>))      WHEN 'st_polygon' THEN 'polygon'      WHEN 'st_multipolygon' THEN 'polygon'      WHEN 'st_multilinestring' THEN 'line'      WHEN 'st_linestring' THEN 'line'      WHEN 'st_multipoint' THEN 'point'      WHEN 'st_point' THEN 'point'      ELSE ''   END AS the_geom FROM (<%= sql %>) __wrapped WHERE <%= geom_column %> IS NOT NULL"),l={sort_order:"asc",rows_per_page:40,page:0},h="polygon";e.exports=o.extend({defaults:{query:"",status:r.initial,simple_geom:"",ready:!1},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");o.prototype.initialize.call(this,e,t),this._configModel=t.configModel,this._addChangeListener()},url:function url(){return this._configModel.getSqlApiUrl()},fetch:function fetch(e){if(this.canFetch()){this.set("status",r.fetching),(e=e||{}).errorCallback=e&&(e.originalError||e.error);var t=e&&(e.success||e.complete);return e.data=s.extend(e.data||{},{api_key:this._configModel.get("api_key"),q:this._getSqlApiQueryParam(e.geomColumnName)},l),e.method=this._httpMethod(),e.success=function(e,i){this._resetRepeatedError(),t&&t(i)}.bind(this),e.error=function(t,i){if(i&&"abort"!==i.statusText){var n=i.responseText?JSON.parse(i.responseText).error:[];1===n.length&&'column "the_geom" does not exist'===n[0]?this.fetch(s.extend({},s.omit(e,"success"),{originalError:e.errorCallback,geomColumnName:"the_geom_webmercator"})):(this._incrementRepeatedError(),this.set({simple_geom:"",query_errors:n,status:this.hasRepeatedErrors()?r.errored:r.unavailable}),e.errorCallback&&e.errorCallback({status:i.status||"Unknown",error:n}))}}.bind(this),n.Model.prototype.fetch.call(this,e)}},parse:function parse(e){var t;return s.some(e.rows,function(e){return!!(t=e.the_geom)}),{status:r.fetched,simple_geom:t||""}},hasValue:function hasValue(){throw new Error("QueryGeometryModel.hasValue() is an async operation. Use `.hasValueAsync` instead.")},hasValueAsync:function hasValueAsync(){var e=this;return this.isFetched()?Promise.resolve(!!this.get("simple_geom")):new Promise(function(t){e.listenToOnce(e,"inFinalStatus",function(){t(!!e.get("simple_geom"))})})},_onChange:function _onChange(){this._removeChangeListener(),this.hasChanged("status")||this.get("status")!==r.fetching?(this.hasChanged("query")||this.hasChanged("ready"))&&this.set("status",this.get("query")?r.unfetched:r.unavailable,{silent:!0}):this.hasChanged("query")&&this.fetch(),this._addChangeListener()},_getSqlApiQueryParam:function _getSqlApiQueryParam(e){return a({geom_column:e||"the_geom",sql:this.get("query")})},isPolygon:function isPolygon(){return this.get("simple_geom")===h}})},,,,,,,,,,,,,,function(e,t,i){var s=i(389),n=i(0);e.exports=s.extend({defaults:{normalized:!0,animated:!1},defaultState:n.extend({normalized:!1},s.prototype.defaultState),getState:function(){var e,t,i=s.prototype.getState.call(this),o=this.dataviewModel.get("start"),r=this.dataviewModel.get("end"),a=this.dataviewModel.get("data"),l=this.get("lo_index"),h=this.get("hi_index"),c=function(e,t){return!!(n.isNumber(e)&&n.isNumber(t)&&e!==t&&Math.abs(e-t)>.01*Math.abs(o-r))};return n.isNumber(l)&&n.isNumber(h)&&l<a.length&&h-1<a.length?(e=a[l].start,t=a[h-1].end):(e=o,t=r),c(o,e)&&(i.min=e),c(r,t)&&(i.max=t),i}})},function(e,t,i){var s=i(0),n=i(389);e.exports=n.extend({defaults:{normalized:!0},defaultState:s.extend({autoStyle:!1,normalized:!1},n.prototype.defaultState),initialize:function(e,t){n.prototype.initialize.apply(this,arguments),this.on("change:collapsed",this._onCollapsedChange,this),this.on("change:style",this._updateAutoStyle,this),this.dataviewModel.once("change",function(){this.get("autoStyle")&&this.autoStyle()},this)},_onCollapsedChange:function(e,t){this.dataviewModel.set("enabled",!t)},getState:function(){var e=n.prototype.getState.call(this),t=this.dataviewModel.get("start"),i=this.dataviewModel.get("end"),o=this.get("min"),r=this.get("max"),a=function(e,n){return!!(s.isNumber(e)&&s.isNumber(n)&&e!==n&&Math.abs(e-n)>.01*Math.abs(t-i))};return a(t,o)?e.min=o:delete e.min,a(i,r)?e.max=r:delete e.max,!0===this.get("zoomed")&&(e.zoomed=!0),e}})},function(e,t,i){var s=i(0),n=i(2);e.exports=n.Collection.extend({addItem:function(e){this.isItemLocked(e.get("name"))||this.add(e)},addItems:function(e){s.each(e,function(e){this.isItemLocked(e.name)||this.add(e)},this)},resetItems:function(e){this.reset(e)},removeItem:function(e){var t=this.isItemLocked(e.get("name"));t&&this.remove(t)},removeItems:function(){this.reset([])},isItemLocked:function(e){return this.find(function(t){return t.get("name")===e})},getItemsName:function(){return this.pluck("name")}})},function(e,t,i){var s=i(0),n=i(389),o=i(1774);e.exports=n.extend({defaults:s.extend({type:"category",search:!1,locked:!1},n.prototype.defaults),defaultState:s.extend({acceptedCategories:[],locked:!1,autoStyle:!1},n.prototype.defaultState),initialize:function(){n.prototype.initialize.apply(this,arguments),this.lockedCategories=new o,this.listenTo(this.dataviewModel,"change:allCategoryNames",this._onDataviewAllCategoryNamesChange),this.on("change:locked",this._onLockedChange,this),this.on("change:collapsed",this._onCollapsedChange,this),this.isAutoStyleEnabled()&&this.on("change:style",this._updateAutoStyle,this),this.dataviewModel.filter.on("change",function(){this.set("acceptedCategories",this._acceptedCategories().pluck("name"))},this),this.dataviewModel.once("change:allCategoryNames",function(){this.get("autoStyle")&&this.autoStyle()},this)},setupSearch:function(){this.dataviewModel.setupSearch(),this.lockedCategories.addItems(this._acceptedCategories().toJSON()),this.toggleSearch()},toggleSearch:function(){this.set("search",!this.get("search"))},enableSearch:function(){this.set("search",!0)},disableSearch:function(){this.set("search",!1)},isSearchEnabled:function(){return this.get("search")},cleanSearch:function(){this.dataviewModel.cleanSearch(),this.lockedCategories.reset([])},autoStyle:function(){this.autoStyler.colors.updateData(this.dataviewModel.get("allCategoryNames")),n.prototype.autoStyle.call(this)},isLocked:function(){return this.get("locked")},canBeLocked:function(){return this.isLocked()||this._acceptedCategories().size()>0},canApplyLocked:function(){return this._acceptedCategories().size()!==this.lockedCategories.size()||this._acceptedCategories().any(function(e){return!this.lockedCategories.isItemLocked(e.get("name"))},this)},applyLocked:function(){var e=this.lockedCategories.getItemsName();if(!e.length)return this.unlockCategories(),!1;this.set("locked",!0);var t=this.dataviewModel.filter;t.cleanFilter(!1),t.accept(e),t.applyFilter(),this.cleanSearch()},lockCategories:function(){this.set("locked",!0),this.dataviewModel.fetch()},unlockCategories:function(){this.set("locked",!1),this.dataviewModel.filter.acceptAll()},_onDataviewAllCategoryNamesChange:function(e,t){this.isAutoStyleEnabled()&&(this.isAutoStyle()||this.autoStyler.colors.updateData(t))},_onLockedChange:function(e,t){t?this.dataviewModel.enableFilter():this.dataviewModel.disableFilter()},_acceptedCategories:function(){return this.dataviewModel.filter.acceptedCategories},_onCollapsedChange:function(e,t){this.dataviewModel.set("enabled",!t)}})},function(e,t,i){var s=i(0),n=i(236),o=i(893),r=i(892),a=o.extend({updateStyle:function(e){this.styles=e.auto_style},_getFillColor:function(e){var t=this._getColor(),i=t||{};if(!t){var s=this.dataviewModel.getDistributionType(this.dataviewModel.getUnfilteredDataModel().get("data"));i=a.SCALES_MAP[e][s]}return"ramp(["+this.dataviewModel.get("column")+"], "+(t?"('"+i.range.join("', '")+"'), ":"cartocolor("+i.palette+", "+this.dataviewModel.get("bins")+"), ")+(i.quantification+")")},getDef:function(e){var t={},i=this.dataviewModel.getDistributionType(this.dataviewModel.getUnfilteredDataModel().get("data")),l=this.dataviewModel.get("bins"),h=this.dataviewModel.get("column"),c=this.styles,d=this.styles&&this.styles.custom||!1;return o.FILL_SELECTORS.forEach(function(o){if(r.isPropertyIncluded(e,o)){var u=a.SCALES_MAP[o][i],p=o.substring(0,o.indexOf("-")),g={};u&&(g=!0===d?s.extend(g,c.definition):{color:{range:n[u.palette][l]||n[u.palette][Object.keys(n[u.palette]).length],quantification:u.quantification,attribute:h}}),t["marker"===p?"point":p]=g}}),t}});a.SCALES_MAP={"polygon-fill":{F:{palette:"PinkYl",quantification:"equal"},L:{palette:"Emrld",quantification:"headtails"},J:{palette:"Emrld",quantification:"headtails"},A:{palette:"Geyser",quantification:"quantiles"},C:{palette:"Sunset",quantification:"jenks"},U:{palette:"Sunset",quantification:"jenks"}},"line-color":{F:{palette:"PinkYl",quantification:"equal"},L:{palette:"Emrld",quantification:"headtails"},J:{palette:"Emrld",quantification:"headtails"},A:{palette:"Geyser",quantification:"quantiles"},C:{palette:"Sunset",quantification:"jenks"},U:{palette:"Sunset",quantification:"jenks"}},"marker-fill":{F:{palette:"RedOr",quantification:"equal"},L:{palette:"BluYl",quantification:"headtails"},J:{palette:"BluYl",quantification:"headtails"},A:{palette:"Geyser",quantification:"quantiles"},C:{palette:"SunsetDark",quantification:"jenks"},U:{palette:"SunsetDark",quantification:"jenks"}}},e.exports=a},function(e,t,i){var s=i(0),n=["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74"];function CategoryColors(e){this.updateColors(e)}CategoryColors.prototype.updateColors=function(e){var t=function getColorRange(e){return e&&e.definition&&e.definition.color&&e.definition.color.range||n}(e);this.colors={},s.each(t,function(e){this.colors[e]=null},this)},CategoryColors.prototype.updateData=function(e){s.each(this.colors,function(t,i){s.contains(e,t)?e=s.without(e,t):this.colors[i]=null},this),s.each(e,function(e){var t=this.getNextAvailableColor();t&&(this.colors[t]=e)},this)},CategoryColors.prototype.getNextAvailableColor=function(){for(var e in this.colors)if(null===this.colors[e])return e;return null},CategoryColors.prototype.getColorByCategory=function(e){for(var t in this.colors)if(this.colors[t]===e)return t;return"#A5AA99"},CategoryColors.prototype.getCategoryByColor=function(e){return this.colors[e]},e.exports=CategoryColors},,,,,,,,,,,,,,,,,,,,,function(e,t,i){var s=i(0),n=i(893);e.exports=n.extend({updateStyle:function(e){this.styles=e.auto_style,this.colors.updateColors(e.auto_style),this.colors.updateData(s.pluck(this.dataviewModel.get("data"),"name"))},_getRange:function(){return s.map(this.dataviewModel.get("data"),function(e){return this.colors.getColorByCategory(e.name)},this)},getDef:function(){var e=this.dataviewModel,t=e.get("data"),i=this._getRange(),o={};return n.FILL_SELECTORS.forEach(function(n){var r,a=n.substring(0,n.indexOf("-"));r={color:{domain:s.pluck(t,"name"),range:i,attribute:e.get("column")}},o["marker"===a?"point":a]=r}),o},_getFillColor:function(){var e=this.dataviewModel,t=e.get("data"),i=e.get("column");return this._getCategoryRamp(t,i)},_getCategoryRamp:function(e,t){for(var i="ramp(["+t+"], ",s="",n="",o=0;o<e.length;o++){var r=e[o],a=o!==e.length-1?", ":"";s+='"'+this.colors.getColorByCategory(r.name)+'"'+a,r.agg?o===e.length-1&&(n=n.substring(0,n.length-2)):"string"!=typeof r.name?n+=r.name+a:n+='"'+String(r.name).replace(/"/g,'\\"')+'"'+a}return i+"("+s+"), ("+n+"), '=')"}})},function(e,t,i){var s={category:i(1798),histogram:i(1776)};e.exports={get:function(e,t,i){var n=s[e.get("type")];if(n)return new n(e,t,i);throw new Error("dataview type not supported")}}},function(e,t,i){var s=i(0),n=i(389),o=i(1775),r=i(1773),a=i(1772),l={auto_style_allowed:"autoStyleEnabled"},h=function(e){return s.reduce(l,function(t,i,s){if(void 0!==e[s])return t[i]=e[s],t},{})},c=function(e,t){s.each(t,function(t){if(void 0===e[t])throw new Error(t+" is required")})},d=function(e,t,i){return s.extend(e,t,{hasInitialState:i})},u=function(e){if(!(e.source instanceof Object&&e.source.cid))throw new Error("Source must be defined and be an instance of AnalysisModel.")},p=function(e,t){this._widgetsCollection=e,this._dataviews=t};p.prototype.getCollection=function(){return this._widgetsCollection},p.prototype.get=function(e){return this._widgetsCollection.get(e)},p.prototype.getList=function(){return this._widgetsCollection.models},p.prototype.createCategoryModel=function(e,t,i){c(e,["title"]);var n=d(e,i,this._widgetsCollection.hasInitialState());u(n);var r=this._dataviews.createCategoryModel(n),a=["id","title","order","collapsed","prefix","suffix","show_stats","show_source","style","hasInitialState"],l=s.pick(n,a),p=h(n);l.attrsNames=a;var g=new o(l,{dataviewModel:r,layerModel:t},p);return g.setInitialState(i),this._widgetsCollection.add(g),g},p.prototype.createHistogramModel=function(e,t,i,n){c(e,["title"]);var o=d(e,i,this._widgetsCollection.hasInitialState());u(o);var a=this._dataviews.createHistogramModel(o);a.has("bins")||a.set("bins",10,{silent:!0});var l=["id","title","order","collapsed","bins","show_stats","show_source","normalized","style","hasInitialState","table_name"],p=s.pick(o,l),g=h(o);p.type="histogram",p.attrsNames=l;var m=new r(p,{dataviewModel:a,layerModel:t},g);return m.setInitialState(i),this._widgetsCollection.add(m),m},p.prototype.createFormulaModel=function(e,t,i){c(e,["title"]);var o=d(e,i,this._widgetsCollection.hasInitialState());u(o);var r=this._dataviews.createFormulaModel(o),a=["id","title","order","collapsed","prefix","suffix","show_stats","show_source","description","hasInitialState"],l=s.pick(o,a);l.type="formula",l.attrsNames=a;var h=new n(l,{dataviewModel:r,layerModel:t});return h.setInitialState(i),this._widgetsCollection.add(h),h},p.prototype.createTimeSeriesModel=function(e,t,i,n){e.column_type=e.column_type||"date",u(e);var o=this._dataviews.createHistogramModel(e),r=["id","style","title","normalized","animated","timezone"],l=s.pick(e,r);l.type="time-series",l.attrsNames=r;var h=new a(l,{dataviewModel:o,layerModel:t},n);return h.setInitialState(i),this._widgetsCollection.add(h),h},p.prototype.setWidgetsState=function(e){this._widgetsCollection.setStates(e)},e.exports=p},function(e,t,i){var s=i(0),n=i(2);e.exports=n.Collection.extend({comparator:"order",initialize:function(){this._allDataviewsFetched=!1,this._initBinds()},_initBinds:function(){this.bind("change:order",s.debounce(this._onChangeOrder.bind(this),10),this),this.bind("change:autoStyle",function(e,t){t&&this.each(function(t){t.layerModel&&t!==e&&t.layerModel.get("layer_name")===e.layerModel.get("layer_name")&&t.get("autoStyle")&&t.set("autoStyle",!1)})},this)},_onChangeOrder:function(){this.sort(),this.trigger("orderChanged",this)},getStates:function(){var e={};return this.each(function(t){var i=t.getState();s.isEmpty(i)||(e[t.get("id")]=i)}),e},setStates:function(e){for(var t in e){this.at(t).setState(e[t])}},hasInitialState:function(){return this._allDataviewsFetched},initialState:function(){this._allDataviewsFetched=!0}})},function(e,t,i){var s=i(1),n=i(6),o=i(897);e.exports=s.extend({className:"CDB-Widget-title CDB-Widget-contentSpaced",events:{"click .js-autoStyle":"_autoStyle","click .js-cancelAutoStyle":"_cancelAutoStyle"},initialize:function(e){if(!e.widgetModel)throw new Error("widgetModel is required");if(!e.dataviewModel)throw new Error("dataviewModel is required");if(!e.layerModel)throw new Error("layerModel is required");this.widgetModel=e.widgetModel,this.dataviewModel=e.dataviewModel,this._layerModel=e.layerModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(o({title:this.widgetModel.get("title"),isAutoStyleEnabled:this._isAutoStyleButtonVisible(),isAutoStyle:this.widgetModel.get("autoStyle"),isCollapsed:this.widgetModel.get("collapsed")})),this._initViews(),this},_initBinds:function(){this.widgetModel.bind("change:title change:collapsed change:autoStyle change:style",this.render,this),this.add_related_model(this.widgetModel),this._layerModel.bind("change:visible change:cartocss",this.render,this),this.add_related_model(this._layerModel)},_initViews:function(){var e=new n({el:this.$el.find(".js-sizes"),gravity:"auto"});this.addView(e);var t=new n({el:this.$el.find(".js-actions"),gravity:"auto"});this.addView(t)},_isAutoStyleButtonVisible:function(){var e=this._layerModel.get("meta"),t=(this._layerModel.get("cartocss")||e&&e.cartocss)&&this.widgetModel.hasColorsAutoStyle();return this.widgetModel.isAutoStyleEnabled()&&this._layerModel.get("visible")&&t},_autoStyle:function(){this.widgetModel.autoStyle()},_cancelAutoStyle:function(){this.widgetModel.cancelAutoStyle()}})},function(e,t,i){var s=i(0),n=i(1),o=i(242),r=i(1802),a=i(922),l=i(546),h=i(896),c=i(339),d=i(6),u=i(390),p=i(895),g=i(338),m=i(337),f=i(336);e.exports=n.extend({className:"CDB-Widget-body",defaults:{chartHeight:72},events:{"click .js-clear":"_resetWidget","click .js-zoom":"_zoom"},initialize:function(){this._dataviewModel=this.model.dataviewModel,this._layerModel=this.model.layerModel,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this.filter=this._dataviewModel.filter,this.lockedByUser=!1,this._numberOfFilters=0,this._initStateApplied=!1,this._originalData.get("hasBeenFetched")?this._initBinds():this.listenToOnce(this._originalData,"change:hasBeenFetched",function(){this._initBinds()}),window.addEventListener("resize",this._onWindowResized.bind(this),{passive:!0})},render:function(){this.clearSubViews(),this._unbinds(),this.$el.toggleClass("is-collapsed",!!this.model.get("collapsed"));var e=this._dataviewModel.getData(),t=this._dataviewModel.hasNulls(),i=this._originalData.getData(),n=!s.size(e)&&!s.size(i),o=this._dataviewModel.get("source").id,r=g.letter(o),a=g.getColorForLetter(r),l=this._dataviewModel.getSourceType()||"",c=this._dataviewModel.isSourceType(),d=c?this.model.get("table_name"):this._layerModel.get("layer_name");return this.$el.html(h({title:this.model.get("title"),sourceId:o,sourceType:m.title(l),isSourceType:c,showStats:this.model.get("show_stats"),showNulls:t,showSource:this.model.get("show_source")&&""!==r,itemsCount:n?"-":e.length,isCollapsed:!!this.model.get("collapsed"),sourceColor:a,layerName:f(d)})),n?(this._addPlaceholder(),this._initTitleView()):(this._setupBindings(),this._initViews()),this},_initViews:function(){this._initTitleView(),this._initDropdownView(),this._renderMiniChart(),this._renderMainChart(),this._renderAllValues()},_onWindowResized:function(){window.innerWidth<1200&&this.histogramChartView&&this.histogramChartView.forceResize()},_initDropdownView:function(){var e=new c({model:this.model,target:".js-actions",container:this.$(".js-header"),flags:{normalizeHistogram:!0}});this.addView(e)},_toggleTooltip:function(e){if(!e||!e.target)return this._clearTooltip();this._showTooltip(e)},_showTooltip:function(e){this.tooltip&&e&&this.tooltip.getElement()===e.target||(this._clearTooltip(),this.tooltip=new d({el:e.target,title:function(){return e.data},trigger:"manual"}),this.tooltip.showTipsy(),this.addView(this.tooltip))},_clearTooltip:function(){this.tooltip&&(this.tooltip.hideTipsy(),this.removeView(this.tooltip),this.tooltip=void 0)},_initTitleView:function(){var e=new r({widgetModel:this.model,dataviewModel:this._dataviewModel,layerModel:this._layerModel});this.$(".js-title").append(e.render().el),this.addView(e)},_initBinds:function(){this.listenTo(this.model,"change:collapsed",this.render),this.listenTo(this.model,"change:normalized",this._onNormalizedChanged),!0===this.model.get("hasInitialState")?this._setInitialState():this.listenTo(this.model,"change:hasInitialState",this._setInitialState),this.listenTo(this._layerModel,"change:layer_name",this.render)},_setInitialState:function(){0===this._dataviewModel.getData().length?this._dataviewModel.once("change:data",this._onInitialState,this):this._onInitialState()},_onNormalizedChanged:function(){var e=this.model.get("normalized");this.histogramChartView.setNormalized(e),this.miniHistogramChartView.setNormalized(e)},_onInitialState:function(){this.add_related_model(this._dataviewModel),this.render(),!0===this.model.get("autoStyle")&&this.model.autoStyle(),this._hasRange()&&(this._numberOfFilters=1),this._isZoomed()&&(this._numberOfFilters=2),0!==this._numberOfFilters?this._setInitialRange():this._completeInitialState()},_setupRange:function(e,t,i,n){var o,r,a=0,l=e.length;s.isNumber(t)&&(a=(o=s.findWhere(e,{start:t}))?o.bin:0),s.isNumber(i)&&(l=(r=s.findWhere(e,{end:i}))?r.bin+1:e.length),(a&&0!==a||l&&l!==e.length)&&(this.filter.setRange(e[a].start,e[l-1].end),this._onChangeFilterEnabled(),this.histogramChartView.selectRange(a,l)),n&&n(a,l)},_setInitialRange:function(){var e=this._dataviewModel.getData(),t=this.model.get("min"),i=this.model.get("max"),s=void 0!==t||void 0!==i;this._setupRange(e,t,i,function(e,t){this.model.set({filter_enabled:s,lo_index:e,hi_index:t}),this._dataviewModel.bind("change:data",this._onHistogramDataChanged,this),this._initStateApplied=!0,this._isZoomed()?(this._onChangeZoomEnabled(),this._onZoomIn()):this._updateStats()}.bind(this))},_completeInitialState:function(){this._dataviewModel.bind("change:data",this._onHistogramDataChanged,this),this._initStateApplied=!0,this._updateStats()},_isZoomed:function(){return this.model.get("zoomed")},_hasRange:function(){var e=this.model.get("min"),t=this.model.get("max");return null!=e||null!=t},_onHistogramDataChanged:function(){this._dataviewModel.changed.url&&this._isZoomed()||(this.lockedByUser?this.lockedByUser=!1:(this._isZoomed()?this._filteredData=this._dataviewModel.getData():(this.histogramChartView.showShadowBars(),this.miniHistogramChartView.replaceData(this._dataviewModel.getData())),this.histogramChartView.replaceData(this._dataviewModel.getData())),this.unsettingRange&&this._unsetRange(),this._updateStats())},_unsetRange:function(){this.unsettingRange=!1,this.histogramChartView.replaceData(this._dataviewModel.getData()),this.model.set({lo_index:null,hi_index:null}),this._isZoomed()||this.histogramChartView.showShadowBars()},_addPlaceholder:function(){this.$(".js-content").append(l())},_renderMainChart:function(){this.histogramChartView=new a({type:"histogram",margin:{top:4,right:4,bottom:4,left:4},hasHandles:!0,hasAxisTip:!0,chartBarColor:this.model.getColor()||"#9DE0AD",width:this.canvasWidth,height:this.defaults.chartHeight,data:this._dataviewModel.getData(),dataviewModel:this._dataviewModel,layerModel:this._layerModel,originalData:this._originalData,displayShadowBars:!this.model.get("normalized"),normalized:this.model.get("normalized"),widgetModel:this.model}),this.$(".js-chart").append(this.histogramChartView.el),this.addView(this.histogramChartView),this.histogramChartView.bind("on_brush_end",this._onBrushEnd,this),this.histogramChartView.bind("hover",this._toggleTooltip,this),this.histogramChartView.render().show(),this._updateStats()},_renderMiniChart:function(){this.miniHistogramChartView=new a({type:"histogram",className:"CDB-Chart--mini",mini:!0,margin:{top:0,right:4,bottom:4,left:4},height:40,showOnWidthChange:!1,dataviewModel:this._dataviewModel,layerModel:this._layerModel,data:this._dataviewModel.getData(),normalized:this.model.get("normalized"),chartBarColor:this.model.getColor()||"#9DE0AD",originalData:this._originalData,widgetModel:this.model}),this.addView(this.miniHistogramChartView),this.$(".js-mini-chart").append(this.miniHistogramChartView.el),this.miniHistogramChartView.bind("on_brush_end",this._onMiniRangeUpdated,this),this.miniHistogramChartView.render()},_setupBindings:function(){this._dataviewModel.bind("change:bins",this._onChangeBins,this),this.model.bind("change:zoomed",this._onChangeZoomed,this),this.model.bind("change:zoom_enabled",this._onChangeZoomEnabled,this),this.model.bind("change:filter_enabled",this._onChangeFilterEnabled,this),this.model.bind("change:total",this._onChangeTotal,this),this.model.bind("change:nulls",this._onChangeNulls,this),this.model.bind("change:max",this._onChangeMax,this),this.model.bind("change:min",this._onChangeMin,this),this.model.bind("change:avg",this._onChangeAvg,this)},_unbinds:function(){this._dataviewModel.off("change:bins",this._onChangeBins,this),this.model.off("change:zoomed",this._onChangeZoomed,this),this.model.off("change:zoom_enabled",this._onChangeZoomEnabled,this),this.model.off("change:filter_enabled",this._onChangeFilterEnabled,this),this.model.off("change:total",this._onChangeTotal,this),this.model.off("change:nulls",this._onChangeNulls,this),this.model.off("change:max",this._onChangeMax,this),this.model.off("change:min",this._onChangeMin,this),this.model.off("change:avg",this._onChangeAvg,this)},_onMiniRangeUpdated:function(e,t){this.lockedByUser=!1,this._clearTooltip(),this.histogramChartView.removeSelection();var i=this._originalData.getData();this.model.set({lo_index:e,hi_index:t,zlo_index:null,zhi_index:null}),this._applyBrushFilter(i,e,t)},_onBrushEnd:function(e,t){this._isZoomed()?this._onBrushEndFiltered(e,t):this._onBrushEndUnfiltered(e,t)},_onBrushEndFiltered:function(e,t){var i=this._filteredData;i&&i.length&&(this.model.get("zlo_index")!==e||this.model.get("zhi_index")!==t)&&(this._numberOfFilters=2,this.lockedByUser=!0,this.model.set({filter_enabled:!0,zlo_index:e,zhi_index:t}),this._applyBrushFilter(i,e,t))},_onBrushEndUnfiltered:function(e,t){var i=this._dataviewModel.getData();i&&i.length&&(this.model.get("lo_index")!==e||this.model.get("hi_index")!==t)&&(this._numberOfFilters=1,this.model.set({filter_enabled:!0,zoom_enabled:!0,lo_index:e,hi_index:t}),this._applyBrushFilter(i,e,t))},_applyBrushFilter:function(e,t,i){t!==i&&t>=0&&t<e.length&&i-1>=0&&i-1<e.length?(this.filter.setRange(e[t].start,e[i-1].end),this._updateStats()):console.error("Error accessing array bounds",t,i,e)},_onChangeFilterEnabled:function(){this.$(".js-filter").toggleClass("is-hidden",!this.model.get("filter_enabled"))},_onChangeBins:function(e,t){this._resetWidget()},_onChangeZoomEnabled:function(){this.$(".js-zoom").toggleClass("is-hidden",!this.model.get("zoom_enabled"))},_renderAllValues:function(){this._changeHeaderValue(".js-nulls","nulls",""),this._changeHeaderValue(".js-val","total","SELECTED"),this._changeHeaderValue(".js-max","max",""),this._changeHeaderValue(".js-min","min",""),this._changeHeaderValue(".js-avg","avg","")},_changeHeaderValue:function(e,t,i){null!=this.model.get(t)?(this._addTitleForValue(e,t,i),new u({el:this.$el}).animateValue(this.model,t,e,p,{formatter:o.formatNumber,templateData:{suffix:" "+i}})):this.$(e).text("0 "+i)},_onChangeNulls:function(){this._changeHeaderValue(".js-nulls","nulls","")},_onChangeTotal:function(){this._changeHeaderValue(".js-val","total","SELECTED")},_onChangeMax:function(){this._changeHeaderValue(".js-max","max","")},_onChangeMin:function(){this._changeHeaderValue(".js-min","min","")},_onChangeAvg:function(){this._changeHeaderValue(".js-avg","avg","")},_addTitleForValue:function(e,t,i){this.$(e).attr("title",this._formatNumberWithCommas(this.model.get(t).toFixed(2))+" "+i)},_formatNumberWithCommas:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},_calculateBars:function(e){var t,i,n,o,r,a;return this._isZoomed()&&2===this._numberOfFilters?(t=this.model.get("zmin"),i=this.model.get("zmax"),n=this.model.get("zlo_index"),o=this.model.get("zhi_index")):1===this._numberOfFilters&&(t=this.model.get("min"),i=this.model.get("max"),n=this.model.get("lo_index"),o=this.model.get("hi_index")),e.length>0?(s.isNumber(t)||s.isNumber(n)?s.isNumber(t)&&!s.isNumber(n)&&(n=(r=s.findWhere(e,{start:t}))&&r.bin||0):n=0,s.isNumber(i)||s.isNumber(o)?s.isNumber(i)&&!s.isNumber(o)&&(o=(a=s.findWhere(e,{end:i}))&&a.bin+1||e.length):o=e.length):(n=0,o=e.length),{loBarIndex:n,hiBarIndex:o}},_updateStats:function(){var e;if(this._initStateApplied&&null!=(e=!this._isZoomed()||this._isZoomed()&&2===this._numberOfFilters?this.histogramChartView.model.get("data"):this.miniHistogramChartView.model.get("data"))){var t,i,n,o,r,a=this._dataviewModel.get("nulls"),l=this._calculateBars(e),h=l.loBarIndex,c=l.hiBarIndex;e&&e.length&&(t=this._calcSum(e,h,c),i=this._calcAvg(e,h,c),h>=0&&h<e.length&&(n=e[h].start),c>=0&&c-1<e.length&&(o=e[Math.max(0,c-1)].end),this._isZoomed()&&2===this._numberOfFilters?r={zmin:n,zmax:o,zlo_index:h,zhi_index:c}:this._isZoomed()||1!==this._numberOfFilters||(r={min:n,max:o,lo_index:h,hi_index:c}),r=s.extend({total:t,nulls:a,avg:i},r),this.model.set(r))}},_calcAvg:function(e,t,i){var n=e.slice(t,i),o=this._calcSum(e,t,i);return o?s.reduce(n,function(e,t){return t.avg&&t.freq?t.avg*t.freq+e:e},0)/o:0},_calcSum:function(e,t,i){return s.reduce(e.slice(t,i),function(e,t){return t.freq+e},0)},_onChangeZoomed:function(){this.model.get("zoomed")?this._onZoomIn():(this._resetWidget(),this._dataviewModel.fetch())},_showMiniRange:function(){var e=this.model.get("lo_index"),t=this.model.get("hi_index");this.miniHistogramChartView.selectRange(e,t),this.miniHistogramChartView.show()},_zoom:function(){this.model.set({zoomed:!0,zoom_enabled:!1}),this.histogramChartView.removeSelection()},_onZoomIn:function(){this.lockedByUser=!1,this._showMiniRange(),this.histogramChartView.setBounds(),this._dataviewModel.enableFilter(),this._dataviewModel.fetch()},_resetWidget:function(){this._numberOfFilters=0,this.model.set({zoomed:!1,zoom_enabled:!1,filter_enabled:!1,lo_index:null,hi_index:null,min:null,max:null,zlo_index:null,zhi_index:null,zmin:null,zmax:null}),this.filter.unsetRange(),this._dataviewModel.disableFilter(),this.histogramChartView.unsetBounds(),this.miniHistogramChartView.hide(),this._clearTooltip(),this._updateStats()},clean:function(){window.removeEventListener("resize",this._onWindowResized.bind(this)),n.prototype.clean.apply(this)}})},function(e,t,i){var s=i(0);e.exports=function unescapeHTML(e){return s.unescape(e)}},function(e,t,i){var s=i(0),n=i(250),o=i(1),r=i(242),a=i(899),l=i(339),h=i(898),c=i(390),d=i(338),u=i(337),p=i(336),g=i(1804),m=i(6);e.exports=o.extend({className:"CDB-Widget-body",initialize:function(){this._dataviewModel=this.model.dataviewModel,this._layerModel=this.model.layerModel,!0===this.model.get("hasInitialState")?this._initBinds():this.listenToOnce(this.model,"change:hasInitialState",this._onInitialState)},_onInitialState:function(){this._initBinds(),this.render()},render:function(){this.clearSubViews();var e=this._dataviewModel.get("data"),t=function(e){var t=n.format("0,000");return s.isNumber(e)?t(e.toFixed(2)):0},i=!s.isUndefined(this._dataviewModel.get("nulls"))&&r.formatNumber(this._dataviewModel.get("nulls"))||"-",o=this.model.get("collapsed"),l=this.model.get("prefix"),m=this.model.get("suffix"),f=this._dataviewModel.get("source").id,_=d.letter(f),v=d.getColorForLetter(_),y=this._dataviewModel.getSourceType()||"",b=this._dataviewModel.isSourceType(),w=b?this.model.get("table_name"):this._layerModel.get("layer_name");return this.$el.html(a({title:this.model.get("title"),sourceId:f,sourceType:u.title(y),isSourceType:b,showStats:this.model.get("show_stats"),showSource:this.model.get("show_source")&&""!==_,operation:this._dataviewModel.get("operation"),value:e,formatedValue:t(e),description:this.model.get("description"),nulls:i,prefix:g(l),suffix:g(m),isCollapsed:o,sourceColor:v,layerName:p(w)})),new c({el:this.$el}).animateValue(this._dataviewModel,"data",".js-value",h,{animationSpeed:700,formatter:t,templateData:{prefix:g(l),suffix:g(m)}}),this.$el.toggleClass("is-collapsed",!!o),this._initViews(),this},_initBinds:function(){this.listenTo(this.model,"change:title change:description change:collapsed change:prefix change:suffix",this.render),this.listenTo(this._dataviewModel,"change:data",this.render),this.listenTo(this._layerModel,"change:layer_name",this.render)},_initViews:function(){var e=new l({model:this.model,target:".js-actions",container:this.$(".js-header")});this.addView(e);var t=new m({el:this.$el.find(".js-actions"),gravity:"auto"});this.addView(t)}})},function(e,t,i){var s=i(905),n=i(901),o=i(543);e.exports=s.extend({className:"CDB-Widget-nav is-hidden CDB-Widget-contentSpaced",render:function(){this.clearSubViews(),this.$el.empty();var e=this._totalPages();return this.$el.html(n()),e>1&&this.$el.append(o({currentPage:this._paginatorModel.get("page"),pages:e})),this},_totalPages:function(){return Math.ceil(this._dataviewModel.getSearchCount()/this.options.itemsPerPage)},toggle:function(){this[this._widgetModel.isSearchEnabled()?"show":"hide"]()},_onSearchClicked:function(){this._widgetModel.cleanSearch(),this._widgetModel.toggleSearch()}})},function(e,t,i){var s=i(1),n=i(242),o=i(903);e.exports=s.extend({tagName:"li",className:"CDB-Widget-listItem",events:{"click .js-button":"_onItemClick"},initialize:function(e){this.dataviewModel=this.options.dataviewModel,this.widgetModel=this.options.widgetModel,this._initBinds()},render:function(){var e=this.model.get("value");return this.$el.html(o({name:this.model.get("name"),value:e,formattedValue:n.formatNumber(e),percentage:e/this.dataviewModel.get("max")*100,isDisabled:!this.model.get("selected"),prefix:this.widgetModel.get("prefix"),suffix:this.widgetModel.get("suffix")})),this},_initBinds:function(){this.model.bind("change:selected",this.render,this),this.widgetModel.bind("change:prefix change:suffix",this.render,this),this.add_related_model(this.widgetModel)},_onItemClick:function(){this.model.set("selected",!this.model.get("selected"))}})},function(e,t,i){var s=i(910),n=i(1807),o=i(902);e.exports=s.extend({className:"CDB-Widget-list is-hidden js-list",render:function(){this.clearSubViews(),this.$el.empty();var e=this._searchResultsCollection;return e.isEmpty()||0===e.size()?this._renderPlaceholder():this._renderList(),this},_initBinds:function(){s.prototype._initBinds.apply(this,arguments),this._searchResultsCollection=this._dataviewModel.getSearchResult(),this.listenTo(this._searchResultsCollection,"change:selected",this._onSelectedItemChange),this.listenTo(this._searchResultsCollection,"reset",this.render)},_getData:function(){return this._searchResultsCollection},_renderPlaceholder:function(){this.$el.addClass("CDB-Widget-list--noresults"),this.$el.html(o({q:this._dataviewModel.getSearchQuery()}))},_addItem:function(e){var t=new n({model:e,widgetModel:this._widgetModel,dataviewModel:this._dataviewModel});this.addView(t),this.$el.append(t.render().el)},toggle:function(){this[this._widgetModel.isSearchEnabled()?"show":"hide"]()},_onSelectedItemChange:function(e,t){this._widgetModel.lockedCategories[t?"addItem":"removeItem"](e)}})},function(e,t,i){var s=i(0),n=i(1),o=i(242),r=i(907),a=i(906),l=i(390);e.exports=n.extend({className:"CDB-Widget-info CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase u-tSpace",tagName:"dl",initialize:function(){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){return this.$el.html(r({isSearchEnabled:this.widgetModel.isSearchEnabled(),isSearchApplied:this.dataviewModel.isSearchApplied(),isLocked:this.widgetModel.isLocked(),isOtherAvailable:this.dataviewModel.isOtherAvailable(),resultsCount:this.dataviewModel.getSearchCount(),totalCats:this._getCategoriesSize(),nullsPer:this._getNullPercentage(),catsPer:this._getCurrentCategoriesPercentage()})),new l({el:this.$el}).animateFromValues(this._getPreviousCategoriesPercentage(),this._getCurrentCategoriesPercentage(),".js-cats",a,{defaultValue:"-",animationSpeed:700,formatter:o.formatValue}),this._checkVisibility(),this},_initBinds:function(){this.dataviewModel.bind("change:data change:totalCount",this.render,this),this.widgetModel.bind("change:search change:locked",this.render,this),this.widgetModel.bind("change:show_stats change:collapsed",this._checkVisibility,this),this.add_related_model(this.dataviewModel),this.add_related_model(this.widgetModel)},_getNullPercentage:function(){var e=this.dataviewModel.get("nulls"),t=this.dataviewModel.get("totalCount")||0;return e?(e/t*100).toFixed(2):0},_getPreviousCategoriesPercentage:function(){var e=this.dataviewModel.previous("totalCount")||0,t=this.dataviewModel.getPreviousData();return this._getCategoriesPercentage(t,e)},_getCurrentCategoriesPercentage:function(){var e=this.dataviewModel.get("totalCount")||0,t=this.dataviewModel.getData().toJSON();return this._getCategoriesPercentage(t,e)},_getCategoriesPercentage:function(e,t){if(!t)return 0;var i=e.reduce(function(e,t){return t.agg?e:e+parseFloat(t.value)},0);return i?(i/t*100).toFixed(2):0},_getCategoriesSize:function(){return s.pluck(this.dataviewModel.getData().reject(function(e){return e.get("agg")}),"name").length},_checkVisibility:function(){var e=!!this.widgetModel.get("show_stats")&&!this.widgetModel.get("collapsed");this.$el.toggle(e)}})},function(e,t,i){var s=i(1),n=i(242),o=i(0),r=i(909),a=i(908);e.exports=s.extend({tagName:"li",className:"CDB-Widget-listItem",events:{"click .js-button":"_onItemClick"},initialize:function(e){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){var e=this.model.get("name"),t=this.model.get("value"),i=this.model.get("agg")||this.widgetModel.isLocked()?a:r,s=this.dataviewModel.filter.getAcceptedCategoryNames(),l=o.contains(s,e);return this.$el.html(i({isAggregated:this.model.get("agg"),name:e,value:t,formattedValue:n.formatNumber(t),percentage:t/this.dataviewModel.get("max")*100,color:this.widgetModel.getColor(e),isDisabled:this.model.get("selected")?"":"is-disabled",isAccepted:l,prefix:this.widgetModel.get("prefix"),suffix:this.widgetModel.get("suffix")})),this},_initBinds:function(){this.model.bind("change",this.render,this),this.widgetModel.bind("change:search change:prefix change:suffix change:autoStyle",this.render,this),this.add_related_model(this.widgetModel)},_onItemClick:function(){this.trigger("itemClicked",this.model,this)}})},function(e,t,i){var s=i(1),n=i(911);e.exports=s.extend({className:"CDB-Widget-filter CDB-Widget-contentSpaced CDB-Widget-contentSpaced--sideMargins",events:{"click .js-all":"_onSelectAll","click .js-lock":"_lockCategories","click .js-unlock":"_unlockCategories"},initialize:function(){this.dataviewModel=this.options.dataviewModel,this.widgetModel=this.options.widgetModel,this._initBinds()},render:function(){var e=this.dataviewModel.filter.acceptedCategories.size(),t=this.dataviewModel.filter.rejectedCategories.size(),i=this.dataviewModel.filter.areAllRejected(),s=this.dataviewModel.getData().size(),o=this.widgetModel.isLocked();return this.$el.html(n({isSearchEnabled:this.widgetModel.isSearchEnabled(),isSearchApplied:this.dataviewModel.isSearchApplied(),isLocked:o,canBeLocked:this.widgetModel.canBeLocked(),allSelected:0===t&&0===e&&!i,canSelectAll:!o&&(t>0||e>0||i),noneSelected:i||!s&&!e,acceptedCats:e,totalLocked:this.widgetModel.lockedCategories.size(),totalCats:s})),this},_initBinds:function(){this.widgetModel.bind("change:search change:locked",this.render,this),this.widgetModel.lockedCategories.bind("change add remove",this.render,this),this.add_related_model(this.widgetModel),this.add_related_model(this.widgetModel.lockedCategories),this.dataviewModel.bind("change:data",this.render,this),this.add_related_model(this.dataviewModel);var e=this.dataviewModel.filter;e.acceptedCategories.bind("add remove reset",this.render,this),e.rejectedCategories.bind("add remove reset",this.render,this),this.add_related_model(e.rejectedCategories),this.add_related_model(e.acceptedCategories)},_lockCategories:function(){this.widgetModel.lockCategories()},_unlockCategories:function(){this.widgetModel.unlockCategories()},_onSelectAll:function(){this.dataviewModel.filter.acceptAll()}})},function(e,t,i){var s=i(0),n=i(4),o=i(1),r=i(339),a=i(6),l=i(912),h=i(338),c=i(337),d=i(336);e.exports=o.extend({events:{"keyup .js-textInput":"_onKeyupInput","submit .js-form":"_onSubmitForm","click .js-applyLocked":"_applyLocked","click .js-autoStyle":"_autoStyle","click .js-cancelAutoStyle":"_cancelAutoStyle"},initialize:function(){if(!this.options.widgetModel)throw new Error("widgetModel is required");if(!this.options.dataviewModel)throw new Error("dataviewModel is required");if(!this.options.layerModel)throw new Error("layerModel is required");this.model=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this.layerModel=this.options.layerModel,this._initBinds()},render:function(){this.clearSubViews();var e=this.dataviewModel.get("source").id,t=h.letter(e),i=h.getColorForLetter(t),s=this.dataviewModel.getSourceType()||"",n=this.dataviewModel.isSourceType(),o=n?this.model.get("table_name"):this.layerModel.get("layer_name");return this.$el.html(l({isCollapsed:this.model.get("collapsed"),isAutoStyleEnabled:this._isAutoStyleButtonVisible(),isAutoStyle:this.model.isAutoStyle(),title:this.model.get("title"),sourceId:e,sourceType:c.title(s),isSourceType:n,showSource:this.model.get("show_source")&&""!==t,sourceColor:i,layerName:d(o),columnName:this.dataviewModel.get("column"),q:this.dataviewModel.getSearchQuery(),isLocked:this.model.isLocked(),canBeLocked:this.model.canBeLocked(),isSearchEnabled:this.model.isSearchEnabled(),canShowApply:this.model.canApplyLocked()})),this._initViews(),this},_initBinds:function(){this.listenTo(this.model,"change:search",this._onSearchToggled),this.listenTo(this.model,"change:title change:collapsed change:autoStyle change:style",this.render),this.listenTo(this.model.lockedCategories,"change add remove",this.render),this.listenTo(this.dataviewModel,"change:column",this.render),this.listenTo(this.dataviewModel.filter,"change",this.render),this.listenTo(this.layerModel,"change:visible change:cartocss change:layer_name",this.render)},_initViews:function(){var e=new r({model:this.model,target:".js-actions",container:this.$el});this.addView(e);var t=new a({el:this.$el.find(".js-colors"),gravity:"auto"});this.addView(t);var i=new a({el:this.$el.find(".js-actions"),gravity:"auto"});this.addView(i)},_isAutoStyleButtonVisible:function(){return this.model.isAutoStyleEnabled()&&this.layerModel.get("visible")&&this.model.hasColorsAutoStyle()},_onSearchToggled:function(){var e=this.model.isSearchEnabled();this[e?"_bindESC":"_unbindESC"](),this.render(),e&&this._focusOnInput()},_onSubmitForm:function(e){e&&e.preventDefault();var t=this.$(".js-textInput").val();this.dataviewModel.getSearchQuery()!==t&&(this.dataviewModel.setSearchQuery(t),this.dataviewModel.isSearchValid()&&this.dataviewModel.applySearch())},_focusOnInput:function(){var e=this;setTimeout(function(){e.$(".js-textInput").focus()},0)},_onKeyupInput:s.debounce(function(e){var t=this.$(".js-textInput").val();13!==e.keyCode&&27!==e.keyCode&&""!==t&&this._onSubmitForm()},250),_bindESC:function(){n(document).bind("keyup."+this.cid,s.bind(this._onKeyUp,this))},_unbindESC:function(){n(document).unbind("keyup."+this.cid)},_onKeyUp:function(e){if(27===e.keyCode)return this._cancelSearch(),!1},_applyLocked:function(){this.model.toggleSearch(),this.model.applyLocked()},_autoStyle:function(){this.model.autoStyle()},_cancelAutoStyle:function(){this.model.cancelAutoStyle()},_cancelSearch:function(){this.model.cleanSearch(),this.model.disableSearch()},clean:function(){this._unbindESC(),o.prototype.clean.call(this)}})},function(e,t,i){var s=i(2),n=i(1),o=i(1812),r=i(1811),a=i(910),l=i(1809),h=i(905),c=i(1808),d=i(1806),u=i(900);e.exports=n.extend({className:"CDB-Widget-body",_ITEMS_PER_PAGE:6,initialize:function(){this._dataviewModel=this.model.dataviewModel,this._layerModel=this.model.layerModel,this._paginatorModel=new s.Model({page:1}),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.toggleClass("is-collapsed",!!this.model.get("collapsed")),this.$el.html(u()),this._initViews(),this},_initBinds:function(){!0===this.model.get("hasInitialState")?this._onInitialState():this.model.bind("change:hasInitialState",this._onInitialState,this),this.model.bind("change:collapsed",function(e,t){this.$el.toggleClass("is-collapsed",!!t)},this)},_onInitialState:function(){this.render(),!0===this.model.get("autoStyle")&&this.model.autoStyle()},_initViews:function(){var e=new o({widgetModel:this.model,dataviewModel:this._dataviewModel,layerModel:this._layerModel});this.$(".js-header").append(e.render().el),this.addView(e);var t=new l({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-header").append(t.render().el),this.addView(t);var i=new r({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-content").html(i.render().el),this.addView(i);var s=new a({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginatorModel:this._paginatorModel});this.$(".js-content").append(s.render().el),this.addView(s);var n=new h({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginatorModel:this._paginatorModel});this.$(".js-footer").append(n.render().el),this.addView(n);var u=new c({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginator:!0,paginatorModel:this._paginatorModel});this.$(".js-content").append(u.render().el),this.addView(u);var p=new d({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginator:!0,paginatorModel:this._paginatorModel});this.$(".js-footer").append(p.render().el),this.addView(p)}})},function(e,t,i){var s=i(0),n=i(4),o=i(268),r=i(1),a=i(1813),l=i(1805),h=i(1803),c=i(928),d=i(894),u=window.matchMedia;e.exports=r.extend({className:"CDB-Widget-canvas",initialize:function(e){this._widgetViewFactory=new c([{type:"formula",createContentView:function(e){return new l({model:e})}},{type:"histogram",createContentView:function(e){return new h({model:e})}},{type:"category",createContentView:function(e){return new a({model:e})}}]),this._widgets=e.widgets,this._widgets.bind("add",this._maybeRenderWidgetView,this),this._widgets.bind("reset",this.render,this),this._widgets.bind("orderChanged",this.render,this),this._widgets.bind("change:collapsed",this._onWidgetUpdate,this),this._widgets.bind("add remove reset",this._onWidgetsChange,this),this.add_related_model(this._widgets),this._resizeHandler=this._onResize.bind(this)},render:function(){return this._cleanScroll(),this._observer&&this._observer.disconnect(),this.clearSubViews(),this.$el.html(d()),this.$el.toggleClass("CDB-Widget-canvas--withMenu",this.model.get("renderMenu")),this._widgets.each(this._maybeRenderWidgetView,this),this._toggleVisiblity(),this._renderScroll(),this._renderShadows(),this._bindScroll(),this._initResize(),this},_initResize:function(){["(max-width: 1600px)","(max-width: 1280px)","(max-width: 759px)"].forEach(function(e){u(e).addListener(this._resizeHandler)},this)},_updateScrollCss:function(){this._onWidgetUpdate();var e=this._container();if(e){var t=e.clientWidth,i=e.clientHeight,s=t<e.scrollWidth,n=i<e.scrollHeight;this._$container().toggleClass("hasXScroll",s),this._$container().toggleClass("hasYScroll",n)}},_$container:function(){return n(this._container())},_container:function(){return this.el.querySelector(".js-container")},_maybeRenderWidgetView:function(e){var t=this._widgetViewFactory.createWidgetView(e);t&&(this.addView(t),this._$container().append(t.render().el))},_bindScroll:function(){this._$container().on("ps-y-reach-start",s.bind(this._onScrollTop,this)).on("ps-y-reach-end",s.bind(this._onScrollBottom,this)).on("ps-scroll-y",s.bind(this._onScroll,this))},_renderScroll:function(){o.initialize(this._container(),{wheelSpeed:1,wheelPropagation:!1,swipePropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20,useBothWheelAxes:!0})},_onWidgetUpdate:function(){o.update(this._container())},_renderShadows:function(){this.$shadowTop=n("<div>").addClass("CDB-Widget-canvasShadow CDB-Widget-canvasShadow--top"),this.$shadowBottom=n("<div>").addClass("CDB-Widget-canvasShadow CDB-Widget-canvasShadow--bottom"),this.$el.append(this.$shadowTop),this.$el.append(this.$shadowBottom)},_onScrollTop:function(){this.$shadowTop.removeClass("is-visible")},_onScroll:function(){var e=this._$container(),t=e.scrollTop(),i=e.get(0).scrollHeight-e.outerHeight();this.$shadowTop.toggleClass("is-visible",t>0),this.$shadowBottom.toggleClass("is-visible",t<i)},_updateScroll:function(){this._$container().scrollLeft=0,this._$container().scrollTop=0},_onResize:function(e){this._updateScroll(),this._onScroll()},_onScrollBottom:function(){this.$shadowBottom.removeClass("is-visible")},_cleanScroll:function(){n(window).off("resize",this._resizeHandler),this._container()&&(this._$container().off("ps-scroll-y"),o.destroy(this._container()))},_toggleVisiblity:function(){this.$el.toggle(!s.isEmpty(this._subviews))},_onWidgetsChange:function(){this._toggleVisiblity(),this.render()},clean:function(){this._cleanScroll(),this._observer&&this._observer.disconnect(),r.prototype.clean.call(this)}})},function(e,t,i){var s=i(9),n=i(1),o=i(0),r=i(4),a=i(913),l=i(5),h=i(268),c=n.extend({className:"CDB-Dashboard-menu",events:{"click .js-toggle-view":"_toogleView"},initialize:function(){this.viewModel=new s.core.Model({open:!1,footer:r(window).width()<1201}),this._initBinds()},_initBinds:function(){this.listenTo(this.viewModel,"change",this.render),this._resize=o.debounce(this._onResizeWindow.bind(this),20),r(window).on("resize",this._resize)},render:function(){var e=this.model.get("title"),t=this.viewModel.get("open"),i=this.viewModel.get("footer");e&&e.length>120&&(e=e.slice(0,110)+"... %23 map"),this.$el.html(a({hasTranslation:t||i,showLogo:this.model.get("showLogo"),title:this.model.get("title"),description:this.model.get("description"),updatedAt:l(this.model.get("updatedAt")).fromNow(),userName:this.model.get("userName"),url:window.location.href,urlWithoutParams:window.location.protocol+"//"+window.location.host+window.location.pathname,inIframe:window.location!==window.parent.location,shortTitle:e,userAvatarURL:this.model.get("userAvatarURL"),userProfileURL:this.model.get("userProfileURL")})),this.$el.toggleClass("is-active",t);var s=this._getDescription().get(0);return h.initialize(s,{wheelSpeed:2,suppressScrollX:!0}),this},_getDescription:function(){return this.$(".js-scroll-wrapper")},_toogleView:function(){var e=this.viewModel.get("open");this.viewModel.set({open:!e})},_onResizeWindow:function(){this.viewModel.set({footer:r(window).width()<1201})},clean:function(){r(window).off("resize",this._resize),n.prototype.clean.call(this)}});e.exports=c},function(e,t,i){var s=i(250),n=i(1),o=i(5),r=i(242),a=i(915);e.exports=n.extend({className:"CDB-Widget-timeSeriesTimeInfo",initialize:function(e){if(!e.torqueLayerModel)throw new Error("torqueLayerModel is required");if(!e.dataviewModel)throw new Error("dataviewModel is required");if(!e.timeSeriesModel)throw new Error("timeSeriesModel is required");this._torqueLayerModel=this.options.torqueLayerModel,this._dataviewModel=this.options.dataviewModel,this._timeSeriesModel=this.options.timeSeriesModel,this._initBinds()},render:function(){var e=this._torqueLayerModel.get("time"),t=this._torqueLayerModel.get("column_type"),i=s.scale.linear().domain([0,this._dataviewModel.get("data").length]).range([this._dataviewModel.get("start"),this._dataviewModel.get("end")]),n="",l=r.formatNumber;return"number"===t?n=a({time:l(i(this._torqueLayerModel.get("step")))}):"date"!==t||isNaN(e&&e.getTime())||(l=r.timestampFactory(this._dataviewModel.get("aggregation"),this._dataviewModel.getCurrentOffset()),n=a({time:l(o(e).unix())})),this.$el.html(n),this},_initBinds:function(){this.listenTo(this._torqueLayerModel,"change:step",this.render)}})},function(e,t,i){var s=i(1),n=i(1816),o=i(921),r=i(914);e.exports=s.extend({className:"CDB-Widget-contentSpaced",initialize:function(){this._dataviewModel=this.options.dataviewModel,this._torqueLayerModel=this.options.torqueLayerModel,this._rangeFilter=this._dataviewModel.filter,this._selectedAmount=this.options.selectedAmount,this._timeSeriesModel=this.options.timeSeriesModel,this.listenTo(this._rangeFilter,"change",this.render)},render:function(){var e=!0;return this.clearSubViews(),this.$el.addClass(this.className),this.$el.html(r()),this._rangeFilter.isEmpty()&&(this._appendView(".js-torque-controls",new n({dataviewModel:this._dataviewModel,torqueLayerModel:this._torqueLayerModel,timeSeriesModel:this._timeSeriesModel})),e=!1),this._createTimeSeriesHeaderView(e),this},_createTimeSeriesHeaderView:function(e){var t=new o({dataviewModel:this._dataviewModel,layerModel:this._torqueLayerModel,rangeFilter:this._dataviewModel.filter,showClearButton:e,timeSeriesModel:this._timeSeriesModel,selectedAmount:this._selectedAmount});this._appendView(".js-time-series-header",t),t.on("resetFilter",this._resetFilter,this)},_resetFilter:function(){this._torqueLayerModel.set({step:0}),this._torqueLayerModel.resetRenderRange()},_appendView:function(e,t){this.addView(t),this.$(e).append(t.render().el)}})},function(e,t,i){var s=i(1),n=i(916);e.exports=s.extend({events:{"click .CDB-Widget-controlButton":"_onClick"},initialize:function(){this._torqueLayerModel=this.options.torqueLayerModel,this._rangeFilter=this.options.rangeFilter,this.listenTo(this._torqueLayerModel,"change:isRunning",this.render),this.listenTo(this._torqueLayerModel,"change:start change.end",this.render)},render:function(){return this.$el.html(n({running:this._torqueLayerModel.get("isRunning"),disabled:!this._rangeFilter.isEmpty()})),this},_onClick:function(){this._torqueLayerModel.get("isRunning")?this._torqueLayerModel.pause():this._torqueLayerModel.play()}})},function(e,t,i){var s=i(250),n=i(9),o=i(1),r=i(5),a=i(242),l=i(544);e.exports=o.extend({defaults:{width:6,height:8},initialize:function(){if(!this.options.chartView)throw new Error("chartView is required");if(!this.options.torqueLayerModel)throw new Error("torqeLayerModel is required");if(!this.options.timeSeriesModel)throw new Error("timeSeriesModel is required");this.model=new n.core.Model,this._dataviewModel=this.options.dataviewModel,this._chartView=this.options.chartView,this._torqueLayerModel=this.options.torqueLayerModel,this._timeSeriesModel=this.options.timeSeriesModel,this._chartMargins=this._chartView.model.get("margin"),this._initBinds(),this._updateXScale(),this._createFormatter()},render:function(){if(!this.timeSlider){var e=s.behavior.drag().on("dragstart",this._onDragStart.bind(this)).on("drag",this._onDrag.bind(this)).on("dragend",this._onDragEnd.bind(this)),t=this._chartView.canvas.append("rect");this.timeSlider=t.attr("class","CDB-TimeSlider").attr("width",this.defaults.width).attr("height",this._calcHeight()).attr("rx",3).attr("ry",3).data([{x:0,y:0}]).attr("transform",this._translateXY).call(e),this.setElement(t.node())}return this._isTabletViewport()&&this._generateTimeSliderTip(),this},_isTabletViewport:function(){return l.isTabletViewport()},_generateTimeSliderTip:function(){var e=this._calcHeight()/2+3+2;e=Math.floor(e),this.timeSliderTip=this._chartView.canvas.select(".CDB-WidgetCanvas").append("g").attr("class","CDB-Chart-timeSliderTip").data([{x:16,y:e}]).attr("transform",this._translateXY),this.timeSliderTip.append("rect").attr("class","CDB-Chart-timeSliderTipRect").attr("rx","2").attr("ry","2").attr("height",17),this.timeSliderTip.append("text").attr("class","CDB-Text CDB-Size-small CDB-Chart-timeSliderTipText").attr("dy","11").attr("dx","0")},_onLocalTimezoneChanged:function(){this._createFormatter(),this._updateTimeSliderTip()},_updateTimeSliderTip:function(){var e=this,t=this._isDateTimeSeries()?this._torqueLayerModel.get("time"):this._torqueLayerModel.get("step");if(void 0!==t){var i=this._chartView.canvas,n=i.select(".CDB-Chart-timeSliderTipText"),o=s.scale.linear().domain([0,this._dataviewModel.get("data").length]).range([this._dataviewModel.get("start"),this._dataviewModel.get("end")]);if(n.data([t]).text(function(t){return e._isDateTimeSeries()?this.formatter(r(t).unix()):this.formatter(o(t))}.bind(this)),n.node()){var a=i.select(".CDB-Chart-timeSliderTipRect"),l=n.node().getBBox(),h=l.width+6,c=this._chartView.chartWidth()+16;a.attr("width",h),n.attr("dx",3),n.attr("dy",l.height-Math.abs((l.height-17)/2));var d=this._xScale(this._torqueLayerModel.get("step"))+this.defaults.width-h/2,u=this._calcHeight()/2+3+2;u=Math.floor(u);var p=this.timeSliderTip.data();p[0].y=u;var g=d;d<16?g=16:d+h>=c&&(g=c-h),isNaN(g)||(p[0].x=g,this.timeSliderTip.data(p).transition().ease("linear").attr("transform",this._translateXY))}}},_initBinds:function(){this.listenTo(this._torqueLayerModel,"change:start change:end",this._updateChartandTimeslider),this.listenTo(this._torqueLayerModel,"change:step",this._onChangeStep),this.listenTo(this._torqueLayerModel,"change:time",this._onChangeTime),this.listenTo(this._torqueLayerModel,"change:steps",this._updateChartandTimeslider),this.listenTo(this._chartView.model,"change:width",this._updateChartandTimeslider),this.listenTo(this._chartView.model,"change:height",this._onChangeChartHeight),this.listenTo(this._dataviewModel,"change:bins",this._updateChartandTimeslider),this.listenTo(this._dataviewModel,"change:column_type",this._createFormatter),this.listenTo(this._dataviewModel.filter,"change:min change:max",this._onFilterMinMaxChange),this.listenTo(this._timeSeriesModel,"change:local_timezone",this._onLocalTimezoneChanged),this.listenTo(this._dataviewModel,"change:start change:end",this._updateChartandTimeslider)},clean:function(){this.timeSlider&&this.timeSlider.remove(),o.prototype.clean.call(this)},_onFilterMinMaxChange:function(e,t){this.$el.toggle(!t)},_onDragStart:function(){var e=this._torqueLayerModel.get("isRunning");e&&this._torqueLayerModel.pause(),this.model.set({isDragging:!0,wasRunning:e})},_onDrag:function(e,t){var i=e.x+s.event.dx;if(this._isWithinRange(i)){e.x=i,this.timeSlider.attr("transform",this._translateXY);var n=Math.round(this._xScale.invert(e.x));this._torqueLayerModel.setStep(n)}},_onDragEnd:function(){this.model.set("isDragging",!1),this.model.get("wasRunning")&&this._torqueLayerModel.play()},_translateXY:function(e){return"translate("+[e.x,e.y]+")"},_isWithinRange:function(e){return e>=this._chartMargins.left&&e<=this._width()-this._chartMargins.right},_onChangeStep:function(){if(this.timeSlider&&!this.model.get("isDragging")){var e=this.timeSlider.data(),t=this._xScale(this._torqueLayerModel.get("step"));isNaN(t)||(e[0].x=t,this.timeSlider.data(e).transition().ease("linear").attr("transform",this._translateXY))}},_onChangeChartHeight:function(){var e=this._isTabletViewport()?this._calcHeight()/2+3:this._calcHeight();this.timeSlider.attr("height",e)},_onChangeTime:function(){this._dataviewModel.filter.isEmpty()&&this._isTabletViewport()?(this._chartView.canvas.select(".CDB-Chart-timeSliderTip").node()||this._generateTimeSliderTip(),this._updateTimeSliderTip()):this._removeTimeSliderTip()},_removeTimeSliderTip:function(){var e=this._chartView.canvas.select(".CDB-Chart-timeSliderTip");e.node()&&e.remove()},_updateChartandTimeslider:function(){this._updateXScale(),this._onChangeStep()},_calcHeight:function(){return this._chartView.chartHeight()+this.defaults.height},_createFormatter:function(){this.formatter=a.formatNumber,this._isDateTimeSeries()&&(this.formatter=a.timestampFactory(this._dataviewModel.get("aggregation"),this._dataviewModel.getCurrentOffset()))},_isDateTimeSeries:function(){return"date"===this._dataviewModel.getColumnType()},_updateXScale:function(){var e=1e3*(this._dataviewModel.get("end")-this._dataviewModel.get("start")),t=(this._torqueLayerModel.get("start")-1e3*this._dataviewModel.get("start"))/e,i=(this._torqueLayerModel.get("end")-1e3*this._dataviewModel.get("start"))/e,n=t*this._width()+this._chartMargins.left,o=i*this._width()-this._chartMargins.right;n=n<0?this._chartMargins.left:n,o=o>this._width()?this._width()-this._chartMargins.right:o,this._xScale=s.scale.linear().domain([0,this._torqueLayerModel.get("steps")]).range([n,o])},_width:function(){return this._chartView.model.get("width")}})},function(e,t,i){var s=i(0),n=i(923),o=i(1819),r=i(1818);e.exports=n.extend({defaults:s.extend({},n.prototype.defaults,{offsetLeft:34}),className:function(){return n.prototype.className+" CDB-Widget-content CDB-Widget-content--torqueTimeSeries u-flex"},initialize:function(){if(!this.options.torqueLayerModel)throw new Error("torqeLayerModel is required");if(!this.options.rangeFilter)throw new Error("rangeFilter is required");if(!this.options.dataviewModel)throw new Error("dataviewModel is required");if(!this.options.timeSeriesModel)throw new Error("timeSeriesModel is required");this._torqueLayerModel=this.options.torqueLayerModel,this._dataviewModel=this.options.dataviewModel,this._timeSeriesModel=this.options.timeSeriesModel,n.prototype.initialize.call(this)},_initBinds:function(){n.prototype._initBinds.call(this),this.listenTo(this._torqueLayerModel,"change:renderRange",this._onRenderRangeChanged),this.listenTo(this._torqueLayerModel,"change:steps change:start change:end",this._reSelectRange),this.listenTo(this._torqueLayerModel,"change:cartocss",this._onUpdateCartocss)},_createHistogramView:function(){this._chartType="date"===this._torqueLayerModel.get("column_type")?"time":"number",n.prototype._createHistogramView.call(this),this._torqueControls=new r({torqueLayerModel:this._torqueLayerModel,rangeFilter:this._rangeFilter}),this.addView(this._torqueControls),this.$el.prepend(this._torqueControls.render().el),this._chartView.setAnimated(),this._chartView.bind("on_brush_click",this._onBrushClick,this),this._timeSliderView=new o({dataviewModel:this._dataviewModel,chartView:this._chartView,torqueLayerModel:this._torqueLayerModel,timeSeriesModel:this._timeSeriesModel,rangeFilter:this._rangeFilter}),this.addView(this._timeSliderView),this._timeSliderView.render()},_onChangeData:function(){n.prototype._onChangeData.call(this),this._chartView&&this._reSelectRange()},_onRenderRangeChanged:function(e,t){void 0===t.start&&void 0===t.end&&(this._chartView.removeSelection(),this._rangeFilter.unsetRange())},_onBrushClick:function(e){var t=this._torqueLayerModel.get("steps"),i=Math.round(t*e);i===t&&(i-=1),n.prototype.resetFilter.apply(this),this._torqueLayerModel.set({step:i})},_onBrushEnd:function(){n.prototype._onBrushEnd.apply(this,arguments),this._reSelectRange()},_timeToStep:function(e,t){var i=this._torqueLayerModel.get("steps"),s=this._torqueLayerModel.get("start"),n=this._torqueLayerModel.get("end"),o=n-s==0?"max"===t?i:0:i*(1e3*e-s)/(n-s);return o=Number(o.toFixed(2))},_reSelectRange:function(e){if(this._rangeFilter.isEmpty())this._torqueLayerModel.play(),this._updateDuration(1);else{this._torqueLayerModel.pause();var t=this._rangeFilter.get("min"),i=this._rangeFilter.get("max"),n=this._timeToStep(t,"min"),o=this._timeToStep(i,"max"),r=this._dataviewModel.get("data"),a=s.findWhere(r,{start:t}),l=s.findWhere(r,{end:i});if(!a||!l)return this._torqueLayerModel.resetRenderRange();var h=this._torqueLayerModel.get("steps"),c=this._chartView.getSelectionExtent()/100;this._updateDuration(c),this._torqueLayerModel.renderRange(this._clampRangeVal(0,h,n),this._clampRangeVal(0,h,o))}},_updateDuration:function(e,t){if(this._torqueLayerModel.getAnimationDuration){var i=this._torqueLayerModel.getAnimationDuration(t||this._torqueLayerModel.get("cartocss"));this._torqueLayerModel.set("customDuration",Math.round(i*e))}},_onUpdateCartocss:function(e,t){var i;if(this._rangeFilter.isEmpty())i=1;else{var s=this._timeToStep(this._rangeFilter.get("min"));i=(this._timeToStep(this._rangeFilter.get("max"))-s)/this._torqueLayerModel.get("steps")}this._updateDuration(i,t,{silent:!0})},_clampRangeVal:function(e,t,i){return Math.max(e,Math.min(t,i))},_getMarginLeft:function(){return 16}})},function(e,t,i){var s=i(0),n=i(1),o=i(917),r=i(545),a=i(1820),l=i(1817),h=i(339),c=i(338),d=i(337),u=i(336);e.exports=n.extend({className:"CDB-Widget-body CDB-Widget-body--timeSeries",initialize:function(){if(!this.model.dataviewModel)throw new Error("dataviewModel is required");if(!this.model.layerModel)throw new Error("layerModel is required");this._dataviewModel=this.model.dataviewModel,this._layerModel=this.model.layerModel,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this._selectedAmount=0,this._initBinds()},render:function(){this.clearSubViews();var e=this._dataviewModel.get("source").id,t=c.letter(e),i=c.getColorForLetter(t),s=this._dataviewModel.getSourceType()||"",n=this._dataviewModel.isSourceType(),a=n?this.model.get("table_name"):this._layerModel.get("layer_name");return this._isDataEmpty()?this.$el.html(r({hasTorqueLayer:!0})):(this.$el.html(o({sourceId:e,sourceType:d.title(s),isSourceType:n,showSource:this.model.get("show_source")&&""!==t,sourceColor:i,layerName:u(a)})),this._createHeaderView(),this._createTorqueHistogramView(),this._createDropdownView()),this},_createHeaderView:function(){this._headerView&&this._headerView.remove(),this._headerView=new l({el:this.$(".js-torque-header"),dataviewModel:this._dataviewModel,torqueLayerModel:this._layerModel,timeSeriesModel:this.model,selectedAmount:this._selectedAmount}),this.addView(this._headerView),this._headerView.render()},_createTorqueHistogramView:function(){this._histogramView&&this._histogramView.remove(),this._histogramView=new a({timeSeriesModel:this.model,dataviewModel:this._dataviewModel,rangeFilter:this._dataviewModel.filter,torqueLayerModel:this._layerModel,layerModel:this._layerModel,displayShadowBars:!this.model.get("normalized"),normalized:!!this.model.get("normalized")}),this.addView(this._histogramView),this.$el.append(this._histogramView.render().el)},_createDropdownView:function(){this._dropdownView&&this._dropdownView.remove(),this._dropdownView=new h({model:this.model,target:".js-actions",container:this.$(".js-header"),flags:{localTimezone:"date"===this._dataviewModel.getColumnType(),normalizeHistogram:!!this.model.get("normalized"),canCollapse:!1}}),this.addView(this._dropdownView)},_initBinds:function(){this.listenTo(this._originalData,"change:data",this._onOriginalDataChange),this.listenTo(this._dataviewModel,"change:data",this.render),this.listenTo(this._dataviewModel,"change:bins",this._onChangeBins),this.listenTo(this._layerModel,"change:layer_name",this.render),this.add_related_model(this._layerModel)},_isDataEmpty:function(){var e=this._dataviewModel.getData();return s.isEmpty(e)||0===s.size(e)},_onOriginalDataChange:function(){this._dataviewModel.fetch()},_onChangeBins:function(e,t){this._originalData.setBins(t)}})},function(e,t,i){var s=i(5),n=i(0),o={substractOneUnit:function(e,t){if(!n.isNumber(e))return e;var i=s.unix(e).utc();return t&&"week"===t?i.subtract(1,"day"):i.subtract(1,t),i.unix()}};e.exports=o},function(e,t,i){var s=i(4),n=i(0),o=i(2),r=o.Model.extend({initialize:function(e){return n.bindAll(this,"fetch","save","retrigger"),o.Model.prototype.initialize.call(this,e)},fetch:function(e){var t=this;this.trigger("loadModelStarted"),s.when(o.Model.prototype.fetch.call(this,e)).done(function(e){t.trigger("loadModelCompleted",e,t)}).fail(function(e){t.trigger("loadModelFailed",e,t)})},setIdAttribute:function(e){this.idAttribute=e},retrigger:function(e,t,i){i||(i=e);var s=this;t.bind&&t.bind(e,function(){s.trigger(i)},s)},save:function(e,t){var i=this;t&&t.silent||this.trigger("saving");var n=o.Model.prototype.save.apply(this,arguments);return s.when(n).done(function(){t&&t.silent||i.trigger("saved")}).fail(function(){t&&t.silent||i.trigger("errorSaving")}),n}});e.exports=r},function(e,t,i){var s=i(0),n=i(1),o=i(545),r=i(924),a=i(923),l=i(921),h=i(339),c=i(338),d=i(337),u=i(336);e.exports=n.extend({className:"CDB-Widget-body CDB-Widget-body--timeSeries",initialize:function(){if(!this.model.dataviewModel)throw new Error("dataviewModel is required");if(!this.model.layerModel)throw new Error("layerModel is required");this._dataviewModel=this.model.dataviewModel,this._layerModel=this.model.layerModel,this._selectedAmount=0,this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty();var e=this._dataviewModel.get("source").id,t=c.letter(e),i=c.getColorForLetter(t),s=this._dataviewModel.getSourceType()||"",n=this._dataviewModel.isSourceType(),a=n?this.model.get("table_name"):this._layerModel.get("layer_name");return this._isDataEmpty()||this._hasError()?this.$el.append(o({hasTorqueLayer:!1})):(this.$el.append(r({sourceId:e,sourceType:d.title(s),isSourceType:n,showSource:this.model.get("show_source")&&""!==t,sourceColor:i,layerName:u(a)})),this._createHistogramView(),this._createHeaderView(),this._createDropdownView(),this._updateRange()),this},_initBinds:function(){this._dataviewModel.once("error",function(){console.log("the tiler does not support non-torque layers just yet\u2026")}),this.listenTo(this._dataviewModel,"change:data",this.render),this.listenToOnce(this.model,"change:hasInitialState",this.render),this.listenTo(this._layerModel,"change:layer_name",this.render),this.add_related_model(this._layerModel)},_createHistogramView:function(){this._histogramView&&this._histogramView.remove(),this._histogramView=new a({timeSeriesModel:this.model,dataviewModel:this._dataviewModel,layerModel:this._layerModel,rangeFilter:this._dataviewModel.filter,displayShadowBars:!this.model.get("normalized"),normalized:!!this.model.get("normalized")}),this.addView(this._histogramView),this.$(".js-content").append(this._histogramView.render().el)},_createHeaderView:function(){if(this._headerView&&this._headerView.remove(),this._headerView=new l({dataviewModel:this._dataviewModel,layerModel:this._layerModel,rangeFilter:this._dataviewModel.filter,timeSeriesModel:this.model,showClearButton:!0,selectedAmount:this._selectedAmount}),!this._histogramView)throw new Error("Histogram view must be instantiated before the header view");this._headerView.bind("resetFilter",this._histogramView.resetFilter,this._histogramView),this.addView(this._headerView),this.$(".js-title").append(this._headerView.render().el)},_createDropdownView:function(){this._dropdownView&&this._dropdownView.remove(),this._dropdownView=new h({model:this.model,target:".js-actions",container:this.$(".js-header"),flags:{localTimezone:"date"===this._dataviewModel.getColumnType(),normalizeHistogram:!0,canCollapse:!1}}),this.addView(this._dropdownView)},_updateRange:function(){var e=this._calculateBars(),t=this._dataviewModel.get("bins"),i=Math.max(e.loBarIndex,0),s=Math.min(e.hiBarIndex,t);(i>0||s<t)&&this._histogramView.selectRange(i,s)},_calculateBars:function(){var e,t,i=this._dataviewModel.getData(),n=this.model.get("min"),o=this.model.get("max"),r=this.model.get("lo_index"),a=this.model.get("hi_index");return i.length>0?(s.isNumber(n)||s.isNumber(r)?s.isNumber(n)&&!s.isNumber(r)&&(r=(e=s.findWhere(i,{start:n}))&&e.bin||0):r=0,s.isNumber(o)||s.isNumber(a)?s.isNumber(o)&&!s.isNumber(a)&&(a=(t=s.findWhere(i,{end:o}))&&t.bin+1||i.length):a=i.length):(r=0,a=i.length),{loBarIndex:r,hiBarIndex:a}},_appendView:function(e){this.addView(e),this.$el.append(e.render().el)},_isDataEmpty:function(){var e=this._dataviewModel.getUnfilteredData();return s.isEmpty(e)||0===s.size(e)},_hasError:function(){return this._dataviewModel.has("error")}})},function(e,t,i){var s=i(0),n={generic:{level:"error",refresh:!0},limit:{level:"error",error:"Timeout",message:"The server is taking too long to respond, due to poor conectivity or a temporary error with our servers. Please try again soon.",refresh:!0},no_data_available:{level:"alert",error:"No data available",message:"There are no results for the combination of filters applied to your data. Try tweaking your filters, or zoom and pan the map to adjust the Map View.",refresh:!1},too_many_bins:{level:"error",error:"Too many bins returned",message:"There are too many bins returned. Try selecting a less granular aggregation or filtering the data source.",refresh:!1},dataview:{level:"error",refresh:!1}};e.exports=function(e){var t=e&&e.type&&s.has(n,e.type)?e.type:"generic";return s.extend({},e,n[t])}},function(e,t,i){var s=i(1),n=i(0),o=i(927),r=i(926);e.exports=s.extend({className:"CDB-Widget-body is-hidden",events:{"click .js-refresh":"_onRefreshClick"},initialize:function(e){this._title=e.title,this._errorModel=e.errorModel,this.listenTo(this._errorModel,"change",this._onErrorModelChanged)},render:function(){var e=this._errorModel.get("error");if(e){var t=this._errorModel.get("placeholder"),i=n.isFunction(t)?t():"";this.$el.addClass("CDB-Widget--"+e.level);var s=e.type?r({placeholder:i,error:e.error,title:this._title,message:e.message,refresh:e.refresh}):o({placeholder:i});this.$el.html(s)}return this},_onErrorModelChanged:function(){this._reset(),n.isEmpty(this._errorModel.get("error"))?this.$el.addClass("is-hidden"):this.$el.removeClass("is-hidden"),this.render()},_onRefreshClick:function(){this._errorModel.get("model").refresh()},_reset:function(){this.$el.removeClass("CDB-Widget--alert CDB-Widget--error"),this.$el.html("")}})},function(e,t,i){var s=i(1);e.exports=s.extend({className:"CDB-Widget-loader",initialize:function(){this._initBinds()},render:function(){return this.$el.append('<div class="CDB-Loader js-loader"></div>'),this},show:function(){this.$(".js-loader").addClass("is-visible"),clearTimeout(this._timeout)},hide:function(){var e=this;this._timeout=setTimeout(function(){e.$(".js-loader").removeClass("is-visible")},500)},_initBinds:function(){this.model.bind("loading",this.show,this),this.model.bind("error",function(e,t){(!t||t&&"abort"!==t.statusText)&&this.hide()},this),this.model.bind("loaded",this.hide,this)}})},function(e,t,i){var s=i(2),n=i(0),o=i(1),r=i(1827),a=i(1826),l=i(1825),h=i(392),c=i(7),d={category:i(547),formula:i(925),histogram:i(546)};e.exports=o.extend({className:"CDB-Widget CDB-Widget--light",options:{columns_title:[]},initialize:function(){this.errorModel=new s.Model({});var e=this.model.dataviewModel;this.listenTo(this.model,"destroy",this.clean),this.listenTo(this.model,"error",this._onError),this.listenTo(this.model,"setDisabled",this._setDisabled),this.listenTo(e,"statusError",this._onError),this.listenTo(e,"sync change:data",this._onDataChanged)},render:function(){return this.clearSubViews(),this.$el.empty(),this._appendView(new r({model:this.model.dataviewModel})),this._appendView(new a({title:this.model.get("title"),errorModel:this.errorModel})),this._appendView(this.options.contentView),this},_onDataChanged:function(e){return this._noDataAvailable()?(this.options.contentView.$el.addClass("is-hidden"),this.errorModel.set({model:e,error:l({type:"no_data_available"}),placeholder:this._getPlaceholder()})):this._dataHasTooManyBins()?(this.options.contentView.$el.addClass("is-hidden"),this.errorModel.set({model:e,error:l({type:"too_many_bins"}),placeholder:this._getPlaceholder()})):void(n.isEmpty(this.errorModel.get("error"))||(this.errorModel.clear(),this.options.contentView.render(),this.options.contentView.$el.removeClass("is-hidden")))},_onError:function(e,t){if(!t||"abort"!==t.message){var i=l(t);this.options.contentView.$el.addClass("is-hidden"),this.errorModel.set({model:e,error:i,placeholder:this._getPlaceholder()})}},_appendView:function(e){this.$el.append(e.render().el),this.addView(e)},_noDataAvailable:function(){var e=this._isHistogram()?"totalAmount":"data",t=this.model.dataviewModel.get(e);return!c.hasValue(t)||n.isArray(t)&&n.isEmpty(t)},_dataHasTooManyBins:function(){if(this._isHistogram()){var e=this.model.dataviewModel.getUnfilteredData&&this.model.dataviewModel.getUnfilteredData();return!n.isEmpty(e)&&n.size(e)>367}return!1},_isHistogram:function(){return"histogram"===this.model.dataviewModel.get("type")},_extractError:function(e){var t=h(e,"responseJSON.errors_with_context",[]);return t.length>0?t[0]:e&&e.message?(e.type=e.type||"generic",e):{}},_getPlaceholder:function(){var e=this.model.dataviewModel.get("type");return d[e]},_setDisabled:function(e,t){var i=e.get("id")!==t;t&&!i&&this.el.scrollIntoView&&this.el.scrollIntoView(),this.$el.toggleClass("is-disabled",null!==t&&i)}})},function(e,t,i){var s=i(0),n=i(1),o=i(928),r=i(1824),a=i(1821);e.exports=n.extend({className:"CDB-Dashboard-belowMap",initialize:function(e){this._widgetViewFactory=new o([{match:function(e){if("time-series"===e.get("type")){var t=e.dataviewModel,i=e.layerModel;return t&&"torque"===i.get("type")&&!0===e.get("animated")}return!1},createContentView:function(e){return new a({model:e})},customizeWidgetAttrs:function(e){return e.className+=" CDB-Widget--timeSeries",e}},{type:"time-series",createContentView:function(e){return new r({model:e})},customizeWidgetAttrs:function(e){return e.className+=" CDB-Widget--timeSeries",e}}]),this._widgets=e.widgets,this._widgets.bind("add",this._maybeRenderWidgetView,this),this._widgets.bind("reset",this.render,this),this._widgets.bind("add reset remove",this._onWidgetsChange,this),this.add_related_model(this._widgets)},render:function(){return this.clearSubViews(),this.$el.empty(),this._widgets.each(this._maybeRenderWidgetView,this),this._toggleVisiblity(),this},_maybeRenderWidgetView:function(e){var t=this._widgetViewFactory.createWidgetView(e);t&&(this.addView(t),this.$el.append(t.render().el))},_toggleVisiblity:function(){this.$el.toggle(!s.isEmpty(this._subviews))},_onWidgetsChange:function(){this._widgets.each(function(e){e.forceResize()}),this._toggleVisiblity()}})},function(e,t,i){var s=i(4),n=i(1),o=i(929),r=i(1829),a=i(1815),l=i(1814);e.exports=n.extend({className:"CDB-Dashboard-canvas",initialize:function(e){this._widgets=e.widgets,this._infoView=e.infoView,this.el.classList.add(this.className),this.$el.html(o()),this._onWindowResize=this._onWindowResize.bind(this),s(window).bind("resize",this._onWindowResize)},render:function(){var e;this.clearSubViews();var t=this.model.get("renderMenu");return this.$el.toggleClass("CDB-Dashboard-canvas--withMenu",t),t&&(e=new a({model:this.model}),this.addView(e),this.$el.append(e.render().el)),this._widgets.some(function(e){return"time-series"===e.get("type")})&&this.$el.toggleClass("CDB-Dashboard-canvas--withTimeSeries"),e=new r({widgets:this._widgets}),this.addView(e),this.$(".js-map-wrapper").toggleClass("CDB-Dashboard-mapWrapper--withMenu",t).append(e.render().el),this._widgets&&this._widgets.length&&this.$el.toggleClass("CDB-Dashboard-canvas--withWidgets"),e=new l({widgets:this._widgets,model:this.model}),this.addView(e),this.$el.append(e.render().el),this},getInitialMapState:function(){return{bounds:this.model.get("initialPosition").bounds}},_onWindowResize:function(){this._widgets.each(function(e){e.forceResize()})},clean:function(){s(window).unbind("resize",this._onWindowResize),n.prototype.clean.call(this)}})},,function(e,t,i){var s=i(548),n=i(0);function Dashboard(e){this._dashboard=e,this.onDataviewsFetched(function(){e.widgets._widgetsCollection.initialState(),e.widgets._widgetsCollection.each(function(e){e&&e.applyInitialState&&e.applyInitialState()})})}Dashboard.prototype={getView:function(){return this._dashboard.dashboardView},getMap:function(){return this._dashboard.vis},reloadMap:function(){this.getMap().reload()},forceResize:function(){this._dashboard.widgets.getCollection().each(function(e){e.forceResize()})},getWidgets:function(){return this._dashboard.widgets.getList()},getDashboardURL:function(){return s.getURLFromState(this.getState())},getState:function(){var e={},t=this.getMapState();n.isEmpty(t)||(e.map=t);var i=this._dashboard.widgets.getCollection().getStates();return n.isEmpty(i)||(e.widgets=i),e},getMapState:function(){var e=this._dashboard.vis.map,t=e.getViewBounds(),i=e.get("center"),s=e.get("zoom");return{ne:t[0],sw:t[1],center:i,zoom:s}},setState:function(e){this._dashboard.widgets.setWidgetsState(e.widgets),this._dashboard.vis.mapvis.map.setBounds([e.map.ne,e.map.sw])},onDataviewsFetched:function(e){this._dashboard.areWidgetsInitialised()?e&&e():this._dashboard.vis.once("dataviewsFetched",function(){e&&e()})},onStateChanged:function(e){this.onDataviewsFetched(function(){e&&this._bindChange(e)}.bind(this))},_bindChange:function(e){this._dashboard.widgets.getCollection().bind("change",function(){e(this.getState(),this.getDashboardURL())},this),this._dashboard.vis.map.bind("change",function(){e(this.getState(),this.getDashboardURL())},this)},getWidget:function(e){return this._dashboard.widgets.get(e)},createCategoryWidget:function(e,t){return this._dashboard.widgets.createCategoryModel(e,t,null)},createHistogramWidget:function(e,t){return this._dashboard.widgets.createHistogramModel(e,t,null)},createFormulaWidget:function(e,t){return this._dashboard.widgets.createFormulaModel(e,t,null)},createTimeSeriesWidget:function(e,t){return this._dashboard.widgets.createTimeSeriesModel(e,t,null)}},e.exports=Dashboard},function(e,t,i){var s=i(0),n=i(9),o=i(1832),r=i(1830),a=i(1801),l=i(1800),h=i(548),c=function(e,t,i,o){var c=document.querySelector(e);if(!c)throw new Error("no element found with selector "+e);(i=i||{}).renderMenu=!s.isBoolean(i.renderMenu)||i.renderMenu,i.autoStyle=!!s.isBoolean(i.autoStyle)&&i.autoStyle;var d=new a,u=new n.core.Model({title:t.title,description:t.description,updatedAt:t.updated_at,userName:t.user.fullname,userProfileURL:t.user.profile_url,userAvatarURL:t.user.avatar_url,renderMenu:i.renderMenu,autoStyle:i.autoStyle,showLogo:i.cartodb_logo,initialPosition:{bounds:t.bounds}}),p=new r({el:c,widgets:d,model:u}),g=i.state||h.getStateFromCurrentURL();g&&!s.isEmpty(g.map)&&(s.isArray(g.map.center)&&(t.center=g.map.center),s.isNumber(g.map.zoom)&&(t.zoom=g.map.zoom),g.map.ne&&g.map.sw&&(t.bounds=[g.map.ne,g.map.sw])),n.createVis(p.$("#map"),t,s.extend(i,{skipMapInstantiation:!0})).once("load",function(e){var i=g&&g.widgets||{},r=new l(d,e.dataviews),a={formula:r.createFormulaModel.bind(r),histogram:r.createHistogramModel.bind(r),"time-series":r.createTimeSeriesModel.bind(r),category:r.createCategoryModel.bind(r)};t.widgets.forEach(function(t){var o,r,l=s.extend({},t,t.options),h=a[t.type],c=i[t.id];s.isFunction(h)?(t.layer_id?o=e.map.layers.get(t.layer_id):Number.isInteger(t.layerIndex)&&(o=e.map.layers.at(t.layerIndex)),t.source&&t.source.id&&(r=e.analysis.findNodeById(t.source.id),l.source=r),h(l,o,c)):n.log.error("No widget found for type "+t.type)}),p.render();var h={dashboardView:p,widgets:r,areWidgetsInitialised:function(){var e=r.getCollection();return!(e.size()>0)||e.hasInitialState()},vis:e};e.instantiateMap({success:function(){o&&o(null,h)},error:function(e){o&&o(new Error(e),h)}})})};e.exports=function(e,t,i,r){var a=arguments,l=a[a.length-1];function _load(t){c(e,t,i,function(e,t){var n=new o(t);i.share_urls&&n.onStateChanged(s.debounce(function(e,t){window.history.replaceState("Object","Title",t)},500)),r&&r(e,n)})}s.isFunction(l)&&(r=l),"string"==typeof t?n.core.Loader.get(t,function(e){e?_load(e):r&&r(new Error("Error fetching viz.json file: "+t))}):_load(t)}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(938),r=i(3),a=["modalModel","onPasswordTyped"];e.exports=n.extend({events:{"click .js-ok":"_onConfirm","click .js-cancel":"_closeDialog","keydown #password-confirmation-form":"_onEnterPressed","input .js-password":"_toggleConfirmButton"},initialize:function initialize(e){r(e,a,this),this._isConfirmDisabled=!0},render:function render(){return this.$el.html(o({isConfirmDisabled:this._isConfirmDisabled})),this._okButton=this.$(".js-ok"),this},_toggleConfirmButton:function _toggleConfirmButton(e){var t=e.target;this._isConfirmDisabled=s.isEmpty(t.value),this._okButton.toggleClass("is-disabled",this._isConfirmDisabled)},_onConfirm:function _onConfirm(e){if(this.killEvent(e),!this._isConfirmDisabled){var t=this.$("#password-confirmation").val();this._onPasswordTyped&&this._onPasswordTyped(t),this._closeDialog()}},_onEnterPressed:function _onEnterPressed(e){13===e.keyCode&&this._onConfirm(e)},_closeDialog:function _closeDialog(){this._modalModel.destroy()}})},,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=function BytesToSize(e){return this instanceof BytesToSize?(this.bytes=e,this.unit=0===e?0:parseInt(Math.floor(Math.log(e)/Math.log(1024))),this):new BytesToSize(e)};s.prototype.size=function(){return this.bytes/Math.pow(1024,this.unit)},s.prototype.UNIT_SUFFIXES=["B","kB","MB","GB","TB"],s.prototype.suffix=function(){return this.UNIT_SUFFIXES[this.unit]},s.prototype.toString=function(e){var t=this.size();if(e){var i=Math.pow(10,e);t=Math.floor(t*i)/i}else t=Math.floor(t);return t+this.suffix()},e.exports=s},,,,function(e,t,i){"use strict";var s=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();var n=i(947),o=function(e){function AuthenticatedClient(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,AuthenticatedClient),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(AuthenticatedClient.__proto__||Object.getPrototypeOf(AuthenticatedClient)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(AuthenticatedClient,n),s(AuthenticatedClient,[{key:"getConfig",value:function getConfig(e){return this.get(["api/v3/me"],e)}},{key:"getVisualization",value:function getVisualization(e,t,i){var s=this.paramsToURI(t);return this.get(["api/v1/viz",e,s],i)}},{key:"getDerivedVisualizations",value:function getDerivedVisualizations(e,t){var i=Object.assign({type:"derived",privacy:"public"},e),s=this.paramsToURI(i);return this.get(["api/v1/viz",s],t)}},{key:"getMap",value:function getMap(e,t){return this.get(["api/v1/maps",e],t)}},{key:"putConfig",value:function putConfig(e,t){var i={data:JSON.stringify(e),dataType:"json"};return this.put(["api/v3/me"],i,t)}},{key:"deleteUser",value:function deleteUser(e,t){var i={data:JSON.stringify(e),dataType:"json"};return this.delete(["api/v3/me"],i,t)}}]),AuthenticatedClient}();e.exports=o},,,,,,,,,,,function(e,t,i){"use strict";var s=i(2),n=i(3);i(605);var o=["configModel","userId"];e.exports=s.Model.extend({url:function url(e){return"/api/"+this._configModel.urlVersion("asset",e)+"/users/"+this._userId+"/assets"},fileAttribute:"filename",initialize:function initialize(e,t){n(t,o,this)}})},function(e,t,i){(function(e){!function(e){"use strict";var t=function(t,i){this.options=i,this.$elementFilestyle=[],this.$element=e(t)};t.prototype={clear:function(){this.$element.val(""),this.$elementFilestyle.find(":text").val("")},destroy:function(){this.$element.removeAttr("style").removeData("filestyle").val(""),this.$elementFilestyle.remove()},disabled:function(e){if(!0===e)this.options.disabled||(this.$element.attr("disabled","true"),this.$elementFilestyle.find("label").attr("disabled","true"),this.options.disabled=!0);else{if(!1!==e)return this.options.disabled;this.options.disabled&&(this.$element.removeAttr("disabled"),this.$elementFilestyle.find("label").removeAttr("disabled"),this.options.disabled=!1)}},buttonBefore:function(e){if(!0===e)this.options.buttonBefore||(this.options.buttonBefore=!0,this.options.input&&(this.$elementFilestyle.remove(),this.constructor(),this.pushNameFiles()));else{if(!1!==e)return this.options.buttonBefore;this.options.buttonBefore&&(this.options.buttonBefore=!1,this.options.input&&(this.$elementFilestyle.remove(),this.constructor(),this.pushNameFiles()))}},icon:function(e){if(!0===e)this.options.icon||(this.options.icon=!0,this.$elementFilestyle.find("label").prepend(this.htmlIcon()));else{if(!1!==e)return this.options.icon;this.options.icon&&(this.options.icon=!1,this.$elementFilestyle.find(".glyphicon").remove())}},input:function(e){if(!0===e){if(!this.options.input){this.options.input=!0,this.options.buttonBefore?this.$elementFilestyle.append(this.htmlInput()):this.$elementFilestyle.prepend(this.htmlInput()),this.$elementFilestyle.find(".badge").remove();var t="",i=[];void 0===this.$element[0].files?i[0]={name:this.$element[0].value}:i=this.$element[0].files;for(var s=0;s<i.length;s++)t+=i[s].name.split("\\").pop()+", ";""!==t&&this.$elementFilestyle.find(":text").val(t.replace(/\, $/g,"")),this.$elementFilestyle.find(".group-span-filestyle").addClass("input-group-btn")}}else{if(!1!==e)return this.options.input;if(this.options.input){this.options.input=!1,this.$elementFilestyle.find(":text").remove();i=[];void 0===this.$element[0].files?i[0]={name:this.$element[0].value}:i=this.$element[0].files,i.length>0&&this.$elementFilestyle.find("label").append(' <span class="badge">'+i.length+"</span>"),this.$elementFilestyle.find(".group-span-filestyle").removeClass("input-group-btn")}}},size:function(e){if(void 0===e)return this.options.size;var t=this.$elementFilestyle.find("label"),i=this.$elementFilestyle.find("input");t.removeClass("btn-lg btn-sm"),i.removeClass("input-lg input-sm"),"nr"!=e&&(t.addClass("btn-"+e),i.addClass("input-"+e))},buttonText:function(e){if(void 0===e)return this.options.buttonText;this.options.buttonText=e,this.$elementFilestyle.find("label span").html(this.options.buttonText)},buttonName:function(e){if(void 0===e)return this.options.buttonName;this.options.buttonName=e,this.$elementFilestyle.find("label").attr({class:"btn "+this.options.buttonName})},iconName:function(e){if(void 0===e)return this.options.iconName;this.$elementFilestyle.find(".glyphicon").attr({class:".glyphicon "+this.options.iconName})},htmlIcon:function(){return this.options.icon?'<span class="glyphicon '+this.options.iconName+'"></span> ':""},htmlInput:function(){return this.options.input?'<input type="text" class="form-control '+("nr"==this.options.size?"":"input-"+this.options.size)+'" disabled> ':""},pushNameFiles:function(){var e="",t=[];void 0===this.$element[0].files?t[0]={name:this.$element.value}:t=this.$element[0].files;for(var i=0;i<t.length;i++)e+=t[i].name.split("\\").pop()+", ";""!==e?this.$elementFilestyle.find(":text").val(e.replace(/\, $/g,"")):this.$elementFilestyle.find(":text").val("")},constructor:function(){var t,i,s,n=this,o=this.$element.attr("id"),r=[];""!==o&&o||(o="filestyle-"+e(".bootstrap-filestyle").length,this.$element.attr({id:o})),i='<span class="group-span-filestyle '+(this.options.input?"input-group-btn":"")+'"><label for="'+o+'" class="btn '+this.options.buttonName+" "+("nr"==this.options.size?"":"btn-"+this.options.size)+'" '+(this.options.disabled?'disabled="true"':"")+">"+this.htmlIcon()+this.options.buttonText+"</label></span>",t=this.options.buttonBefore?i+this.htmlInput():this.htmlInput()+i,this.$elementFilestyle=e('<div class="bootstrap-filestyle input-group">'+t+"</div>"),(s=this.$elementFilestyle.find("label")).parent().attr("tabindex","0").keypress(function(e){13!==e.keyCode&&32!==e.charCode||s.click()}),this.$element.css({position:"absolute",clip:"rect(0,0,0,0)"}).attr("tabindex","-1").after(this.$elementFilestyle),this.options.disabled&&this.$element.attr("disabled","true"),this.$element.change(function(){var e="";void 0===this.files?r[0]={name:this.value}:r=this.files;for(var t=0;t<r.length;t++)e+=r[t].name.split("\\").pop()+", ";""!==e?n.$elementFilestyle.find(":text").val(e.replace(/\, $/g,"")):n.$elementFilestyle.find(":text").val(""),0==n.options.input?0==n.$elementFilestyle.find(".badge").length?n.$elementFilestyle.find("label").append(' <span class="badge">'+r.length+"</span>"):0==r.length?n.$elementFilestyle.find(".badge").remove():n.$elementFilestyle.find(".badge").html(r.length):n.$elementFilestyle.find(".badge").remove()}),window.navigator.userAgent.search(/firefox/i)>-1&&this.$elementFilestyle.find("label").click(function(){return n.$element.click(),!1})}};var i=e.fn.filestyle;e.fn.filestyle=function(i,s){var n="",o=this.each(function(){if("file"===e(this).attr("type")){var o=e(this),r=o.data("filestyle"),a=e.extend({},e.fn.filestyle.defaults,i,"object"==typeof i&&i);r||(o.data("filestyle",r=new t(this,a)),r.constructor()),"string"==typeof i&&(n=r[i](s))}});return void 0!==typeof n?n:o},e.fn.filestyle.defaults={buttonText:"Choose file",iconName:"glyphicon-folder-open",buttonName:"btn-default",size:"nr",input:!0,icon:!0,buttonBefore:!1,disabled:!1},e.fn.filestyle.noConflict=function(){return e.fn.filestyle=i,this},e(function(){e(".filestyle").each(function(){var t=e(this),i={input:"false"!==t.attr("data-input"),icon:"false"!==t.attr("data-icon"),buttonBefore:"true"===t.attr("data-buttonBefore"),disabled:"true"===t.attr("data-disabled"),size:t.attr("data-size"),buttonText:t.attr("data-buttonText"),buttonName:t.attr("data-buttonName"),iconName:t.attr("data-iconName")};t.filestyle(i)})})}(e)}).call(this,i(4))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(244);e.exports=s.extend({className:"Dropdown",hide:function hide(){this.$el.css({opacity:0})}})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(4),n=i(244),o=i(393);e.exports=n.extend({className:"CDB-Text Dropdown Dropdown--public",render:function render(){return this.$el.html(o()),s("body").append(this.el),this}})},function(e,t,i){"use strict";var s=i(4),n=i(396),o=i(244);e.exports=o.extend({className:"CDB-Text Dropdown",render:function render(){var e=this.model,t=e.viewUrl();return this.$el.html(n({name:e.fullName()||e.get("username"),email:e.get("email"),isOrgOwner:e.isOrgOwner(),dashboardUrl:t.dashboard(),publicProfileUrl:t.publicProfile(),accountProfileUrl:t.accountProfile(),logoutUrl:t.logout()})),s("body").append(this.el),this}})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(4),n=i(0),o=i(1),r=i(569),a=i(6),l=["username","avatar"];e.exports=o.extend({initialize:function initialize(e){n.each(l,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this)},render:function render(){return this.clearSubViews(),this.$el.html(r({avatar:this._avatar,username:this._username})),this._initViews(),this},_initViews:function _initViews(){var e=new a({el:this.$(".js-avatar"),title:function title(){return s(this).attr("data-title")}});this.addView(e)}})},function(e,t,i){"use strict";var s=i(1),n=i(0),o=i(570),r=i(2185),a=["users"];e.exports=s.extend({initialize:function initialize(e){n.each(a,function(t){if(!e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this)},render:function render(){return this.clearSubViews(),this.$el.html(o({people:this._getRemainsPeople()})),this._renderUsers(),this},_getRemainsPeople:function _getRemainsPeople(){return Math.max(0,this._users.length-3)},_renderUsers:function _renderUsers(){n.each(this._users.slice(0,3),this._renderUser,this)},_renderUser:function _renderUser(e){var t=new r({username:e.username,avatar:e.avatar_url});this.$(".js-content").append(t.render().el),this.addView(t)}})},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(571),r=i(6),a=i(4),l=i(2186),h=["model","permission","name","canChangeReadAccess","hasReadAccess","hasWriteAccessAvailable","canChangeWriteAccess","hasWriteAccess","isSelected"],c=["description","role","avatar","users"];e.exports=n.extend({className:"Share-permission",events:{"change .js-read":"_onChangeRead","change .js-write":"_onChangeWrite","mouseover .js-toggler.is-disabled":"_onHoverDisabledToggler","mouseout .js-toggler":"_destroyTooltip","mouseleave .js-toggler":"_destroyTooltip"},initialize:function initialize(e){s.each(h,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),s.each(c,function(t){this["_"+t]=e[t]},this)},render:function render(){return this.clearSubViews(),this.$el.html(o({name:this._name,avatar:this._avatar,role:this._role,users:this._users,description:this._description,canChangeReadAccess:this._canChangeReadAccess,hasReadAccess:this._hasReadAccess,hasWriteAccessAvailable:this._hasWriteAccessAvailable,canChangeWriteAccess:this._canChangeWriteAccess,hasWriteAccess:this._hasWriteAccess})),this._users&&this._renderUsers(),this.$el.toggleClass("is-selected",this._isSelected),this},_renderUsers:function _renderUsers(){var e=new l({className:"u-flex u-alignCenter",users:this._users});this.$(".js-users").append(e.render().el),this.addView(e)},_onChangeWrite:function _onChangeWrite(){var e=this._permission;e.canChangeWriteAccess(this._model)&&(e.hasWriteAccess(this._model)?e.revokeWriteAccess(this._model):e.grantWriteAccess(this._model))},_onChangeRead:function _onChangeRead(){var e=this._permission;e.canChangeReadAccess(this._model)&&(e.hasReadAccess(this._model)?e.revokeAccess(this._model):e.grantReadAccess(this._model))},_onHoverDisabledToggler:function _onHoverDisabledToggler(e){var t,i,s=this._permission.findRepresentableAclItem(this._model);s&&!s.isOwn(this._model)&&(t=this._inheritedAccessTooltipText(s),i=a(e.currentTarget),this._tooltip=this._createTooltip({$el:i,msg:t}),this._tooltip.showTipsy())},_createTooltip:function _createTooltip(e){return new r({el:e.$el,title:function title(){return e.msg}})},_destroyTooltip:function _destroyTooltip(){this._tooltip&&(this._tooltip.hideTipsy(),this._tooltip.destroyTipsy())},_inheritedAccessTooltipText:function _inheritedAccessTooltipText(e){var t=e.get("type");switch(t){case"group":return _t("components.modals.publish.share.tooltip.group",{name:e.get("entity").get("name")});case"org":return _t("components.modals.publish.share.tooltip.org");default:return console.error("Trying to display inherited access for an unrecognized type "+t),""}}})},function(e,t,i){"use strict";var s=i(1),n=i(0),o=i(2187),r=["collection","currentUserId","organization","hasOrganization","sharePermissionModel","isVisualization"];e.exports=s.extend({className:"Share-list",initialize:function initialize(e){n.each(r,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),this._sortedCollection=this._sortCollection(),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function _initBinds(){this._sharePermissionModel.acl.on("add remove reset change",this.render,this),this.add_related_model(this._sharePermissionModel)},_initViews:function _initViews(){this._hasOrganization&&this._renderOrganization(),n.each(this._sortedCollection,this._renderItem,this)},_sortCollection:function _sortCollection(){var e=this._collection.filter(function(e){var t=this._sharePermissionModel,i=t.hasWriteAccess(e),s=t.hasReadAccess(e);return i||s},this),t=this._collection.filter(function(e){var t=this._sharePermissionModel,i=t.hasWriteAccess(e),s=t.hasReadAccess(e);return!i&&!s},this);return e.concat(t)},_renderOrganization:function _renderOrganization(){var e=this._organization,t=this._sharePermissionModel,i=!this._isVisualization,s=t.canChangeWriteAccess(e),n=t.hasWriteAccess(e),r=t.canChangeReadAccess(e),a=t.hasReadAccess(e),l=new o({model:e,permission:t,avatar:e.get("avatar_url"),description:_t("components.modals.publish.share.organization.desc"),name:_t("components.modals.publish.share.organization.title"),canChangeReadAccess:r,hasReadAccess:a,hasWriteAccessAvailable:i,canChangeWriteAccess:s,hasWriteAccess:n,isSelected:a||n});this.$el.append(l.render().$el),this.addView(l)},_renderItem:function _renderItem(e){var t,i=e.get("model"),s=this._sharePermissionModel,n=!this._isVisualization,r=s.canChangeWriteAccess(e),a=s.hasWriteAccess(e),l=s.canChangeReadAccess(e),h=s.hasReadAccess(e),c=this._getRole(i);e.id!==this._currentUserId&&(t=new o({model:e,permission:s,name:e.get("name")||e.get("username"),avatar:e.get("avatar_url"),role:c,users:i.users,canChangeReadAccess:l,hasReadAccess:h,hasWriteAccessAvailable:n,canChangeWriteAccess:r,hasWriteAccess:a,isSelected:h||a}),this.$el.append(t.render().$el),this.addView(t))},_getRole:function _getRole(e){return void 0!==e.viewer&&(!0===e.viewer?_t("components.modals.publish.share.role.viewer"):_t("components.modals.publish.share.role.builder"))}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({defaults:{per_page:20,page:1,q:""},initialize:function initialize(e,t){if(!t.collection)throw new Error("collection is required");if(!t.collection.totalCount)throw new Error("collection requires to implement totalCount method");this.collection=t.collection,this._initBinds()},_initBinds:function _initBinds(){this.collection.on("sync",this._updateStateFetched,this),this.collection.on("error",this._updateStateError,this)},fetch:function fetch(){return this.trigger("fetching",this),this.collection.fetch({data:this.attributes},{reset:!0})},_updateStateFetched:function _updateStateFetched(){this.trigger("fetched",this)},_updateStateError:function _updateStateError(){this.trigger("error",this)}})},function(e,t,i){"use strict";var s=i(2),n=i(1),o=i(0),r=i(286),a=i(2189),l=i(11),h=i(960),c=i(186),d=i(573),u=i(7),p=i(285),g=i(572),m=["listCollection","createContentView"];e.exports=n.extend({events:{"click .js-search-link":"_onSearchClick","click .js-clean-search":"_onCleanSearchClick","keydown .js-search-input":"_onKeyDown"},initialize:function initialize(e){o.each(m,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),this._paginationModel=new r({current_page:1}),this._paginationSearchModel=new a({},{collection:this._listCollection}),this._stateModel=new s.Model({state:"idle"}),this._initBinds(),this._initPagination(),this._paginationSearchModel.fetch()},render:function render(){return this.clearSubViews(),this.$el.html(d({q:this._paginationSearchModel.get("q")})),this._initViews(),this},_initBinds:function _initBinds(){this._paginationSearchModel.on("fetching",this.showLoading,this),this._paginationSearchModel.on("fetched",this._updateStateFetched,this),this._paginationSearchModel.on("error",this.showError,this),this._paginationModel.bind("change:current_page",this._fetchByPagination,this),this._stateModel.on("change:state",this.render,this),this.add_related_model(this._paginationModel),this.add_related_model(this._stateModel),this.add_related_model(this._stateModel)},_fetchByPagination:function _fetchByPagination(){this._paginationSearchModel.set("page",this._paginationModel.get("current_page")),this._paginationSearchModel.fetch()},showError:function showError(){this._stateModel.set("state","error")},showLoading:function showLoading(){this._stateModel.set("state","loading")},_updateStateFetched:function _updateStateFetched(){this._paginationModel.set({per_page:this._paginationSearchModel.get("per_page"),total_count:this._listCollection.totalCount()}),this._listCollection.length>0?this._stateModel.set("state","show"):this._stateModel.set("state","no-results")},_initPagination:function _initPagination(){this._paginationView=new p({className:"Pagination Pagination--search Pagination--searchShare",model:this._paginationModel,template:g}),this.addView(this._paginationView)},_initViews:function _initViews(){var e,t=this._stateModel.get("state");if(this.$el.append(this._paginationView.render().el),"loading"===t&&this._content().html(l({title:_t("components.pagination-search.loading.title")})),"error"===t){var i=new c({title:_t("components.pagination-search.error.title"),desc:_t("components.pagination-search.error.desc")});this._content().html(i.render().el),this.addView(i)}"show"===t&&(e=this._createContentView({hasOrganization:""===this._paginationSearchModel.get("q")}),this._content().html(e.render().el),this.addView(e)),"no-results"===t&&this._content().html(h({icon:"CDB-IconFont-defaultUser",title:_t("components.pagination-search.no-results.title"),desc:_t("components.pagination-search.no-results.desc")}))},_focusSearchInput:function _focusSearchInput(){this._searchInput().focus().val()},_onSearchClick:function _onSearchClick(e){this.killEvent(e),this._searchInput().focus()},_onCleanSearchClick:function _onCleanSearchClick(e){this.killEvent(e),this._cleanSearch()},_onKeyDown:function _onKeyDown(e){13===e.which?(this.killEvent(e),this._submitSearch()):27===e.which&&this._paginationSearchModel.get("q")&&(this.killEvent(e),this._cleanSearch())},_submitSearch:function _submitSearch(e){this._makeNewSearch(u.stripHTML(this._searchInput().val().trim()))},_cleanSearch:function _cleanSearch(){this._searchInput().val(""),this._makeNewSearch("")},_makeNewSearch:function _makeNewSearch(e){this._paginationSearchModel.set({q:e,page:1}),this._paginationSearchModel.fetch()},_searchInput:function _searchInput(){return this.$(".js-search-input")},_cleanSearchBtn:function _cleanSearchBtn(){return this.$(".js-clean-search")},_content:function _content(){return this.$(".js-content")}})},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(245),r=i(409),a=i(592);e.exports=s.Collection.extend({model:function model(e,t){var i=e.type,s=e.configModel;return t=n.extend(t,{configModel:s}),e.model&&(e=n.extend({},e,e.model)),"user"===i?new r(n.omit(e,"configModel"),t):"group"===i?new a(n.omit(e,"configModel"),t):void 0},sync:o,url:function url(e){return this.configModel.get("base_url")+"/api/"+this.configModel.urlVersion("organizationGrantables",e)+"/organization/"+this.organization.id+"/grantables"},initialize:function initialize(e,t){if(!t.organization)throw new Error("Organization is required");if(!t.currentUserId)throw new Error("currentUserId is required");if(!t.configModel)throw new Error("configModel is required");this.configModel=t.configModel,this.organization=t.organization,this.currentUserId=t.currentUserId},parse:function parse(e){return this.trigger("fetched",this),this.total_entries=e.total_entries,n.reduce(e.grantables,function(e,t){return t.id===this.currentUserId?this.total_entries--:(t.organization=this.organization,t.configModel=this.configModel,e.push(t)),e},[],this)},fetch:function fetch(e){return e=e||{},this.trigger("fetching",this),e.error=function(e,t){this.trigger("error",this)}.bind(this),s.Collection.prototype.fetch.call(this,e)},totalCount:function totalCount(){return this.total_entries}})},,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(1),n=i(300),o=i(3),r=["userModel"];e.exports=s.extend({initialize:function initialize(e){o(e,r,this)},render:function render(){return this.$el.html(n({userType:this._getUserType()})),this},_getUserType:function _getUserType(){var e=this._userModel.get("account_type").toLowerCase();return this._userModel.isInsideOrg()?"org":"internal"===e||"partner"===e||"ambassador"===e?"internal":"free"!==e?"client":"regular"}})},function(e,t,i){"use strict";var s=i(4),n=i(3),o=i(249),r=i(244),a=["viewModel"];e.exports=r.extend({className:"Dropdown BreadcrumbsDropdown",events:{"click a":"_navigateToLinksHref"},initialize:function initialize(e){n(e,a,this),r.prototype.initialize.apply(this,arguments)},render:function render(){var e=this.model.viewUrl().dashboard(),t=e.datasets(),i=e.deepInsights(),n=e.maps();return this.$el.html(this.template({avatarUrl:this.model.get("avatar_url"),userName:this.model.get("username"),mapsUrl:n,datasetsUrl:t,deepInsightsUrl:i,lockedDatasetsUrl:t.lockedItems(),lockedMapsUrl:n.lockedItems(),isDeepInsights:this._viewModel.isDisplayingDeepInsights(),isDatasets:this._viewModel.isDisplayingDatasets(),isMaps:this._viewModel.isDisplayingMaps(),isLocked:this._viewModel.isDisplayingLockedItems()})),s("body").append(this.el),this},_navigateToLinksHref:function _navigateToLinksHref(){this.hide(),this.options.router&&o.apply(this,arguments)}})},function(e,t,i){"use strict";var s=i(0),n=i(4),o=i(3),r=i(244),a=i(7),l=i(301),h=["model","configModel"];e.exports=r.extend({className:"Dropdown",initialize:function initialize(e){o(e,h,this),r.prototype.initialize.apply(this,arguments)},shortDisplayName:function shortDisplayName(e){var t=e.get("account_type_display_name"),i=s.isUndefined(t)?e.get("account_type"):t;return s.isUndefined(i)?i:"organization user"===(i=i.toLowerCase())?"org. user":i.replace(/lump-sum/gi,"- A").replace(/academic/gi,"aca.").replace(/ - Monthly/i," - M").replace(/ - Annual/i," - A").replace(/Non-Profit/i,"NP").replace(/On-premises/i,"OP").replace(/Internal use engine/i,"engine").replace(/Lite/i,"L").replace(/Cloud Engine &/i,"C. Engine &").replace(/& Enterprise Builder/i,"& E. Builder").replace(/CARTO for /i,"").replace(/CARTO /i,"")},render:function render(){var e=this.model,t=e.get("db_size_in_bytes"),i=e.get("quota_in_bytes"),s=Math.round(t/i*100),o="";s>80&&s<90?o="is--inAlert":s>89&&(o="is--inDanger");var r=this.shortDisplayName(e),h=this.model.viewUrl(),c=window.upgrade_url||this._configModel.get("upgrade_url")||"";return this.$el.html(l({name:e.fullName()||e.get("username"),email:e.get("email"),accountType:r,isOrgAdmin:e.isOrgAdmin(),usedDataStr:a.readablizeBytes(t),usedDataPct:s,progressBarClass:o,availableDataStr:a.readablizeBytes(i),showUpgradeLink:c&&(e.isOrgOwner()||!e.isInsideOrg())&&!this._configModel.get("cartodb_com_hosted"),upgradeUrl:c,publicProfileUrl:h.publicProfile(),apiKeysUrl:h.apiKeys(),organizationUrl:h.organization(),accountProfileUrl:h.accountProfile(),logoutUrl:h.logout(),isViewer:e.isViewer(),isBuilder:e.isBuilder(),orgDisplayEmail:e.isInsideOrg()?e.organization.display_email:null,engineEnabled:e.get("actions").engine_enabled,mobileAppsEnabled:e.get("actions").mobile_sdk_enabled})),n("body").append(this.el),this}})},,,,,,,,,function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({defaults:{status:"idle",info:"",closable:!0},initialize:function initialize(e,t){void 0===e.id&&this.set("id","notifier"+this.cid),this.set("defaultDelay",t.delay),t.visDefinitionModel&&(this._retriggerEvent(t.visDefinitionModel,"vis:reload"),this._retriggerEvent(t.visDefinitionModel,"vis:error"))},isClosable:function isClosable(){return!0===this.get("closable")},updateClosable:function updateClosable(e){this.set({closable:e})},getButton:function getButton(){return this.get("button")},updateButton:function updateButton(e){this.set({button:e})},getStatus:function getStatus(){return this.get("status")},updateStatus:function updateStatus(e){this.set({status:e})},getInfo:function getInfo(){return this.get("info")},getAction:function getAction(){return this.get("action")},setAction:function setAction(e){this.set({action:e})},updateInfo:function updateInfo(e){this.set({info:e})},update:function update(e){this.set(e)},_retriggerEvent:function _retriggerEvent(e,t){e.on(t,function(){this.trigger(t,arguments)},this)}})},function(e,t,i){"use strict";var s=i(2),n=i(2224);e.exports=s.Collection.extend({model:function model(e,t){return new n(e,t)},findById:function findById(e){return this.findWhere({id:e})},addNotification:function addNotification(e,t){var i=this._findNotificationByAttrs(e);return i?i.update(e):this.add(e,t)},_findNotificationByAttrs:function _findNotificationByAttrs(e){return this.findWhere({info:e.info})}})},function(e,t,i){"use strict";var s=i(1);e.exports=s.extend({tagName:"button",initialize:function initialize(e){if(!e.template)throw new Error("template is required");if(!e.editorModel)throw new Error("editorModel is required");this.template=e.template,this._editorModel=e.editorModel,this._data={},e.model&&(this._data=e.model.toJSON()),this._initBinds()},_initBinds:function _initBinds(){this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.add_related_model(this._editorModel)},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.append(this.template(this._data)),this},_changeStyle:function _changeStyle(){this.$(".js-theme").toggleClass("is-white",this._editorModel.isEditing())}})},function(e,t,i){"use strict";var s=i(1),n=i(587),o=i(2226),r=i(586),a=i(585);e.exports=s.extend({className:"Notifier-inner",tagName:"li",events:{"click .js-close":"_closeHandler","click .js-action":"_actionHandler"},initialize:function initialize(e){if(!e.notifierModel)throw new Error("notifierModel is required");if(!e.editorModel)throw new Error("editorModel is required");this._editorModel=e.editorModel,this.template=this.options.template||n,this._notifierModel=e.notifierModel,this.$el.attr("id",this._notifierModel.get("id")),this._delay=this._notifierModel.get("delay")||this._notifierModel.get("defaultDelay"),this._notifierModel.get("delay")&&!1!==this._notifierModel.get("closable")&&(this._timeout=setTimeout(this._autoClose.bind(this),this._delay)),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this._changeStyle(),this},_initBinds:function _initBinds(){this.listenTo(this._notifierModel,"change",this.render),this.listenTo(this._notifierModel,"change:status",this._onChangeStatus),this.add_related_model(this._notifierModel),this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.add_related_model(this._editorModel)},_initViews:function _initViews(){var e=this._notifierModel.getButton(),t=this._notifierModel.isClosable(),i=this.template({status:this._notifierModel.getStatus(),info:this._notifierModel.getInfo(),isActionable:e,isClosable:t});this.$el.append(i),e&&this._createActionView(e),t&&this._createCloseView()},_createActionView:function _createActionView(e){var t=new o({template:a,className:"js-action",model:this._notifierModel,editorModel:this._editorModel});this.$(".js-actionButton").append(t.render().el),this.addView(t)},_createCloseView:function _createCloseView(){var e=new o({template:r,className:"CDB-Shape js-close",editorModel:this._editorModel});this.$(".js-closeButton").append(e.render().el),this.addView(e)},_closeHandler:function _closeHandler(){var e=this._notifierModel.getStatus(),t=this._notifierModel.getAction();this._notifierModel.trigger("notification:close",t||e),clearTimeout(this._timeout),this._notifierModel&&this._notifierModel.collection&&this._notifierModel.collection.remove(this._notifierModel)},_actionHandler:function _actionHandler(){var e=this._notifierModel.getStatus(),t=this._notifierModel.getAction();this._notifierModel.trigger("notification:action",t||e)},_changeStyle:function _changeStyle(){this.$(".Notifier-info").toggleClass("u-whiteTextColor",this._editorModel.isEditing()),this.$(".Notifier-actions .CDB-Shape-close").toggleClass("is-blue",!this._editorModel.isEditing()),this.$(".Notifier-actions .CDB-Shape-close").toggleClass("is-white",this._editorModel.isEditing())},_autoClose:function _autoClose(){this._notifierModel.set({action:"autoclose"},{silent:!0}),this._closeHandler()},_onChangeStatus:function _onChangeStatus(e,t){"success"!==t&&"error"!==t||!1===this._notifierModel.get("closable")||!1===this._notifierModel.get("autoclosable")||(this._timeout=setTimeout(this._autoClose.bind(this),this._delay))}})},function(e,t,i){"use strict";var s=i(1),n=i(0),o=i(2227),r=i(584);e.exports=s.extend({className:"Notifier",initialize:function initialize(e){if(!e.collection)throw new Error("collection is mandatory");if(!e.editorModel)throw new Error("editorModel is mandatory");this._editorModel=e.editorModel,this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(r()),this._renderAllSubviews(),this._renderLoading(),this},rebindEvents:function rebindEvents(){return this.stopListening(this.collection),this.stopListening(this._editorModel),this._initBinds(),this},_initBinds:function _initBinds(){this.listenTo(this.collection,"reset update change:status",this.render),this.add_related_model(this.collection),this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.add_related_model(this._editorModel)},_renderAllSubviews:function _renderAllSubviews(){this.collection.each(this._renderSubview,this)},_renderSubview:function _renderSubview(e){var t=new o({notifierModel:e,editorModel:this._editorModel}),i=e.get("status");("success"===i||"error"===i?this._getDoneContainer():this._getLoadingContainer()).append(t.render().el),this.addView(t)},_removeSubview:function _removeSubview(e){var t=e.get("id"),i=n.first(n.filter(this._subviews,function(e){return e._notifierModel.get("id")===t}));i&&(this.removeView(i),i.remove())},_renderLoading:function _renderLoading(){this._getLoader().toggleClass("is-visible",this._anyNotificationLoading())},_anyNotificationLoading:function _anyNotificationLoading(){return this.collection.any(function(e){return!n.contains(["success","error","warning"],e.get("status"))})},_changeStyle:function _changeStyle(){this.$el.toggleClass("is-dark",this._editorModel.isEditing())},_getDoneContainer:function _getDoneContainer(){return this.$(".js-status-done")},_getLoadingContainer:function _getLoadingContainer(){return this.$(".js-status-loading")},_getLoader:function _getLoader(){return this.$(".js-loader")}})},,function(e,t,i){"use strict";var s=i(2),n=i(1);e.exports=s.Model.extend({defaults:{show:!0,createContentView:function createContentView(){return new n}},createContentView:function createContentView(){return this.get("createContentView")(this)},show:function show(){this.set("show",!0)},hide:function hide(){this.set("show",!1)},isHidden:function isHidden(){return!this.get("show")},destroy:function destroy(){var e=Array.prototype.slice.call(arguments);this.trigger.apply(this,["destroy"].concat(e))}})},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(232);e.exports=n.extend({className:function className(){var e=["Dialog","is-white"];return this.options.escapeOptionsDisabled||e.push("is-opening"),this.options.breadcrumbsEnabled&&e.push("Dialog--withBreadcrumbs"),e.join(" ")},events:{"click .js-close":"_onClose"},initialize:function initialize(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy),this._escapeOptionsDisabled=this.options.escapeOptionsDisabled,this._breadcrumbsEnabled=this.options.breadcrumbsEnabled,this._keepOpenOnRouteChange=this.options.keepOpenOnRouteChange},render:function render(){this.clearSubViews(),this.$el.html(o({escapeOptionsDisabled:this._escapeOptionsDisabled||!1,breadcrumbsEnabled:this._breadcrumbsEnabled||!1}));var e=this.model.createContentView();return this.addView(e),e.render(),this.$(".js-content").append(e.el),this},show:function show(){this.model.show()},hide:function hide(){this.model.hide()},destroy:function destroy(){this.model.destroy()},keepOpenOnRouteChange:function keepOpenOnRouteChange(){return this.model.get("keepOpenOnRouteChange")},_onShowChange:function _onShowChange(e,t){t?(this.$el.show(),this.$el.removeClass("is-closing").addClass("is-opening")):(this.$el.removeClass("is-opening").addClass("is-closing"),this._delayDueToAnimation(function(){this.$el.hide()}))},_onClose:function _onClose(e){e.stopPropagation(),this.destroy()},_onDestroy:function _onDestroy(){this.hide(),s.invoke(this._subviews,"allOff"),this._delayDueToAnimation(function(){this.clean()})},_delayDueToAnimation:function _delayDueToAnimation(e){setTimeout(e.bind(this),120)}})},,,,,function(e,t,i){"use strict";var s=i(4),n=i(0),o=i(2),r=i(1),a={width:160,speedIn:150,speedOut:300,verticalPosition:"down",horizontalPosition:"right",tick:"right",verticalOffset:0,horizontalOffset:0};e.exports=r.extend({className:"dropdown",initialize:function initialize(e){n.bindAll(this,"open","hide","_handleClick","_keydown","_onDocumentClick"),this.options={},n.defaults(this.options,e,a),e.template&&(this.template=e.template),s(e.target).on("click",this._handleClick),s(document).on("keydown",this._keydown),s(document).on("click",this._onDocumentClick),this.modelView=new o.Model({open:!1}),this.modelView.on("change:open",function(e,t){t?this.hide():this.open()},this)},render:function render(){return this.$el.html(this.template&&this.template(this.options)).css({width:this.options.width}),this},_handleClick:function _handleClick(e){e&&e.preventDefault();var t=this.modelView.get("open");this.modelView.set("open",!t)},_onDocumentClick:function _onDocumentClick(e){var t=s(e.target),i=s(this.options.target);t.get(0)===i.get(0)||0!==t.closest(".Dropdown").length||(this.modelView.set({open:!1},{silent:!0}),this.hide())},_keydown:function _keydown(e){27===e.keyCode&&this.modelView.set("open",!1)},hide:function hide(){this.$el.hide()},show:function show(){this.$el.css({display:"block",opacity:1})},open:function open(e,t){var i=t&&s(t)||this.options.target;this.options.target=i;var n=i[this.options.position||"offset"](),o=i.outerWidth(),r=i.outerHeight(),a=this.$el.outerWidth(),l=this.$el.outerHeight(),h=this.options.verticalPosition,c=this.options.verticalOffset,d=this.options.horizontalPosition,u=this.options.horizontalOffset;this.$el.css({top:n.top+parseInt("up"===h?-l-10-c:r+10-c),left:n.left+parseInt("left"===d?u-15:o-a+15-u)}).addClass(("up"===h?"vertical_top":"vertical_bottom")+" "+("right"===d?"horizontal_right":"horizontal_left")+" tick_"+this.options.tick),this.show()},isOpen:function isOpen(){return this.modelView.get("open")},clean:function clean(){var e=s(this.options.target);this.options.target&&e.off("click",this._handleClick),s(document).off("keydown",this._keydown),s(document).off("click",this._onDocumentClick),r.prototype.clean.apply(this)}})},function(e,t,i){"use strict";var s=i(4),n=i(180),o=i(54),r=i(244),a=i(311);e.exports=r.extend({className:"Dropdown",initialize:function initialize(e){r.prototype.initialize.apply(this,arguments),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(this.template()),this._renderDropdown(),this._checkScroll(),s("body").append(this.el),this},_renderDropdown:function _renderDropdown(){this.dropdown_content=o.createByTemplate(a,{items:this.collection.toJSON(),unreadItems:this.collection.filter(function(e){return!e.get("opened")}).length}),this.addView(this.dropdown_content),this.$(".js-content").html(this.dropdown_content.render().el)},_checkScroll:function _checkScroll(){setTimeout(function(){if(this.$el.height()>=300){var e=new n({createContentView:function(){return this.dropdown_content}.bind(this)});this.addView(e),this.$el.addClass("Dropdown--withScroll"),this.$(".js-content").html(e.render().el)}}.bind(this),301)},_initBinds:function _initBinds(){}})},function(e,t,i){"use strict";var s=i(977),n=i(3),o=["userId","configModel","apiKey"];e.exports=s.extend({url:function url(){return"/api/v3/users/"+this._userId+"/notifications/"+this.id+"?api_key="+this._apiKey},initialize:function initialize(e,t){n(t,o,this)},markAsRead:function markAsRead(){this.save({notification:{read_at:new Date}})}})},function(e,t,i){"use strict";var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},n=i(2),o=i(977),r=i(2238),a=i(3),l=["configModel"];e.exports=n.Collection.extend({initialize:function initialize(e){a(e,l,this)},model:function model(e,t){return"org_notification"===e.type?new r(e,s({},t,{configModel:t.collection._configModel})):new o(e)}})},,function(e,t,i){"use strict";var s=i(2),n=i(0),o=s.Model.extend({defaults:{likeable:!0},url:function url(e){var t=this._configModel.urlVersion("like");return this._configModel.get("base_url")+"/api/"+t+"/viz/"+this.get("vis_id")+"/like"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");if(!e.vis_id)throw new Error("vis_id attribute is required");this._configModel=t.configModel,this.on("destroy",function(){this.set({liked:!1,likes:this.get("likes")-1})},this)},_onSaveError:function _onSaveError(e,t){this.trigger("error",{status:t.status,statusText:t.statusText})},toggleLiked:function toggleLiked(){this.get("liked")?this.destroy():(this.set({id:null},{silent:!0}),this.save({},{error:this._onSaveError.bind(this)}))}},{newByVisData:function newByVisData(e){var t=n.defaults({id:e.liked?e.vis_id:null},n.omit(e,"url","configModel")),i=new o(t,{configModel:e.configModel});return e.url&&(i.url=e.url),i}});e.exports=o},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({idAttribute:"name"})},function(e,t,i){"use strict";var s=i(2),n=i(2242);e.exports=s.Collection.extend({model:n,initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");if(!t.tableModel)throw new Error("tableModel is required");this._configModel=t.configModel,this._tableModel=t.tableModel},url:function url(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("column")+"/tables/"+this._tableModel.get("name")+"/columns"}})},function(e,t,i){"use strict";e.exports=function(e,t,i){var s=this;i||(i=e),t.bind&&t.bind(e,function(){s.trigger(i)},this)}},function(e,t,i){"use strict";var s=i(0),n=i(4),o=i(2),r=i(3),a=["configModel"];e.exports=o.Model.extend({_X:1.2,_INTERVAL:1500,_STATES:["created","failure","success","syncing","queued"],defaults:{name:"",url:"",state:"",run_at:0,ran_at:0,retried_times:0,interval:0,error_code:0,error_message:"",service_name:"",service_item_id:"",content_guessing:!0,type_guessing:!0},url:function url(e){var t="/api/"+this._configModel.urlVersion("synchronization",e)+"/synchronizations/";return this.isNew()?t:t+this.id},initialize:function initialize(e){r(e,a,this),this.bind("destroy",function(){this.unset("id")})},toJSON:function toJSON(){var e=s.clone(this.attributes),t={url:e.url,interval:e.interval,content_guessing:e.content_guessing,type_guessing:e.type_guessing,create_vis:e.create_vis};return"remote"===e.type&&s.extend(t,{remote_visualization_id:e.remote_visualization_id,create_vis:!1,value:e.value}),void 0!==e.id&&(t.id=e.id),e.service_name&&(t.service_name=e.service_name,t.service_item_id=e.service_item_id),t},syncNow:function syncNow(e){n.ajax({url:this._configModel.prefixUrl()+this.url()+"/sync_now",type:"PUT"}).always(e)},pollCheck:function pollCheck(e){var t=this,i=this._INTERVAL;this.pollTimer=setInterval(function request(){t.destroyCheck();t.fetch({error:function error(e,i){t.set({error_message:i.statusText||"",state:"failure"})}});i*=t._X;t.pollTimer=setInterval(request,i)},i)},destroyCheck:function destroyCheck(){clearInterval(this.pollTimer)},isSync:function isSync(){return!this.isNew()},linkToTable:function linkToTable(e){var t=this;e.has("synchronization")&&this.set(e.get("synchronization")),e.bind("change:synchronization",function(){t.set(e.get("synchronization"))},e),e.bind("destroy",function destroy(){t.unbind(null,null,e),t.destroy()},e)}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({idAttribute:"item_queue_id",urlRoot:"/api/v1/imports",initialize:function initialize(){this.bind("change",this._checkFinish,this)},setUrlRoot:function setUrlRoot(e){this.urlRoot=e},pollCheck:function pollCheck(e){var t=this;this.pollTimer=setInterval(function(){t.fetch({error:function error(e){t.trigger("change")}})},e||1500)},destroyCheck:function destroyCheck(){clearInterval(this.pollTimer)},_checkFinish:function _checkFinish(){!0===this.get("success")?(clearInterval(this.pollTimer),this.trigger("importComplete",this)):!1===this.get("success")?(clearInterval(this.pollTimer),this.trigger("importError",this)):this.trigger("importChange",this)}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(3),r=["configModel"];e.exports=n.Model.extend({idAttribute:"name",url:function url(e){var t=this._configModel.urlVersion("column",e),i=this.table||this.collection.table;i||console.error("column has no table assigned");var s="/api/"+t+"/tables/"+i.get("name")+"/columns/";return this.isNew()?s:s+this.id},initialize:function initialize(e){if(o(e,r,this),this.table=this.get("table"),!this.table)throw"you should specify a table model";this.unset("table",{silent:!0})},toJSON:function toJSON(){var e=s.clone(this.attributes);return e._name&&(e.name=e._name,delete e._name),e}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Collection.extend({fetched:!1,initialize:function initialize(){var e=this;this.bind("sync",function(){e.fetched=!0})},getCell:function getCell(e,t){var i=this.at(e);return i?i.get(t):null},isEmpty:function isEmpty(){return 0===this.length}})},function(e,t,i){"use strict";var s=i(290).extend({edit:function edit(){return this.urlToPath()},public:function _public(){return this.urlToPath("public")}});e.exports=s},function(e,t,i){"use strict";var s=i(290).extend({edit:function edit(){return this.urlToPath("map")},public:function _public(){return this.urlToPath("public_map")},deepInsights:function deepInsights(){return this.urlToPath("deep-insights")}});e.exports=s},function(e,t,i){"use strict";var s=i(2).Model.extend({defaults:{time:0}});e.exports=s},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({url:function url(e){return this.visualization.url(e)+"/next_id"},initialize:function initialize(){this.visualization=this.get("visualization"),this.set("id",this.visualization.id),this.unset("visualization")}})},function(e,t,i){"use strict";var s=i(2).Model.extend({defaults:{visible:!0,type:"Tiled"}});e.exports=s},function(e,t,i){"use strict";var s=i(2),n=i(2253),o=i(3),r=["configModel"],a=s.Collection.extend({model:n,initialize:function initialize(e,t){o(t,r,this),this.comparator=function(e){return parseInt(e.get("order"),10)},this.bind("add",this._assignIndexes),this.bind("remove",this._assignIndexes)},url:function url(e){return"/api/"+this._configModel.urlVersion("layer",e)+"/maps/"+this.map.id+"/layers"},parse:function parse(e){return e.layers},_assignIndexes:function _assignIndexes(e,t,i){if(this.size()>0&&(this.at(0).set({order:0}),this.size()>1)){for(var s={},n=1;n<this.size();++n){var o=this.at(n),r=o.get("type");s[r]=s[r]||[],s[r].push(o)}for(var a=0,l=["CartoDB","torque","Tiled"],h=0;h<l.length;++h)for(var c=s[l[h]]||[],d=0;d<c.length;++d){c[d].set({order:++a})}}}});e.exports=a},function(e,t,i){"use strict";var s=i(2),n=i(2254),o=i(3),r=["configModel"],a=s.Model.extend({urlRoot:"/api/v1/maps",initialize:function initialize(e){o(e,r,this),this.bind("change:id",this._fetchLayers,this),this.layers=new n(null,{configModel:this._configModel}),this.layers.map=this},_fetchLayers:function _fetchLayers(){this.layers.fetch()}});e.exports=a},function(e,t,i){"use strict";var s=i(0),n=i(4),o=i(2),r=i(176),a=i(3),l=["configModel"];e.exports=o.Collection.extend({model:r,initialize:function initialize(e,t){if(a(t,l,this),!t.group)throw new Error("group is required");this.group=t.group},url:function url(){return this.group.url.apply(this.group,arguments)+"/users"},parse:function parse(e){return this.total_entries=e.total_entries,this.total_user_entries=e.total_user_entries,e.users},addInBatch:function addInBatch(e,t){return this._batchAsyncProcessUsers("POST",e,t)},removeInBatch:function removeInBatch(e,t){var i=this;return this._batchAsyncProcessUsers("DELETE",e,t).done(function(){s.each(e,i.remove.bind(i))})},_batchAsyncProcessUsers:function _batchAsyncProcessUsers(e,t,i){var s=this,o=n.Deferred();return n.ajax({type:e,url:this._configModel.get("base_url")+this.url(),data:{users:t,password_confirmation:i},success:function success(){var e=arguments;s.fetch({success:function success(){o.resolve.apply(o,e)},error:function error(){o.resolve.apply(o,e)}})},error:function error(){o.reject.apply(o,arguments)}}),o},totalCount:function totalCount(){return this.total_user_entries}})},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(3),r=i(176),a=i(590),l=["configModel"];e.exports=s.Collection.extend({model:function model(e,t){var i=t.collection,s=i._configModel,n=i.organization,model=void 0;return model="user"===e.type?new r(e,{configModel:s,collection:i}):new a(e,{configModel:s,collection:i}),model.organization=n,model.entity=model,model},url:function url(e){return"/api/"+this._configModel.urlVersion("organizationGrantables",e)+"/organization/"+this.organization.id+"/grantables"},initialize:function initialize(e,t){if(o(t,l,this),!t.organization)throw new Error("organization is required");this.organization=t.organization,this.currentUserId=t.currentUserId,this.sync=i(985)},parse:function parse(e){return this.total_entries=e.total_entries,n.reduce(e.grantables,function(e,t){return t.id===this.currentUserId?this.total_entries--:e.push(t),e},[],this)},totalCount:function totalCount(){return this.total_entries}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(176),r=i(3),a=["organization","configModel"];e.exports=n.Collection.extend({model:o,_DEFAULT_EXCLUDE_CURRENT_USER:!0,url:function url(){return"/api/v1/organization/"+this.organization.id+"/users"},initialize:function initialize(e,t){r(t,a,this),this.organization=this._organization,this.currentUserId=t.currentUserId,this._excludeCurrentUser=this._DEFAULT_EXCLUDE_CURRENT_USER},comparator:function comparator(e){return e.get("username")},excludeCurrentUser:function excludeCurrentUser(e){e=!!e,this._excludeCurrentUser=e,e&&!this.currentUserId&&console.error("set excludeCurrentUser to true, but there is no current user id set to exclude!")},restoreExcludeCurrentUser:function restoreExcludeCurrentUser(){this.excludeCurrentUser(this._DEFAULT_EXCLUDE_CURRENT_USER)},parse:function parse(e){return this.total_entries=e.total_entries,this.total_user_entries=e.total_user_entries,s.reduce(e.users,function(e,t){return this._excludeCurrentUser&&t.id===this.currentUserId?(this.total_user_entries--,this.total_entries--):e.push(t),e},[],this)},totalCount:function totalCount(){return this.total_user_entries}})},,function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(348),r=["id","username","avatar_url","name"];e.exports=s.Model.extend({defaults:{access:"r"},isOwn:function isOwn(e){return e.id===this.get("entity").id},validate:function validate(e,t){if(e.access!==o.READ_ONLY&&e.access!==o.READ_WRITE)return"access can't take 'r' or 'rw' values"},toJSON:function toJSON(){var e=n.pick(this.get("entity").toJSON(),r);return e.username||(e.username=e.name,delete e.name),{type:this.get("type")||"user",entity:e,access:this.get("access")}}})},function(e,t,i){"use strict";var s=i(2),n=i(315),o=i(3),r=["configModel","currentUserId"];e.exports=s.Collection.extend({model:function model(e,t){var i=t.collection;return new n(e,{parse:!0,collection:i})},url:function url(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("user")+"/users/"+this._currentUserId+"/layers"},initialize:function initialize(e,t){o(t,r,this)},isCustomCategory:function isCustomCategory(){return this.where(function(e){return["NASA","TileJSON","WMS","Mapbox","Custom",void 0].some(function(t){return e.get("category")===t})})},getSelected:function getSelected(){return this.findWhere({selected:!0})},hasCustomBaseLayer:function hasCustomBaseLayer(e){if(e)return this.where({className:e}).length>0}})},function(e,t,i){"use strict";var s=i(2),n=i(592);e.exports=s.Collection.extend({model:n,initialize:function initialize(e,t){this.organization=t.organization}})},function(e,t,i){"use strict";var s=i(0),n=function Poller(e,t){this.model=e,this.numberOfRequests=0,this.polling=!1,this.interval=t.interval,"function"!=typeof this.interval&&(this.interval=function(){return t.interval}),this.stopWhen=t.stopWhen,this.error=t.error,this.autoStart=t.autoStart,this.autoStart&&this.start()};n.prototype.start=function(){this.timeout||this._scheduleFetch()},n.prototype._scheduleFetch=function(){this.timeout=setTimeout(this._fetch.bind(this),this.interval(this.numberOfRequests))},n.prototype._fetch=function(){var e=this;e.polling||(e.polling=!0,e.model.fetch({success:function success(){e.polling=!1,e.numberOfRequests++,e._continuePolling()&&e._scheduleFetch()},error:function error(t){s.isFunction(e.error)&&e.error(e.model)}}))},n.prototype._continuePolling=function(){return!this.stopWhen||s.isFunction(this.stopWhen)&&!this.stopWhen(this.model)},n.prototype.stop=function(){this.polling=!1,clearTimeout(this.timeout),delete this.timeout},e.exports=n},function(e,t,i){"use strict";var s=i(0),n=i(2263),o=function ImportModelPoller(e){var t={interval:function interval(e){return e>=30?5e3:2e3},stopWhen:function stopWhen(e){var t=e.get("state");return"complete"===t||"failure"===t}};n.call(this,e,t)};o.prototype=s.extend({},n.prototype),e.exports=o},,function(e,t,i){"use strict";var s=i(1),n=i(7),o=i(997);e.exports=s.extend({initialize:function initialize(e){this._userModel=e.userModel,this._initBinds()},render:function render(){var e=this._userModel.get("twitter"),t=e.quota-e.monthly_use,i=Math.min(100,Math.ceil(100*this.model.get("value")/t));return this.$el.html(o({value:this.model.get("value"),remaining:t,per:i,hardLimit:e.hard_limit,remainingFormatted:n.formatNumber(t),quota:e.quota,block_price:e.block_price,block_size:n.readizableNumber(e.block_size)})),this},_initBinds:function _initBinds(){this.model.bind("change",this.render,this)}})},function(e,t,i){"use strict";var s=i(2),n=i(1),o=i(0);i(234);var r=i(2266),a=i(3),l=["userModel"];e.exports=n.extend({initialize:function initialize(e){a(e,l,this),this._disabled=!(!e||!e.disabled)&&e.disabled,this.model=new s.Model,this._initBinds(),this._setModel()},render:function render(){return this.clearSubViews(),this._destroySlider(),this._initViews(),this},_initBinds:function _initBinds(){this.model.bind("change:value",this._onValueChange,this)},_setModel:function _setModel(){var e=this._userModel.get("twitter"),t=e.quota-e.monthly_use,i=1*t/100,s=t>0?80*t/100:t+1;this.model.set({max:e.hard_limit?t:t+1,min:i,step:i,value:t>0?s:e.quota,disabled:this._disabled||t<=0})},_initViews:function _initViews(){this._setModel(),this.$(".js-slider").slider(o.extend({range:"min",orientation:"horizontal",slide:this._onSlideChange.bind(this),change:this._onSlideChange.bind(this)},this.model.attributes));var e=new r({el:this.$(".js-info"),userModel:this._userModel,model:this.model});e.render(),this.addView(e)},_onSlideChange:function _onSlideChange(e,t){this.model.set("value",t.value)},_onValueChange:function _onValueChange(){this.trigger("maxCreditsChange",this.getMaxCredits(),this)},getMaxCredits:function getMaxCredits(){var e=this._userModel.get("twitter"),t=e.quota-e.monthly_use,i=this.model.get("value");return i>t?0:i},_destroySlider:function _destroySlider(){this.$(".js-slider").data("ui-slider")&&this.$(".js-slider").slider("destroy")},clean:function clean(){this._destroySlider(),n.prototype.clean.call(this)}})},function(e,t,i){"use strict";var s=i(1),n=i(0),o=i(4),r=i(998);e.exports=s.extend({className:"TwitterCategory",_MAX_CATEGORIES:4,_MAX_TERMS:29,events:{"keydown .js-terms":"_onInputChange","keypress .js-terms":"_onInputChange","keyup .js-terms":"_onInputChange"},initialize:function initialize(){this._initBinds()},render:function render(){return this.$el.empty(),this.$el.append(r({disabled:this.model.get("disabled"),terms:this.model.get("terms"),category:this.model.get("category"),counter:this.model.get("counter")})),this.show(),this},_initBinds:function _initBinds(){n.bindAll(this,"_onInputChange"),this.model.bind("change:category",this._onCategoryChange,this)},_onCategoryChange:function _onCategoryChange(){this.$(".js-category").text(_t("components.modals.add-layer.imports.twitter.category")+" "+this.model.get("category"))},_onInputChange:function _onInputChange(e){var t=o(e.target).val(),i={};return 13===e.keyCode?(e.preventDefault(),this.trigger("submit",this.model,this),!1):(this.$(".CDB-IconFont-twitter").toggleClass("is-highlighted",t.length>0),(0===this.model.get("counter")||this.model.get("terms").length>this._MAX_TERMS)&&37!==e.keyCode&&39!==e.keyCode&&8!==e.keyCode&&t.length>0?(this.killEvent(e),this.trigger("limit",this.model,this),!1):(this.trigger("nolimit",this.model,this),t=t?t.split(","):[],i.terms=t,void this.model.set(i)))},show:function show(){this.$el.addClass("enabled")},hide:function hide(){this.$el.removeClass("enabled")}})},function(e,t,i){"use strict";var s=i(2),n=i(999);e.exports=s.Collection.extend({model:n})},function(e,t,i){"use strict";var s=i(1),n=i(0),o=i(4),r=i(2269),a=i(999),l=i(2268);e.exports=s.extend({_MAX_CATEGORIES:4,_MAX_TERMS:29,initialize:function initialize(e){this._disabled=!(!e||!e.disabled)&&e.disabled;var t=this._generateCategory();this.collection=new r([t]),this._initBinds()},render:function render(){return this.clearSubViews(),this.collection.each(this._addCategory,this),this},_initBinds:function _initBinds(){this.collection.bind("change",this._manageCategories,this),this.collection.bind("change",this._onCategoryChange,this),this.add_related_model(this.collection)},_manageCategories:function _manageCategories(){var e=this.collection.size(),t=this.collection.filter(function(e){return 0===e.get("terms").length});if(0===t.length&&e<this._MAX_CATEGORIES){var i=this._generateCategory();return this.collection.add(i),this._addCategory(i),!1}if(t.length>0){var s=n.first(t),o=n.find(this._subviews,function(e){return s.cid===e.model.cid}),r=o.$el.index();if(1===e)return!1;if(r===e-1)return!1;r!==e-1&&t.length>1&&(s=t[1],o=n.find(this._subviews,function(e){return s.cid===e.model.cid}),this._removeCategory(o)),this._sortCategoryIndex()}},_sortCategoryIndex:function _sortCategoryIndex(){var e=this;this.$(".twitter-category").each(function(t,i){var s=o(i).find(".js-category").text().replace(_t("components.modals.add-layer.imports.twitter.category")+" ","");s!==t+1&&e.collection.find(function(e){return e.get("category")===s}).set("category",(t+1).toString())})},_generateCategory:function _generateCategory(){return new a({disabled:this._disabled,terms:[],category:(this.collection?this.collection.size()+1:1).toString()})},_addCategory:function _addCategory(e){var t=new l({model:e});t.bind("submit",this._onCategorySubmit,this),t.bind("limit",this._onCategoryLimit,this),t.bind("nolimit",this._onCategoryNoLimit,this),this.$el.append(t.render().el),this.addView(t),this.trigger("addCategory")},_removeCategory:function _removeCategory(e){e.hide(),e.clean(),e.model.destroy(),this.trigger("removeCategory")},_onCategorySubmit:function _onCategorySubmit(){this.trigger("submitCategory",this.collection.toJSON(),this)},_onCategoryLimit:function _onCategoryLimit(){this.trigger("limitCategory",this.collection.toJSON(),this)},_onCategoryNoLimit:function _onCategoryNoLimit(){this.trigger("noLimitCategory",this.collection.toJSON(),this)},_onCategoryChange:function _onCategoryChange(){this.trigger("changeCategory",this.collection.toJSON(),this)},getCategories:function getCategories(){return this.collection.toJSON()}})},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(4),r=i(9),a=i(3),l=i(174),h=i(248),c=n.template("SELECT DISTINCT <%= column %> FROM (<%= sql %>) _table_sql WHERE <%= column %> ilike '%<%= search %>%' ORDER BY <%= column %> ASC"),d=["configModel","rowModel","column"];e.exports=l.extend({initialize:function initialize(e,t){a(t,d,this),this._query=t.nodeDefModel.querySchemaModel.get("query");var i=t.configModel;this.SQL=new r.SQL({user:i.get("user_name"),sql_api_template:i.get("sql_api_template"),api_key:i.get("api_key")}),this.stateModel=new s.Model({state:n.isEmpty(e)?"empty":"fetched"}),l.prototype.initialize.call(this,e,t)},model:function model(e,t){var i=Object.keys(e)[0],s={};return s.val=e[i],s.label=e[i],new h(s)},_onSelectedChange:function _onSelectedChange(e,t){"multiple"!==this.type&&t&&this.each(function(t){t.cid!==e.cid&&t.set({selected:!1},{silent:!0})},this)},buildQuery:function buildQuery(e){var t=this.options.column;return c({sql:this._query,search:e,column:this._rowModel.get(t)})},fetch:function fetch(e){this.deferred=o.Deferred();var t=this.buildQuery(e);return this.stateModel.set("state","fetching"),this.SQL.execute(t,null,{extra_params:["page","rows_per_page"],page:0,rows_per_page:40,success:function(e){this._onFetchSuccess(e),this.stateModel.set("state","fetched"),this.deferred.resolve()}.bind(this),error:function(){this.stateModel.set("state","error"),this.deferred.reject()}.bind(this)}),this.deferred.promise()},_onFetchSuccess:function _onFetchSuccess(e){this.reset(e.rows),n.isEmpty(this.models)&&this.stateModel.set("state","empty")},isFetching:function isFetching(){return"fetching"===this.getState()},getState:function getState(){return this.stateModel.get("state")},getItem:function getItem(e){return this.findWhere({val:e})},isAsync:function isAsync(){return!0}})},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(3),r=i(7),a=i(413),l=["model"];e.exports=n.extend({className:"CDB-Box-modalHeader",events:{"input .js-input-search":"_search"},initialize:function initialize(e){o(e,l,this)},render:function render(){return this.$el.html(a()),setTimeout(function(){this._getInput().focus()}.bind(this),100),this},_onClickFilters:function _onClickFilters(e){this.killEvent(e),this.trigger("filters")},_search:s.debounce(function(e){var t=this._getInput().val();t=t.toLowerCase(),t=r.sanitizeHtml(t),this.model.set("query",t)},500),_getInput:function _getInput(){return this.$(".js-input-search")}})},function(e,t,i){"use strict";var s=i(2),n=i(1),o=i(223),r=i(3),a=i(414),l=i(2272),h=i(412),c=["searchCollection","lazySearch"];e.exports=n.extend({className:"CDB-Box-modal CustomList",module:"components:lazy-load:lazy-list-view",initialize:function initialize(e){r(e,c,this),this._type=e.type||_t("components.backbone-forms.lazy-select.type"),this.model=new s.Model({query:"",visible:!1}),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.html(a()),this._createSearchView(),this._renderListSection(),this},_initBinds:function _initBinds(){this.listenTo(this._searchCollection.stateModel,"change:state",this._renderListSection),this.listenTo(this.model,"change:query",this._search),this.listenTo(this.model,"change:visible",function(e,t){t?this.render():this.clearSubViews(),this._toggleVisibility()})},_createListView:function _createListView(){this._listView&&(this._listView.clean(),this.removeView(this._listView)),this._listView=new o({className:"",typeLabel:this._type,showSearch:!1,collection:this._searchCollection,searchPlaceholder:this.options.searchPlaceholder}),this.addView(this._listView),this._listView.show(),this.$(".js-list").html(this._listView.$el)},_createStatusView:function _createStatusView(e){var t=h({status:e,type:this._type});this.$(".js-list").html(t)},_renderListSection:function _renderListSection(){var e=this._searchCollection.stateModel.get("state");"fetched"===e?this._createListView():this._createStatusView(e)},_createSearchView:function _createSearchView(){this._searchView=new l({model:this.model}),this.addView(this._searchView),this.$(".js-search").append(this._searchView.render().el)},_search:function _search(){var e=this.model.get("query");this._lazySearch(e)},_isSerching:function _isSerching(){return!!this.model.get("query")},show:function show(){this.model.set("visible",!0)},hide:function hide(){this.model.set("visible",!1)},toggle:function toggle(){this.model.set("visible",!this.model.get("visible"))},isVisible:function isVisible(){return this.model.get("visible")},_toggleVisibility:function _toggleVisibility(){this.$el.toggleClass("is-visible",!!this.isVisible())}})},function(e,t,i){"use strict";var s=i(2),n=i(57),o=i(416),r=i(415),a=i(2273),l=i(246),h=i(8),c=i(2271);s.Form.editors.LazySelect=s.Form.editors.Base.extend({tagName:"div",className:"u-ellipsis Editor-formSelect",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function focusJsButton(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},options:{selectedItemTemplate:r},initialize:function initialize(e){s.Form.editors.Base.prototype.initialize.call(this,e),n.setOptions(this,e),this.template=e.template||o,this.dialogMode=this.options.dialogMode||h.Mode.DEFAULT;var t={configModel:this.options.configModel,nodeDefModel:this.options.nodeDefModel,rowModel:this.model,column:this.options.column};null!=this.options.options?this.searchCollection=new c(this.options.options,t):this.searchCollection=this.options.collection,this._initBinds();var i=this.model.get(this.options.keyAttr);null!=i&&this.setValue(i);var r=function(e){this.searchCollection.fetch(e)}.bind(this),l=this.model.get(this.options.column);this._listView=new a({configModel:this.options.configModel,searchCollection:this.searchCollection,lazySearch:r,type:l,searchPlaceholder:this.options.searchPlaceholder})},render:function render(){var e=!this.searchCollection.length,t=this.options.disabled,i=this.model.get(this.options.keyAttr),s=this._getPlaceholder(),n=this._hasValue(),o=n?s:i,r=i||"";return this.$el.html(this.template({title:r,label:o,keyAttr:this.options.keyAttr,isEmpty:e,isDisabled:t,isNull:n})),this._popupManager=new l(this.cid,this.$el,this._listView.$el),this._popupManager.append(this.dialogMode),this},_initBinds:function _initBinds(){var e=function(){this._listView.hide(),this._popupManager&&this._popupManager.untrack()}.bind(this);this.applyESCBind(e),this.applyClickOutsideBind(e),this.listenTo(this.searchCollection,"change:selected",this._onItemSelected)},_destroyBinds:function _destroyBinds(){this.stopListening(this.searchCollection),s.Form.editors.Base.prototype._destroyBinds.call(this)},_getPlaceholder:function _getPlaceholder(e){var t=this.options.keyAttr;return this.options.placeholder||_t("components.backbone-forms.select.placeholder",{keyAttr:t})},_hasValue:function _hasValue(){var e=this.model.get(this.options.keyAttr);return null==e||""===e},_onItemSelected:function _onItemSelected(e){this._listView.hide(),this._popupManager.untrack(),this._renderButton(e).focus(),this.trigger("change",this)},_onButtonClick:function _onButtonClick(){this._listView.toggle(),this._listView.isVisible()?this._popupManager.track():this._popupManager.untrack()},_onButtonKeyDown:function _onButtonKeyDown(e){13===e.which&&(e.preventDefault(),this._listView.isVisible()?this._popupManager.track():(e.stopPropagation(),this._onButtonClick()))},focus:function focus(){this.$(".js-button").focus()},blur:function blur(){this.$(".js-button").blur()},getValue:function getValue(){var e=this.searchCollection.getSelectedItem();return e?e.getValue():this.value},setValue:function setValue(e){var t=this.searchCollection.getSelectedItem();t?this._renderButton(t):this._renderButton(e),this.value=e},_renderButton:function _renderButton(e){var t=this.$(".js-button"),i=e.getName&&e.getName()||e,s=this.options.selectedItemTemplate({label:i});return t.toggleClass("is-empty",""===i).attr("title",i).html(s),t},remove:function remove(){this._popupManager&&this._popupManager.destroy(),this._listView&&this._listView.clean(),this._destroyBinds(),s.Form.editors.Base.prototype.remove.call(this)}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=n.Form.extend({initialize:function initialize(e){this.options=e,n.Form.Original.prototype.initialize.call(this,e),this.listenTo(this.model,"updateSchema",this.updateSchema)},updateSchema:function updateSchema(e){var t,i,n=s.keys(e),o=s.keys(this.schema);s.each(o,function(t){null==e[t]&&(this.fields[t].remove(),delete this.fields[t])},this),s.each(n,function(n){var o=e[n];null==this.schema[n]?(this.fields[n]=this.createField(n,o),this.renderAddedField(n)):(t=this.fields[n],i=s.extend({},s.omit(t.editor.options,s.keys(e[n])),{schema:e[n]}),t.editor._popupManager&&t.editor._popupManager.destroy(),t.editor._dialogView&&t.editor._dialogView.clean(),t.editor.undelegateEvents(),t.editor._destroyBinds&&t.editor._destroyBinds(),t.editor.initialize(i),t.editor.delegateEvents(),t.editor.render())},this),this.schema=s.extend({},this.schema,e)},renderAddedField:function renderAddedField(e){var t=this,i=this.fields,o=this.$el,r=n.$;o.find("[data-editors]").each(function(n,o){var a=r(o),l=a.attr("data-editors");if(!s.isUndefined(l)){var h="*"===l?t.selectedFields||s.keys(i):l.split(",");s.each(h,function(t){var s;t===e&&(s=i[t],a.append(s.editor.render().el))})}}),o.find("[data-editors]").each(function(n,o){var a=r(o),l=a.attr("data-editors");if(!s.isUndefined(l)){var h="*"===l?t.selectedFields||s.keys(i):l.split(",");s.each(h,function(t){var s;t===e&&(s=i[t],a.append(s.editor.render().el))})}})}});e.exports=o},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(2275),r=i(57);s.Form.editors.List.MeasurementModel=s.Form.editors.NestedModel.extend({initialize:function initialize(e){if(s.Form.editors.Base.prototype.initialize.call(this,e),r.setOptions(this,e),!this.form)throw new Error('Missing required option "form"');if(!e.schema.model)throw new Error('Missing required "schema.model" option for NestedModel editor')},render:function render(){var e=this.value||{},t=this.schema.model,i=e.constructor===t?e:new t(e,this.options);return this.nestedForm=new o({className:"Editor-formInner--nested",model:i,idPrefix:this.cid+"_",fieldTemplate:"nestedField",template:n.template('<form data-fields="*"></form>'),trackingClass:this.options.trackingClass}),this._observeFormEvents(),this.listenTo(this.nestedForm,"change",this._onChangeForm,this),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},_onChangeForm:function _onChangeForm(){this.nestedForm.commit()},remove:function remove(){this.nestedForm&&this.nestedForm.remove(),s.Form.editors.NestedModel.prototype.remove.call(this)}})},function(e,t,i){"use strict";var s=i(0),n=i(316),o=i(248);e.exports=n.extend({initialize:function initialize(e,t){this.type="multiple",n.prototype.initialize.call(this,e,t)},model:function model(e,t){var i={};return i.val=e.subsection_id,i.label=e.subsection_name,i.items=e.num_measurements,new o(i)},setSelected:function setSelected(e){var t={silent:!0};s.isArray(e)?this.each(function(i){s.contains(e,i.getValue())?i.set({selected:!0},t):i.set({selected:!1},t)}):this.each(function(i){i.getValue()===e?i.set({selected:!0},t):i.set({selected:!1},t)})},getSelected:function getSelected(){return this.filter(function(e){return!0===e.get("selected")})},buildQuery:function buildQuery(e){return"SELECT count(*) num_measurements, tag.key subsection_id, tag.value subsection_name FROM OBS_GetAvailableNumerators((SELECT ST_SetSRID(ST_Extent(the_geom), 4326) FROM ({{{ query }}}) q), {{{ region }}}) numers, Jsonb_Each(numers.numer_tags) tag WHERE tag.key like 'subsection%' GROUP BY tag.key, tag.value"}})},function(e,t,i){"use strict";var s=i(0),n=i(316),o=i(248);e.exports=n.extend({model:function model(e,t){return new o(e,t)},_onFetchSuccess:function _onFetchSuccess(e){var t=e.rows;t=s.map(t,function(e){var t={};t.val=e.numer_id,t.label=e.numer_name,t.description=e.numer_description,t.type=e.numer_type,t.aggregate=e.numer_aggregate,t.filter=[];var i=e.numer_tags;for(var n in s.isObject(i)||(i=JSON.parse(i)),i)/^subsection/.test(n)&&t.filter.push({id:n,name:i[n]}),/^license/.test(n)&&(t.license=i[n]);return t}).filter(function(e){return e.filter.length>0}),this.reset(t)},buildQuery:function buildQuery(e){return e&&e.search&&e.filters?"SELECT numer_id, numer_name, numer_description, numer_type, numer_aggregate, numer_tags FROM _OBS_GetNumerators((SELECT ST_SetSRID(ST_Extent(the_geom), 4326) FROM ({{{ query }}}) q), section_tags => {{{ region }}} , name => '{{{ search }}}', subsection_tags => {{{ filters }}})":e&&e.filters?"SELECT numer_id, numer_name, numer_description, numer_type, numer_aggregate, numer_tags FROM _OBS_GetNumerators((SELECT ST_SetSRID(ST_Extent(the_geom), 4326) FROM ({{{ query }}}) q), section_tags => {{{ region }}}, subsection_tags => {{{ filters }}})":e&&e.search?"SELECT numer_id, numer_name, numer_description, numer_type, numer_aggregate, numer_tags FROM _OBS_GetNumerators((SELECT ST_SetSRID(ST_Extent(the_geom), 4326) FROM ({{{ query }}}) q), section_tags => {{{ region }}}, name => '{{{ search }}}')":"SELECT numer_id, numer_name, numer_description, numer_type, numer_aggregate, numer_tags FROM _OBS_GetNumerators((SELECT ST_SetSRID(ST_Extent(the_geom), 4326) FROM ({{{ query }}}) q), section_tags => {{{ region }}}) ORDER BY numer_name ASC"},search:function search(){return this}})},function(e,t,i){"use strict";var s=i(0),n=i(1014),o=s.template("<%-name %> (<%- items %>)");e.exports=n.extend({render:function render(){this.clearSubViews(),this.$el.empty();var e=null==this.model.getName()?"null":this.model.getName();return e=e.replace(/"/g,""),this.$el.append(this.options.template(s.extend({isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),name:o({name:e,items:this.model.get("items")}),val:this.model.getValue(),description:this.model.get("description")}))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this}})},function(e,t,i){"use strict";var s=i(1),n=i(223),o=i(2279),r=i(418),a=i(417),l=i(3),h=i(349),c=["filtersCollection"];e.exports=s.extend({events:{"click .js-back":"_onClickBack"},initialize:function initialize(e){l(e,c,this),this._initBinds(),this._listView=new n({className:"DO-Filters",typeLabel:_t("components.backbone-forms.data-observatory.dropdown.filter.item-label"),showSearch:!1,collection:this._filtersCollection,itemTemplate:r,itemView:o}),this.addView(this._listView)},render:function render(){return this.$el.append(a({headerTitle:_t("components.backbone-forms.data-observatory.dropdown.filter.header")})),this._renderListSection(),this},_renderListSection:function _renderListSection(){var e=this._filtersCollection.stateModel.get("state");"fetched"===e?this.$(".js-content").html(this._listView.render().$el):this._createStatusView(e)},_createStatusView:function _createStatusView(e){var t=h({status:e,type:_t("components.backbone-forms.data-observatory.dropdown.filter.type")});this.$(".js-content").html(t)},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_initBinds:function _initBinds(){this.listenTo(this._filtersCollection.stateModel,"change:state",this._renderListSection,this),this.listenTo(this._filtersCollection,"change:selected",this._onSelectItem,this)},_onSelectItem:function _onSelectItem(e){this.trigger("selectItem",e,this)}})},function(e,t,i){"use strict";var s=i(1),n=i(3),o=i(419),r=["model"];e.exports=s.extend({initialize:function initialize(e){n(e,r,this),this._initBinds()},render:function render(){var e,t=this.model.get("query"),i=this.model.get("filtering"),s=this.model.get("items");return e=""!==t||i?_t("analyses.data-observatory-measure.count.search",{items:s}):_t("analyses.data-observatory-measure.count.suggested"),this.$el.html(o({items:e})),this},_initBinds:function _initBinds(){this.listenTo(this.model,"change:items",this.render)}})},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(3),r=i(7),a=i(420),l=["model","filtersCollection"];e.exports=n.extend({className:"CDB-Box-modalHeader",events:{"input .js-input-search":"_search","click .js-filters":"_onClickFilters"},initialize:function initialize(e){o(e,l,this)},render:function render(){var e=this._getSearchLabel();return this.$el.html(a({label:e})),setTimeout(function(){this._getInput().focus()}.bind(this),100),this},_getSearchLabel:function _getSearchLabel(){var e=this._filtersCollection.getSelected().length,t=_t("analyses.data-observatory-measure.filters.label");return 1===e?t=_t("analyses.data-observatory-measure.filters.applied.single"):e>1&&(t=_t("analyses.data-observatory-measure.filters.applied.multiple",{filters:e})),t},_onClickFilters:function _onClickFilters(e){this.killEvent(e),this.trigger("filters")},_search:s.debounce(function(e){var t=this._getInput().val();t=t.toLowerCase(),t=r.sanitizeHtml(t),this.model.set("query",t)},500),_getInput:function _getInput(){return this.$(".js-input-search")}})},function(e,t,i){"use strict";var s=i(0),n=i(247);e.exports=n.extend({render:function render(){this.$el.empty(),this.clearSubViews();var e=null==this.model.getName()?"null":this.model.getName(),t=this.model.get("selected");return this.$el.append(this.options.template(s.extend({isSelected:t,isDisabled:this.model.get("disabled"),name:e,val:this.model.getValue(),description:this.model.get("description")}))),this.$el.attr("data-val",this.model.getValue()).attr("data-selected",t).toggleClass("is-disabled",!!this.model.get("disabled")),this},_onMouseLeave:function _onMouseLeave(){this.$el.attr("data-selected")||this.$el.removeClass("is-highlighted")},_onMouseEnter:function _onMouseEnter(){this.$el.attr("data-selected")||this.$el.addClass("is-highlighted")}})},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(1),r=i(223),a=i(2283),l=i(422),h=i(3),c=i(421),d=i(2282),u=i(2281),p=i(349),g=["filtersCollection","measurementsCollection","searchMeasurements","measurementModel"];e.exports=o.extend({options:{maxItems:100},initialize:function initialize(e){h(e,g,this),this.model=new s.Model({query:"",items:this.options.maxItems,filtered:!1}),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.html(c()),this._createSearchView(),this._createCountView(),this._renderListSection(),this},_initBinds:function _initBinds(){this.listenTo(this._measurementsCollection.stateModel,"change:state",this._renderListSection),this.listenTo(this.model,"change:query",this._search)},_createListView:function _createListView(){this._listView&&(this._listView.clean(),this.removeView(this._listView)),this._isSerching()||this._promoteSelected(),this.model.set({items:this._measurementsCollection.size(),filtering:this._isFiltering()}),this._listView=new r({typeLabel:_t("components.backbone-forms.data-observatory.dropdown.measurement.type"),showSearch:!1,itemView:a,collection:this._measurementsCollection,itemTemplate:l}),this.addView(this._listView),this._listView.show(),this.$(".js-list").html(this._listView.$el)},_createStatusView:function _createStatusView(e){var t=p({status:e,type:_t("components.backbone-forms.data-observatory.dropdown.measurement.type")});this.$(".js-list").html(t)},_renderListSection:function _renderListSection(){var e=this._measurementsCollection.stateModel.get("state");"fetched"===e?this._createListView():this._createStatusView(e)},_createSearchView:function _createSearchView(){this._searchView=new d({model:this.model,filtersCollection:this._filtersCollection}),this.addView(this._searchView),this.$(".js-search").append(this._searchView.render().el),this.listenTo(this._searchView,"filters",this._onClickFilters)},_onClickFilters:function _onClickFilters(e){this.killEvent(e),this.trigger("filters")},_createCountView:function _createCountView(){var e=new u({model:this.model});this.addView(e),this.$(".js-count").append(e.render().el)},_search:function _search(){var e=this.model.get("query");this._searchMeasurements(e)},_isSerching:function _isSerching(){return!!this.model.get("query")},_isFiltering:function _isFiltering(){return this._filtersCollection.getSelected().length>0},_promoteSelected:function _promoteSelected(){var e=this._measurementModel;if(e.getValue()){var t=this._measurementsCollection.findWhere({val:e.getValue()});t&&this._measurementsCollection.remove(t);var i=n.clone(e.attributes);i.selected=!0,this._measurementsCollection.add(i,{at:0})}}})},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(1),r=i(3),a=i(222),l=i(2284),h=i(2280),c=["filtersCollection","measurementsCollection","measurementModel","region"],d=function braces(e){return n.template("'{<%- value %>}'")({value:e})};e.exports=o.extend({className:"CDB-Box-modal CustomList",initialize:function initialize(e){r(e,c,this),this.model=new s.Model({visible:!1}),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._generateStackLayoutView(),this},_initBinds:function _initBinds(){this.listenTo(this.model,"change:visible",function(e,t){t?this.render():this.clearSubViews(),this._toggleVisibility()})},_generateStackLayoutView:function _generateStackLayoutView(){var e=function(e,t){return this._createListView(e,t)}.bind(this),t=function(e,t){return this._createFilterView(e,t)}.bind(this),i=new s.Collection([{createStackView:e},{createStackView:t}]);this._stackLayoutView=new a({collection:i}),this.addView(this._stackLayoutView),this.$el.append(this._stackLayoutView.render().$el)},_buildFilters:function _buildFilters(){var e=this._filtersCollection.getSelected();return n.map(e,function(e){return e.getValue()}).join(", ")},_fetchMeasurements:function _fetchMeasurements(){var e=this._region,t={region:e&&d(e)};return this._measurementsCollection.fetch(t)},_fetchMeasurementsWithFilter:function _fetchMeasurementsWithFilter(){var e=this._region,t=this._buildFilters(),i={filters:t&&d(t),region:e&&d(e)};return this._measurementsCollection.fetch(i)},_searchMeasurements:function _searchMeasurements(e){var t=this._region,i=this._buildFilters(),s={filters:i&&d(i),region:t&&d(t),search:e,abortable:!0};return this._measurementsCollection.fetch(s)},_fetchFilters:function _fetchFilters(){var e=this._region,t={region:e&&d(e)};return this._filtersCollection.fetch(t)},_fetchCollections:function _fetchCollections(){this._filtersCollection.getSelected().length>0?this._fetchMeasurementsWithFilter():this._fetchMeasurements()},_createListView:function _createListView(e,t){this._fetchCollections();var i=new l({filtersCollection:this._filtersCollection,measurementsCollection:this._measurementsCollection,searchMeasurements:this._searchMeasurements.bind(this),measurementModel:this._measurementModel});return i.bind("filters",function(){e.nextStep()},this),i},_createFilterView:function _createFilterView(e,t){0===this._filtersCollection.size()&&this._fetchFilters();var i=new h({filtersCollection:this._filtersCollection});return i.bind("back",function(){this._measurementsCollection.trigger("maybeFiltersUpdated"),e.prevStep()},this),i},hide:function hide(){this.model.set("visible",!1)},toggle:function toggle(){this.model.set("visible",!this.model.get("visible"))},isVisible:function isVisible(){return this.model.get("visible")},_toggleVisibility:function _toggleVisibility(){this.$el.toggleClass("is-visible",!!this.isVisible())}})},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(57),r=i(424),a=i(423),l=i(2285),h=i(246),c=i(8),d=i(2278),u=i(2277),p="fetching",g=["aggregate","type","label","val","description","filter","license"];s.Form.editors.DataObservatoryDropdown=s.Form.editors.Base.extend({tagName:"div",className:"u-ellipsis Editor-formSelect",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function focusJsButton(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},options:{selectedItemTemplate:a},initialize:function initialize(e){s.Form.editors.Base.prototype.initialize.call(this,e),o.setOptions(this,e),this.template=e.template||r,this.dialogMode=this.options.dialogMode||c.Mode.DEFAULT,this.measurementModel=this.options.measurementModel;var t={configModel:this.options.configModel,nodeDefModel:this.options.nodeDefModel};this.measurementsCollection=new d([],t),this.filtersCollection=new u([],t),this._initBinds(),this._dialogView=new l({configModel:this.options.configModel,nodeDefModel:this.options.nodeDefModel,measurementsCollection:this.measurementsCollection,filtersCollection:this.filtersCollection,measurementModel:this.measurementModel,region:this.options.region})},render:function render(){var e=this._isLoading(),t=this.options.disabled,i=this.measurementModel,s=this._getPlaceholder(),n=this._hasValue(),o=n?s:i.getName(),r=i.getName()||"";return this.$el.html(this.template({title:r,label:o,keyAttr:this.options.keyAttr,isDisabled:t,isLoading:e,isNull:n})),this._popupManager=new h(this.cid,this.$el,this._dialogView.$el),this._popupManager.append(this.dialogMode),i&&this._renderLicense(i),this},_initBinds:function _initBinds(){var e=function(){this._dialogView.hide(),this._popupManager&&this._popupManager.untrack()}.bind(this);this.applyESCBind(e),this.applyClickOutsideBind(e),this.listenTo(this.measurementsCollection,"change:selected",this._onItemSelected)},_destroyBinds:function _destroyBinds(){this.stopListening(this.measurementsCollection),s.Form.editors.Base.prototype._destroyBinds.call(this)},_getPlaceholder:function _getPlaceholder(e){var t=this.options.keyAttr;return this.options.placeholder||_t("components.backbone-forms.select.placeholder",{keyAttr:t})},_hasValue:function _hasValue(){var e=this.measurementModel.getValue();return null==e||""===e},_isLoading:function _isLoading(){return this.measurementModel.getState()===p},_onItemSelected:function _onItemSelected(e){var t=this.measurementsCollection.getSelectedItem();t&&(this.measurementModel.clear({silent:!0}),this.measurementModel.set(n.pick(t.attributes,g))),this._dialogView.hide(),this._popupManager.untrack(),this._renderLicense(t),this._renderButton(t).focus(),this.trigger("change",this)},_onButtonClick:function _onButtonClick(){this._dialogView.toggle(),this._dialogView.isVisible()?this._popupManager.track():this._popupManager.untrack()},_onButtonKeyDown:function _onButtonKeyDown(e){13===e.which&&(e.preventDefault(),this._dialogView.isVisible()?this._popupManager.track():(e.stopPropagation(),this._onButtonClick()))},validate:function validate(){var e=this.getValue(),t=this.schema.validators,i=this.getValidator;if(!t)return null;var s=null;return n.every(t,function(t){return!!(s=i(t)(e,{}))}),s||null},focus:function focus(){this.$(".js-button").focus()},blur:function blur(){this.$(".js-button").blur()},getValue:function getValue(){var e=this.measurementModel;return e?e.getValue():this.value?this.value:void 0},setValue:function setValue(e){var t=this.measurementModel;t&&this._renderButton(t),this.value=e},_renderButton:function _renderButton(e){var t=this.$(".js-button"),i=e.getName(),s=this.options.selectedItemTemplate({label:i});return t.removeClass("is-empty").attr("title",i).html(s),t},_renderLicense:function _renderLicense(e){var t=e.get("license");this.$(".js-license").removeClass("u-isHidden").find("span").text(t)},remove:function remove(){this._popupManager&&this._popupManager.destroy(),this._dialogView&&this._dialogView.clean(),this._destroyBinds(),s.Form.editors.Base.prototype.remove.call(this)}})},function(e,t,i){"use strict";e.exports=function(e){function clearPlaceholder(e){e.state.placeholder&&(e.state.placeholder.parentNode.removeChild(e.state.placeholder),e.state.placeholder=null)}function setPlaceholder(e){clearPlaceholder(e);var t=e.state.placeholder=document.createElement("pre");t.style.cssText="height: 0; overflow: visible",t.className="CodeMirror-placeholder";var i=e.getOption("placeholder");"string"==typeof i&&(i=document.createTextNode(i)),t.appendChild(i),e.display.lineSpace.insertBefore(t,e.display.lineSpace.firstChild)}function onBlur(e){isEmpty(e)&&setPlaceholder(e)}function onChange(e){var t=e.getWrapperElement(),i=isEmpty(e);t.className=t.className.replace(" CodeMirror-empty","")+(i?" CodeMirror-empty":""),i?setPlaceholder(e):clearPlaceholder(e)}function isEmpty(e){return 1===e.lineCount()&&""===e.getLine(0)}e.defineOption("placeholder","",function(t,i,s){var n=s&&s!=e.Init;if(i&&!n)t.on("blur",onBlur),t.on("change",onChange),t.on("swapDoc",onChange),onChange(t);else if(!i&&n){t.off("blur",onBlur),t.off("change",onChange),t.off("swapDoc",onChange),clearPlaceholder(t);var o=t.getWrapperElement();o.className=o.className.replace(" CodeMirror-empty","")}i&&!t.hasFocus()&&onBlur(t)})}},function(e,t,i){"use strict";e.exports=function(e){var t=e.Pos;function SearchCursor(e,i,s,n){if(this.atOccurrence=!1,this.doc=e,null==n&&"string"==typeof i&&(n=!1),s=s?e.clipPos(s):t(0,0),this.pos={from:s,to:s},"string"!=typeof i)i.global||(i=new RegExp(i.source,i.ignoreCase?"ig":"g")),this.matches=function(s,n){if(s){i.lastIndex=0;for(var o=e.getLine(n.line).slice(0,n.ch),r=0;;){i.lastIndex=r;var a=i.exec(o);if(!a)break;if(h=(l=a).index,(r=l.index+(l[0].length||1))==o.length)break}(c=l&&l[0].length||0)||(0==h&&0==o.length?l=void 0:h!=e.getLine(n.line).length&&c++)}else{i.lastIndex=n.ch;o=e.getLine(n.line);var l,h,c=(l=i.exec(o))&&l[0].length||0;(h=l&&l.index)+c==o.length||c||(c=1)}if(l&&c)return{from:t(n.line,h),to:t(n.line,h+c),match:l}};else{var o=i;n&&(i=i.toLowerCase());var r=n?function(e){return e.toLowerCase()}:function(e){return e},a=i.split("\n");if(1==a.length)i.length?this.matches=function(s,n){if(s){var a=e.getLine(n.line).slice(0,n.ch);if((h=(l=r(a)).lastIndexOf(i))>-1)return h=adjustPos(a,l,h),{from:t(n.line,h),to:t(n.line,h+o.length)}}else{var l,h;a=e.getLine(n.line).slice(n.ch);if((h=(l=r(a)).indexOf(i))>-1)return h=adjustPos(a,l,h)+n.ch,{from:t(n.line,h),to:t(n.line,h+o.length)}}}:this.matches=function(){};else{var l=o.split("\n");this.matches=function(i,s){var n=a.length-1;if(i){if(s.line-(a.length-1)<e.firstLine())return;if(r(e.getLine(s.line).slice(0,l[n].length))!=a[a.length-1])return;for(var o=t(s.line,l[n].length),h=s.line-1,c=n-1;c>=1;--c,--h)if(a[c]!=r(e.getLine(h)))return;var d=(u=e.getLine(h)).length-l[0].length;if(r(u.slice(d))!=a[0])return;return{from:t(h,d),to:o}}if(!(s.line+(a.length-1)>e.lastLine())){var u;d=(u=e.getLine(s.line)).length-l[0].length;if(r(u.slice(d))==a[0]){var p=t(s.line,d);for(h=s.line+1,c=1;c<n;++c,++h)if(a[c]!=r(e.getLine(h)))return;if(r(e.getLine(h).slice(0,l[n].length))==a[n])return{from:p,to:t(h,l[n].length)}}}}}}}function adjustPos(e,t,i){if(e.length==t.length)return i;for(var s=Math.min(i,e.length);;){var n=e.slice(0,s).toLowerCase().length;if(n<i)++s;else{if(!(n>i))return s;--s}}}SearchCursor.prototype={findNext:function findNext(){return this.find(!1)},findPrevious:function findPrevious(){return this.find(!0)},find:function find(e){var i=this,s=this.doc.clipPos(e?this.pos.from:this.pos.to);function savePosAndFail(e){var s=t(e,0);return i.pos={from:s,to:s},i.atOccurrence=!1,!1}for(;;){if(this.pos=this.matches(e,s))return this.atOccurrence=!0,this.pos.match||!0;if(e){if(!s.line)return savePosAndFail(0);s=t(s.line-1,this.doc.getLine(s.line-1).length)}else{var n=this.doc.lineCount();if(s.line==n-1)return savePosAndFail(n);s=t(s.line+1,0)}}},from:function from(){if(this.atOccurrence)return this.pos.from},to:function to(){if(this.atOccurrence)return this.pos.to},replace:function replace(i,s){if(this.atOccurrence){var n=e.splitLines(i);this.doc.replaceRange(n,this.pos.from,this.pos.to,s),this.pos.to=t(this.pos.from.line+n.length-1,n[n.length-1].length+(1==n.length?this.pos.from.ch:0))}}},e.defineExtension("getSearchCursor",function(e,t,i){return new SearchCursor(this.doc,e,t,i)}),e.defineDocExtension("getSearchCursor",function(e,t,i){return new SearchCursor(this,e,t,i)}),e.defineExtension("selectMatches",function(t,i){for(var s=[],n=this.getSearchCursor(t,this.getCursor("from"),i);n.findNext()&&!(e.cmpPos(n.to(),this.getCursor("to"))>0);)s.push({anchor:n.from(),head:n.to()});s.length&&this.setSelections(s,0)})}},function(e,t,i){"use strict";var s=i(0);e.exports=function(e){var t=e.Pos;function scriptHint(i,n,o,r){var a=i.getCursor(),l=o(i,a),h=l,c=[];for(l.state=e.innerMode(i.getMode(),l.state).state,/^[\w$_-]*$/.test(l.string)||(l=h={start:a.ch,end:a.ch,string:"",state:l.state,type:"."===l.string?"property":null});"property"===h.type;){if("."!==(h=o(i,t(a.line,h.start))).string)return;if(")"===(h=o(i,t(a.line,h.start))).string){var d=1;do{switch((h=o(i,t(a.line,h.start))).string){case")":d++;break;case"(":d--}}while(d>0);if(0!==(h=o(i,t(a.line,h.start))).type.indexOf("variable"))return;h.type="function"}c.push(h)}return{list:function getCompletions(e,t,i,n){var o=[],r=e.string.toLowerCase();function maybeAdd(e){var t=s.isObject(e)?e.text:e;0!==(t=t.toLowerCase()).indexOf(r)||r===t||function arrayContains(e,t){return-1!==e.indexOf(t)}(o,t)||o.push(e)}return function gatherCompletions(e){for(var t in e)maybeAdd(e[t])}(n.list),s.each(i,maybeAdd),o}(l,0,n,r),from:t(a.line,l.start),to:t(a.line,l.end)}}e.registerHelper("hint","custom-list",function columnsHint(e,t){return scriptHint(e,[],function(e,t){return e.getTokenAt(t)},t)})}},function(e,t,i){"use strict";e.exports=function(e){var t="CodeMirror-hint",i="CodeMirror-hint-active";function Completion(e,t){this.cm=e,this.options=t,this.widget=null,this.debounce=0,this.tick=0,this.startPos=this.cm.getCursor("start"),this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var i=this;e.on("cursorActivity",this.activityFunc=function(){i.cursorActivity()})}e.showHint=function(e,t,i){if(!t)return e.showHint(i);i&&i.async&&(t.async=!0);var s={hint:t};if(i)for(var n in i)s[n]=i[n];return e.showHint(s)},e.defineExtension("showHint",function(t){t=function parseOptions(e,t,i){var s=e.options.hintOptions,n={};for(var r in o)n[r]=o[r];if(s)for(var r in s)void 0!==s[r]&&(n[r]=s[r]);if(i)for(var r in i)void 0!==i[r]&&(n[r]=i[r]);n.hint.resolve&&(n.hint=n.hint.resolve(e,t));return n}(this,this.getCursor("start"),t);var i=this.listSelections();if(!(i.length>1)){if(this.somethingSelected()){if(!t.hint.supportsSelection)return;for(var s=0;s<i.length;s++)if(i[s].head.line!=i[s].anchor.line)return}this.state.completionActive&&this.state.completionActive.close();var n=this.state.completionActive=new Completion(this,t);n.options.hint&&(e.signal(this,"startCompletion",this),n.update(!0))}});var s=window.requestAnimationFrame||function(e){return setTimeout(e,1e3/60)},n=window.cancelAnimationFrame||clearTimeout;function getText(e,t){var i=t&&t.autocompleteSuffix?t.autocompleteSuffix:"",s=t&&t.autocompletePrefix?t.autocompletePrefix:"";return"string"!=typeof e&&(e=e.text),s+e+i}function getHintElement(e,t){for(;t&&t!=e;){if("LI"===t.nodeName.toUpperCase()&&t.parentNode==e)return t;t=t.parentNode}}function styleHint(e){var t=document.createElement(e.displayText||getText(e));(t=document.createElement("span")).className="CDB-Size-small has-letter",t.innerHTML=e.displayText||getText(e);var i=function getType(e){return"string"==typeof e?"":e.type}(e);return i&&(t.className="CDB-Size-small has-letter",t.dataset.type=i),t}function Widget(s,n){this.completion=s,this.data=n,this.picked=!1;var o,r=this,a=s.cm,l=this.hints=document.createElement("ul");l.className="CodeMirror-hints",this.selectedHint=n.selectedHint||0;for(var h=n.list,c=0;c<h.length;++c){var d=l.appendChild(document.createElement("li")),u=h[c],p=t+(c!=this.selectedHint?"":" "+i);null!=u.className&&(p=u.className+" "+p),d.className=p,u.render?u.render(d,n,u):(o=styleHint(u),d.appendChild(o)),d.hintId=c}var g=a.cursorCoords(s.options.alignWithWord?n.from:null),m=g.left,f=g.bottom,_=!0;l.style.left=m+"px",l.style.top=f+"px";var v=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),y=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(s.options.container||document.body).appendChild(l);var b=l.getBoundingClientRect();if(b.bottom-y>0){var w=b.bottom-b.top;if(g.top-(g.bottom-b.top)-w>0)l.style.top=(f=g.top-w)+"px",_=!1;else if(w>y){l.style.height=y-5+"px",l.style.top=(f=g.bottom-b.top)+"px";var C=a.getCursor();n.from.ch!=C.ch&&(g=a.cursorCoords(C),l.style.left=(m=g.left)+"px",b=l.getBoundingClientRect())}}var M,k=b.right-v;(k>0&&(b.right-b.left>v&&(l.style.width=v-5+"px",k-=b.right-b.left-v),l.style.left=(m=g.left-k)+"px"),a.addKeyMap(this.keyMap=function buildKeyMap(e,t){var i={Up:function Up(){t.moveFocus(-1)},Down:function Down(){t.moveFocus(1)},PageUp:function PageUp(){t.moveFocus(1-t.menuSize(),!0)},PageDown:function PageDown(){t.moveFocus(t.menuSize()-1,!0)},Home:function Home(){t.setFocus(0)},End:function End(){t.setFocus(t.length-1)},Enter:t.pick,Tab:t.pick,Esc:t.close},s=e.options.customKeys,n=s?{}:i;function addBinding(e,s){var o;o="string"!=typeof s?function bound(e){return s(e,t)}:i.hasOwnProperty(s)?i[s]:s,n[e]=o}if(s)for(var o in s)s.hasOwnProperty(o)&&addBinding(o,s[o]);var r=e.options.extraKeys;if(r)for(var o in r)r.hasOwnProperty(o)&&addBinding(o,r[o]);return n}(s,{moveFocus:function moveFocus(e,t){r.changeActive(r.selectedHint+e,t)},setFocus:function setFocus(e){r.changeActive(e)},menuSize:function menuSize(){return r.screenAmount()},length:h.length,close:function close(){s.close()},pick:function pick(){r.pick()},data:n})),s.options.closeOnUnfocus)&&(a.on("blur",this.onBlur=function(){M=setTimeout(function(){s.close()},100)}),a.on("focus",this.onFocus=function(){clearTimeout(M)}));var S=a.getScrollInfo();return a.on("scroll",this.onScroll=function(){var e=a.getScrollInfo(),t=a.getWrapperElement().getBoundingClientRect(),i=f+S.top-e.top,n=i-(window.pageYOffset||(document.documentElement||document.body).scrollTop);if(_||(n+=l.offsetHeight),n<=t.top||n>=t.bottom)return s.close();l.style.top=i+"px",l.style.left=m+S.left-e.left+"px"}),e.on(l,"dblclick",function(e){var t=getHintElement(l,e.target||e.srcElement);t&&null!=t.hintId&&(r.changeActive(t.hintId),r.pick())}),e.on(l,"click",function(e){var t=getHintElement(l,e.target||e.srcElement);t&&null!=t.hintId&&(r.changeActive(t.hintId),s.options.completeOnSingleClick&&r.pick())}),e.on(l,"mousedown",function(){setTimeout(function(){a.focus()},20)}),e.signal(n,"select",h[0],l.firstChild),!0}function fetchHints(e,t,i,s){if(e.async)e(t,s,i);else{var n=e(t,i);n&&n.then?n.then(s):s(n)}}Completion.prototype={close:function close(){this.active()&&(this.cm.state.completionActive=null,this.tick=null,this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.data&&e.signal(this.data,"close"),this.widget&&this.widget.close(),e.signal(this.cm,"endCompletion",this.cm))},active:function active(){return this.cm.state.completionActive==this},pick:function pick(t,i){var s=t.list[i];s.hint?s.hint(this.cm,t,s):this.cm.replaceRange(getText(s,this.options),s.from||t.from,s.to||t.to,"complete"),e.signal(t,"pick",s),this.close()},cursorActivity:function cursorActivity(){this.debounce&&(n(this.debounce),this.debounce=0);var e=this.cm.getCursor(),t=this.cm.getLine(e.line);if(e.line!=this.startPos.line||t.length-e.ch!=this.startLen-this.startPos.ch||e.ch<this.startPos.ch||this.cm.somethingSelected()||e.ch&&this.options.closeCharacters.test(t.charAt(e.ch-1)))this.close();else{var i=this;this.debounce=s(function(){i.update()}),this.widget&&this.widget.disable()}},update:function update(e){if(null!=this.tick){var t=this,i=++this.tick;fetchHints(this.options.hint,this.cm,this.options,function(s){t.tick==i&&t.finishUpdate(s,e)})}},finishUpdate:function finishUpdate(t,i){this.data&&e.signal(this.data,"update");var s=this.widget&&this.widget.picked||i&&this.options.completeSingle;this.widget&&this.widget.close(),t&&this.data&&function isNewCompletion(t,i){return e.cmpPos(i.from,t.from)>0&&t.to.ch-t.from.ch!=i.to.ch-i.from.ch}(this.data,t)||(this.data=t,t&&t.list.length&&(s&&1==t.list.length?this.pick(t,0):(this.widget=new Widget(this,t),e.signal(t,"shown"))))}},Widget.prototype={close:function close(){if(this.completion.widget==this){this.completion.widget=null,this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap);var e=this.completion.cm;this.completion.options.closeOnUnfocus&&(e.off("blur",this.onBlur),e.off("focus",this.onFocus)),e.off("scroll",this.onScroll)}},disable:function disable(){this.completion.cm.removeKeyMap(this.keyMap);var e=this;this.keyMap={Enter:function Enter(){e.picked=!0}},this.completion.cm.addKeyMap(this.keyMap)},pick:function pick(){this.completion.pick(this.data,this.selectedHint)},changeActive:function changeActive(t,s){if(t>=this.data.list.length?t=s?this.data.list.length-1:0:t<0&&(t=s?0:this.data.list.length-1),this.selectedHint!=t){var n=this.hints.childNodes[this.selectedHint];n.className=n.className.replace(" "+i,""),(n=this.hints.childNodes[this.selectedHint=t]).className+=" "+i,n.offsetTop<this.hints.scrollTop?this.hints.scrollTop=n.offsetTop-3:n.offsetTop+n.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=n.offsetTop+n.offsetHeight-this.hints.clientHeight+3),e.signal(this.data,"select",this.data.list[this.selectedHint],n)}},screenAmount:function screenAmount(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}},e.registerHelper("hint","auto",{resolve:function resolveAutoHints(t,i){var s,n=t.getHelpers(i,"hint");if(n.length){var o=function resolved(e,t,i){var s=function applicableHelpers(e,t){if(!e.somethingSelected())return t;for(var i=[],s=0;s<t.length;s++)t[s].supportsSelection&&i.push(t[s]);return i}(e,n);!function run(n){if(n==s.length)return t(null);fetchHints(s[n],e,i,function(e){e&&e.list.length>0?t(e):run(n+1)})}(0)};return o.async=!0,o.supportsSelection=!0,o}return(s=t.getHelper(t.getCursor(),"hintWords"))?function(t){return e.hint.fromList(t,{words:s})}:e.hint.anyword?function(t,i){return e.hint.anyword(t,i)}:function(){}}}),e.registerHelper("hint","fromList",function(t,i){var s=t.getCursor(),n=t.getTokenAt(s),o=e.Pos(s.line,n.end);if(n.string&&/\w/.test(n.string[n.string.length-1]))var r=n.string,a=e.Pos(s.line,n.start);else r="",a=o;for(var l=[],h=0;h<i.words.length;h++){var c=i.words[h];c.slice(0,r.length)==r&&l.push(c)}if(l.length)return{list:l,from:a,to:o}}),e.commands.autocomplete=e.showHint;var o={hint:e.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null};e.defineOption("hintOptions",null)}},function(e,t,i){"use strict";e.exports=function(e){function Bar(t,i,s){this.orientation=i,this.scroll=s,this.screen=this.total=this.size=1,this.pos=0,this.node=document.createElement("div"),this.node.className=t+"-"+i,this.inner=this.node.appendChild(document.createElement("div"));var n=this;function onWheel(t){var i=e.wheelEventPixels(t)["horizontal"===n.orientation?"x":"y"],s=n.pos;n.moveTo(n.pos+i),n.pos!==s&&e.e_preventDefault(t)}e.on(this.inner,"mousedown",function(t){if(1===t.which){e.e_preventDefault(t);var i="horizontal"===n.orientation?"pageX":"pageY",s=t[i],o=n.pos;e.on(document,"mousemove",move),e.on(document,"mouseup",done)}function done(){e.off(document,"mousemove",move),e.off(document,"mouseup",done)}function move(e){if(1!==e.which)return done();n.moveTo(o+(e[i]-s)*(n.total/n.size))}}),e.on(this.node,"click",function(t){e.e_preventDefault(t);var i,s=n.inner.getBoundingClientRect();i="horizontal"===n.orientation?t.clientX<s.left?-1:t.clientX>s.right?1:0:t.clientY<s.top?-1:t.clientY>s.bottom?1:0,n.moveTo(n.pos+i*n.screen)}),e.on(this.node,"mousewheel",onWheel),e.on(this.node,"DOMMouseScroll",onWheel)}Bar.prototype.setPos=function(e,t){return e<0&&(e=0),e>this.total-this.screen&&(e=this.total-this.screen),!(!t&&e===this.pos)&&(this.pos=e,this.inner.style["horizontal"===this.orientation?"left":"top"]=e*(this.size/this.total)+"px",!0)},Bar.prototype.moveTo=function(e){this.setPos(e)&&this.scroll(e,this.orientation)};function SimpleScrollbars(e,t,i){this.addClass=e,this.horiz=new Bar(e,"horizontal",i),t(this.horiz.node),this.vert=new Bar(e,"vertical",i),t(this.vert.node),this.width=null}Bar.prototype.update=function(e,t,i){var s=this.screen!==t||this.total!==e||this.size!==i;s&&(this.screen=t,this.total=e,this.size=i);var n=this.screen*(this.size/this.total);n<10&&(this.size-=10-n,n=10),this.inner.style["horizontal"===this.orientation?"width":"height"]=n+"px",this.setPos(this.pos,s)},SimpleScrollbars.prototype.update=function(e){if(null==this.width){var t=window.getComputedStyle?window.getComputedStyle(this.horiz.node):this.horiz.node.currentStyle;t&&(this.width=parseInt(t.height,10))}var i=this.width||0,s=e.scrollWidth>e.clientWidth+1,n=e.scrollHeight>e.clientHeight+1;return this.vert.node.style.display=n?"block":"none",this.horiz.node.style.display=s?"block":"none",n&&(this.vert.update(e.scrollHeight,e.clientHeight,e.viewHeight-(s?i:0)),this.vert.node.style.bottom=s?i+"px":"0"),s&&(this.horiz.update(e.scrollWidth,e.clientWidth,e.viewWidth-(n?i:0)-e.barLeft),this.horiz.node.style.right=n?i+"px":"0",this.horiz.node.style.left=e.barLeft+"px"),{right:n?i:0,bottom:s?i:0}},SimpleScrollbars.prototype.setScrollTop=function(e){this.vert.setPos(e)},SimpleScrollbars.prototype.setScrollLeft=function(e){this.horiz.setPos(e)},SimpleScrollbars.prototype.clear=function(){var e=this.horiz.node.parentNode;e.removeChild(this.horiz.node),e.removeChild(this.vert.node)},e.scrollbarModel.simple=function(e,t){return new SimpleScrollbars("CodeMirror-simplescroll",e,t)},e.scrollbarModel.overlay=function(e,t){return new SimpleScrollbars("CodeMirror-overlayscroll",e,t)}}},function(e,t,i){"use strict";var s=i(1003);e.exports=function(e){e.defineMode("cartocss",function(e){var t,i=e.indentUnit;function ret(e,i){return t=i,e}var n="a abbr acronym address applet area article aside audio b base basefont bdi bdo big blockquote body br button canvas caption cite code col colgroup command datalist dd del details dfn dir div dl dt em embed fieldset figcaption figure font footer form frame frameset h1 h2 h3 h4 h5 h6 head header hgroup hr html i iframe img input ins keygen kbd label legend li link map mark menu meta meter nav noframes noscript object ol optgroup option output p param pre progress q rp rt ruby s samp script section select small source span strike strong style sub summary sup table tbody td textarea tfoot th thead time title tr track tt u ul var video wbr".split(" "),o=function keySet(e){for(var t={},i=0;i<e.length;++i)t[e[i]]=!0;return t}(s);var r=/(^\:root$|^\:nth\-child$|^\:nth\-last\-child$|^\:nth\-of\-type$|^\:nth\-last\-of\-type$|^\:first\-child$|^\:last\-child$|^\:first\-of\-type$|^\:last\-of\-type$|^\:only\-child$|^\:only\-of\-type$|^\:empty$|^\:link|^\:visited$|^\:active$|^\:hover$|^\:focus$|^\:target$|^\:lang$|^\:enabled^\:disabled$|^\:checked$|^\:first\-line$|^\:first\-letter$|^\:before$|^\:after$|^\:not$|^\:required$|^\:invalid$)/;function tokenBase(e,i){var s=e.next();if("@"===s)return e.eatWhile(/[\w\-]/),ret("meta",e.current());if("/"===s&&e.eat("*"))return i.tokenize=tokenCComment,tokenCComment(e,i);if("<"===s&&e.eat("!"))return i.tokenize=tokenSGMLComment,tokenSGMLComment(e,i);if("="===s)ret(null,"compare");else{if("|"===s&&e.eat("="))return ret(null,"compare");if("'"===s||"'"===s)return i.tokenize=function tokenString(e){return function(t,i){for(var s,n=!1;null!=(s=t.next())&&(s!==e||n);)n=!n&&"\\"===s;return n||(i.tokenize=tokenBase),ret("string","string")}}(s),i.tokenize(e,i);if("/"===s){if(e.eat("/"))return i.tokenize=tokenSComment,tokenSComment(e,i);if("string"===t||"("===t)return ret("string","string");if(void 0!==i.stack[i.stack.length-1])return ret(null,s);if(e.eatWhile(/[\a-zA-Z0-9\-_.\s]/),/\/|\)|#/.test(e.peek()||e.eatSpace()&&")"===e.peek())||e.eol())return ret("string","string")}else{if("!"===s)return e.match(/^\s*\w*/),ret("keyword","important");if(/\d/.test(s))return e.eatWhile(/[\w.%]/),ret("number","unit");if(/[,+<>*\/]/.test(s))return"="===e.peek()||"a"===t?ret("string","string"):ret(null,"select-op");if(!/[;{}:\[\]()~\|]/.test(s)){if("."===s)return"("===t||"string"===t?ret("string","string"):(e.eatWhile(/[\a-zA-Z0-9\-_]/)," "===e.peek()&&e.eatSpace(),")"===e.peek()?ret("number","unit"):ret("tag","tag"));if("#"===s)return e.eatWhile(/[A-Za-z0-9]/),(4===e.current().length||7===e.current().length)&&null!=e.current().match(/[A-Fa-f0-9]{6}|[A-Fa-f0-9]{3}/,!1)?e.current().substring(1)!==e.current().match(/[A-Fa-f0-9]{6}|[A-Fa-f0-9]{3}/,!1)[0]?ret("atom","tag"):(e.eatSpace(),/[\/<>.({!$%^&*_\-\\?=+\|#'~`]/.test(e.peek())?ret("atom","tag"):"}"===e.peek()?ret("color","unit"):/[a-zA-Z\\]/.test(e.peek())?ret("color","unit"):(e.eol(),ret("color","unit"))):(e.eatWhile(/[\w\\\-]/),ret("atom","tag"));if("&"===s)return e.eatWhile(/[\w\-]/),ret(null,s);if(e.eatWhile(/[\w\\\-_%.{]/),"string"===t)return ret("string","string");if(null!=e.current().match(/(^http$|^https$)/))return e.eatWhile(/[\w\\\-_%.{:\/]/),ret("string","string");if("<"===e.peek()||">"===e.peek())return ret("tag","tag");if(/\(/.test(e.peek()))return ret(null,s);if("/"===e.peek()&&void 0!==i.stack[i.stack.length-1])return ret("string","string");if(e.current().match(/\-\d|\-.\d/))return ret("number","unit");if(function inTagsArray(e){for(var t=0;t<n.length;t++)if(e===n[t])return!0}(e.current().toLowerCase()))return ret("tag","tag");if(/\/|[\s\)]/.test(e.peek()||e.eol()||e.eatSpace()&&"/"===e.peek())&&-1!==e.current().indexOf("."))return"{"===e.current().substring(e.current().length-1,e.current().length)?(e.backUp(1),ret("tag","tag")):(e.eatSpace(),/[{<>.a-zA-Z\/]/.test(e.peek())||e.eol()?ret("tag","tag"):ret("string","string"));if(e.eol()||"["===e.peek()||"#"===e.peek()||"tag"===t)return"{"===e.current().substring(e.current().length-1,e.current().length)&&e.backUp(1),ret("tag","tag");if("compare"===t||"a"===t||"("===t)return ret("string","string");if("|"===t||"-"===e.current()||"["===t)return ret(null,s);if(":"===e.peek()){e.next();var a=":"===e.peek();if(a)e.backUp(1);else{var l=e.pos,h=e.current().length;e.eatWhile(/[a-z\\\-]/);var c=e.pos;if(null!=e.current().substring(h-1).match(r))return e.backUp(c-(l-1)),ret("tag","tag");e.backUp(c-(l-1))}return a?ret("tag","tag"):ret("variable","variable")}return o.hasOwnProperty(e.current())?ret("color","unit"):ret("variable","variable")}if(":"===s)return e.eatWhile(/[a-z\\\-]/),r.test(e.current())?ret("tag","tag"):":"===e.peek()?(e.next(),e.eatWhile(/[a-z\\\-]/),e.current().match(/\:\:\-(o|ms|moz|webkit)\-/)?ret("string","string"):r.test(e.current().substring(1))?ret("tag","tag"):ret(null,s)):ret(null,s);if("~"!==s)return ret(null,s);if("r"===t)return ret("string","string")}}}function tokenSComment(e,t){return e.skipToEnd(),t.tokenize=tokenBase,ret("comment","comment")}function tokenCComment(e,t){for(var i,s=!1;null!=(i=e.next());){if(s&&"/"===i){t.tokenize=tokenBase;break}s="*"===i}return ret("comment","comment")}function tokenSGMLComment(e,t){for(var i,s=0;null!=(i=e.next());){if(s>=2&&">"===i){t.tokenize=tokenBase;break}s="-"===i?s+1:0}return ret("comment","comment")}return{startState:function startState(e){return{tokenize:tokenBase,baseIndent:e||0,stack:[]}},token:function token(e,i){if(e.eatSpace())return null;var s=i.tokenize(e,i),n=i.stack[i.stack.length-1];return"hash"===t&&"rule"===n?s="atom":"variable"===s&&("rule"===n?s=null:n&&"@media{"!==n||(s="when"===e.current()?"variable":/[\s,|\s\)|\s]/.test(e.peek())?"tag":t)),"rule"===n&&/^[\{\};]$/.test(t)&&i.stack.pop(),"{"===t?"@media"===n?i.stack[i.stack.length-1]="@media{":i.stack.push("{"):"}"===t?i.stack.pop():"@media"===t?i.stack.push("@media"):"{"===n&&"comment"!==t&&i.stack.push("rule"),s},indent:function indent(e,t){var s=e.stack.length;return/^\}/.test(t)&&(s-="rule"===e.stack[e.stack.length-1]?2:1),e.baseIndent+s*i},electricChars:"}"}}),e.defineMIME("text/x-carto","cartocss")}},function(e,t,i){"use strict";e.exports=function(e){e.defineMode("mustache",function(){return{token:function token(e,t){var i;if(e.match("{{")){if(null==(i=e.peek())||null!=i&&i.match(/[{]{1,}/))return e.next(),"mustache-error";if(null!=i&&i.match(/[a-zA-Z\u00C0-\u024F_]+/))return null}if(e.match("}}")){if(null!=(i=e.peek())&&i.match(/[}]{1,}/))return e.next(),"mustache-error";if(null==i)return null}return e.match("}")&&(null==(i=e.peek())||null!=i&&i.match(/[}]{1,}/))?(e.next(),"mustache-error"):e.match("{")&&(null==(i=e.peek())||null!=i&&i.match(/[{]{1,}/))?(e.next(),"mustache-error"):e.match(/[a-zA-Z\u00C0-\u024F_]+/,!0)?"mustache-text":void e.next()}}}),function(){function set(e){for(var t={},i=e.split(" "),s=0;s<i.length;++s)t[i[s]]=!0;return t}e.defineMIME("text/mustache",{name:"mustache",client:set("source"),keywords:set("{{  }}")})}()}},function(e,t,i){"use strict";e.exports=function(e){e.defineMode("sql",function(t,i){var s=i.client||{},n=i.atoms||{false:!0,true:!0,null:!0},o=i.builtin||{},r=i.keywords||{},a=i.operatorChars||/^[*+\-%<>!=&|~^]/,l=i.support||{},h=i.hooks||{},c=i.dateSQL||{date:!0,time:!0,timestamp:!0};function tokenBase(e,t){var i=e.next();if(h[i]){var d=h[i](e,t);if(!1!==d)return d}if(1==l.hexNumber&&("0"==i&&e.match(/^[xX][0-9a-fA-F]+/)||("x"==i||"X"==i)&&e.match(/^'[0-9a-fA-F]+'/)))return"number";if(1==l.binaryNumber&&(("b"==i||"B"==i)&&e.match(/^'[01]+'/)||"0"==i&&e.match(/^b[01]+/)))return"number";if(i.charCodeAt(0)>47&&i.charCodeAt(0)<58)return e.match(/^[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/),1==l.decimallessFloat&&e.eat("."),"number";if("?"==i&&(e.eatSpace()||e.eol()||e.eat(";")))return"variable-3";if("'"==i||'"'==i&&l.doubleQuote)return t.tokenize=function tokenLiteral(e){return function(t,i){for(var s,n=!1;null!=(s=t.next());){if(s==e&&!n){i.tokenize=tokenBase;break}n=!n&&"\\"==s}return"string"}}(i),t.tokenize(e,t);if((1==l.nCharCast&&("n"==i||"N"==i)||1==l.charsetCast&&"_"==i&&e.match(/[a-z][a-z0-9]*/i))&&("'"==e.peek()||'"'==e.peek()))return"keyword";if(/^[\(\),\;\[\]]/.test(i))return null;if(l.commentSlashSlash&&"/"==i&&e.eat("/"))return e.skipToEnd(),"comment";if(l.commentHash&&"#"==i||"-"==i&&e.eat("-")&&(!l.commentSpaceRequired||e.eat(" ")))return e.skipToEnd(),"comment";if("/"==i&&e.eat("*"))return t.tokenize=tokenComment,t.tokenize(e,t);if("."!=i){if(a.test(i))return e.eatWhile(a),null;if("{"==i&&(e.match(/^( )*(d|D|t|T|ts|TS)( )*'[^']*'( )*}/)||e.match(/^( )*(d|D|t|T|ts|TS)( )*"[^"]*"( )*}/)))return"number";e.eatWhile(/^[_\w\d]/);var u=e.current().toLowerCase();return c.hasOwnProperty(u)&&(e.match(/^( )+'[^']*'/)||e.match(/^( )+"[^"]*"/))?"number":n.hasOwnProperty(u)?"atom":o.hasOwnProperty(u)?"builtin":r.hasOwnProperty(u)?"keyword":s.hasOwnProperty(u)?"string-2":null}return 1==l.zerolessFloat&&e.match(/^(?:\d+(?:e[+-]?\d+)?)/i)?"number":1==l.ODBCdotTable&&e.match(/^[a-zA-Z_]+/)?"variable-2":void 0}function tokenComment(e,t){for(;;){if(!e.skipTo("*")){e.skipToEnd();break}if(e.next(),e.eat("/")){t.tokenize=tokenBase;break}}return"comment"}function pushContext(e,t,i){t.context={prev:t.context,indent:e.indentation(),col:e.column(),type:i}}return{startState:function startState(){return{tokenize:tokenBase,context:null}},token:function token(e,t){if(e.sol()&&t.context&&null==t.context.align&&(t.context.align=!1),e.eatSpace())return null;var i=t.tokenize(e,t);if("comment"==i)return i;t.context&&null==t.context.align&&(t.context.align=!0);var s=e.current();return"("==s?pushContext(e,t,")"):"["==s?pushContext(e,t,"]"):t.context&&t.context.type==s&&function popContext(e){e.indent=e.context.indent,e.context=e.context.prev}(t),i},indent:function indent(i,s){var n=i.context;if(!n)return e.Pass;var o=s.charAt(0)==n.type;return n.align?n.col+(o?0:1):n.indent+(o?0:t.indentUnit)},blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:l.commentSlashSlash?"//":l.commentHash?"#":null}}),function(){function set(e){for(var t={},i=e.split(" "),s=0;s<i.length;++s)t[i[s]]=!0;return t}e.defineMIME("text/x-pgsql",{name:"sql",client:set("source"),keywords:set("alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit a abort abs absent absolute access according action ada add admin after aggregate all allocate also always analyse analyze any are array array_agg array_max_cardinality asensitive assertion assignment asymmetric at atomic attribute attributes authorization avg backward base64 before begin begin_frame begin_partition bernoulli binary bit_length blob blocked bom both breadth c cache call called cardinality cascade cascaded case cast catalog catalog_name ceil ceiling chain characteristics characters character_length character_set_catalog character_set_name character_set_schema char_length check checkpoint class class_origin clob close cluster coalesce cobol collate collation collation_catalog collation_name collation_schema collect column columns column_name command_function command_function_code comment comments commit committed concurrently condition condition_number configuration conflict connect connection connection_name constraint constraints constraint_catalog constraint_name constraint_schema constructor contains content continue control conversion convert copy corr corresponding cost covar_pop covar_samp cross csv cube cume_dist current current_catalog current_date current_default_transform_group current_path current_role current_row current_schema current_time current_timestamp current_transform_group_for_type current_user cursor cursor_name cycle data database datalink datetime_interval_code datetime_interval_precision day db deallocate dec declare default defaults deferrable deferred defined definer degree delimiter delimiters dense_rank depth deref derived describe descriptor deterministic diagnostics dictionary disable discard disconnect dispatch dlnewcopy dlpreviouscopy dlurlcomplete dlurlcompleteonly dlurlcompletewrite dlurlpath dlurlpathonly dlurlpathwrite dlurlscheme dlurlserver dlvalue do document domain dynamic dynamic_function dynamic_function_code each element else empty enable encoding encrypted end end-exec end_frame end_partition enforced enum equals escape event every except exception exclude excluding exclusive exec execute exists exp explain expression extension external extract false family fetch file filter final first first_value flag float floor following for force foreign fortran forward found frame_row free freeze fs full function functions fusion g general generated get global go goto grant granted greatest grouping groups handler header hex hierarchy hold hour id identity if ignore ilike immediate immediately immutable implementation implicit import including increment indent index indexes indicator inherit inherits initially inline inner inout input insensitive instance instantiable instead integrity intersect intersection invoker isnull isolation k key key_member key_type label lag language large last last_value lateral lead leading leakproof least left length level library like_regex link listen ln load local localtime localtimestamp location locator lock locked logged lower m map mapping match matched materialized max maxvalue max_cardinality member merge message_length message_octet_length message_text method min minute minvalue mod mode modifies module month more move multiset mumps name names namespace national natural nchar nclob nesting new next nfc nfd nfkc nfkd nil no none normalize normalized nothing notify notnull nowait nth_value ntile null nullable nullif nulls number object occurrences_regex octets octet_length of off offset oids old only open operator option options ordering ordinality others out outer output over overlaps overlay overriding owned owner p pad parameter parameter_mode parameter_name parameter_ordinal_position parameter_specific_catalog parameter_specific_name parameter_specific_schema parser partial partition pascal passing passthrough password percent percentile_cont percentile_disc percent_rank period permission placing plans pli policy portion position position_regex power precedes preceding prepare prepared preserve primary prior privileges procedural procedure program public quote range rank read reads reassign recheck recovery recursive ref references referencing refresh regr_avgx regr_avgy regr_count regr_intercept regr_r2 regr_slope regr_sxx regr_sxy regr_syy reindex relative release rename repeatable replace replica requiring reset respect restart restore restrict result return returned_cardinality returned_length returned_octet_length returned_sqlstate returning returns revoke right role rollback rollup routine routine_catalog routine_name routine_schema row rows row_count row_number rule savepoint scale schema schema_name scope scope_catalog scope_name scope_schema scroll search second section security selective self sensitive sequence sequences serializable server server_name session session_user setof sets share show similar simple size skip snapshot some source space specific specifictype specific_name sql sqlcode sqlerror sqlexception sqlstate sqlwarning sqrt stable standalone start state statement static statistics stddev_pop stddev_samp stdin stdout storage strict strip structure style subclass_origin submultiset substring substring_regex succeeds sum symmetric sysid system system_time system_user t tables tablesample tablespace table_name temp template temporary then ties timezone_hour timezone_minute to token top_level_count trailing transaction transactions_committed transactions_rolled_back transaction_active transform transforms translate translate_regex translation treat trigger trigger_catalog trigger_name trigger_schema trim trim_array true truncate trusted type types uescape unbounded uncommitted under unencrypted unique unknown unlink unlisten unlogged unnamed unnest until untyped upper uri usage user user_defined_type_catalog user_defined_type_code user_defined_type_name user_defined_type_schema using vacuum valid validate validator value value_of varbinary variadic var_pop var_samp verbose version versioning view views volatile when whenever whitespace width_bucket window within work wrapper write xmlagg xmlattributes xmlbinary xmlcast xmlcomment xmlconcat xmldeclaration xmldocument xmlelement xmlexists xmlforest xmliterate xmlnamespaces xmlparse xmlpi xmlquery xmlroot xmlschema xmlserialize xmltable xmltext xmlvalidate year yes loop repeat"),builtin:set("bigint int8 bigserial serial8 bit varying varbit boolean bool box bytea character char varchar cidr circle date double precision float8 inet integer int int4 interval json jsonb line lseg macaddr money numeric decimal path pg_lsn point polygon real float4 smallint int2 smallserial serial2 serial serial4 text time without zone with timetz timestamp timestamptz tsquery tsvector txid_snapshot uuid xml"),atoms:set("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^]/,dateSQL:set("date time timestamp"),support:set("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber nCharCast charsetCast commentHash commentSpaceRequired")})}()}},function(e,t,i){"use strict";var s=i(1),n=i(4),o=i(0),r=i(464),a=i(1003),l=["editor"],h=o.template("1px solid  <%- color %>"),c=function stopPropagation(e){e.stopPropagation()};e.exports=s.extend({initialize:function initialize(e){o.each(l,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),this._updateColors=o.debounce(this._updateColors,5).bind(this),this._onDocumentClick=this._onDocumentClick.bind(this),this._editor=e.editor,this._initBinds()},_initBinds:function _initBinds(){var e=this,t=function(){this._destroyPicker()}.bind(this);this._enableUpdateBind(),this._editor.on("mousedown",function(t,i){o.delay(e._onClick.bind(e,t,i),50)}),this._editor.on("keydown",t),this._editor.on("viewportChange",t),this._editor.on("scroll",t),this._editor.getWrapperElement().addEventListener("click",c)},_disableBinds:function _disableBinds(){this._editor.getWrapperElement().removeEventListener("click",c),this._editor.off(null,null,this)},_enableUpdateBind:function _enableUpdateBind(){this._editor.on("update",this._updateColors)},_disableUpdateBind:function _disableUpdateBind(){this._editor.off("update",this._updateColors)},_onClick:function _onClick(e,t){var i=this._editor.getCursor(!0),s=this._editor.getTokenAt(i);"color"===s.type?this._createPicker(t,i,s):this._destroyPicker()},_updateColors:function _updateColors(e){var t=e.getWrapperElement();o.each(t.querySelectorAll(".cm-color"),function(e){this._paintColor(e.textContent,e)},this)},_replaceColor:function _replaceColor(e,t){var i,s,n=this._editor.getCursor(),r=this._getMatch(n,"name"),a=this._getMatch(n,"hex"),l=r||a;if(l){i={line:n.line,ch:l.start},s={line:n.line,ch:l.end},this._editor.replaceRange(e,i,s,"paste");var h=this._editor.getWrapperElement();o.each(h.querySelectorAll(".cm-color"),function(e){var t=e.style,i=e.innerText;t&&t.borderBottom||this._paintColor(i,e)},this)}},_paintColor:function _paintColor(e,t){t.style.borderBottom=h({color:e})},_getMatch:function _getMatch(e,t){if(t){var i;switch(t.toLowerCase()){case"name":i=new RegExp(a.join("|"),"g");break;case"hsl":i=/hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)/g;break;case"rgb":i=/rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)/;break;case"hex":i=/#[a-fA-F0-9]{3,6}/g;break;default:return void console.log("Invalid color match selection")}for(var s=this._editor.getLine(e.line),n=i.exec(s);n;){var o=n[0],r=o.length,l=n.index,h=n.index+r;if(e.ch>=l&&e.ch<=h)return n=null,{start:l,end:h,string:o};n=i.exec(s)}}},_createPicker:function _createPicker(e,t,i){var s=this._editor.cursorCoords();this._destroyPicker(),this._colorPicker=new r({className:"Editor-boxModal ColorPicker--cm Editor-boxModal--darked Editor-FormDialog CDB-Text",value:i.string,disableOpacity:!0}),this._colorPicker.$el.attr("data-colorpicker-cid",this.cid),this._colorPicker.bind("change",o.debounce(this._onColorPickerChange.bind(this,e),5),this);var a=s.top+20;a+220>n(window).outerHeight()&&(a=s.top-220-20),this._colorPicker.$el.css({left:s.left,top:a}),document.body.appendChild(this._colorPicker.render().el),document.addEventListener("click",this._onDocumentClick)},_onDocumentClick:function _onDocumentClick(e){0===n(e.target).closest('[data-colorpicker-cid="'+this.cid+'"]').length&&this._destroyPicker()},_onColorPickerChange:function _onColorPickerChange(e,t){this._disableUpdateBind(),this._replaceColor(t.hex,e.target),this.trigger("codeSaved"),this._enableUpdateBind()},_destroyPicker:function _destroyPicker(){this._colorPicker&&(this.removeView(this._colorPicker),this._colorPicker.clean(),delete this._colorPicker),document.removeEventListener("click",this._onDocumentClick)},clean:function clean(){this._disableBinds(),s.prototype.clean.call(this)}})},,function(e,t,i){"use strict";var s=i(4),n=i(2),o=i(428),r=i(317);n.Form.editors.CodeEditor=n.Form.editors.TextArea.extend({render:function render(){return this.setValue(this.value),this._codemirrorModel=new n.Model({content:this.value,readonly:!1,lineNumbers:!1}),o.init({tokens:this.options.tokens,tableName:!1,columnsName:!1}),this._initViews(),this._toggleDisableState(),this},getValue:function getValue(){var e=this.$el.val();return""===(e=this.codeMirrorView.getContent())?null:e},_initViews:function _initViews(){this._destroyEditor();var e=o.reset().hints;this.codeMirrorView=new r({model:this._codemirrorModel,hints:e,mode:"text/mustache",autocompleteChars:2,autocompletePrefix:"{{",autocompleteSuffix:"}}",placeholder:this.options.placeholder,tips:[]}),this.codeMirrorView.bind("codeChanged",function(){this.trigger("change",this.codeMirrorView.getContent())},this);var t=s(this.codeMirrorView.render().el);this.$el.replaceWith(t),this.setElement(t),this.$el.addClass("CodeMirror-formInput"),this._addTrackingClass()},_addTrackingClass:function _addTrackingClass(){if(this.options.trackingClass){var e=this.options.trackingClass+" track-"+this.options.key+this.options.editorType;this.$el.addClass(e)}},_hasEditor:function _hasEditor(){return this.options.editor&&!!this.codeMirrorView},_destroyEditor:function _destroyEditor(){this._hasEditor()&&this.codeMirrorView.remove()},remove:function remove(){this._destroyEditor(),n.Form.editors.Base.prototype.remove.apply(this)},clean:function clean(){this.$el.remove()}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(57),r=i(174),a=i(8),l=i(322);n.Form.editors.Suggest=n.Form.editors.Select.extend({initialize:function initialize(e){n.Form.editors.Base.prototype.initialize.call(this,e),o.setOptions(this,e),this.template=e.template||l,this.dialogMode=this.options.dialogMode||a.Mode.DEFAULT,this._setupCollection(),this._initViews(),this.setValue(this.model.get(this.options.keyAttr)),this._initBinds()},_setupCollection:function _setupCollection(){var e={label:this.value,val:this.value};if(this.collection=new r(this.options.options),this.options.editorAttrs&&this.options.editorAttrs.collectionData){var t=s.map(this.options.editorAttrs.collectionData,function(e){return{label:e,val:e}});this.collection.reset(t)}this.value&&!this.collection.findWhere(e)&&this.collection.add(e)},_initBinds:function _initBinds(){var e=function(){this._listView.hide(),this._popupManager.untrack()}.bind(this);this.collection.bind("change:selected",this._onItemSelected,this),this.collection.bind("reset",this.render,this),this.applyESCBind(e),this.applyClickOutsideBind(e)},_renderButton:function _renderButton(e){var t=this.$(".js-button"),i=e.getName(),n=null===i||"null"===i,o=n?"null":i,r=s.extend({},e.attributes,{label:o}),a=this.options.selectedItemTemplate(r);return t.html(a).toggleClass("is-empty",n),t}})},function(e,t,i){"use strict";var s=i(2),n=i(7),o=i(5),r=[{val:0,label:_t("months.january")},{val:1,label:_t("months.february")},{val:2,label:_t("months.march")},{val:3,label:_t("months.april")},{val:4,label:_t("months.may")},{val:5,label:_t("months.june")},{val:6,label:_t("months.july")},{val:7,label:_t("months.august")},{val:8,label:_t("months.september")},{val:9,label:_t("months.october")},{val:10,label:_t("months.november")},{val:11,label:_t("months.december")}];e.exports=s.Model.extend({initialize:function initialize(){this.schema={day:{type:"Text",title:"",validators:["required",/^(([0]?[1-9])|([1-2][0-9])|(3[01]))$/,function(e,t){if(!o(n.formatDate(t)).isValid())return{type:"date",message:_t("components.datepicker.invalid-date")}}]},month:{type:"Select",title:"",position:{left:0,"min-width":"200px"},options:r},year:{title:"",type:"Text",validators:["required",/^([0-9]{0,4})$/]},time:{title:"",type:"Text",validators:["required",/^([01]{1}[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/]}}},getFormattedDate:function getFormattedDate(){return n.formatDate(this.toJSON())}})},function(e,t,i){"use strict";var s=i(2),n=i(1),o=i(5),r=i(2299);e.exports=n.extend({tagName:"div",className:"Table-editorDate",events:{keyup:"_onKeyUp"},initialize:function initialize(){var e=this.model.get("value"),t={};t=e?o(e).utc():o().utc(),this._formModel=new r({day:t.date(),month:t.month(),year:t.year(),time:t.format("HH:mm:ss"),utcOffset:t.utcOffset()}),this._formModel.bind("change",this._setValue,this),this.add_related_model(this._formModel),this._setValue()},render:function render(){return this._formView=new s.Form({model:this._formModel}),this._formView.bind("change",function(){this.commit()}),this.$el.html(this._formView.render().el),this},_setValue:function _setValue(){this.model.set("value",this._formModel.getFormattedDate())},_onKeyUp:function _onKeyUp(){this._setValue()},clean:function clean(){this._formView.remove(),n.prototype.clean.apply(this)}})},function(e,t,i){"use strict";var s=i(1),n=i(2300);e.exports=s.extend({className:"CDB-Box-modal CustomList CustomList--inputs is-visible has-visibility js-datetimePicker",initialize:function initialize(){this._initBinds()},render:function render(){return this.clearSubViews(),this._datetimeEditorView=new n({model:this.model}),this.addView(this._datetimeEditorView),this.$el.append(this._datetimeEditorView.render().el),this},_initBinds:function _initBinds(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy)},_onShowChange:function _onShowChange(e,t){t?(this.$el.show(),this.$el.removeClass("is-closing").addClass("is-opening")):(this.$el.removeClass("is-opening").addClass("is-closing"),this.$el.hide())},show:function show(){this.model.show()},hide:function hide(){this.model.hide()},_onDestroy:function _onDestroy(){this.hide(),this.clean()}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({defaults:{show:!1},show:function show(){this.set("show",!0)},hide:function hide(){this.set("show",!1)},isHidden:function isHidden(){return!this.get("show")},destroy:function destroy(){var e=Array.prototype.slice.call(arguments);this.trigger.apply(this,["destroy"].concat(e))}})},function(e,t,i){"use strict";var s=i(2),n=i(57),o=i(5),r=i(2302),a=i(2301),l=i(429),h=i(8),c=i(246);s.Form.editors.DateTime=s.Form.editors.Base.extend({className:"Editor-formInput u-flex u-alignCenter",events:{"click .js-input":"_onInputClick"},initialize:function initialize(e){s.Form.editors.Base.prototype.initialize.call(this,e),n.setOptions(this,e),this.dialogMode=this.options.dialogMode||h.Mode.DEFAULT,this._initBinds(),this.render()},render:function render(){return s.Form.editors.Base.prototype.render.apply(this,arguments),this._removeDateTimeDialog(),this.$el.html(l({value:this._getFormattedDatetime()})),this._initViews(),this},_getFormattedDatetime:function _getFormattedDatetime(){if(this.value){var e=new Date(this.value).toUTCString(),t=o(e).utc();return t.format("YYYY-MM-DD")+"T"+t.format("HH:mm:ss")+"Z"}return null},_initViews:function _initViews(){this.options.editorAttrs&&this.options.editorAttrs.disabled&&this.$el.addClass("is-disabled"),this._datetimeDialogModel=new r({value:this._getFormattedDatetime()}),this._datetimeDialogModel.bind("change:value",this._onInputChanged,this),this._datetimeDialogView=new a({model:this._datetimeDialogModel}),this._popupManager=new c(this.cid,this.$el,this._datetimeDialogView.$el)},_initBinds:function _initBinds(){var e=function(){this._removeDateTimeDialog()}.bind(this);this.applyESCBind(e),this.applyClickOutsideBind(e)},_onInputClick:function _onInputClick(){this._datetimeDialogView.render(),this._popupManager.append(this.dialogMode),this._popupManager.track()},_removeDateTimeDialog:function _removeDateTimeDialog(){this._datetimeDialogView&&(this._popupManager.untrack(),this._datetimeDialogView.remove())},_onInputChanged:function _onInputChanged(e){var t=this._datetimeDialogModel.get("value");this.setValue(t),this.trigger("change",this)},_updateInput:function _updateInput(e){this.$(".js-input").toggleClass("is-empty",!e).text(e)},getValue:function getValue(){return this._datetimeDialogModel.get("value")},setValue:function setValue(e){this._updateInput(e),this.value=e},remove:function remove(){this._removeDateTimeDialog(),this._popupManager&&this._popupManager.destroy(),s.Form.editors.Base.prototype.remove.apply(this)}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Collection.extend({removeTag:function removeTag(e){var t=this.findWhere({label:e});t&&this.remove(t)},addTag:function addTag(e){!this.findWhere({label:e})&&this.add({label:e})},getValue:function getValue(){return this.map(function(e){return e.get("label")})}})},function(e,t,i){"use strict";var s=i(1);e.exports=s.extend({tagName:"li",initialize:function initialize(e){if(!e.label)throw new Error("label is required");this._label=e.label},render:function render(){return this.clearSubViews(),this.$el.html(this._label),this}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(430),r=i(2305),a=i(2304),l=i(57);i(4),i(234),i(595),n.Form.editors.Taglist=n.Form.editors.Base.extend({className:"Form-tags CDB-Text",events:{mouseover:"_onMouseOver",mouseout:"_onMouseOut"},initialize:function initialize(e){n.Form.editors.Base.prototype.initialize.call(this,e),l.setOptions(this,e),this._tagCollection=new a(this._normalize(e.schema.options.tags)),this.isEditable=e.schema.options.isEditable||void 0===e.schema.options.isEditable},render:function render(){return this._initViews(),this},_initViews:function _initViews(){var e=this,t=this.isEditable||0!==this._tagCollection.length?_t("components.taglist.placeholder"):_t("components.taglist.none");this.$el.html(o()),this._tagCollection.each(this._renderTag,this),this.$(".js-tagsList").tagit({allowSpaces:!0,caseSensitive:!1,placeholderText:t,readOnly:!this.isEditable,onBlur:function onBlur(){e.isEditable&&e.$el.removeClass("is-focus"),e.trigger("blur",e)},onFocus:function onFocus(){e.isEditable&&e.$el.removeClass("is-hover").addClass("is-focus"),e.trigger("focus",e)},afterTagAdded:e._onTagAdded.bind(e),afterTagRemoved:e._onTagRemoved.bind(e)})},_renderTag:function _renderTag(e){var t=new r({label:e.get("label")});this.$(".js-tagsList").append(t.render().el)},focus:function focus(){this.hasFocus||this.$el.focus()},blur:function blur(){this.hasFocus&&this.$el.blur()},getValue:function getValue(){return this._tagCollection.getValue()},setValue:function setValue(e){this._tagCollection.reset(this._normalize(e)),this._destroyTagit(),this.render(),this.trigger("change",this)},_onMouseOver:function _onMouseOver(){!this.$el.hasClass("is-focus")&&this.$el.addClass("is-hover")},_onMouseOut:function _onMouseOut(){!this.$el.hasClass("is-focus")&&this.$el.removeClass("is-hover")},_onTagRemoved:function _onTagRemoved(e,t){var i=t.tag.find(".tagit-label").text();this._tagCollection.removeTag(i),this.trigger("change",this)},_onTagAdded:function _onTagAdded(e,t){var i=t.tag.find(".tagit-label").text();this._tagCollection.addTag(i),this.trigger("change",this)},_normalize:function _normalize(e){return s.map(e,function(e){return{label:e.trim()}})},_destroyTagit:function _destroyTagit(){this.$(".ui-widget").length>0&&this.$(".js-tagsList").tagit("destroy")},remove:function remove(){this._destroyTagit(),n.Form.editors.Base.prototype.remove.apply(this)},clean:function clean(){this.$el.remove()}})},function(e,t,i){"use strict";var s=i(2),n=i(1),o=i(431),r=[1,5];e.exports=n.extend({events:{"click .js-back":"_onClickBack","click .js-bins":"_onClickBins","click .js-quantification":"_onClickQuantification"},render:function render(){return this.clearSubViews(),this._removeForm(),this.$el.empty(),this.$el.append(o({bins:this.model.get("bins"),attribute:this.model.get("attribute"),quantification:this.model.get("quantification")})),this._initForm(),this},_initForm:function _initForm(){this._formView&&this._formView.remove();var e=this._getRangeOrCalculateItIfNeeded();this._formView=this._createFormView(e),this._renderFormView()},_renderFormView:function _renderFormView(){this.$(".js-content").append(this._formView.render().$el)},_getRangeOrCalculateItIfNeeded:function _getRangeOrCalculateItIfNeeded(){var e,t,i=this.model.get("fixed"),s=this.model.get("range");if(s&&(e=+s[0],t=+s[1]),i){var n=this._calculateRangeFromFixed(i);e=n[0],t=n[1],this.model.set("range",n),this.model.unset("fixed")}return[e,t]},_createFormView:function _createFormView(e){var t=e[0],i=e[1],n=new s.Model({min:t,max:i}),o=this._getNumberType.bind(this);n.schema={min:o(),max:o()},n.bind("change",function(e){this.model.set("range",[+e.get("min"),+e.get("max")])},this);var r=new s.Form({className:"Editor-boxList",model:n});return r.bind("change",function(){this.commit()}),r},_calculateRangeFromFixed:function _calculateRangeFromFixed(e,t){t=t||30;var i=e/(this.options.max-this.options.min),s=Math.floor(Math.max(this.options.min,e-t*i)),n=Math.floor(Math.min(this.options.max,e+t*i));return[s=Math.max(s,r[0]),n=Math.max(n,r[1])]},_getNumberType:function _getNumberType(){return{type:"Number",validators:["required",{type:"interval",min:this.options.min,max:this.options.max}]}},_removeForm:function _removeForm(){this._formView&&this._formView.remove()},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onClickQuantification:function _onClickQuantification(e){this.killEvent(e),this.trigger("selectQuantification",this)},_onClickBins:function _onClickBins(e){this.killEvent(e),this.trigger("selectBins",this)},clean:function clean(){this._removeForm(),n.prototype.clean.call(this)}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(1),r=i(432),a=i(600),l=i(599),h=i(222),c=i(470),d=i(283),u=i(2307),p=i(246),g=i(56),m=i(3),f=["columns","popupConfig"];e.exports=o.extend({className:"Form-StyleByValue u-ellipsis",events:{"click .js-button":"_showByValueDialog","click .js-back":"_onClickBack"},initialize:function initialize(e){m(e,f,this),this._settings=g.Settings.NUMBER,this._setupModel()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},afterRender:function afterRender(){this._openPopupForColumn()},_openPopupForColumn:function _openPopupForColumn(){var e=this.model.get("attribute");if(s.isUndefined(e)){var t=this;setTimeout(function(){t._showByValueDialog()},200)}},_setupModel:function _setupModel(){var e={};if(!this.model.get("quantification")){var t=this._settings.quantifications;e.quantification=t.items[t.defaultIndex]}var i=this.model.get("bins"),n=this._settings.bins;i||(e.bins=n.items[n.defaultIndex]),+i>+s.last(n.items)&&(e.bins=s.last(n.items)),this.model.set(e),this.listenTo(this.model,"change:attribute change:range",this.render)},_initViews:function _initViews(){this._initDialog(),this._initPopup(),this._initInputColumn()},_initDialog:function _initDialog(){if(!this._dialogView){var e=new a;this.listenToOnce(e,"destroy",function(){this._dialogView=null,this.stopListening(e)}),this._dialogView=new l({model:e})}},_initPopup:function _initPopup(){this._popupManager=new p(this._popupConfig.cid,this._popupConfig.$el,this._dialogView.$el)},_initInputColumn:function _initInputColumn(){var e=this.model.get("attribute"),t=this.model.get("range"),i=e||_t("form-components.editors.style.select-by-column"),s=t?t[0]+" - "+t[1]:"";this.$el.append(r({columnSelected:!!e,label:i,rangeSelected:!!t,range:s}))},removeDialog:function removeDialog(){this._dialogView.clean(),this._popupManager.untrack()},removePopupManager:function removePopupManager(){this._popupManager.destroy()},_createStackView:function _createStackView(){var e=new h({collection:new n.Collection([{createStackView:this._createColumnsView.bind(this)},{createStackView:this._createSizeValueContentView.bind(this)},{createStackView:this._createQuantificationView.bind(this)},{createStackView:this._createBinsView.bind(this)}])});return e.model.set("position",this._getDialogStepPosition()),e},_showByValueDialog:function _showByValueDialog(){this._dialogView.model.set("createContentView",this._createStackView.bind(this)),this._dialogView.render(),this._dialogView.show(),this._popupManager.append(this._popupConfig.mode),this._popupManager.track()},_getDialogStepPosition:function _getDialogStepPosition(){var e=1;return this.model.get("attribute")?this.model.get("quantification")||(e=2):e=0,e},_createColumnsView:function _createColumnsView(e,t){var i=new c({stackLayoutModel:e,columns:this._columns.filter(function(e){return"number"===e.type}),showSearch:!0,typeLabel:"column"});return i.bind("selectItem",function(t){this.model.set("attribute",t.get("val"));var i=1;this.model.get("quantification")||(i=2),e.goToStep(i)},this),i},_createSizeValueContentView:function _createSizeValueContentView(e,t){var i=new u({stackLayoutModel:e,model:this.model,min:this.options.min,max:this.options.max});return i.bind("back",function(t){e.prevStep()},this),i.bind("selectQuantification",function(t){e.goToStep(2)},this),i.bind("selectBins",function(t){e.goToStep(3)},this),i},_createQuantificationView:function _createQuantificationView(e,t){var i=new c({headerTitle:_t("form-components.editors.fill.quantification.title"),stackLayoutModel:e,columns:this._settings.quantifications.items,itemTemplate:d,showSearch:!1});return i.bind("selectItem",function(t){this.model.set("quantification",t.get("val")),e.prevStep()},this),i.bind("back",function(t){e.prevStep()},this),i},_createBinsView:function _createBinsView(e,t){var i=new c({headerTitle:_t("form-components.editors.fill.bins"),stackLayoutModel:e,columns:this._settings.bins.items});return i.bind("selectItem",function(t){this.model.set("bins",t.get("val")),e.goToStep(1)},this),i.bind("back",function(t){e.goToStep(1)},this),i},_onClickBack:function _onClickBack(e){this.killEvent(e)}})},function(e,t,i){"use strict";var s=i(2),n=i(1);e.exports=n.extend({render:function render(){return this.clearSubViews(),this._removeForm(),this.$el.empty(),this._initForm(),this},_initForm:function _initForm(){this._formModel=new s.Model({value:this.model.get("fixed")}),this._formModel.schema={value:{type:"Number",title:"",validators:["required",{type:"interval",min:this.options.min,max:this.options.max,step:this.options.step}]}},this._formModel.bind("change",function(e){this.model.set("fixed",e.get("value"))},this),this._formView=new s.Form({model:this._formModel}),this._formView.bind("change",function(){this.commit()}),this.$el.append(this._formView.render().$el)},_removeForm:function _removeForm(){this._formView&&this._formView.remove()},clean:function clean(){this._removeForm(),n.prototype.clean.call(this)}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(323),r=i(1004),a=i(57),l=i(2309),h=i(2308),c=i(56);n.Form.editors.Size=n.Form.editors.Base.extend({className:"Form-InputSize CDB-Text",events:{focus:function focus(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},initialize:function initialize(e){n.Form.editors.Base.prototype.initialize.call(this,e),a.setOptions(this,e),this._sizeModel=new n.Model(this.model.get(e.key)),this._initBinds(),this._initViews()},_initBinds:function _initBinds(){this._updateSizeModelOnChangeBind(),this.applyESCBind(this._removeDialogs),this.applyClickOutsideBind(this._removeDialogs)},_updateSizeModelOnChangeBind:function _updateSizeModelOnChangeBind(){var e=this;this._sizeModel.bind("change",function(){e.model.set(e.key,e._sizeModel.toJSON())},this)},_removeDialogs:function _removeDialogs(){this._valueView&&this._valueView.removeDialog()},_removePopupManagers:function _removePopupManagers(){this._valueView&&this._valueView.removePopupManager()},_initViews:function _initViews(){this._tabPaneTabs=this._getTabPanes(),this._setSelectedTab(),this._tabPaneView=r(this._tabPaneTabs,this._getTabPaneOptions()),this.listenTo(this._tabPaneView.collection,"change:selected",this._onChangeTabPaneViewTab),this.$el.append(this._tabPaneView.render().$el)},_getTabPanes:function _getTabPanes(){var e=[],t=this.options.editorAttrs;return t&&t.hidePanes?(s.contains(t.hidePanes,c.Panes.FIXED)||e.push(this._buildFixedPane()),s.contains(t.hidePanes,c.Panes.BY_VALUE)||e.push(this._buildByValuePane())):e=[this._buildFixedPane(),this._buildByValuePane()],e},_setSelectedTab:function _setSelectedTab(){var e=this._getSelectedTabPaneIndex();this._tabPaneTabs[e].selected=!0},_getTabPaneOptions:function _getTabPaneOptions(){return{tabPaneOptions:{template:o,tabPaneItemOptions:{tagName:"li",klassName:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"div",className:"CDB-Text CDB-Size-medium"}}},_buildFixedPane:function _buildFixedPane(){var e=this,t=this.options.editorAttrs.geometryName;return{name:c.Panes.FIXED,label:_t("form-components.editors.fill.input-number.fixed"),tooltip:_t("editor.style.tooltips.size.fixed-tab",{type:t}),createContentView:function createContentView(){return e._generateFixedContentView()}}},_buildByValuePane:function _buildByValuePane(){var e=this,t=this.options.editorAttrs.geometryName;return{name:c.Panes.BY_VALUE,label:_t("form-components.editors.fill.input-number.by-value"),tooltip:_t("editor.style.tooltips.size.by-value-tab",{type:t}),createContentView:function createContentView(){return e._generateByValueContentView()}}},_getSelectedTabPaneIndex:function _getSelectedTabPaneIndex(){var e=this._sizeModel.get("range"),t=this._tabPaneTabs.length>1;return e&&t?1:0},_onChangeTabPaneViewTab:function _onChangeTabPaneViewTab(){var e=this._tabPaneView.getSelectedTabPaneName();e===c.Panes.FIXED?this._updateFixedValue():this._updateRangeValue(),this.trigger("change",e,this)},_updateFixedValue:function _updateFixedValue(){var e=this._sizeModel.get("range");if(e){var t=.5*(+e[0]+ +e[1]);this._sizeModel.set("fixed",t),this._sizeModel.unset("range")}},_updateRangeValue:function _updateRangeValue(){var e=this._sizeModel.get("fixed");if(null!==e&&!s.isUndefined(e)&&this._sizeModel.get("attribute")){var t=this.options.editorAttrs,i=t&&t.defaultRange||[e,e];this._sizeModel.set("range",i),this._sizeModel.unset("fixed")}},_generateFixedContentView:function _generateFixedContentView(){var e=this.options.editorAttrs;return this._fixedView=new l({model:this._sizeModel,min:e&&e.min||c.Size.DefaultInput100.MIN,max:e&&e.max||c.Size.DefaultInput100.MAX,step:e&&e.step||c.Size.DefaultInput100.STEP}),this._fixedView},_generateByValueContentView:function _generateByValueContentView(){var e=this.options.editorAttrs;return this._valueView=new h({model:this._sizeModel,columns:this.schema.options,min:e&&e.min||c.Size.DefaultInput100.MIN,max:e&&e.max||c.Size.DefaultInput100.MAX,popupConfig:{cid:this.cid,$el:this.$el,mode:this.options.dialogMode}}),this._valueView},focus:function focus(){this.hasFocus||this.$(".js-menu").focus()},blur:function blur(){this.hasFocus&&this.$(".js-menu").blur()},getValue:function getValue(){return this._sizeModel.toJSON()},remove:function remove(){this._removeDialogs(),this._removePopupManagers(),n.Form.editors.Base.prototype.remove.apply(this)},clean:function clean(){this.$el.remove()}})},function(e,t,i){"use strict";var s=i(1),n=i(433);e.exports=s.extend({className:"Label",initialize:function initialize(){if(!this.model)throw new Error("A model should be provided");this.model.on("change:label",this.render,this),this.model.on("change:selected",this.render,this)},render:function render(){return this.$el.html(n({customId:this.model.cid+this.model.get("name"),label:this.model.get("label"),name:this.model.get("name"),help:this.model.get("help")||"",selected:this.model.get("selected"),selectedChild:this.model.get("selectedChild")||""})),this}})},function(e,t,i){"use strict";var s=i(0),n=i(4),o=i(1),r=i(1008),a=i(6),l=i(434),h=i(56),c=i(7),d=i(3),u=["columns","query","configModel","userModel","modals"];e.exports=o.extend({tagName:"li",className:"CDB-OptionInput-item",events:{click:"_onClick"},initialize:function initialize(e){if(this.options.editorAttrs&&(this._editorAttrs=this.options.editorAttrs,this._help=this._editorAttrs.help,this._imageEnabled=this._editorAttrs.imageEnabled,this._hideNumericColumns=this.options.hideNumericColumns,this._removeByValueCategory=this.options.removeByValueCategory,this._editorAttrs.hidePanes&&!s.contains(this._editorAttrs.hidePanes,h.Panes.BY_VALUE))){if(!e.configModel)throw new Error("configModel param is required");if(!e.userModel)throw new Error("userModel param is required");if(!e.modals)throw new Error("modals param is required");if(!e.query)throw new Error("query param is required")}if(!e.columns)throw new Error("columns is required");d(e,u,this),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.toggleClass("is-disabled",this.options.disabled),this.$el.html(l({value:this._getValue(),attribute:this.model.get("attribute"),opacity:this._getOpacity(),colorBar:this._getColorbar(),help:this._help.color||""})),this._initViews(),this},afterRender:function afterRender(){this._openPopupForColumn()},_openPopupForColumn:function _openPopupForColumn(){var e=this.model.get("attribute");if(s.isUndefined(e)){var t=this;setTimeout(function(){t.$el.click()},200)}},_getColorbar:function _getColorbar(){var e=this._getValue();if(!s.isArray(e))return"";var t=100/e.length,i=0,n=this;return"background: linear-gradient(90deg, "+e.map(function(e){var s=i,o=i+t,r=n._getColorStep(e,[s,o]);return i=o,r}).join(", ")+")"},_getColorStep:function _getColorStep(e,t){return e+" "+t[0]+"%, "+e+" "+t[1]+"%"},_initViews:function _initViews(){if(this._help.color){var e=new a({el:this.$(".js-help"),gravity:"w",title:function title(){return n(this).data("tooltip")},offset:8});this.addView(e)}},_initBinds:function _initBinds(){var e=this;this.model.set("createContentView",function(){return e._createContentView()}).bind(this),this.model.on("change:selected",this._onToggleSelected,this),this.model.on("change:opacity change:range change:attribute",this.render,this)},_getColumn:function _getColumn(){return s.find(this._columns,function(e){return e.label===this.model.get("attribute")},this)},_iconStylingEnabled:function _iconStylingEnabled(){return this._imageEnabled},_createContentView:function _createContentView(){return this._inputColorValueContentView=new r({model:this.model,columns:this._columns,hideNumericColumns:this._hideNumericColumns,removeByValueCategory:this._removeByValueCategory,configModel:this._configModel,categorizeColumns:this._categorizeColumns,imageEnabled:this._imageEnabled,userModel:this._userModel,modals:this._modals,hideTabs:this._hideTabs,query:this._query}),this.model.on("change",this._onChangeValue,this),this._inputColorValueContentView},_onClick:function _onClick(){this.options.disabled||this.trigger("click",this.model)},_getValue:function _getValue(){return this.model.get("range")&&this.model.get("range").length?this._getRangeColorValues():null},_getRangeColorValues:function _getRangeColorValues(){return s.map(this.model.get("range"),function(e){return c.hexToRGBA(e,this._getOpacity())},this)},_getOpacity:function _getOpacity(){return null!=this.model.get("opacity")?this.model.get("opacity"):1},_onToggleSelected:function _onToggleSelected(){this.$el.toggleClass("is-active",this.model.get("selected"))},_onChangeValue:function _onChangeValue(e){this.model.set({quantification:e.get("quantification"),range:e.get("range")})}})},function(e,t,i){"use strict";var s=i(1005),n=i(2312),o=i(56),r=i(3),a=["columns","query","configModel","userModel","editorAttrs","modals","dialogMode","valueColorInputModel","popupConfig"];e.exports=s.extend({initialize:function initialize(e){r(e,a,this),this._initViews()},_initInputFields:function _initInputFields(){s.prototype._initInputFields.call(this),this._initColorByValueInput()},_initColorByValueInput:function _initColorByValueInput(){var e=this._valueColorInputModel.get("quantification");e&&o.Quantification.REFERENCE[e]&&this._valueColorInputModel.set("quantification",o.Quantification.REFERENCE[e],{silent:!0}),this._valueColorInputView=new n({model:this._valueColorInputModel,columns:this.options.columns,hideNumericColumns:this.options.hideNumericColumns,removeByValueCategory:this.options.removeByValueCategory,query:this.options.query,configModel:this.options.configModel,userModel:this.options.userModel,modals:this.options.modals,imageEnabled:this.options.imageEnabled,editorAttrs:this.options.editorAttrs?this.options.editorAttrs:{},disabled:this.options.editorAttrs&&this.options.editorAttrs.disabled}),this._valueColorInputView.bind("click",this._onInputClick,this),this.$(".js-content").append(this._valueColorInputView.render().$el),this._inputCollection&&this._inputCollection.push(this._valueColorInputModel)},afterRender:function afterRender(){this._valueColorInputView&&this._valueColorInputView.afterRender()}})},function(e,t,i){"use strict";var s=i(0),n=i(4),o=i(1),r=i(435),a=i(319),l=i(598),h=i(6),c=i(7);e.exports=o.extend({tagName:"li",className:"CDB-OptionInput-item",events:{click:"_onClick"},initialize:function initialize(e){this.options.editorAttrs&&(this._editorAttrs=this.options.editorAttrs,this._help=this._editorAttrs.help),this._imageEnabled=!0,this._columns=e.columns,this._configModel=e.configModel,this._userModel=e.userModel,this._modals=e.modals,this._query=e.query,this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.html(r({help:this._help.image||"",image:this.model.get("image"),isCustomMarker:"custom-marker"===this.model.get("kind")})),this._initViews(),this},_initViews:function _initViews(){if(this.iconView=new a({imageClass:"Editor-fillImageAsset",imageUrl:this._getImageURL(),color:this._getColor()}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el),this._help.image){var e=new h({el:this.$(".js-help"),gravity:"w",title:function title(){return n(this).data("tooltip")},offset:8});this.addView(e)}},_initBinds:function _initBinds(){var e=this;this.model.set("createContentView",function(){return e._createContentView()}).bind(this),this.model.on("change:images change:image",this.render,this),this.model.on("change:opacity change:fixed",this._updateImageColor,this)},_categoryImagesPresent:function _categoryImagesPresent(){return this.model.get("images").forEach(function(e){if(!s.isEmpty(e))return!0}),!1},_updateImageColor:function _updateImageColor(){this.iconView&&this.iconView.updateImageColor(this._getColor())},_getColor:function _getColor(){var e=this.model.get("fixed");return e?c.hexToRGBA(e,this._getOpacity()):e},_getOpacity:function _getOpacity(){return null!=this.model.get("opacity")?this.model.get("opacity"):1},_onClick:function _onClick(){this.options.disabled||this.trigger("click",this.model)},_onChangeFile:function _onChangeFile(e){var t,i;e?(t=e.kind,i=e.url):(t=null,i=null),this.model.set({kind:t,image:i})},_createContentView:function _createContentView(){return this._inputColorFileView=new l({model:this.model,userModel:this._userModel,configModel:this._configModel,modals:this._modals}),this._initInputColorFileViewBindings(),this._inputColorFileView},_initInputColorFileViewBindings:function _initInputColorFileViewBindings(){this._inputColorFileView&&(this._inputColorFileView.bind("change",this._onChangeFile,this),this._inputColorFileView.on("onClean",function(){this._inputColorFileView.unbind("change",this._onChangeFile,this)},this))},_getImageURL:function _getImageURL(){return this.model.get("image")&&this._isIconStylingEnabled()?this.model.get("image"):""},_getKind:function _getKind(){return this.model.get("kind")&&this._isIconStylingEnabled()?this.model.get("kind"):""},_isIconStylingEnabled:function _isIconStylingEnabled(){return this._imageEnabled}})},function(e,t,i){"use strict";var s=i(0),n=i(4),o=i(1),r=i(464),a=i(6),l=i(436),h=i(7);e.exports=o.extend({tagName:"li",className:"CDB-OptionInput-item",events:{click:"_onClick"},initialize:function initialize(e){if(this.options.editorAttrs&&(this._editorAttrs=this.options.editorAttrs,this._help=this._editorAttrs.help),!e.columns)throw new Error("columns is required");this._columns=e.columns,this._configModel=e.configModel,this._userModel=e.userModel,this._modals=e.modals,this._query=e.query,this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.toggleClass("is-disabled",this.options.disabled),this.$el.html(l({value:this._getValue(),opacity:this._getOpacity(),help:this._help&&this._help.color||null})),this._initViews(),this},_initViews:function _initViews(){if(this._help&&this._help.color){var e=new a({el:this.$(".js-help"),gravity:"w",title:function title(){return n(this).data("tooltip")},offset:8});this.addView(e)}},_initBinds:function _initBinds(){var e=this;this.model.set("createContentView",function(){return e._createContentView()}).bind(this),this.model.on("change:selected",this._onToggleSelected,this),this.model.on("change:opacity change:fixed",this.render,this)},_getColumn:function _getColumn(){return s.find(this._columns,function(e){return e.label===this.model.get("attribute")},this)},_createContentView:function _createContentView(){return this._colorPickerView=new r({value:this.model.get("fixed"),opacity:this.model.get("opacity"),disableOpacity:this._disableOpacity||!1}),this._initColorPickerViewBindings(),this._colorPickerView},_initColorPickerViewBindings:function _initColorPickerViewBindings(){this._colorPickerView&&(this._colorPickerView.bind("change",this._onChangeValue,this),this._colorPickerView.on("onClean",function(){this._colorPickerView.unbind("change",this._onChangeValue,this)},this))},_onClick:function _onClick(){this.options.disabled||this.trigger("click",this.model)},_getValue:function _getValue(){var e=this.model.get("fixed");return e?h.hexToRGBA(e,this._getOpacity()):e},_getOpacity:function _getOpacity(){return null!=this.model.get("opacity")?this.model.get("opacity"):1},_onToggleSelected:function _onToggleSelected(){this.$el.toggleClass("is-active",this.model.get("selected"))},_onChangeValue:function _onChangeValue(e){this.model.set({fixed:e.hex,opacity:e.opacity})}})},function(e,t,i){"use strict";var s=i(2),n=i(0),o=["color","image"];e.exports=s.Collection.extend({constructor:function constructor(e,t){t=n.extend(t||{},{silent:!1}),s.Collection.prototype.constructor.call(this,e,t)},comparator:function comparator(e){return o.indexOf(e.get("type"))},initialize:function initialize(){this.bind("change",this._onModelsChanged,this),this.bind("change:selected",this._onSelectedChange,this)},getSelected:function getSelected(){return this.find(function(e){return e.get("selected")})},unselect:function unselect(){this.each(function(e){e.set("selected",!1)},this)},_onSelectedChange:function _onSelectedChange(e,t){t&&this.each(function(t){t!==e&&t.set("selected",!1)},this)},_onModelsChanged:function _onModelsChanged(e){var t=e.changed;n.isEmpty(t)||1===n.size(t)&&e.changed.hasOwnProperty("selected")||this.trigger("onInputChanged",e)}})},function(e,t,i){"use strict";var s=i(1005),n=i(2315),o=i(2314),r=i(3),a=["columns","editorAttrs","dialogMode","popupConfig","fixedColorInputModel","imageInputModel"];e.exports=s.extend({initialize:function initialize(e){r(e,a,this),this._editorAttrs.imageEnabled&&(this._configModel=this.options.configModel,this._userModel=this.options.userModel,this._modals=this.options.modals),this._initViews()},_initInputFields:function _initInputFields(){s.prototype._initInputFields.call(this),this._initFillColorInput(),this._initFillImageInput()},_initFillColorInput:function _initFillColorInput(){this._fillInputColorView=new n({model:this._fixedColorInputModel,columns:this._columns,configModel:this._configModel,userModel:this._userModel,modals:this._modals,editorAttrs:this._editorAttrs||{},disabled:this._editorAttrs&&this._editorAttrs.disabled}),this._fillInputColorView.bind("click",this._onInputClick,this),this.$(".js-content").append(this._fillInputColorView.render().$el),this._inputCollection&&this._inputCollection.push(this._fixedColorInputModel)},_initFillImageInput:function _initFillImageInput(){this._editorAttrs.imageEnabled&&(this._fillInputImageView=new o({model:this._imageInputModel,columns:this._columns,configModel:this._configModel,userModel:this._userModel,modals:this._modals,query:this._query,editorAttrs:this._editorAttrs||{},disabled:this._editorAttrs&&this._editorAttrs.disabled}),this._fillInputImageView.bind("click",this._onInputClick,this),this.$(".js-content").append(this._fillInputImageView.render().$el),this._inputCollection&&this._inputCollection.push(this._imageInputModel))},_unbindFormInputs:function _unbindFormInputs(){this._fillInputColorView.unbind("click",this._onInputClick,this),this._fillInputImageView&&this._fillInputImageView.unbind("click",this._onInputClick,this),this._inputCollection.unbind("onInputChanged",this._onInputChanged,this)},clean:function clean(){this._unbindFormInputs(),s.prototype.clean.call(this)}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(57),r=i(2317),a=i(2313),l=i(8),h=i(56),c=i(323),d=i(1004);n.Form.editors.FillColor=n.Form.editors.Base.extend({className:"Form-InputFill Editor-formInput--FillColor",initialize:function initialize(e){n.Form.editors.Base.prototype.initialize.call(this,e),o.setOptions(this,e),this.options.editorAttrs&&(this.options=s.extend(this.options,{columns:this.options.options,query:this.options.query,configModel:this.options.configModel,userModel:this.options.userModel,editorAttrs:this.options.editorAttrs,modals:this.options.modals}),this._colorKeyAttribute=e.key,this._colorAttributes=this.model.get(this._colorKeyAttribute),this._sizeAttributes=this.model.get("fillSize"),this._imageInputModel=new n.Model(s.extend({type:"image"},this._colorAttributes)),this._fixedColorInputModel=new n.Model(s.extend({type:"color"},this._colorAttributes)),this._valueColorInputModel=new n.Model(s.extend({type:"color"},this._colorAttributes))),this._initViews()},_initViews:function _initViews(){var e=this,t=this.options.editorAttrs.geometryName,i={name:h.Panes.FIXED,label:_t("form-components.editors.fill.input-number.solid"),tooltip:_t("editor.style.tooltips.fill.fixed-tab",{type:t}),createContentView:function createContentView(){return e._generateFixedContentView()}},n={name:h.Panes.BY_VALUE,label:_t("form-components.editors.fill.input-number.by-value"),tooltip:_t("editor.style.tooltips.fill.by-value-tab",{type:t}),createContentView:function createContentView(){return e._generateValueContentView()}};if(this._tabPaneTabs=[],this.options.editorAttrs&&this.options.editorAttrs.hidePanes){var o=this.options.editorAttrs.hidePanes;s.contains(o,h.Panes.FIXED)||this._tabPaneTabs.push(i),s.contains(o,h.Panes.BY_VALUE)||this._tabPaneTabs.push(n)}else this._tabPaneTabs=[i,n];var r={tabPaneOptions:{template:c,tabPaneItemOptions:{tagName:"li",klassName:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"div",className:"CDB-Text CDB-Size-medium"}},a=this._getSelectedTabPaneIndex();this._tabPaneTabs[a].selected=!0,this._tabPaneView=d(this._tabPaneTabs,r),this.$el.append(this._tabPaneView.render().$el)},_getSelectedTabPaneIndex:function _getSelectedTabPaneIndex(){return this._colorAttributes&&this._colorAttributes.range&&this._tabPaneTabs.length>1?1:0},_removeFillColorFixedDialog:function _removeFillColorFixedDialog(){this._fillColorFixedView.removeDialog()},_removeFillColorByValueDialog:function _removeFillColorByValueDialog(){this._fillColorByValueView.removeDialog()},_generateFixedContentView:function _generateFixedContentView(){return this._fillColorFixedView=new r({model:this.model,columns:this.options.columns,configModel:this.options.configModel,userModel:this.options.userModel,modals:this.options.modals,query:this.options.query,editorAttrs:this.options.editorAttrs,dialogMode:l.Mode.FLOAT,hideTabs:this.options.hideTabs,fixedColorInputModel:this._fixedColorInputModel,imageInputModel:this._imageInputModel,popupConfig:{cid:this.cid,$el:this.$el}}),this.applyESCBind(this._removeFillColorFixedDialog),this.applyClickOutsideBind(this._removeFillColorFixedDialog),this._fillColorFixedView.on("onInputChanged",function(e){this.trigger("change",e)},this),this._fillColorFixedView},_generateValueContentView:function _generateValueContentView(){return this._fillColorByValueView=new a({columns:this.options.columns,query:this.options.query,configModel:this.options.configModel,userModel:this.options.userModel,editorAttrs:this.options.editorAttrs,model:this.model,dialogMode:l.Mode.FLOAT,categorizeColumns:this.options.categorizeColumns,hideNumericColumns:this.options.hideNumericColumns,removeByValueCategory:this.options.removeByValueCategory,modals:this.options.modals,hideTabs:this.options.hideTabs,valueColorInputModel:this._valueColorInputModel,popupConfig:{cid:this.cid,$el:this.$el}}),this.applyESCBind(this._removeFillColorByValueDialog),this.applyClickOutsideBind(this._removeFillColorByValueDialog),this._fillColorByValueView.on("onInputChanged",function(e){this.trigger("change",e)},this),this._fillColorByValueView},getValue:function getValue(e){return this._tabPaneView.getSelectedTabPaneName()===h.Panes.FIXED?this._getFillFixedValues():this._getFillByValueValues()},_getFillFixedValues:function _getFillFixedValues(){var e=this._fixedColorInputModel.toJSON(),t=this._imageInputModel.toJSON();e.range&&(e.fixed=e.range[0],e.opacity=1);var i=s.omit(e,["createContentView","selected","type","image","marker","range"]),n=s.omit(t,["createContentView","selected","type","fixed","range"]),o=s.extend({},n,i);return this._fixedColorInputModel.set(o),this._imageInputModel.set(o),o},_getFillByValueValues:function _getFillByValueValues(){var e=s.omit(this._valueColorInputModel.toJSON(),["createContentView","selected","type"]);return this._valueColorInputModel.set(e),e}})},function(e,t,i){"use strict";e.exports={green:{3:["#E5F5F9","#99D8C9","#2CA25F"],4:["#EDF8FB","#B2E2E2","#66C2A4","#238B45"],5:["#EDF8FB","#B2E2E2","#66C2A4","#2CA25F","#006D2C"],6:["#EDF8FB","#CCECE6","#99D8C9","#66C2A4","#2CA25F","#006D2C"],7:["#EDF8FB","#D7FAF4","#CCECE6","#66C2A4","#41AE76","#238B45","#005824"]},blue:{3:["#EDF8B1","#7FCDBB","#2C7FB8"],4:["#FFFFCC","#A1DAB4","#41B6C4","#225EA8"],5:["#FFFFCC","#A1DAB4","#41B6C4","#2C7FB8","#253494"],6:["#FFFFCC","#C7E9B4","#7FCDBB","#41B6C4","#2C7FB8","#253494"],7:["#FFFFCC","#C7E9B4","#7FCDBB","#41B6C4","#1D91C0","#225EA8","#0C2C84"]},pink:{3:["#E7E1EF","#C994C7","#DD1C77"],4:["#F1EEF6","#D7B5D8","#DF65B0","#CE1256"],5:["#F1EEF6","#D7B5D8","#DF65B0","#DD1C77","#980043"],6:["#F1EEF6","#D4B9DA","#C994C7","#DF65B0","#DD1C77","#980043"],7:["#F1EEF6","#D4B9DA","#C994C7","#DF65B0","#E7298A","#CE1256","#91003F"]},black:{3:["#F0F0F0","#BDBDBD","#636363"],4:["#F7F7F7","#CCCCCC","#969696","#525252"],5:["#F7F7F7","#CCCCCC","#969696","#636363","#252525"],6:["#F7F7F7","#D9D9D9","#BDBDBD","#969696","#636363","#252525"],7:["#F7F7F7","#D9D9D9","#BDBDBD","#969696","#737373","#525252","#252525"]},red:{3:["#FFEDA0","#FEB24C","#F03B20"],4:["#FFFFB2","#FECC5C","#FD8D3C","#E31A1C"],5:["#FFFFB2","#FECC5C","#FD8D3C","#F03B20","#BD0026"],6:["#FFFFB2","#FED976","#FEB24C","#FD8D3C","#F03B20","#BD0026"],7:["#FFFFB2","#FED976","#FEB24C","#FD8D3C","#FC4E2A","#E31A1C","#B10026"]},inverted_green:{3:["#2CA25F","#99D8C9","#E5F5F9"],4:["#238B45","#66C2A4","#B2E2E2","#EDF8FB"],5:["#006D2C","#2CA25F","#66C2A4","#B2E2E2","#EDF8FB"],6:["#006D2C","#2CA25F","#66C2A4","#99D8C9","#CCECE6","#EDF8FB"],7:["#005824","#238B45","#41AE76","#66C2A4","#CCECE6","#D7FAF4","#EDF8FB"]},inverted_blue:{3:["#2C7FB8","#7FCDBB","#EDF8B1"],4:["#225EA8","#41B6C4","#A1DAB4","#FFFFCC"],5:["#253494","#2C7FB8","#41B6C4","#A1DAB4","#FFFFCC"],6:["#253494","#2C7FB8","#41B6C4","#7FCDBB","#C7E9B4","#FFFFCC"],7:["#0C2C84","#225EA8","#1D91C0","#41B6C4","#7FCDBB","#C7E9B4","#FFFFCC"]},inverted_pink:{3:["#DD1C77","#C994C7","#E7E1EF"],4:["#CE1256","#DF65B0","#D7B5D8","#F1EEF6"],5:["#980043","#DD1C77","#DF65B0","#D7B5D8","#F1EEF6"],6:["#980043","#DD1C77","#DF65B0","#C994C7","#D4B9DA","#F1EEF6"],7:["#91003F","#CE1256","#E7298A","#DF65B0","#C994C7","#D4B9DA","#F1EEF6"]},inverted_black:{3:["#636363","#BDBDBD","#F0F0F0"],4:["#525252","#969696","#CCCCCC","#F7F7F7"],5:["#252525","#636363","#969696","#CCCCCC","#F7F7F7"],6:["#252525","#636363","#969696","#BDBDBD","#D9D9D9","#F7F7F7"],7:["#252525","#525252","#737373","#969696","#BDBDBD","#D9D9D9","#F7F7F7"]},inverted_red:{3:["#F03B20","#FEB24C","#FFEDA0"],4:["#E31A1C","#FD8D3C","#FECC5C","#FFFFB2"],5:["#BD0026","#F03B20","#FD8D3C","#FECC5C","#FFFFB2"],6:["#BD0026","#F03B20","#FD8D3C","#FEB24C","#FED976","#FFFFB2"],7:["#B10026","#E31A1C","#FC4E2A","#FD8D3C","#FEB24C","#FED976","#FFFFB2"]},spectrum1:{3:["#1a9850","#fff2cc","#d73027"],4:["#1a9850","#d2ecb4","#fed6b0","#d73027"],5:["#1a9850","#8cce8a","#fff2cc","#f79272","#d73027"],6:["#1a9850","#8cce8a","#d2ecb4","#fed6b0","#f79272","#d73027"],7:["#1a9850","#8cce8a","#d2ecb4","#fff2cc","#fed6b0","#f79272","#d73027"]},spectrum2:{3:["#0080ff","#fff2cc","#ff4d4d"],4:["#0080ff","#7fbfff","#ffa6a6","#ff4d4d"],5:["#0080ff","#40a0ff","#fff2cc","#ff7a7a","#ff4d4d"],6:["#0080ff","#40a0ff","#7fbfff","#ffa6a6","#ff7a7a","#ff4d4d"],7:["#0080ff","#40a0ff","#7fbfff","#fff2cc","#ffa6a6","#ff7a7a","#ff4d4d"]},purple_states:{3:["#F1E6F1","#B379B3","#8A4E8A"],4:["#F1E6F1","#D8BBD8","#A05AA0","#8A4E8A"],5:["#F1E6F1","#D8BBD8","#B379B3","#A05AA0","#8A4E8A"],6:["#F1E6F1","#D8BBD8","#CCA5CC","#B379B3","#A05AA0","#8A4E8A"],7:["#F1E6F1","#D8BBD8","#CCA5CC","#C08FC0","#B379B3","#A05AA0","#8A4E8A"]},red_states:{3:["#F2D2D3","#D4686C","#C1373C"],4:["#F2D2D3","#EBB7B9","#CC4E52","#C1373C"],5:["#F2D2D3","#EBB7B9","#D4686C","#CC4E52","#C1373C"],6:["#F2D2D3","#EBB7B9","#E39D9F","#D4686C","#CC4E52","#C1373C"],7:["#F2D2D3","#EBB7B9","#E39D9F","#DB8286","#D4686C","#CC4E52","#C1373C"]},blue_states:{3:["#ECF0F6","#6182B5","#43618F"],4:["#ECF0F6","#B2C2DB","#4E71A6","#43618F"],5:["#ECF0F6","#B2C2DB","#6182B5","#4E71A6","#43618F"],6:["#ECF0F6","#B2C2DB","#9BB0D0","#6182B5","#4E71A6","#43618F"],7:["#ECF0F6","#B2C2DB","#9BB0D0","#849EC5","#6182B5","#4E71A6","#43618F"]},inverted_purple_states:{3:["#8A4E8A","#B379B3","#F1E6F1"],4:["#8A4E8A","#A05AA0","#D8BBD8","#F1E6F1"],5:["#8A4E8A","#A05AA0","#B379B3","#D8BBD8","#F1E6F1"],6:["#8A4E8A","#A05AA0","#B379B3","#CCA5CC","#D8BBD8","#F1E6F1"],7:["#8A4E8A","#A05AA0","#B379B3","#C08FC0","#CCA5CC","#D8BBD8","#F1E6F1"]},inverted_red_states:{3:["#C1373C","#D4686C","#F2D2D3"],4:["#C1373C","#CC4E52","#EBB7B9","#F2D2D3"],5:["#C1373C","#CC4E52","#D4686C","#EBB7B9","#F2D2D3"],6:["#C1373C","#CC4E52","#D4686C","#E39D9F","#EBB7B9","#F2D2D3"],7:["#C1373C","#CC4E52","#D4686C","#DB8286","#E39D9F","#EBB7B9","#F2D2D3"]},inverted_blue_states:{3:["#43618F","#6182B5","#ECF0F6"],4:["#43618F","#4E71A6","#B2C2DB","#ECF0F6"],5:["#43618F","#4E71A6","#6182B5","#B2C2DB","#ECF0F6"],6:["#43618F","#4E71A6","#6182B5","#9BB0D0","#B2C2DB","#ECF0F6"],7:["#43618F","#4E71A6","#6182B5","#849EC5","#9BB0D0","#B2C2DB","#ECF0F6"]}}},function(e,t,i){"use strict";var s=i(2),n=i(0);e.exports=s.Model.extend({defaults:{eventName:"",eventProperties:{}},url:function url(){return this._configModel.get("base_url")+"/api/v3/metrics"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._userId=t.userId,this._visId=t.visId,this._configModel=t.configModel},toJSON:function toJSON(){return{name:this.get("eventName"),properties:n.extend({},this.get("eventProperties"),{visualization_id:this._visId,user_id:this._userId})}}})},function(e,t,i){"use strict";var s=i(491);e.exports=s.extend({module:"components:form-components:editors:fill:input-color:input-qualitative-ramps:categories-list:list-view:categories-custom-list-view",_renderItem:function _renderItem(e,t){var i=this.options.itemView,s=this.options.imageEnabled&&t<this.options.maxValues,n=new i({model:e,typeLabel:this.options.typeLabel,template:this.options.itemTemplate,imageEnabled:s});this.$(".js-list").append(n.render().el),this.addView(n),n.bind("customEvent",function(e,t){this.trigger("customEvent",e,t,this)},this)}})},function(e,t,i){"use strict";var s=i(0),n=i(4),o=i(319),r=i(247);e.exports=r.extend({module:"components:form-components:editors:fill:input-color:input-qualitative-ramps:categories-list:list-item-view:categories-list-item-view",render:function render(){this.clearSubViews(),this.$el.empty();var e=null==this.model.getName()?"null":this.model.getName();return this.$el.append(this.options.template(s.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),name:e,val:this.model.getValue(),options:this.model.get("renderOptions"),image:this.model.get("image"),imageEnabled:this.options.imageEnabled}))),this._loadImages(),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this},_loadImages:function _loadImages(){this.iconView=new o({imageClass:"CDB-Text u-actionTextColor js-assetPicker",imageUrl:this.model.get("image"),color:this.model.get("val")}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_onClick:function _onClick(e){this.killEvent(e);var t=n(e.target),i=t.closest(".js-image-container").length>0,s=t.closest(".js-assetPicker").length>0;this.model.set({selectedClass:s||i?["js-assetPicker"]:[],selected:!0})}})},function(e,t,i){"use strict";var s=i(223),n=i(265),o=i(2322),r=i(2321);e.exports=s.extend({module:"components:form-components:editors:fill:input-color:input-qualitative-ramps:categories-list:list-view:categories-list-view",options:{showSearch:!0,allowFreeTextInput:!1,typeLabel:"column",itemTemplate:n,itemView:o},_renderList:function _renderList(){this._listView=new r({model:this.model,allowFreeTextInput:this.options.allowFreeTextInput,collection:this.collection,typeLabel:this.options.typeLabel,itemView:this.options.itemView,itemTemplate:this.options.itemTemplate,size:this.options.size,maxValues:this.options.maxValues,imageEnabled:this.options.imageEnabled}),this.$el.append(this._listView.render().el),this._listView.highlight(),this.addView(this._listView),this._listView.bind("customEvent",function(e,t){this.trigger(e,t,this)},this)}})},function(e,t,i){"use strict";var s=i(0),n=i(4),o=i(1),r=i(7),a=i(2323),l=i(174),h=i(438),c=i(437);e.exports=o.extend({module:"components:form-components:editors:fill:input-color:input-qualitative-ramps:categories-list:list-view:input-categories-list-view",events:{"click .js-color":"_onClickColor","click .js-back":"_onClickBack"},initialize:function initialize(e){this._showSearch=e.showSearch||!1,this._typeLabel=e.typeLabel,this._maxValues=e.maxValues,this._requiredNumberOfColors=e.requiredNumberOfColors},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.append(h({range:this.model.get("range"),attribute:this.model.get("attribute"),requiredNumberOfColors:this._requiredNumberOfColors})),this._setupCollection(),this._initBinds(),this._listView=new a({itemTemplate:c,collection:this._collection,showSearch:this._showSearch,typeLabel:this._typeLabel,maxValues:this._maxValues,imageEnabled:this.options.imageEnabled}),this.addView(this._listView),this.$(".js-content").append(this._listView.render().$el),this},_setupCollection:function _setupCollection(){this._collection=new l(null,{silent:!1});var e=this.model.get("range"),t=this.model.get("domain"),i=this.model.get("images");if(e&&e.length&&t&&t.length){var n=s.map(e,function(e,n){var o=null==t[n]||s.isString(t[n])&&r.isBlank(t[n]),a=t[n];n>=this._maxValues?a=_t("form-components.editors.fill.input-qualitative-ramps.others"):o&&(a=_t("form-components.editors.fill.input-qualitative-ramps.null"));var l={label:a,val:e};return i&&i.length&&(l.image=i[n]),l},this);this._collection.reset(n)}},_initBinds:function _initBinds(){this.listenTo(this.model,"change:range",this.render),this.listenTo(this.model,"change:domain",this.render),this.listenTo(this.model,"change:index",this.render),this.listenTo(this._collection,"change:selected",this._onSelectItem)},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onClickColor:function _onClickColor(e){this.killEvent(e);var t=n(e.target).index(),i=this._collection.at(t);i&&this._onSelectItem(i)},_onSelectItem:function _onSelectItem(e){var t={index:this._collection.indexOf(e),target:s.contains(e.get("selectedClass"),"js-assetPicker")?"asset":"color"};this.trigger("selectItem",t,this)}})},function(e,t,i){"use strict";var s=i(0),n=i(236),o="colorblind",r="diverging",a="qualitative",l="quantitative";e.exports={getColorRamps:function getColorRamps(e){if(!e)throw new Error("Number of colors per ramp is required");var t=[];return s.each(n,function(i){i&&i[e]&&t.push(i[e])}),t},getColorRampsByTag:function getColorRampsByTag(e,t){if(!e)throw new Error("Number of colors per ramp is required");var i=[];return s.each(n,function(n){n&&n[e]&&s.contains(n.tags,t)&&i.push(n[e])}),i},getColorblindRamps:function getColorblindRamps(e){return this.getColorRampsByTag(e,o)},getDivergingRamps:function getDivergingRamps(e){return this.getColorRampsByTag(e,r)},getQualitativeRamps:function getQualitativeRamps(e){return this.getColorRampsByTag(e,a)},getQuantitativeRamps:function getQuantitativeRamps(e){return this.getColorRampsByTag(e,l)}}},function(e,t,i){"use strict";var s=i(0),n=i(1);e.exports=n.extend({module:"components:form-components:editors:fill:input-color:input-qualitative-ramps:color-ramps-list:list-item-view:color-ramps-list-item-view",className:"CDB-ListDecoration-item CustomList-item CustomList-item--invert js-listItem",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave","click .js-listItemLink":"_onClick"},initialize:function initialize(e){this.options=s.extend({},this.options,e),this.listenTo(this.model,"change",this.render)},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.append(this.options.template({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),name:this.model.getName(),val:this.model.getValue(),options:this.model.get("renderOptions")})),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")).toggleClass("is-selected",!!this.model.get("selected")),this},_onMouseLeave:function _onMouseLeave(){this.$el.removeClass("is-highlighted")},_onMouseEnter:function _onMouseEnter(){this.$el.addClass("is-highlighted")},_onClick:function _onClick(e){this.killEvent(e),this.model.get("selected")?this.trigger("customEvent","customize",this.model.getValue(),this):this.model.set("selected",!0)}})},function(e,t,i){"use strict";var s=i(0),n=i(9),o=i(1),r=i(441),a=i(440),l=i(439),h=i(2326),c=i(223),d=i(174),u=i(2325),p={CUSTOM_COLOR:"custom-color",RAMP_SELECTED:"ramp-selected",CUSTOMIZE:"customize"};e.exports=o.extend({module:"components:form-components:editors:fill:input-color:input-qualitative-ramps:color-ramps-list:list-view:color-ramps-list-view",events:{"click .js-customize":"_onClickCustomize","click .js-clear":"_onClickClear","click .js-customRamp":"_onClickCustomRamp","click .js-back":"_onClickBack"},initialize:function initialize(e){this.model=e.model,this._maxValues=e.maxValues,this._requiredNumberOfColors=e.requiredNumberOfColors,this._initModels(),this._initBinds()},render:function render(){this.clearSubViews(),this.$el.empty(),this.$el.append(a());var e=this._customRamp.get("range");if(this._listView=new c({collection:this.collection,showSearch:!1,typeLabel:this._typeLabel,itemTemplate:l,itemView:h}),this._listView.bind("customize",function(e){this.trigger("customize",e,this)},this),this.$(".js-rampsList").append(this._listView.render().el),this.addView(this._listView),e&&e.length)this.$(".js-customList").addClass("is-customized"),this.$(".js-customList").prepend(r({customRamp:e}));else{var t=this.collection.getSelectedItem();t||(t=this.collection.first()),this._selectRamp(t)}return this},_selectRamp:function _selectRamp(e){if(e){var t=e.get("val");this.$(".js-listItemLink").removeClass("is-selected"),this.$('.js-listItem[data-val="'+t.join(",")+'"] .js-listItemLink').addClass("is-selected")}},_initModels:function _initModels(){this._customRamp=new n.core.Model,this._setupCollection()},_initBinds:function _initBinds(){this.listenTo(this.collection,"change:selected",this._onSelectItem)},_onSelectItem:function _onSelectItem(e){var t=e.get("val");this.model.set("range",t),this.trigger(p.RAMP_SELECTED,t,this)},_setupCollection:function _setupCollection(){var e=u.getQualitativeRamps(this._requiredNumberOfColors),t=this.model.get("range");e=s.map(e,function(e,i){var s=!1;return e&&e.length&&t&&t.length&&(s=e.join().toLowerCase()===t.join().toLowerCase()),e?{selected:s,name:i,val:e}:null},this),this.collection=new d(s.compact(e),{silent:!1}),this.collection.getSelectedItem()||this._customRamp.set("range",this.model.get("range"))},_onClickCustomize:function _onClickCustomize(e){this.killEvent(e);var t=this.collection.getSelectedItem();this._customRamp.set("range",t),this.trigger(p.CUSTOMIZE,t,this)},_onClickClear:function _onClickClear(e){this.killEvent(e),this._customRamp.set("range",null),this.collection.getSelectedItem()||this.collection.first().set("selected",!0,{silent:!0}),this.render(),this._listView.highlight()},_onClickCustomRamp:function _onClickCustomRamp(e){this.killEvent(e),this._customRamp.get("range")&&this.trigger("customize",this.collection.getSelectedItem(),this)}},{EVENTS:p})},function(e,t,i){"use strict";var s=i(1),n=i(442),o=i(319);e.exports=s.extend({events:{"click .js-back":"_onClickBack","click .js-colorPicker":"_onClickColorPicker"},initialize:function initialize(e){this._imageEnabled=e.imageEnabled,this._initBinds()},render:function render(e,t){this.clearSubViews(),this.$el.empty();var i=this._getRampItem();return this.$el.append(n({index:this.model.get("index")||0,color:i.color||"",label:i.title||_t("form-components.editors.fill.input-qualitative-ramps.others"),image:i.image||"",imageEnabled:this._imageEnabled})),this._loadImages(),this},_initBinds:function _initBinds(){this.listenTo(this.model,"change:image",this.render)},_getRampItem:function _getRampItem(){var e=this.model.get("ramp");return e?e[this.model.get("index")]:{color:"",title:_t("form-components.editors.fill.input-qualitative-ramps.others"),image:""}},_loadImages:function _loadImages(){var e=this._getRampItem();this.iconView=new o({imageClass:"CDB-Text u-actionTextColor js-assetPicker",imageUrl:e.image,color:e.color}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onClickColorPicker:function _onClickColorPicker(e){this.killEvent(e),this.trigger("goToColorPicker",this)}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(1),r=i(443),a=i(2328),l=i(598),h=i(3),c=["configModel","modals","ramp","userModel"];e.exports=o.extend({initialize:function initialize(e){h(e,c,this),this._imageEnabled=e.imageEnabled,this.model=new n.Model({index:this.options.index,ramp:e.ramp})},render:function render(){return this.clearSubViews(),this.$el.html(r()),this._initViews(),this},_initViews:function _initViews(){this._headerView=new a({model:this.model,imageEnabled:this._imageEnabled}),this._headerView.bind("goToColorPicker",this._onGoToColorPicker,this),this._headerView.bind("back",this._onClickBack,this),this.$(".js-header").append(this._headerView.render().el),this.addView(this._headerView),this._assetPicker=new l({model:this.model,userModel:this._userModel,configModel:this._configModel,modals:this._modals,imageEnabled:this._imageEnabled}),this._assetPicker.bind("change",s.debounce(this._onChangeImage,50),this),this.$(".js-content").append(this._assetPicker.render().el),this.addView(this._assetPicker)},_getRampItem:function _getRampItem(){var e=this.model.get("ramp");return e?e[this.model.get("index")]:{color:"",title:_t("form-components.editors.fill.input-qualitative-ramps.others"),image:""}},_onChangeImage:function _onChangeImage(e){var t=e&&e.url||"",i=e&&e.kind||"";this._getRampItem().image=t,this.model.trigger("change:image"),this.trigger("change:image",{url:t,kind:i,index:this.model.get("index")},this)},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onGoToColorPicker:function _onGoToColorPicker(e){this.killEvent(e),this.trigger("goToColorPicker",this)}})},function(e,t,i){"use strict";var s=i(4),n=i(0),o=i(1),r=i(319),a=i(445);e.exports=o.extend({events:{"click .js-color":"_onClickColor","click .js-assetPicker":"_onClickAssetPicker","keyup .js-a":"_onChangeOpacity"},initialize:function initialize(e){this.listenTo(this.model,"change",this.render)},render:function render(e,t){if(e&&e.changed&&void 0!==e.changed.opacity)return this._reRenderOpacity(),this;this.clearSubViews(),this.$el.empty();var i=this._getRampItem();return this.$el.append(a({ramp:this.model.get("ramp"),index:this.model.get("index"),opacity:this.model.get("opacity"),label:i.title||_t("form-components.editors.fill.input-qualitative-ramps.others"),color:i.color||"",iconStylingEnabled:this.options.iconStylingEnabled,isCategorized:n.has(i,"image"),image:i.image||"",imageEnabled:this.options.imageEnabled})),this._slider=this.$(".js-slider").slider({range:"min",value:this._inverseSliderValue(this.model.get("opacity")),min:0,max:1,step:.02,orientation:"horizontal",disabled:!1,slide:this._onSlideChange.bind(this)}),this._loadImages(),this},_getRampItem:function _getRampItem(){var e=this.model.get("ramp");return e?e[this.model.get("index")]:{color:"",title:_t("form-components.editors.fill.input-qualitative-ramps.others"),image:""}},_loadImages:function _loadImages(){var e=this._getRampItem();this.iconView=new r({imageClass:"CDB-Text u-actionTextColor js-assetPicker",imageUrl:e.image,color:e.color}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_onClickColor:function _onClickColor(e){this.killEvent(e),this.model.set("index",s(e.target).index())},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onClickAssetPicker:function _onClickAssetPicker(e){this.killEvent(e),this.trigger("goToAssetPicker",this)},_onSlideChange:function _onSlideChange(e,t){this.model.set("opacity",this._inverseSliderValue(t.value))},_inverseSliderValue:function _inverseSliderValue(e){return parseFloat(Number(1-e).toFixed(2))},_onChangeOpacity:function _onChangeOpacity(){var e=this.$(".js-a"),t=e.val(),i=this._isValidOpacity(t);e.toggleClass("has-error",!i),i&&this.model.set("opacity",parseFloat(t))},_isValidOpacity:function _isValidOpacity(e){return/^((0(\.\d+)?)|(1(\.0)?))$/.test(e)},_reRenderOpacity:function _reRenderOpacity(){var e,t,i=this.$(".js-a"),s=this.$(".js-slider"),n=this.model.get("opacity");i.length>0&&(e=i.val(),(!this._isValidOpacity(e)||this._isValidOpacity(e)&&parseFloat(e)!==n)&&i.val(n)),void 0!==s.slider("instance")&&void 0!==(t=s.slider("value"))&&t!==this._inverseSliderValue(n)&&s.slider("value",this._inverseSliderValue(n))}})},function(e,t,i){"use strict";var s=i(1),n=i(0);e.exports=s.extend({className:"CDB-ListDecoration-item CustomList-item CustomList-item--invert js-listItem",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave","click .js-listItemLink":"_onClick","click .js-invert":"_onClickInvert"},initialize:function initialize(e){this.options=n.extend({},this.options,e),this.listenTo(this.model,"change",this.render)},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.append(this.options.template(n.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isInverted:this.model.get("inverted"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),name:this.model.getName(),val:this.model.getValue(),options:this.model.get("renderOptions")}))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")).toggleClass("is-selected",!!this.model.get("selected")).toggleClass("is-inverted",!!this.model.get("inverted")),this},_onMouseLeave:function _onMouseLeave(){this.$el.removeClass("is-highlighted")},_onMouseEnter:function _onMouseEnter(){this.$el.addClass("is-highlighted")},_onClick:function _onClick(e){this.killEvent(e),this.model.get("selected")?this.trigger("customEvent","customize",this.model.get("val"),this):this.model.set("selected",!0)},_onClickInvert:function _onClickInvert(e){this.killEvent(e),this.model.set("inverted",!this.model.get("inverted")),this.trigger("customEvent","invert",this.model,this)}})},function(e,t,i){"use strict";var s=i(0),n=i(9),o=i(1),r=i(223),a=i(174),l=i(449),h=i(2331),c=i(448),d=i(236),u=i(447);e.exports=o.extend({module:"components:form-components:editors:fill:input-color:input-quantitative-ramps:input-ramp-list-view",events:{"click .js-customize":"_onClickCustomize","click .js-clear":"_onClickClear","click .js-customRamp":"_onClickCustomRamp","click .js-back":"_onClickBack","click .js-switch":"_onClickSwitch","click .js-quantification":"_onClickQuantification","click .js-bins":"_onClickBins"},initialize:function initialize(e){this._showSearch=e.showSearch||!1,this._typeLabel=e.typeLabel,this._initModels(),this._initBinds()},render:function render(){this.clearSubViews(),this.$el.empty(),this.$el.append(u({bins:this.model.get("bins"),attribute:this.model.get("attribute"),quantification:this.model.get("quantification")})),this._initViews();var e=this._customRamp.get("range");if(e&&e.length)this.$(".js-customList").addClass("is-customized"),this.$(".js-customList").prepend(c({customRamp:e}));else{var t=this.collection.getSelectedItem();t||(t=this.collection.first()),this._selectRamp(t)}return this},_initModels:function _initModels(){this._customRamp=new n.core.Model,this._setupCollection()},_initBinds:function _initBinds(){this.listenTo(this.model,"change:bins",this._onChangeBins),this.listenTo(this.model,"change:attribute_type",this._updateRampOnAttributeChange),this.listenTo(this.collection,"change:selected",this._onSelectItem)},_initViews:function _initViews(){this._listView=new r({collection:this.collection,showSearch:this._showSearch,typeLabel:this._typeLabel,itemTemplate:l,itemView:h}),this._listView.bind("invert",this._invertRamp,this),this._listView.bind("customize",function(e){this.trigger("customize",e,this)},this),this.$(".js-content").append(this._listView.render().el),this.addView(this._listView)},_getRamps:function _getRamps(){var e=this.model.get("attribute_type"),t={number:["quantitative","diverging"],string:["qualitative"]},i=d;return t[e]&&(i=s.filter(i,function(i){return!!i.tags&&s.contains(t[e],i.tags[0])})),i=s.map(i,function(e,t){var i=e[this.model.get("bins")],n=this.model.get("range"),o=!1,r=!1;return i&&i.length&&n&&n.length&&((o=i.join().toLowerCase()===n.join().toLowerCase())||(r=o=s.clone(i).reverse().join().toLowerCase()===n.join().toLowerCase())),i?{selected:o,inverted:r,name:t,val:i}:null},this)},_setupCollection:function _setupCollection(){var e=this._getRamps();this.collection=new a(s.compact(e),{silent:!1}),this.collection.getSelectedItem()||this._customRamp.set("range",this.model.get("range"))},_updateRampOnAttributeChange:function _updateRampOnAttributeChange(e,t){var i=this._getRamps();this.collection.reset(s.compact(i),{silent:!0}),this._customRamp.set("range",!1);var n=this.collection.first();n&&n.set("selected",!0),this.render()},_invertRamp:function _invertRamp(e){if(e){this._customRamp.set("range",null),e.set("selected",!1);var t=[].concat(e.get("val")).reverse();e.set({val:t,selected:!0}),this.model.set("range",t)}},_selectRamp:function _selectRamp(e){if(e){var t=e.get("val");this.$(".js-listItemLink").removeClass("is-selected"),this.$('.js-listItem[data-val="'+t.join(",")+'"] .js-listItemLink').addClass("is-selected")}},_onClickClear:function _onClickClear(e){this.killEvent(e),this._customRamp.set("range",null),this.collection.getSelectedItem()||this.collection.first().set("selected",!0),this.render(),this._listView.highlight()},_onClickCustomRamp:function _onClickCustomRamp(e){this.killEvent(e),this.model.get("range")===this._customRamp.get("range")?this.trigger("customize",this.collection.getSelectedItem(),this):this.model.set("range",this._customRamp.get("range")),this.$(".js-listItemLink").removeClass("is-selected"),this.$(".js-customRamp").addClass("is-selected")},_onClickCustomize:function _onClickCustomize(e){this.killEvent(e);var t=this.collection.getSelectedItem();this._customRamp.set("range",t),this.trigger("customize",t,this)},_onChangeBins:function _onChangeBins(){var e=this._customRamp.get("range");e&&(e=this.model.get("bins")>e.length?s.range(this.model.get("bins")).map(function(t){return t>=e.length?"#CCCCCC":e[t]}):e.slice(0,this.model.get("bins")),this.model.set("range",e),this._customRamp.set("range",e))},_onSelectItem:function _onSelectItem(e){this._selectRamp(e),this.trigger("selectItem",e,this)},_onClickSwitch:function _onClickSwitch(e){this.killEvent(e),this.trigger("switch",this)},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onClickQuantification:function _onClickQuantification(e){this.killEvent(e),this.trigger("selectQuantification",this)},_onClickBins:function _onClickBins(e){this.killEvent(e),this.trigger("selectBins",this)}})},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(1),r=i(2332),a=i(222),l=i(1007);e.exports=o.extend({module:"components:form-components:editors:fill:input-color:input-quantitative-ramps:input-ramp-content-view",events:{"click .js-back":"_onClickBack"},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function _initViews(){var e=this,t=new s.Collection([{createStackView:function createStackView(t,i){return e._createInputRampListView(t,i).bind(e)}},{createStackView:function createStackView(t,i){return e._createColorPickerView(t,i).bind(e)}}]);this._stackLayoutView=new a({collection:t}),this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_createColorPickerView:function _createColorPickerView(e,t){var i=n.map(this.model.get("range"),function(e,t){return{val:e,color:e,title:this.model.get("attribute")}},this),s=void 0!==this.model.get("opacity")?this.model.get("opacity"):1,o=new l({index:0,ramp:i,opacity:s});return o.bind("back",function(t){e.prevStep()},this),o.bind("change",this._updateRange,this),o.bind("change:opacity",function(e){this.model.set("opacity",e)},this),o},_createInputRampListView:function _createInputRampListView(e,t){var i=new r({model:this.model,showSearch:this.options.showSearch||!1,typeLabel:this.options.typeLabel});return i.bind("customize",function(t){e.nextStep()},this),i.bind("change_ramp",this._updateRamp,this),i.bind("change",this._updateRange,this),i.bind("back",function(e){this.trigger("back",this)},this),i.bind("switch",function(e){this.trigger("switch",this)},this),i.bind("selectItem",function(e){this.trigger("selectItem",e.get("val"),this)},this),i.bind("selectBins",function(e){this.trigger("selectBins",this)},this),i.bind("selectQuantification",function(e){this.trigger("selectQuantification",this)},this),i},_updateRamp:function _updateRamp(e){this.model.set("range",e)},_updateRange:function _updateRange(e){this.model.set("range",n.pluck(e,"color"))},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(1),r=i(222),a=i(470),l=i(283),h=i(2333),c=i(236),d=i(56);e.exports=o.extend({module:"components:form-components:editors:fill:input-color:input-quantitative-ramps:main-view",initialize:function initialize(e){this._settings=e.settings||d.Settings.COLOR_RAMPS,this._setupModel(),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_setupModel:function _setupModel(){var e={};this.model.get("quantification")||(e.quantification=this._settings.quantifications.items[this._settings.quantifications.defaultIndex]),this.model.get("bins")||(e.bins=this._settings.bins.items[this._settings.bins.defaultIndex]),+this.model.get("bins")>+this._settings.bins.items[this._settings.bins.items.length-1]&&(e.bins=this._settings.bins.items[this._settings.bins.items.length-1]),this.model.set(e)},_initBinds:function _initBinds(){var e=this.model.get("range");this.listenTo(this.model,"change:bins",this._updateRange),this.listenTo(this.model,"change:attribute",this.render),this.listenTo(this.model,"change:quantification",this._onChangeQuantification),this.model.unset("fixed"),e&&this._isValidRange(e)||this.model.set("range",this._getDefaultRamp())},_isValidRange:function _isValidRange(e){return e&&e.length>1||!1},_initViews:function _initViews(){var e=this,t=[{createStackView:function createStackView(t,i){return e._createInputRampContentView(t,i).bind(e)}}];this.options.hideTabs&&s.contains(this.options.hideTabs,d.Tabs.QUANTIFICATION)||t.push({createStackView:function createStackView(t,i){return e._createQuantificationListView(t,i).bind(e)}}),this.options.hideTabs&&s.contains(this.options.hideTabs,d.Tabs.BINS)||t.push({createStackView:function createStackView(t,i){return e._createBinsListView(t,i).bind(e)}});var i=new n.Collection(t);this._stackLayoutView=new r({collection:i}),this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_updateRange:function _updateRange(){var e=this.model.previous("bins");if(e){var t=s.find(c,function(t){var i=t[e],s=this.model.get("range");return i&&s&&i.join("").toLowerCase()===s.join("").toLowerCase()},this);if(t){var i=this.model.get("bins");this.model.set("range",t[i])}}},_createInputRampContentView:function _createInputRampContentView(e,t){var i=new h({stackLayoutModel:e,model:this.model});return i.bind("back",function(e){this.trigger("back")},this),i.bind("selectItem",function(e){this.model.unset("domain"),this.model.set("range",e)},this),i.bind("selectQuantification",function(t){e.goToStep(1)},this),i.bind("selectBins",function(t){e.goToStep(2)},this),i},_createBinsListView:function _createBinsListView(e,t){var i=new a({headerTitle:_t("form-components.editors.fill.bins"),stackLayoutModel:e,columns:this._settings.bins.items});return i.bind("selectItem",function(t){this.model.set("bins",t.get("val")),e.goToStep(0)},this),i.bind("back",function(t){e.goToStep(0)},this),i},_createQuantificationListView:function _createQuantificationListView(e,t){var i=new a({headerTitle:_t("form-components.editors.fill.quantification.title"),stackLayoutModel:e,itemTemplate:l,columns:this._settings.quantifications.items,showSearch:!1});return i.bind("selectItem",function(t){this.model.set("quantification",t.get("val")),e.prevStep()},this),i.bind("back",function(t){e.goToStep(0)},this),i},_getDefaultRamp:function _getDefaultRamp(){return s.map(c,function(e){return e[this.model.get("bins")]},this)[0]},_onChangeQuantification:function _onChangeQuantification(){"category"===this.model.get("quantification")&&this.trigger("switch",this)},remove:function remove(){o.prototype.remove.apply(this)}})},function(e,t,i){"use strict";var s=i(1),n=i(451),o=i(6);e.exports=s.extend({className:"Carousel-item",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave",click:"_onClick"},initialize:function initialize(e){this._itemClassName=e&&e.itemOptions?e.itemOptions.className:"",this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.bind("mouseenter",this._onMouseEnter.bind(this)),this.$el.bind("mouseleave",this._onMouseLeave.bind(this)),this.$el.html(n({name:this.model.getName(),className:this._itemClassName,template:this.model.get("template")()})),this.model.getValue()&&this.$el.addClass("js-"+this.model.getValue()),this.$el.toggleClass("is-selected",!!this.model.get("selected")),this._initViews(),this},_initViews:function _initViews(){if(this.model.get("tooltip")){var e=new o({el:this.$el,gravity:"s",title:function(){return this.model.get("tooltip")}.bind(this)});this.addView(e)}},_initBinds:function _initBinds(){this.model.bind("change:selected",this.render,this)},_onMouseEnter:function _onMouseEnter(){this.model.set("highlighted",!0)},_onMouseLeave:function _onMouseLeave(){this.model.set("highlighted",!1)},_onClick:function _onClick(e){this.killEvent(e),this.model.set("selected",!0)}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({defaults:{selected:!1,label:"",template:function template(){return""}},getName:function getName(){return this.get("label")||this.getValue()},getValue:function getValue(){return this.get("val")}})},function(e,t,i){"use strict";var s=i(1),n=i(268),o=i(452),r=i(282),a=i(2335),l=i(0);e.exports=s.extend({className:"Carousel",tagName:"div",initialize:function initialize(e){if(!e.collection){if(!e.options)throw new Error("options array {value, label} is required");this.collection=new r(e.options),this.options=e}this._bindedCheckShadows=this._checkShadows.bind(this),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(o()),this._renderList(),this._applyCustomScroll(),this},_initBinds:function _initBinds(){this.collection.bind("change:selected",this._checkScroll,this)},_renderList:function _renderList(){this.collection.each(function(e){this._createItem(e)},this)},_createItem:function _createItem(e){var t=this.options,i=t&&t.listItemOptions?t.listItemOptions.className:"Carousel-item",s=new a({className:i,model:e,itemOptions:this.options.itemOptions});this._listContainer().append(s.render().el),this.addView(s)},_applyCustomScroll:function _applyCustomScroll(){n.initialize(this._listContainer().get(0),{wheelSpeed:1,wheelPropagation:!1,swipePropagation:!0,suppressScrollY:!0,stopPropagationOnClick:!1,minScrollbarLength:120,useBothWheelAxes:!0}),this._checkScroll(),this._bindScroll()},_destroyCustomScroll:function _destroyCustomScroll(){this._unbindScroll(),n.destroy(this._listContainer().get(0))},_bindScroll:function _bindScroll(){this._listContainer().on("ps-x-reach-start",this._bindedCheckShadows).on("ps-x-reach-end",this._bindedCheckShadows).on("ps-scroll-x",this._bindedCheckShadows)},_unbindScroll:function _unbindScroll(){this._listContainer().off("ps-x-reach-start",this._bindedCheckShadows).off("ps-x-reach-end",this._bindedCheckShadows).off("ps-scroll-x",this._bindedCheckShadows)},_checkScroll:function _checkScroll(){var e=this.$(".is-selected").position();e&&(this._listContainer().scrollLeft(e.left-20),this._bindedCheckShadows())},_listContainer:function _listContainer(){return this.$(".js-list")},_checkShadows:function _checkShadows(){var e=this._listContainer().scrollLeft(),t=this._listContainer().get(0).scrollWidth-this._listContainer().outerWidth();this.$(".js-leftShadow").toggleClass("is-visible",e>0),this.$(".js-rightShadow").toggleClass("is-visible",e<t)},clean:function clean(){this._destroyCustomScroll(),s.prototype.clean.apply(this)},initScroll:function initScroll(){setTimeout(l.bind(function(){this._checkShadows(),this._checkScroll(),n.update(this._listContainer().get(0))},this),0)}})},function(e,t,i){"use strict";var s=i(1),n=i(351),o="selected";e.exports=s.extend({tagName:"li",className:"AssetsList-item AssetsList-item--medium",events:{"click .js-asset":"_onClick"},initialize:function initialize(){this.listenTo(this.model,"change:state",this._changeState)},render:function render(){return this.clearSubViews(),this.$el.append(n({type:"icon",name:this.model.get("name"),public_url:this.model.get("public_url")})),this},_onClick:function _onClick(e){this.killEvent(e),this.trigger(o,this.model),this.model.set("state",o)},_changeState:function _changeState(){this.$el.toggleClass("is-selected",this.model.get("state")===o)}})},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(2338),r=i(1010),a=i(3),l=["icons","selectedAsset"];e.exports=n.extend({tagName:"ul",className:"AssetsList",initialize:function initialize(e){a(e,l,this),this._setupAssets(e)},render:function render(){return this.clearSubViews(),this._renderAssets(),this},_renderAssets:function _renderAssets(){this._assetsCollection.each(function(e){var t=new o({model:e});this.model&&t.model.getURLFor(e.get("icon"))===this.model.get("image")&&t.model.set("state","selected"),t.bind("selected",this._selectItem,this),this.$el.append(t.render().el),this.addView(t)},this)},_setupAssets:function _setupAssets(e){s.isEmpty(e)||(this._icons=s.map(this._icons,function(t){return s.extend(t,e)}));var t=this._icons;this.options.limit&&(t=t.slice(0,this.options.limit)),this._assetsCollection=new r(t),this.add_related_model(this._assetsCollection)},_selectItem:function _selectItem(e){this._selectedAsset.set({url:e.get("public_url"),kind:e.get("kind")}),this._assetsCollection.deselectAll(e)}})},function(e,t,i){"use strict";i(1026);var s=i(604),n=i(4),o=i(2),r=i(1),a=i(7),l=i(3),h=i(596),c=i(455),d=["configModel","userModel"];e.exports=r.extend({className:"Form-modal",events:{"keyup .js-url":"_onURLChanged","click .js-submit":"_onClickSubmit"},initialize:function initialize(e){l(e,d,this),this._stateModel=new o.Model({status:"show",uploads:0}),this.listenTo(this._stateModel,"change:status",this.render),this._assetCollection=new h(null,{configModel:this._configModel,userModel:this._userModel})},render:function render(){return this.clearSubViews(),this.$el.html(c()),this._initDropzone(),this},_initDropzone:function _initDropzone(){var e=n("html")[0],t=this;this.dragster=new Dragster(e),n(e).bind("dragster:enter",function(e){t._showDropzone()}),n(e).bind("dragster:leave",function(e){t._hideDropzone()}),e.dropzone||(this.dropzone=new s(e,{url:":)",autoProcessQueue:!1,previewsContainer:!1}),this.dropzone.on("dragover",function(){t._showDropzone()}),this.dropzone.on("drop",function(e){t.trigger("upload-files",e.dataTransfer.files),t._hideDropzone()}))},_showDropzone:function _showDropzone(){this.$(".Form-upload").addClass("is-dropping")},_hideDropzone:function _hideDropzone(){this.$(".Form-upload").removeClass("is-dropping")},_destroyDropzone:function _destroyDropzone(){var e=n("html")[0];this.dragster&&(this.dragster.removeListeners(),this.dragster.reset(),n(e).unbind("dragster:enter dragster:leave")),this.dropzone&&this.dropzone.destroy()},_hasError:function _hasError(){return"error"===this._stateModel.get("status")},_onClickSubmit:function _onClickSubmit(e){this.killEvent(e);var t=this._getURL();t?a.isURL(t)?(this._hideURLError(),this.trigger("upload-url",t)):this._showURLError():this._hideURLError()},_getURL:function _getURL(){return this.$(".js-url").val()},_onURLChanged:function _onURLChanged(){var e=this._getURL();e?a.isURL(e)?this._hideURLError():this._showURLError():this._hideURLError()},_showURLError:function _showURLError(){this.$(".js-url-error").addClass("is-visible")},_hideURLError:function _hideURLError(){this.$(".js-url-error").removeClass("is-visible")},clean:function clean(){this._destroyDropzone(),r.prototype.clean.apply(this)}})},function(e,t,i){"use strict";var s=i(2),n=i(597),o=i(3),r=["configModel","orgId"];e.exports=s.Collection.extend({model:n,url:function url(e){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("organization-assets",e)+"/organization/"+this._orgId+"/assets"},initialize:function initialize(e,t){o(t,r,this)},deselectAll:function deselectAll(e){this.each(function(t){t!==e&&"selected"===t.get("state")&&t.set("state","")})}})},function(e,t,i){"use strict";var s=i(1),n=i(3),o=i(1011),r=i(456),a=["userAssetCollection","organizationAssetCollection","selectedAsset"];e.exports=s.extend({initialize:function initialize(e){n(e,a,this),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(r),this._organizationAssetCollection.deselectAll(),this._organizationAssetCollection.each(this._renderAsset,this),this},_initBinds:function _initBinds(){this.listenTo(this._organizationAssetCollection,"reset",this.render),this.listenTo(this._organizationAssetCollection,"change",this._onChangeAssets)},_getSelectedAsset:function _getSelectedAsset(){var e=this._organizationAssetCollection.where({state:"selected"});return e&&e[0]},_renderAsset:function _renderAsset(e){var t=new o({model:e,assetHeight:48,selectedAsset:this._selectedAsset});e.get("public_url")===this.model.get("image")&&e.set("state","selected"),t.bind("selected",this._selectAsset,this),this.$(".js-assets").append(t.render().el),this.addView(t)},_onChangeAssets:function _onChangeAssets(){var e=this._getSelectedAsset();this._selectedAsset.set({url:e&&e.get("public_url"),kind:"custom-marker"})},_selectAsset:function _selectAsset(e){e.set("state","selected"),this._organizationAssetCollection.deselectAll(e),this._userAssetCollection.deselectAll()}})},function(e,t,i){"use strict";var s=i(1),n=i(3),o=i(459),r=["title","editable"];e.exports=s.extend({events:{"click .js-remove":"_onClickRemove","click .js-select-all":"_onClickSelectAll","click .js-deselect-all":"_onClickDeselectAll"},initialize:function initialize(e){n(e,r,this),this._assetsCollection=this.options.assetsCollection,this._initBinds()},render:function render(){this.clearSubViews();var e=this._getSelectedAssetsCount(),t=this._assetsCollection.size();return this.$el.html(o({title:this._title,editable:this._editable,assetsCount:t,selectedCount:e,allSelected:e===t})),this},_initBinds:function _initBinds(){this.listenTo(this._assetsCollection,"add change remove",this.render)},_onClickRemove:function _onClickRemove(){this.trigger("remove")},_onClickSelectAll:function _onClickSelectAll(){this.trigger("select-all")},_onClickDeselectAll:function _onClickDeselectAll(){this.trigger("deselect-all")},_getSelectedAssetsCount:function _getSelectedAssetsCount(){var e=this._assetsCollection.where({state:"selected"});return e?e.length:0}})},function(e,t,i){"use strict";var s=i(4),n=i(0),o=i(1),r=i(1011),a=i(3),l=i(2),h=i(11),c=i(2343),d=i(186),u=i(352),p=i(457),g=["userModel","userAssetCollection","selectedAsset"];e.exports=o.extend({initialize:function initialize(e){if(a(e,g,this),this._userModel.isInsideOrg()){if(!e.organizationAssetCollection)throw new Error("organizationAssetCollection is required");this._organizationAssetCollection=e.organizationAssetCollection}this._stateModel=new l.Model,this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(p),this._isLoading()?this._renderLoading():this._hasError()?this._renderError():this._renderRegularView(),this},_addHeaderView:function _addHeaderView(){this._assetHeaderView=new c({editable:!0,title:this.options.title,assetsCollection:this._userAssetCollection}),this.addView(this._assetHeaderView),this.$(".js-nav").append(this._assetHeaderView.render().el),this._assetHeaderView.bind("select-all",this._selectAllAssets,this),this._assetHeaderView.bind("deselect-all",this._deselectAllAssets,this),this._assetHeaderView.bind("remove",this._removeSelectedAssets,this)},_renderRegularView:function _renderRegularView(){this._addHeaderView(),this._renderAddButton(),this._userAssetCollection.deselectAll(),this._userAssetCollection.each(this._renderAsset,this)},_renderAddButton:function _renderAddButton(){var e=new r({model:new l.Model({type:"text",name:"+"}),assetHeight:48});e.bind("selected",function(){this.trigger("init-upload")},this),this.addView(e),this.$(".js-assets").append(e.render().$el)},_initBinds:function _initBinds(){this._keyDown=this._onKeyDown.bind(this),s(document).on("keydown",this._keyDown),this._keyUp=this._onKeyUp.bind(this),s(document).on("keyup",this._keyUp),this.listenTo(this._stateModel,"change:status",this.render),this.listenTo(this._userAssetCollection,"change",this._onChangeAssets)},_getSelectedAsset:function _getSelectedAsset(){return this._userAssetCollection.findWhere({state:"selected"})},_getSelectedAssetsCount:function _getSelectedAssetsCount(){var e=this._userAssetCollection.where({state:"selected"});return e?e.length:0},_onKeyDown:function _onKeyDown(e){this._shiftKeyPressed=e.shiftKey},_onKeyUp:function _onKeyUp(e){this._shiftKeyPressed=e.shiftKey},_onClickBack:function _onClickBack(e){this.killEvent(e),this._stateModel.unset("status")},_renderAsset:function _renderAsset(e){var t=new r({model:e,assetHeight:48,selectedAsset:this._selectedAsset});e.get("public_url")===this.model.get("image")&&e.set("state","selected"),t.bind("selected",this._selectAsset,this),this.$(".js-assets").append(t.render().el),this.addView(t)},_onChangeAssets:function _onChangeAssets(){if(1===this._getSelectedAssetsCount()){var e=this._getSelectedAsset();this._selectedAsset.set({url:e&&e.get("public_url"),kind:"custom-marker"})}else this._selectedAsset.set({url:"",kind:""})},_selectAllAssets:function _selectAllAssets(){this._userAssetCollection.selectAll()},_deselectAllAssets:function _deselectAllAssets(){this._userAssetCollection.deselectAll()},_selectAsset:function _selectAsset(e){this._shiftKeyPressed?e.set("state","selected"===e.get("state")?"":"selected"):e.set("state","selected"),this._shiftKeyPressed||(this._userAssetCollection.deselectAll(e),this._userModel.isInsideOrg()&&this._organizationAssetCollection.deselectAll())},_removeSelectedAssetsFromView:function _removeSelectedAssetsFromView(){var e=this._userAssetCollection.select(function(e){return"selected"===e.get("state")},this);n.each(e,function(e){this.$("#"+e.get("id")).remove()},this)},_removeSelectedAssets:function _removeSelectedAssets(){this._stateModel.set("status","loading");var e=this._userAssetCollection.select(function(e){return"selected"===e.get("state")},this);n.each(e,function(e){e.destroy({complete:this._onDestroyFinished.bind(this)})},this)},_onDestroyFinished:function _onDestroyFinished(e){200===e.status?(this._removeSelectedAssetsFromView(),this._stateModel.unset("status"),this._selectedAsset.unset("kind"),this._selectedAsset.unset("url")):this._stateModel.set({error_message:e.statusText,status:"error"})},_isLoading:function _isLoading(){return"loading"===this._stateModel.get("status")},_hasError:function _hasError(){return"error"===this._stateModel.get("status")},_renderLoading:function _renderLoading(){this.$el.html(h({title:_t("components.modals.assets-picker.loading")}))},_renderError:function _renderError(){this.$el.html(new d({title:this._stateModel.get("error_message"),desc:_t("components.modals.assets-picker.error-desc"),template:u}).render().el)},_disableBinds:function _disableBinds(){s(document).off("keydown",this._keyDown),s(document).off("keyup",this._keyUp)},clean:function clean(){this._disableBinds(),o.prototype.clean.apply(this)}})},function(e,t,i){"use strict";var s=i(1),n=i(3),o=i(180),r=i(2344),a=["userModel","userAssetCollection","title","selectedAsset"];e.exports=s.extend({className:"Tab-paneContentInner",events:{"change .js-uploadInput":"_onFileSelected"},initialize:function initialize(e){if(n(e,a,this),this._userModel.isInsideOrg()){if(!e.organizationAssetCollection)throw new Error("organizationAssetCollection is required");this._organizationAssetCollection=e.organizationAssetCollection}},render:function render(){return this.clearSubViews(),this.$el.empty(),this._renderAssets(),this},_renderAssets:function _renderAssets(){var e=new o({createContentView:function(){var e=new r({title:this._title,model:this.model,organizationAssetCollection:this._organizationAssetCollection,userAssetCollection:this._userAssetCollection,selectedAsset:this._selectedAsset,userModel:this._userModel});return e.bind("init-upload",function(){this.trigger("init-upload")},this),e}.bind(this)});this.addView(e),this.$el.append(e.render().el)}})},function(e,t,i){"use strict";var s=i(4),n=i(0),o=i(1),r=i(2),a=i(7),l=i(1012),h=i(2345),c=i(2342),d=i(2341),u=i(2340),p=i(3),g=i(596),m=i(320),f=i(180),_=i(2339),v=i(11),y=i(186),b=i(352),w=i(13),C=i(454),M=i(453),k="custom-marker",S=["modalModel","configModel","userModel"];e.exports=o.extend({className:"Dialog-content Dialog-content--expanded",events:{"click .js-add":"_onSetImage","click .js-upload":"_initUpload","change .js-fileInput":"_onFileSelected","click .js-back":"_onClickBack"},initialize:function initialize(e){p(e,S,this),this._initModels(),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(C({disclaimer:l.disclaimer})),this._hasFetchedAllCollections()?this._initTabPane():this._isLoading()?this._renderLoading():this._hasError()&&this._renderError(),this},_hasFetchedAllCollections:function _hasFetchedAllCollections(){return"show"===this._stateModel.get("status")},_initModels:function _initModels(){var e=this;this._selectedAsset=new r.Model({url:this.model.get("image")}),this._stateModel=new r.Model({status:"loading",modalEnabled:!1,uploads:0}),this._assetCollections=[],this._userAssetCollection=new g(null,{configModel:this._configModel,userModel:this._userModel}),this._assetCollections.push(this._userAssetCollection),this._userModel.isInsideOrg()&&(this._organizationAssetCollection=new d(null,{configModel:this._configModel,orgId:this._userModel.getOrganization().get("id")}),this._assetCollections.push(this._organizationAssetCollection));var t=n.invoke(this._assetCollections,"fetch");s.when.apply(s,t).then(function(){e._stateModel.set("status","show")},function(t,i){e._setError(i)})},_initBinds:function _initBinds(){this.listenTo(this._selectedAsset,"change:url",this._onChangeSelectedAsset),this.listenTo(this._stateModel,"change:status",this.render),this.listenTo(this._stateModel,"change:modalEnabled",this._onChangeSetButton)},_onClickBack:function _onClickBack(e){this.killEvent(e),this._stateModel.set("status","show"),this._assetsTabPaneView.setSelectedTabPaneByName("upload-file")},_upload:function _upload(e){this._userAssetCollection.create(e,{beforeSend:this._beforeAssetUpload.bind(this),success:this._onAssetUploaded.bind(this),error:this._onAssetUploadError.bind(this),complete:this._onAssetUploadComplete.bind(this)})},_renderError:function _renderError(){this._hideDisclaimer(),this.$(".js-body").html(new y({title:a.capitalize(this._stateModel.get("error_message")),desc:_t("components.modals.assets-picker.error-desc"),template:b}).render().el)},_renderLoading:function _renderLoading(){this._hideDisclaimer(),this.$(".js-body").html(v({title:_t("components.modals.assets-picker.loading")}))},_isLoading:function _isLoading(){return"loading"===this._stateModel.get("status")},_hasError:function _hasError(){return"error"===this._stateModel.get("status")},_initTabPane:function _initTabPane(){var e=[{name:"maki-icons",label:_t("components.modals.add-asset.icons"),createContentView:this._createMakiIconsView.bind(this)},{name:"your-uploads",label:_t("components.modals.add-asset.your-uploads"),createContentView:this._createYourUploadsView.bind(this)}];this._userModel.isInsideOrg()&&this._organizationAssetCollection.length>0&&e.push({name:"organization-uploads",label:_t("components.modals.add-asset.organization-uploads"),createContentView:this._createOrganizationUploadsView.bind(this)}),e.push({name:"upload-file",label:_t("components.modals.add-asset.upload-file"),createContentView:this._createUploadFileView.bind(this)});var t={tabPaneOptions:{template:M,disclaimer:l.disclaimer,tabPaneItemOptions:{tagName:"li",klassName:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this._assetsTabPaneView=m(e,t),this.listenTo(this._assetsTabPaneView.collection,"change",this._onChangeSelectedTab),this.addView(this._assetsTabPaneView),this.$(".js-body").append(this._assetsTabPaneView.render().el),this._initSetButtonState()},_onChangeSelectedTab:function _onChangeSelectedTab(){switch(this._assetsTabPaneView.getSelectedTabPaneName()){case"maki-icons":this._setDisclaimer(l.disclaimer),this._toggleSetButton();break;case"upload-file":this._hideDisclaimer(),this._disableSetButton();break;default:this._hideDisclaimer(),this._toggleSetButton()}},_toggleSetButton:function _toggleSetButton(){this._stateModel.set("modalEnabled",void 0!==this._selectedAsset.get("url"))},_initSetButtonState:function _initSetButtonState(){if(this.model.get("image")){var e=!1;"marker"===this.model.get("kind")&&(e=!0),e||n.each(this._assetCollections,function(t){e||(e=t.some(function(e){return this.model.get("image")===e.get("public_url")},this))},this),e&&this._enableSetButton()}},_enableSetButton:function _enableSetButton(){this._stateModel.set("modalEnabled",!0)},_disableSetButton:function _disableSetButton(){this._stateModel.set("modalEnabled",!1)},_createYourUploadsView:function _createYourUploadsView(){var e=new h({model:this.model,selectedAsset:this._selectedAsset,title:_t("components.modals.add-asset.your-uploads"),organizationAssetCollection:this._organizationAssetCollection,userAssetCollection:this._userAssetCollection,userModel:this._userModel}).bind(this);return this._userAssetsView=e,e.bind("init-upload",this._initUpload,this),this._hideDisclaimer(),this._userAssetsView},_createOrganizationUploadsView:function _createOrganizationUploadsView(){var e=new f({createContentView:function(){return new c({title:_t("components.modals.add-asset.organization-uploads"),model:this.model,organizationAssetCollection:this._organizationAssetCollection,userAssetCollection:this._userAssetCollection,selectedAsset:this._selectedAsset})}.bind(this)});return this._hideDisclaimer(),e},_createUploadFileView:function _createUploadFileView(){var e=new u({model:this.model,userModel:this._userModel,configModel:this._configModel}).bind(this);return e.bind("upload-complete",this._onUploadComplete,this),e.bind("upload-files",this._uploadFiles,this),e.bind("upload-url",this._uploadURL,this),e},_createMakiIconsView:function _createMakiIconsView(){return new f({createContentView:function(){return new _({model:this.model,selectedAsset:this._selectedAsset,title:_t("components.modals.add-asset.maki-icons"),icons:l.icons,folder:"maki-icons",kind:"marker",size:"18"})}.bind(this)})},_onUploadComplete:function _onUploadComplete(){this._assetsTabPaneView.setSelectedTabPaneByName("your-uploads")},_onChangeSetButton:function _onChangeSetButton(){this.$(".js-add").toggleClass("is-disabled",!this._stateModel.get("modalEnabled"))},_onChangeSelectedAsset:function _onChangeSelectedAsset(){this._selectedAsset.get("url")||(this.model.unset("image"),this.model.unset("kind")),this._stateModel.set("modalEnabled",!!this._selectedAsset.get("url"))},_initUpload:function _initUpload(e){this.killEvent(e),this.$(".js-fileInput").click()},_setDisclaimer:function _setDisclaimer(e){this.$(".js-disclaimer").html(e)},_hideDisclaimer:function _hideDisclaimer(){this.$(".js-disclaimer").html("")},_getSelectedFiles:function _getSelectedFiles(){return this.$(".js-fileInput").prop("files")},_uploadURL:function _uploadURL(e){this._upload({type:"url",kind:k,url:e})},_uploadFiles:function _uploadFiles(e){n.each(e,function(e){this._upload({kind:k,type:"file",filename:e})},this)},_onFileSelected:function _onFileSelected(){this._uploadFiles(this._getSelectedFiles())},_beforeAssetUpload:function _beforeAssetUpload(){this._stateModel.set("uploads",this._stateModel.get("uploads")+1),this._stateModel.get("uploads")>0&&this._stateModel.set("status","loading")},_onAssetUploaded:function _onAssetUploaded(e){this._resetFileSelection()},_setError:function _setError(e){this._stateModel.set({error_message:w(e),status:"error"})},_onAssetUploadError:function _onAssetUploadError(e,t){this._userAssetCollection.remove(e),this._resetFileSelection(),this._setError(t)},_onAssetUploadComplete:function _onAssetUploadComplete(){this._stateModel.set("uploads",this._stateModel.get("uploads")-1),this._stateModel.get("uploads")<1&&!this._hasError()&&(this._stateModel.set("status","show"),this._onUploadComplete())},_resetFileSelection:function _resetFileSelection(){this.$(".js-fileInput").val("")},_onSetImage:function _onSetImage(e){this.killEvent(e),this._stateModel.get("modalEnabled")&&(this.model.set({image:this._selectedAsset.get("url"),kind:this._selectedAsset.get("kind")}),this.trigger("change",{url:this._selectedAsset.get("url"),kind:this._selectedAsset.get("kind")},this),this._modalModel.destroy(this.model))}})},,function(e,t,i){"use strict";var s=i(1),n=i(465);e.exports=s.extend({className:"Label",initialize:function initialize(){if(!this.model)throw new Error("A model should be provided");this.model.bind("change:label",this.render,this)},render:function render(){return this.clearSubViews(),this.$el.html(n({color:this.model.get("label"),selectedChild:this.model.get("selectedChild")||""})),this}})},function(e,t,i){"use strict";var s=i(466),n=i(1),o=i(319);e.exports=n.extend({tagName:"i",className:"CDB-IconFont",initialize:function initialize(e){if(!this.model)throw new Error("A model should be provided");this.model.bind("change:label",this.render,this),this.model.bind("change:color",this._updateColor,this)},render:function render(){this.clearSubViews();var e=this._getLabelType();return this.$el.html(s({type:e,label:this.model.get("label"),kind:this.model.get("kind"),selectedChild:this.model.get("selectedChild")||""})),"file"===e&&this._loadImages(),this},_loadImages:function _loadImages(){this.iconView=new o({imageClass:"Tab-paneLabelImage",imageUrl:this._getImageURL(),color:this.model.get("color")}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_updateColor:function _updateColor(){this.iconView&&this.iconView.updateImageColor(this.model.get("color"))},_getLabelType:function _getLabelType(){var e=this.model.get("label");return e&&e.match(/^http/)?"file":"text"},_getImageURL:function _getImageURL(){return this.model.get("label")}})},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(182),r=i(177),a=i(2349),l=i(2348);e.exports=function(e,t){var i=(t=t||{}).tabPaneItemLabelOptions,h=e.map(function(e){return["label","createContentView"].forEach(function(t){if(!e[t])throw new Error(t+" should be provided")}),{name:e.name,selected:e.selected,label:e.label,color:e.color,kind:e.kind,selectedChild:e.selectedChild,createButtonView:function createButtonView(){return"color"===e.type?new l(s.extend({model:this},i)):new a(s.extend({model:this,type:e.type},i))},createContentView:function createContentView(){return e.createContentView&&e.createContentView()||new n}}}),c=new r(h),d=t.tabPaneOptions;return new o(s.extend({collection:c},d))}},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(321),r=i(2350),a=i(464),l=i(598),h=i(56);e.exports=n.extend({initialize:function initialize(e){if(this.options.editorAttrs){var t=this.options.editorAttrs;if(this._imageEnabled=t.imageEnabled,t.hidePanes&&(this._hidePanes=t.hidePanes,this._imageEnabled&&!s.contains(this._hidePanes,h.Panes.FILE))){if(!e.configModel)throw new Error("configModel param is required");if(!e.userModel)throw new Error("userModel param is required");if(!e.modals)throw new Error("modals param is required")}t.disableOpacity&&(this._disableOpacity=!0)}this._userModel=e.userModel,this._configModel=e.configModel,this._modals=e.modals,this._query=e.query},render:function render(){return this.clearSubViews(),this._imageEnabled&&this._setupTabPanes(),this._tabPaneView?this.$el.append(this._tabPaneView.render().$el):this.$el.append(this._generateFixedContentView().render().$el),this},_setupTabPanes:function _setupTabPanes(){var e=this,t={name:"fixed",type:"color",label:this.model.get("fixed"),createContentView:function createContentView(){return e._generateFixedContentView()}},i={name:"file",type:this.model.get("image")?"image":"text",label:this.model.get("image")||_t("form-components.editors.fill.input-color.img"),kind:this.model.get("kind")||"marker",color:this.model.get("fixed"),createContentView:function createContentView(){return e._generateFileContentView()}};this._tabPaneTabs=[],this.options.editorAttrs&&this.options.editorAttrs.hidePanes?(this._hidePanes=this.options.editorAttrs.hidePanes,s.contains(this._hidePanes,h.Panes.FIXED)||this._tabPaneTabs.push(t),s.contains(this._hidePanes,h.Panes.FILE)||this._tabPaneTabs.push(i)):this._tabPaneTabs=[t,i];var n={tabPaneOptions:{template:o,tabPaneItemOptions:{tagName:"li",klassName:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this.model.get("image")&&this._tabPaneTabs.length>1&&(this._tabPaneTabs[1].selected=!0),this.listenTo(this.model,"change:image",this._updateImageTabPane),this.listenTo(this.model,"change:fixed",this._updateTextTabPane),this._tabPaneView=r(this._tabPaneTabs,n),this.addView(this._tabPaneView)},_updateTextTabPane:function _updateTextTabPane(){this._updateImageTabPane(),this._tabPaneView.collection.at(0).set("label",this.model.get("fixed"))},_updateImageTabPane:function _updateImageTabPane(){this.model.get("image")?this._tabPaneView.collection.at(1).set({label:this.model.get("image"),color:this.model.get("fixed")}):this._tabPaneView.collection.at(1).set("label",_t("form-components.editors.fill.input-color.img"))},_generateFixedContentView:function _generateFixedContentView(){var e=new a({value:this.model.get("fixed"),opacity:this.model.get("opacity"),disableOpacity:this._disableOpacity});return e.bind("change",this._onChangeValue,this),e},_generateFileContentView:function _generateFileContentView(){var e=new l({model:this.model,userModel:this._userModel,configModel:this._configModel,modals:this._modals});return e.bind("change",this._onChangeFile,this),e},_onChangeFile:function _onChangeFile(e){e&&e.url?this.model.set({image:e.url,kind:e.kind}):this.model.unset("image")},_onChangeValue:function _onChangeValue(e){this.model.set({fixed:e.hex,opacity:e.opacity})}})},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(321),r=i(320),a=i(2351),l=i(1008),h=i(56);e.exports=n.extend({initialize:function initialize(e){if(this.options.editorAttrs){var t=this.options.editorAttrs;if(t.hidePanes&&(this._hidePanes=t.hidePanes,!s.contains(this._hidePanes,h.Panes.BY_VALUE))){if(!e.configModel)throw new Error("configModel param is required");if(!e.userModel)throw new Error("userModel param is required");if(!e.modals)throw new Error("modals param is required");if(!e.query)throw new Error("query param is required")}t.categorizeColumns&&(this._categorizeColumns=!0),t.hideTabs&&(this._hideTabs=t.hideTabs),t.imageEnabled&&(this._imageEnabled=!0)}if(!e.columns)throw new Error("columns is required");this._columns=e.columns,this._configModel=e.configModel,this._userModel=e.userModel,this._modals=e.modals,this._query=e.query,this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function _initBinds(){this.model.on("change:fixed",this._onChangeFixed,this)},_onChangeFixed:function _onChangeFixed(){this.model.get("fixed")&&!this.model.get("range")||(this.model.unset("image",{silent:!0}),this.model.unset("images",{silent:!0}))},_initViews:function _initViews(){var e=this,t={name:"fixed",label:_t("form-components.editors.fill.input-color.solid"),createContentView:function createContentView(){return e._generateFixedContentView()}},i={name:"value",label:_t("form-components.editors.fill.input-color.value"),createContentView:function createContentView(){return e._generateValueContentView()}};this._tabPaneTabs=[],this._hidePanes?(s.contains(this._hidePanes,h.Panes.FIXED)||this._tabPaneTabs.push(t),s.contains(this._hidePanes,h.Panes.BY_VALUE)||this._tabPaneTabs.push(i)):this._tabPaneTabs=[t,i];var n={tabPaneOptions:{template:o,tabPaneItemOptions:{tagName:"li",klassName:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this.model.get("range")&&this._tabPaneTabs.length>1&&(this._tabPaneTabs[1].selected=!0),this._tabPaneView=r(this._tabPaneTabs,n),this._tabPaneView.collection.bind("change:selected",this._onChangeTabPaneViewTab,this),this.$el.append(this._tabPaneView.render().$el),this.addView(this._tabPaneView)},_onChangeTabPaneViewTab:function _onChangeTabPaneViewTab(){var e=this._tabPaneView.getSelectedTabPaneName();"fixed"===e&&(s.each(["domain","bins","attribute","quantification"],function(e){this.model.unset(e,{silent:!0})},this),this.model.get("fixed")||(this.model.get("range")?(this.model.set("fixed",this.model.get("range")[0]),this.model.unset("range")):this.model.set("fixed","#0303FF"))),this.trigger("change",e,this)},_generateFixedContentView:function _generateFixedContentView(){return new a({model:this.model,configModel:this._configModel,userModel:this._userModel,modals:this._modals,editorAttrs:this.options.editorAttrs})},_generateValueContentView:function _generateValueContentView(){return new l({model:this.model,columns:this._columns,configModel:this._configModel,categorizeColumns:this._categorizeColumns,imageEnabled:this._imageEnabled,userModel:this._userModel,modals:this._modals,hideTabs:this._hideTabs,query:this._query})}})},function(e,t,i){"use strict";var s=i(0),n=i(4),o=i(1),r=i(467),a=i(2352),l=i(7),h=i(2319),c=i(319),d=i(6),u=i(56);e.exports=o.extend({tagName:"section",className:"CDB-OptionInput-item",events:{click:"_onClick"},initialize:function initialize(e){if(this.options.editorAttrs){this._editorAttrs=this.options.editorAttrs,this._imageEnabled=this._editorAttrs.imageEnabled,this._help=this._editorAttrs.help;var t=this._editorAttrs.hidePanes;if(t&&!s.contains(t,u.Panes.BY_VALUE)){if(!e.configModel)throw new Error("configModel param is required");if(!e.userModel)throw new Error("userModel param is required");if(!e.modals)throw new Error("modals param is required");if(!e.query)throw new Error("query param is required")}}if(!e.columns)throw new Error("columns is required");this._columns=e.columns,this._configModel=e.configModel,this._userModel=e.userModel,this._modals=e.modals,this._query=e.query,this._initBinds()},render:function render(){this.clearSubViews(),this.$el.empty(),this.options.disabled&&this.$el.addClass("is-disabled");var e=this._getColumn(),t=e&&e.type,i=this.model.get("domain")&&this.model.get("domain").length;this.model.get("range")&&s.isString(this.model.get("range"))&&this._migrateRange();var n=this.model.get("range")&&this.model.get("range").length,o="string"===t||i&&n,a=this._getImageURL(),l=this._iconStylingEnabled()&&!this._getImageURL()&&this._categoryImagesPresent();return this.$el.html(r({categoryImagesPresent:l,imageURL:a,kind:this._getKind(),showCategories:o,value:this._getValue(),opacity:this._getOpacity(),help:this._help||""})),this._initViews(),this},_initViews:function _initViews(){if(this.iconView=new c({imageClass:"Editor-fillImageAsset",imageUrl:this._getImageURL(),color:this.model.get("fixed")}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el),this._help){var e=new d({el:this.$(".js-help"),gravity:"w",title:function title(){return n(this).data("tooltip")},offset:8});this.addView(e)}},_categoryImagesPresent:function _categoryImagesPresent(){var e=this.model.get("images");for(var t in e)if(!s.isEmpty(e[t]))return!0;return!1},_iconStylingEnabled:function _iconStylingEnabled(){return this._imageEnabled},_getKind:function _getKind(){return this.model.get("kind")&&this._iconStylingEnabled()?this.model.get("kind"):""},_getImageURL:function _getImageURL(){return this.model.get("image")&&this._iconStylingEnabled()?this.model.get("image"):""},_migrateRange:function _migrateRange(){var e=this.model.get("range"),t=this.model.get("bins")||3;h[e]&&h[e][t]&&this.model.set("range",h[e][t])},_getColumn:function _getColumn(){return s.find(this._columns,function(e){return e.label===this.model.get("attribute")},this)},_createContentView:function _createContentView(){var e=new a({configModel:this._configModel,userModel:this._userModel,modals:this._modals,query:this._query,model:this.model,columns:this._columns,editorAttrs:this._editorAttrs});return e.bind("change",this.render,this),e},_onClick:function _onClick(e){this.options.disabled||this.trigger("click",this.model)},_initBinds:function _initBinds(){var e=this;this.model.set("createContentView",function(){return e._createContentView()}).bind(this),this.model.on("change:images",this.render,this),this.model.on("change:selected",this._onToggleSelected,this),this.model.on("change:opacity",this.render,this),this.model.on("change:fixed",this.render,this),this.model.on("change:fixed",this._updateColor,this),this.model.on("change:image",this.render,this),this.model.on("change:range",this.render,this)},_updateColor:function _updateColor(){this.iconView&&this.iconView.updateImageColor(this.model.get("fixed"))},_getValue:function _getValue(){var e=this.model.get("fixed");return e&&(e=l.hexToRGBA(e,this._getOpacity())),this.model.get("range")&&this.model.get("range").length&&(e=s.map(this.model.get("range"),function(e){return l.hexToRGBA(e,this._getOpacity())},this)),e},_getOpacity:function _getOpacity(){return null!=this.model.get("opacity")?this.model.get("opacity"):1},_onToggleSelected:function _onToggleSelected(){this.$el.toggleClass("is-active",this.model.get("selected"))}})},function(e,t,i){"use strict";var s=i(2),n=i(1),o=i(468);e.exports=n.extend({events:{"click .js-back":"_onClickBack","click .js-bins":"_onClickBins","click .js-quantification":"_onClickQuantification"},render:function render(){return this.clearSubViews(),this._removeForm(),this.$el.empty(),this.$el.append(o({bins:this.model.get("bins"),attribute:this.model.get("attribute"),quantification:this.model.get("quantification")})),this._initForm(),this},_calculateRangeFromFixed:function _calculateRangeFromFixed(e,t){t=t||30;var i=e/(this.options.max-this.options.min);return[Math.floor(Math.max(this.options.min,e-t*i)),Math.floor(Math.min(this.options.max,e+t*i))]},_initForm:function _initForm(){this._formView&&this._formView.remove();var e,t,i=this.model.get("range");if(e=t=this.model.get("fixed"),i&&(e=+i[0],t=+i[1]),e===t){var n=this._calculateRangeFromFixed(e);e=n[0],t=n[1],this.model.set("range",n)}this._formModel=new s.Model({min:e,max:t}),this._formModel.schema={min:{type:"Number",validators:["required",{type:"interval",min:this.options.min,max:this.options.max}]},max:{type:"Number",validators:["required",{type:"interval",min:this.options.min,max:this.options.max}]}},this._formModel.bind("change",function(e){this.model.set("range",[+e.get("min"),+e.get("max")])},this),this._formView=new s.Form({className:"Editor-boxList",model:this._formModel}),this._formView.bind("change",function(){this.commit()}),this.$(".js-content").append(this._formView.render().$el)},_removeForm:function _removeForm(){this._formView&&this._formView.remove()},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onClickQuantification:function _onClickQuantification(e){this.killEvent(e),this.trigger("selectQuantification",this)},_onClickBins:function _onClickBins(e){this.killEvent(e),this.trigger("selectBins",this)},clean:function clean(){this._removeForm(),n.prototype.clean.call(this)}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({defaults:{position:0},initialize:function initialize(e,t){this.stackLayoutItems=t.stackLayoutItems},goToStep:function goToStep(e){if(e>=this.stackLayoutItems.size())throw new Error("There is no "+e+" stack view in the collection");this.set({position:e},{silent:!0}),this._rememberStep.apply(this,arguments),this._triggerPositionChanged(e,Array.prototype.slice.call(arguments,1))},nextStep:function nextStep(){var e=this.get("position"),t=++e;this.goToStep.apply(this,Array.prototype.concat.apply([t],arguments))},prevStep:function prevStep(){var e=this.get("position"),t=--e;this.goToStep.apply(this,Array.prototype.concat.apply([t],arguments))},goBack:function goBack(){this._goBackToArguments&&this.goToStep.apply(this,this._goBackToArguments)},_triggerPositionChanged:function _triggerPositionChanged(e,t){this.trigger("positionChanged",e,Array.prototype.slice.call(t))},_rememberStep:function _rememberStep(){this._goBackToArguments=this._lastStepArguments||[0],this._lastStepArguments=arguments}})},function(e,t,i){"use strict";var s=i(2),n=i(1),o=i(222),r=i(470),a=i(283),l=i(2354),h=i(56);e.exports=n.extend({events:{"click .js-back":"_onClickBack"},initialize:function initialize(e){if(!e.columns)throw new Error("columns param is required");this._columns=e.columns,this._settings=h.Settings.NUMBER,this._setupModel()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_setupModel:function _setupModel(){var e={};this.model.get("quantification")||(e.quantification=this._settings.quantifications.items[this._settings.quantifications.defaultIndex]),this.model.get("bins")||(e.bins=this._settings.bins.items[this._settings.bins.defaultIndex]),+this.model.get("bins")>+this._settings.bins.items[this._settings.bins.items.length-1]&&(e.bins=this._settings.bins.items[this._settings.bins.items.length-1]),this.model.set(e)},_initViews:function _initViews(){var e=this,t=new s.Collection([{createStackView:function createStackView(t,i){return e._createInputRampContentView(t,i).bind(e)}},{createStackView:function createStackView(t,i){return e._createInputNumberContentView(t,i).bind(e)}},{createStackView:function createStackView(t,i){return e._createQuantificationListView(t,i).bind(e)}},{createStackView:function createStackView(t,i){return e._createBinsListView(t,i).bind(e)}}]);this._stackLayoutView=new o({collection:t});var i=1;this.model.get("attribute")?this.model.get("quantification")||(i=2):i=0,this._stackLayoutView.model.set("position",i),this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_createInputRampContentView:function _createInputRampContentView(e,t){var i=new r({stackLayoutModel:e,columns:this._columns.filter(function(e){return"number"===e.type}),showSearch:!0,typeLabel:"column"});return i.bind("selectItem",function(e){this.model.set("attribute",e.get("val"));var t=1;this.model.get("quantification")||(t=2),this._stackLayoutView.model.goToStep(t)},this),i},_createInputNumberContentView:function _createInputNumberContentView(e,t){var i=new l({stackLayoutModel:e,model:this.model,min:this.options.min,max:this.options.max});return i.bind("back",function(t){e.prevStep()},this),i.bind("selectQuantification",function(t){e.goToStep(2)},this),i.bind("selectBins",function(t){e.goToStep(3)},this),i},_createQuantificationListView:function _createQuantificationListView(e,t){var i=new r({headerTitle:_t("form-components.editors.fill.quantification.title"),stackLayoutModel:e,columns:this._settings.quantifications.items,itemTemplate:a,showSearch:!1});return i.bind("selectItem",function(t){this.model.set("quantification",t.get("val")),e.prevStep()},this),i.bind("back",function(t){e.prevStep()},this),i},_createBinsListView:function _createBinsListView(e,t){var i=new r({headerTitle:_t("form-components.editors.fill.bins"),stackLayoutModel:e,columns:this._settings.bins.items});return i.bind("selectItem",function(t){this.model.set("bins",t.get("val")),e.goToStep(1)},this),i.bind("back",function(t){e.goToStep(1)},this),i},_onClickBack:function _onClickBack(e){this.killEvent(e)}})},function(e,t,i){"use strict";var s=i(2),n=i(1);e.exports=n.extend({render:function render(){return this.clearSubViews(),this._removeForm(),this.$el.empty(),this._initForm(),this},_initForm:function _initForm(){this._formModel=new s.Model({value:this.model.get("fixed")}),this._formModel.schema={value:{type:"Number",validators:["required",{type:"interval",min:this.options.min,max:this.options.max,step:this.options.step}]}},this._formModel.bind("change",function(e){this.model.set("fixed",e.get("value"))},this),this._formView=new s.Form({className:"CDB-ListDecoration-itemPadding",model:this._formModel}),this._formView.bind("change",function(){this.commit()}),this.$el.append(this._formView.render().$el)},_removeForm:function _removeForm(){this._formView&&this._formView.remove()},clean:function clean(){this._removeForm(),n.prototype.clean.call(this)}})},function(e,t,i){"use strict";var s=i(0),n=i(1),o=i(321),r=i(320),a=i(2357),l=i(2356),h=i(56);e.exports=n.extend({initialize:function initialize(e){if(!e.columns)throw new Error("columns param is required");this._columns=e.columns,this.listenTo(this.model,"change:attribute",this._updateRangeValue)},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function _initViews(){var e=this,t={name:"fixed",label:_t("form-components.editors.fill.input-number.fixed"),createContentView:function createContentView(){return e._generateFixedContentView()}},i={name:"value",label:_t("form-components.editors.fill.input-number.by-value"),createContentView:function createContentView(){return e._generateValueContentView()}};if(this._tabPaneTabs=[],this.options.editorAttrs&&this.options.editorAttrs.hidePanes){var n=this.options.editorAttrs.hidePanes;s.contains(n,h.Panes.FIXED)||this._tabPaneTabs.push(t),s.contains(n,h.Panes.BY_VALUE)||this._tabPaneTabs.push(i)}else this._tabPaneTabs=[t,i];var a={tabPaneOptions:{template:o,tabPaneItemOptions:{tagName:"li",klassName:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this.model.get("range")&&this._tabPaneTabs.length>1&&(this._tabPaneTabs[1].selected=!0),this._tabPaneView=r(this._tabPaneTabs,a),this.listenTo(this._tabPaneView.collection,"change:selected",this._onChangeTabPaneViewTab),this.addView(this._tabPaneView),this.$el.append(this._tabPaneView.render().$el)},_onChangeTabPaneViewTab:function _onChangeTabPaneViewTab(){var e=this._tabPaneView.getSelectedTabPaneName();"fixed"===e?this._updateFixedValue():this._updateRangeValue(),this.trigger("change",e,this)},_updateFixedValue:function _updateFixedValue(){if(this.model.get("range")){var e=this.model.get("range"),t=.5*(+e[0]+ +e[1]);this.model.set("fixed",t),this.model.unset("range")}},_updateRangeValue:function _updateRangeValue(){if(null!==this.model.get("fixed")&&void 0!==this.model.get("fixed")&&this.model.get("attribute")){var e=this.options.editorAttrs,t=e&&e.defaultRange||[this.model.get("fixed"),this.model.get("fixed")];this.model.set("range",t),this.model.unset("fixed")}},_generateFixedContentView:function _generateFixedContentView(){var e=this.options.editorAttrs;return new a({model:this.model,min:e&&e.min||0,max:e&&e.max||100,step:e&&e.step||1})},_generateValueContentView:function _generateValueContentView(){var e=this.options.editorAttrs;return new l({model:this.model,columns:this._columns,min:e&&e.min||0,max:e&&e.max||100})},_onChangeValue:function _onChangeValue(e){this.model.set("fixed",e.value)}})},function(e,t,i){"use strict";var s=i(4),n=i(1),o=i(472),r=i(2358),a=i(6);e.exports=n.extend({tagName:"li",className:"CDB-OptionInput-item",events:{click:"_onClick"},initialize:function initialize(e){if(!e.columns)throw new Error("columns is required");this._columns=e.columns,this.options.editorAttrs&&this.options.editorAttrs.help&&(this._help=this.options.editorAttrs.help),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.options.disabled&&this.$el.addClass("is-disabled"),this.$el.html(o({help:this._help||"",value:this._getValue()})),this._initViews(),this},_initViews:function _initViews(){if(this._help){var e=new a({el:this.$(".js-help"),gravity:"w",title:function title(){return s(this).data("tooltip")}});this.addView(e)}},_createContentView:function _createContentView(){var e=new r({model:this.model,columns:this._columns,editorAttrs:this.options.editorAttrs});return e.bind("change",this.render,this),e},_onClick:function _onClick(e){this.options.disabled||this.trigger("click",this.model)},_initBinds:function _initBinds(){this.model.set("createContentView",function(){return this._createContentView()}.bind(this)),this.listenTo(this.model,"change:selected",this._onToggleSelected),this.listenTo(this.model,"change:fixed",this._onChangeValue),this.listenTo(this.model,"change:range",this._onChangeValue)},_getValue:function _getValue(){function dropDecimal(e){return e.replace(/\.0$/,"")}return this.model.get("range")?this.model.get("range").map(function(e){return dropDecimal((+e).toFixed(1))}).join(".."):dropDecimal((+this.model.get("fixed")).toFixed(1))},_onChangeValue:function _onChangeValue(){this.$(".js-value").text(this._getValue())},_onToggleSelected:function _onToggleSelected(){this.$el.toggleClass("is-active",this.model.get("selected"))}})},function(e,t,i){"use strict";var s=i(2),n=i(0),o=["size","color"];e.exports=s.Collection.extend({constructor:function constructor(e,t){t=n.extend(t||{},{silent:!1}),s.Collection.prototype.constructor.call(this,e,t)},comparator:function comparator(e){return o.indexOf(e.get("type"))},initialize:function initialize(){this.bind("change:selected",this._onSelectedChange,this),this.bind("change",this._onModelsChanged,this)},getSelected:function getSelected(){return this.find(function(e){return e.get("selected")})},unselect:function unselect(){this.each(function(e){e.set("selected",!1)},this)},_onSelectedChange:function _onSelectedChange(e,t){t&&this.each(function(t){t!==e&&t.set("selected",!1)},this)},_onModelsChanged:function _onModelsChanged(e){var t=e.changed;n.isEmpty(t)||1===n.size(t)&&e.changed.hasOwnProperty("selected")||this.trigger("inputChanged",e,this)},getValues:function getValues(){return this.reduce(function(e,t){var i={},s=t.toJSON();return s.fixed?(i.fixed=s.fixed,"color"===s.type&&(s.image&&(i.image=s.image),s.kind&&(i.kind=s.kind),i.opacity=s.opacity)):i=n.omit(s,["createContentView","selected","type"]),e[s.type]=i,e},{})}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(57),r=i(600),a=i(599),l=i(8),h=i(2360),c=i(2359),d=i(2353),u=i(350),p=i(246),g={size:c,color:d,image:d},m={Jenks:"jenks","Equal Interval":"equal","Heads/Tails":"headtails",Quantile:"quantiles"};n.Form.editors.Fill=n.Form.editors.Base.extend({className:"Form-InputFill CDB-OptionInput CDB-Text js-input",events:{focus:function focus(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},initialize:function initialize(e){n.Form.editors.Base.prototype.initialize.call(this,e),o.setOptions(this,e),this.options=s.extend(this.options,{columns:this.options.options,query:this.options.query,configModel:this.options.configModel,userModel:this.options.userModel,editorAttrs:this.options.editorAttrs,modals:this.options.modals}),this._keyAttr=e.key,this.dialogMode=this.options.dialogMode||l.Mode.DEFAULT,this._initBinds(),this._initViews()},_initViews:function _initViews(){this.$el.append(u()),this.options.editorAttrs&&this.options.editorAttrs.disabled&&this.$el.addClass("is-disabled"),this._initFillDialog(),this._initInputFields(),this._popupManager=new p(this.cid,this.$el,this._dialogView.$el)},_initInputFields:function _initInputFields(){var e;this._inputCollection=new h,s.each(this.model.get(this._keyAttr),function(e,t){this._inputCollection.add(s.extend({type:t},e))},this),this._inputCollection.each(function(t){var i=t.get("type"),s=g[i];if(!s)throw new Error(i+" is not a valid type of constructor");t.get("quantification")&&m[t.get("quantification")]&&t.set("quantification",m[t.get("quantification")],{silent:!0}),(e=new s({model:t,columns:this.options.columns,query:this.options.query,configModel:this.options.configModel,userModel:this.options.userModel,modals:this.options.modals,editorAttrs:this.options.editorAttrs?this.options.editorAttrs[i]:{},disabled:this.options.editorAttrs&&this.options.editorAttrs.disabled})).bind("click",this._onInputClick,this),this.$(".js-content").append(e.render().$el)},this),this._inputCollection.bind("inputChanged",this._onInputChanged,this)},_initBinds:function _initBinds(){this.applyESCBind(function(){this._removeDialog()}),this.applyClickOutsideBind(function(){this._removeDialog()})},_onInputClick:function _onInputClick(e){e.get("selected")?this._removeDialog():(e.set("selected",!0),this._dialogView.model.set("createContentView",e.get("createContentView")),this._dialogView.render(),this._dialogView.show(),this._popupManager.append(this.dialogMode),this._popupManager.track())},_onInputChanged:function _onInputChanged(e){this._adjustImageSize(e),this.trigger("change",this)},_adjustImageSize:function _adjustImageSize(e){if("color"===e.get("type")||"marker"===e.get("kind")){var t=this._inputCollection.findWhere({type:"size"});if(!e.get("image")&&e.hasChanged("image")&&e.previous("image"))t.set("fixed",7);else if(e.get("images")||!e.hasChanged("images")){var i=e.get("image")&&e.hasChanged("image")&&!e.previous("image"),n=s.isEmpty(s.compact(e.get("images"))),o=s.isEmpty(s.compact(e.previous("images"))),r=!n&&e.hasChanged("images")&&o;(i||r)&&t&&t.get("fixed")<20&&t.set("fixed",20)}else t.set("fixed",7)}},_initFillDialog:function _initFillDialog(){var e=new r;this.listenToOnce(e,"destroy",function(){this._dialogView=null,this.stopListening(e)}),this._dialogView=new a({model:e})},_removeDialog:function _removeDialog(e){this._inputCollection.unselect(),this._dialogView.clean(),this._popupManager.untrack()},focus:function focus(){this.hasFocus||this.$(".js-fillInput").focus()},blur:function blur(){this.hasFocus&&this.$(".js-fillInput").blur()},getValue:function getValue(){return this._inputCollection.getValues()},setValue:function setValue(e){},remove:function remove(){this._removeDialog(),this._popupManager.destroy(),this._inputCollection.unbind("inputChanged",this._onInputChanged,this),n.Form.editors.Base.prototype.remove.apply(this)}})},function(e,t,i){"use strict";var s=i(4),n=i(0),o=i(2),r=i(57),a=i(473),l=window.MutationObserver,h="lowest";o.Form.editors.Slider=o.Form.editors.Base.extend({className:"rangeslider--no-fill",options:{direction:"horizontal",initial:h},events:{"change .js-slider":"_onValueChange",focus:function focus(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},initialize:function initialize(e){if(o.Form.editors.Base.prototype.initialize.call(this,e),r.setOptions(this,e),!this.options.labels)throw new Error("labels is required");if(this.options.values&&this.options.labels.length!==this.options.values.length)throw new Error("values and labels should have the same length");void 0!==this.options.value&&(this.value=this.options.value),this._onValueChange=this._onValueChange.bind(this),this._onSlideChange=this._onSlideChange.bind(this),this._values=this.options.values,this._labels=this.options.labels,this._getInitialTickID(),this._updateUI()},render:function render(){var e=this.options.disabled||this._labels.length<=0,t=0===this._labels.length?4:this._labels.length-1,i=this._getStepPercentage();return this.$el.html(a({orientation:this.options.direction,disabled:e,min:0,max:t,value:this.rangeIndex})),this._renderSlider(),this._addTicks(i),this._updateUI(),this},_getInitialTickID:function _getInitialTickID(){var e=this.value;this._values&&this._values.length>0?-1===(e=this._values.indexOf(this.value))&&(e=this.options.initial===h?0:this._values.length-1):this.value||(e=0),this.rangeIndex=e},_getNumberOfValues:function _getNumberOfValues(){return this._values&&this._values.length||0},_renderSlider:function _renderSlider(){var e,t,i,s;l?(e=document.body,t=this.$(".js-slider").get(0),i=function(){e.contains(t)&&(this._initializeSlider(),s.disconnect())}.bind(this),s=new l(i),i(),s.observe(e,{subtree:!0,childList:!0})):this._initializeSlider()},_initializeSlider:function _initializeSlider(){var e=this._getNumberOfValues(),t=function(){this.$(".js-slider").rangeslider({polyfill:!1,fillClass:"rangesliderFill",handleClass:"rangesliderHandle",onSlideEnd:this._onSlideChange})}.bind(this);1!==e&&(l?t():setTimeout(t,0)),this.$(".js-slider").toggle(1!==e)},_updateUI:function _updateUI(){this._updateLabel(this.rangeIndex),this._highlightTick(this.rangeIndex)},_addTicks:function _addTicks(e){var t=this._getNumberOfValues(),i=this._labels.length>0?this._labels.length:5;n.each(n.range(i),function(t,i){s('<div class="rangeslider-tick js-tick"></div>').css("left",e*i+6+"px").appendTo(this.$(".js-ticks"))},this),this.$(".js-ticks").toggle(1!==t)},_highlightTick:function _highlightTick(e){this.$(".js-tick").removeClass("is-highlighted"),s(this.$(".js-tick").get(e)).addClass("is-highlighted")},_updateLabel:function _updateLabel(e){var t=this._labels[e];this._labels.length<=0&&(t=_t("form-components.editors.slide.no-values")),this.$(".js-label").text(t)},_getStepPercentage:function _getStepPercentage(){return 148/this._getSteps()},_getSteps:function _getSteps(){var e=this._labels.length-1;return e<0&&(e=4),e},_onValueChange:function _onValueChange(e){var t=this.$(".js-slider").val();this._onSlideChange(null,t)},_onSlideChange:function _onSlideChange(e,t){this.rangeIndex=+t,this.value=this._values&&this._values.length>0?this._values[this.rangeIndex]:this.rangeIndex,this._updateUI(this.rangeIndex),this.trigger("change",this)},getValue:function getValue(){var e=this._values&&this._values.length>0?this._values[this.rangeIndex]:null;return this.value||e},setValue:function setValue(e){var t=this._values?this._values.indexOf(e):e;this.$(".js-slider").val(t).change(),this.value=e},_destroySlider:function _destroySlider(){this.$(".js-slider").off("change",this._onValueChange),this.$(".js-slider").rangeslider("destroy")},remove:function remove(){this._destroySlider(),o.Form.editors.Base.prototype.remove.apply(this)},clean:function clean(){this.$el.remove()}})},function(e,t,i){"use strict";var s=i(2),n=i(57);s.Form.editors.List.CategoryModel=s.Form.editors.NestedModel.extend({initialize:function initialize(e){if(s.Form.editors.Base.prototype.initialize.call(this,e),n.setOptions(this,e),!this.form)throw new Error('Missing required option "form"');if(!e.schema.model)throw new Error('Missing required "schema.model" option for NestedModel editor')},render:function render(){var e=this.form.constructor,t=this.value||{},i=this.schema.model,s=t.constructor===i?t:new i(t,this.options);return this.nestedForm=new e({model:s,idPrefix:this.cid+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this}})},function(e,t,i){"use strict";var s=i(2),n=i(0);i(234),s.Form.editors.SortableList=s.Form.editors.List.extend({initialize:function initialize(){s.Form.editors.List.prototype.initialize.apply(this,arguments)},render:function render(){return s.Form.editors.List.prototype.render.apply(this,arguments),this._initSortable(),this},addItem:function addItem(){return s.Form.editors.List.prototype.addItem.apply(this,arguments),this._updateEditability(),this},removeItem:function removeItem(){return s.Form.editors.List.prototype.removeItem.apply(this,arguments),this._updateEditability(),this},_initSortable:function _initSortable(){this.$list.sortable({axis:"y",items:".js-sortable",tolerance:"pointer",containment:this.$list,forceHelperSize:!0,forcePlaceholderSize:!0,update:this._onSortableUpdate.bind(this)})},_onSortableUpdate:function _onSortableUpdate(e,t){var i=[];n.each(this.items,function(e){var t=e.$el.index(this.$list);i[t]=e}),this.items=i,this.commit()},_updateEditability:function _updateEditability(){this.items.length>1?(this.$(".js-sortable").addClass("is-movable"),this.$(".js-editable").removeClass("is-hidden")):(this.$(".js-sortable").removeClass("is-movable"),this.$(".js-editable").addClass("is-hidden"))}})},function(e,t,i){"use strict";var s=i(2),n=i(4),o=i(0),r=i(57),a=i(6);s.Form.editors.List.Item=s.Form.editors.Base.extend({events:{'click [data-action="remove"]':function clickDataActionRemove(e){e.preventDefault(),this.list.removeItem(this)},"keydown input[type=text]":function keydownInputTypeText(e){13===e.keyCode&&(e.preventDefault(),this.list.addItem(null,!0),this.list.$list.find("input:last").focus())}},initialize:function initialize(e){r.setOptions(this,e),this.list=e.list,this.schema=e.schema||this.list.schema,this.Editor=e.Editor||s.Form.editors.Text,this.template=e.template||this.schema.itemTemplate||this.constructor.template,this.errorClassName=e.errorClassName||this.constructor.errorClassName},render:function render(){this.editor=new this.Editor({key:this.options.key,schema:this.schema,value:this.options.value,list:this.options.list,item:this,form:this.options.form,trackingClass:this.options.trackingClass},{userModel:this.options.userModel,configModel:this.options.configModel,modals:this.options.modals}).render();var e=n(n.trim(this.template()));e.find("[data-editor]").append(this.editor.el);var t=e.find(".js-remove-help");return t.length&&(this._removeTooltip(),this._tooltip=new a({el:t,gravity:"w",title:function title(){return _t("editor.legend.tooltips.item.remove")}})),this.setElement(e),this},getValue:function getValue(){return this.editor.getValue()},setValue:function setValue(e){this.editor.setValue(e)},focus:function focus(){this.editor.focus()},blur:function blur(){this.editor.blur()},validate:function validate(){var e=this.getValue(),t=this.list.form?this.list.form.getValue():{},i=this.schema.validators,s=this.getValidator;if(!i)return null;var n=null;return o.every(i,function(i){return!!(n=s(i)(e,t))}),n?this.setError(n):this.clearError(),n||null},setError:function setError(e){this.$el.addClass(this.errorClassName),this.$el.attr("title",e.message)},clearError:function clearError(){this.$el.removeClass(this.errorClassName),this.$el.attr("title",null)},_removeTooltip:function _removeTooltip(){this._tooltip&&this._tooltip.clean()},remove:function remove(){this._removeTooltip(),this.editor.remove(),s.Form.editors.Base.prototype.remove.apply(this)},clean:function clean(){this.$el.remove()}},{template:o.template('      <div>        <span data-editor></span>        <button type="button" data-action="remove">&times;</button>      </div>    ',null,s.Form.templateSettings),errorClassName:"error"})},function(e,t,i){"use strict";var s=i(4),n=i(0),o=i(2),r=i(57),a=i(6),l=["userModel","configModel","modals","layerDefinitionModel","trackingClass"];o.Form.editors.List=o.Form.editors.Base.extend({events:{'click [data-action="add"]':function clickDataActionAdd(e){e.preventDefault(),this._canAddNewItems()&&this.addItem(null,!0)}},initialize:function initialize(e){e=e||{};var t=o.Form.editors;t.Base.prototype.initialize.call(this,e),r.setOptions(this,e);var i=this.schema;if(!i)throw new Error("Missing required option 'schema'");this.template=e.template||i.listTemplate||this.constructor.template,this.Editor=function(){var e=i.itemType;return e?t.List[e]?t.List[e]:t[e]:t.Text}(),n.each(l,function(e){this.options[e]&&(this["_"+e]=this.options[e])},this),this.items=[],this.errors=[],this._initBinds()},render:function render(){var e=this,t=this.value||[],i=s(s.trim(this.template()));return this.$list=i.is("[data-items]")?i:i.find("[data-items]"),this.setElement(i),this.$el.attr("id",this.id),this.$el.attr("name",this.key),t.length?n.each(t,function(t){e.addItem(t)}):this.Editor.isAsync||this.addItem(null,!0),this.hasFocus&&this.trigger("blur",this),this.validate(),this},_initBinds:function _initBinds(){this.options.maxItems&&this.listenTo(this,"add remove",this._setAddButtonState)},addItem:function addItem(e,t){var i=this,s=o.Form.editors,r={list:this,form:this.form,schema:this.schema,value:e,Editor:this.Editor,key:this.key},a=n.reduce(l,function(e,t){return this.options[t]&&(e[t]=this["_"+t]),e},{},this),h=n.extend({},r,a),c=new s.List.Item(h).render(),d=function _addItem(){i.items.push(c),i.$list.append(c.el),c.editor.on("all",function(e){if("change"!==e){var t=n.toArray(arguments);t[0]="item:"+e,t.splice(1,0,i),s.List.prototype.trigger.apply(this,t)}},i),c.editor.on("change",function(){c.addEventTriggered||(c.addEventTriggered=!0,this.trigger("add",this,c.editor)),this.trigger("item:change",this,c.editor),this.trigger("change",this)},i),c.editor.on("focus",function(){this.hasFocus||this.trigger("focus",this)},i),c.editor.on("blur",function(){if(this.hasFocus){var e=this;setTimeout(function(){n.find(e.items,function(e){return e.editor.hasFocus})||e.trigger("blur",e)},0)}},i),(t||e)&&(c.addEventTriggered=!0),t&&(i.trigger("add",i,c.editor),i.trigger("change",i))};return this.Editor.isAsync?c.editor.on("readyToAdd",d,this):(d(),c.editor.focus()),c},removeItem:function removeItem(e){var t=this.schema.confirmDelete;if(!t||confirm(t)){var i=n.indexOf(this.items,e);this.items[i].remove(),this.items.splice(i,1),e.addEventTriggered&&(this.trigger("remove",this,e.editor),this.trigger("change",this)),this.items.length||this.Editor.isAsync||this.addItem()}},getValue:function getValue(){var e=n.map(this.items,function(e){return e.getValue()});return n.without(e,void 0,"")},setValue:function setValue(e){this.value=e,this.render()},focus:function focus(){this.hasFocus||this.items[0]&&this.items[0].editor.focus()},blur:function blur(){if(this.hasFocus){var e=n.find(this.items,function(e){return e.editor.hasFocus});e&&e.editor.blur()}},remove:function remove(){n.invoke(this.items,"remove"),o.Form.editors.Base.prototype.remove.call(this)},validate:function validate(){if(!this.validators)return null;var e=n.map(this.items,function(e){return e.validate()});this.options.maxItems&&this.options.maxItems<this.items.length&&e.push(_t("form-components.editors.list.max-items")),this.errors=n.compact(e);var t=!!this.errors.length;return this._setAddButtonState(),t?void 0:null},_errorPresenter:function _errorPresenter(e){return n.unique(this.errors.map(function(e){return e.message})).join("\n")},_setAddButtonState:function _setAddButtonState(){var e=this._getAddButtonElement(),t=!!this.errors.length;e.toggleClass("is-disabled",t),t?this._errorTooltip=new a({el:e,gravity:"s",offset:0,title:this._errorPresenter.bind(this)}):this._errorTooltip&&(this._errorTooltip.clean(),this._errorTooltip=null),this.options.maxItems&&e.toggle(this.items.length<this.options.maxItems)},_getAddButtonElement:function _getAddButtonElement(){return this.$('[data-action="add"]')},_canAddNewItems:function _canAddNewItems(){var e=this.options,t=e.maxItems&&e.maxItems<=this.items.length||!1;return!this.errors.length&&!t}},{template:n.template('      <div>        <div data-items></div>        <button type="button" data-action="add">Add</button>      </div>    ',null,o.Form.templateSettings)})},function(e,t,i){"use strict";var s=i(174),n=i(0);e.exports=s.extend({search:function search(e){return e=e.toLowerCase(),n(this.filter(function(t){var i=t.getName().toLowerCase(),s=t.get("type").toLowerCase();return~i.indexOf(e)&&"number"===s}))}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({defaults:{visible:!1,operator:"count",attribute:""},isValidOperator:function isValidOperator(){var e=this.get("operator"),t=this.get("attribute");return"count"===e||!(!e||!t)}})},function(e,t,i){"use strict";var s=i(1),n=i(0),o=i(4),r=i(223),a=i(353),l=i(2368),h=i(476),c=i(475);e.exports=s.extend({className:"Editor-dropdown Editor-boxModal Editor-dropdownOperators",tagName:"div",events:{'change input[name="operator"]':"_onOperationChange"},initialize:function initialize(e){this.model=new l({operator:e.operator,attribute:e.attribute,visible:!1}),e.attribute&&this.collection.setSelected(e.attribute),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.append(c({operator:this.model.get("operator")})),this._renderList(),this._dropdownOverlay=new a({onClickAction:this.hide.bind(this),visible:this.model.get("visible")}),this.addView(this._dropdownOverlay),this},_initBinds:function _initBinds(){this.model.bind("change:operator change:attribute",n.debounce(this._onModelChange.bind(this),10)),this.model.bind("change:visible",function(e,t){this._toggleVisibility(),t?this.render():(this._destroyList(),this.$(".js-list").html(h()))},this),this.collection.bind("change:selected",this._onAttributeSelected,this),this.add_related_model(this.collection)},_hasList:function _hasList(){return!!this._listView},_renderList:function _renderList(){if("count"!==this.model.get("operator")){if(this._hasList())return;this._listView=new r({className:"CDB-Dropdown-options CDB-Text CDB-Size-medium",collection:this.collection,showSearch:!0,typeLabel:this.options.keyAttr}),this.$(".js-list").html(this._listView.render().el)}else this._destroyList(),this.$(".js-list").html(h())},_destroyList:function _destroyList(){this._hasList()&&(this.removeView(this._listView),this._listView.clean(),delete this._listView)},_onModelChange:function _onModelChange(){this.model.isValidOperator()&&this.trigger("change",this.model.toJSON(),this)},_onOperationChange:function _onOperationChange(e){var t=o(e.target).val();"count"===t&&(this.model.set("attribute",""),this.collection.removeSelected()),this.model.set("operator",t),this._renderList()},_onAttributeSelected:function _onAttributeSelected(e){e.get("selected")&&this.model.set("attribute",e.getValue())},_toggleVisibility:function _toggleVisibility(){this.$el.toggleClass("is-visible",!!this.model.get("visible"))},show:function show(){this.model.set("visible",!0)},hide:function hide(){this.model.set("visible",!1)},toggle:function toggle(){this.model.set("visible",!this.model.get("visible"))},isVisible:function isVisible(){return this.model.get("visible")},remove:function remove(){this._destroyList(),this.$el.empty(),s.prototype.remove.call(this)}})},function(e,t,i){"use strict";var s=i(2),n=i(57),o=i(0),r=i(4),a=i(2369),l=i(2367),h=i(474),c=i(246),d=i(8),u=i(6);s.Form.editors.Operators=s.Form.editors.Base.extend({tagName:"div",className:"Editor-formSelect u-ellipsis",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function focusJsButton(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},initialize:function initialize(e){s.Form.editors.Base.prototype.initialize.call(this,e),n.setOptions(this,e),this.collection=new l(this.options.options),this.dialogMode=this.options.dialogMode||d.Mode.DEFAULT,this.options.editorAttrs&&this.options.editorAttrs.help&&(this._help=this.options.editorAttrs.help),this._initViews(),this.setValue(this.model.get(this.options.keyAttr)),this._initBinds()},_initViews:function _initViews(){var e=this.model.get(this.options.keyAttr);this.$el.append(r("<div>").addClass("js-operator")),this._setOperatorTemplate(),this._operatorsListView=new a({operator:e.operator,attribute:e.attribute,collection:this.collection}),this._operatorsListView.bind("change",this._onOperatorsChange,this),this._popupManager=new c(this.cid,this.$el,this._operatorsListView.$el),this._popupManager.append(this.dialogMode),this.options.disabled&&this.undelegateEvents()},_setOperatorTemplate:function _setOperatorTemplate(){this.$(".js-operator").html(h({name:this._getOperatorsTextValue(),disabled:this.options.disabled,keyAttr:this.options.keyAttr,help:this._help||""})),this._help&&(this._removeTooltip(),this._helpTooltip=new u({el:this.$(".js-help"),gravity:"w",title:function title(){return r(this).data("tooltip")}}))},_initBinds:function _initBinds(){var e=function(){this._operatorsListView.hide(),this._popupManager.untrack()}.bind(this);this.applyESCBind(e),this.applyClickOutsideBind(e)},_onOperatorsChange:function _onOperatorsChange(e){this.model.set(this.options.keyAttr,e),this._setOperatorTemplate(),this.$(".js-button").focus(),this.trigger("change",this)},_getOperatorsTextValue:function _getOperatorsTextValue(){var e=this.model.get(this.options.keyAttr);return e&&e.operator?e.operator.toUpperCase()+(e.attribute?"("+e.attribute+")":""):""},_onButtonClick:function _onButtonClick(e){this._operatorsListView.toggle(),this._operatorsListView.isVisible()?this._popupManager.track():this._popupManager.untrack()},_onButtonKeyDown:function _onButtonKeyDown(e){13===e.which&&(e.preventDefault(),this._operatorsListView.isVisible()?this._popupManager.untrack():(e.stopPropagation(),this._operatorsListView.toggle(),this._popupManager.track()))},getValue:function getValue(){var e=this.model.get(this.options.keyAttr);return o.omit(e,"visible")},setValue:function setValue(e){var t=this._getOperatorsTextValue();this.value=t,this._setOperatorTemplate()},_removeTooltip:function _removeTooltip(){this._helpTooltip&&this._helpTooltip.clean()},remove:function remove(){this._removeTooltip(),this._popupManager&&this._popupManager.destroy(),this._operatorsListView&&this._operatorsListView.clean(),s.Form.editors.Base.prototype.remove.call(this)},clean:function clean(){this.$el.remove()}})},function(e,t,i){"use strict";var s=i(247),n=i(0);e.exports=s.extend({render:function render(){return this.$el.empty(),this.clearSubViews(),this.$el.append(this.options.template(n.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isSourceType:this.model.get("isSourceType"),name:this.model.getName(),val:this.model.getValue()},this.model.attributes))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this}})},function(e,t,i){"use strict";var s=i(2),n=i(2371),o=i(478),r=i(477);s.Form.editors.NodeDataset=s.Form.editors.Select.extend({options:{selectedItemTemplate:o,itemListTemplate:r,customListItemView:n}})},function(e,t,i){"use strict";var s=i(4),n=i(0),o=i(2),r=i(57),a=i(6),l=i(479);o.Form.editors.EnablerEditor=o.Form.editors.Base.extend({tagName:"div",className:"Editor-checker u-flex u-alignCenter",events:{"click .js-check":"_onCheckClicked"},initialize:function initialize(e){if(o.Form.editors.Base.prototype.initialize.call(this,e),r.setOptions(this,e),this.validators=null,!this.options.editor)throw new Error("editor options is required");this._editorOptions=this.options.editor,this.value=this.model.get(e.key),this._checkModel=new o.Model({enabled:!!this.value}),this.template=l,this._initBinds()},render:function render(){return this.$el.html(this.template({label:this.options.label,isChecked:this._isChecked(),help:this.options.help||"",isDisabled:!!this.options.isDisabled,id:this.cid})),this.options.help&&(this._helpTooltip=new a({el:this.$(".js-help"),gravity:"s",offset:0,title:function title(){return s(this).data("tooltip")}})),this._renderComponent(),this},_initBinds:function _initBinds(){this._checkModel.bind("change:enabled",function(e,t){this._manageValue(t),this._renderComponent(),this._triggerChange()},this)},_manageValue:function _manageValue(e){e?(this.validators=this.options.validators,this.value=this.options.defaultValue||"",this._editorComponent.setValue(this.options.defaultValue||"")):(this.validators=null,this.value="",this._editorComponent.setValue("")),this.model.set(this.options.keyAttr,this.value),this.validate()},_isChecked:function _isChecked(){return this._checkModel.get("enabled")},_renderComponent:function _renderComponent(){this._editorComponent&&this._removeComponent();var e=!this._isChecked()||this.options.isDisabled,t=o.Form.editors[this._editorOptions.type],i=n.extend(this._editorOptions.editorAttrs||{},{disabled:e});this._editorComponent=new t(n.extend({model:this.model,key:this.options.keyAttr,editorAttrs:i,trackingClass:this.options.trackingClass,editorType:this._editorOptions.type},n.omit(this._editorOptions,"editorAttrs","type"))),this._editorComponent.bind("change",this._setEditorComponentValue,this),this.$(".js-editor").html(this._editorComponent.render().el);try{this._editorComponent.focus()}catch(e){}},_removeComponent:function _removeComponent(){this._editorComponent.remove(),this._editorComponent.unbind("change",this._setEditorComponentValue,this)},_setEditorComponentValue:function _setEditorComponentValue(){this.value=this._editorComponent.getValue(),this._triggerChange()},_triggerChange:function _triggerChange(){this.trigger("change",this)},getValue:function getValue(){return this._checkModel.get("enabled")&&this._editorComponent&&this._editorComponent.getValue()||""},setValue:function setValue(e){this._checkModel.set("enabled",!!e),this._editorComponent&&this._editorComponent.setValue(e),this.value=e},_onCheckClicked:function _onCheckClicked(e){this._checkModel.set("enabled",s(e.target).is(":checked"))},remove:function remove(){this._editorComponent&&this._removeComponent(),this._helpTooltip&&this._helpTooltip.clean(),o.Form.editors.Base.prototype.remove.call(this)}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(480);n.Form.editors.Toggle=n.Form.editors.Radio.extend({className:"Editor-formLabel CDB-Text CDB-Size-medium u-alignCenter",_arrayToHtml:function _arrayToHtml(e){var t=this.getName(),i=this.id,n=s.map(e,function(e,n){var o=this.form.model.get(this.key),r={name:t,id:i+"-"+n};return s.isObject(e)?(r.value=e.val||0===e.val?e.val:"",r.label=e.label,r.help=e.help,r.labelHTML=e.labelHTML,r.selected=void 0!==o?o===e.val:e.selected):(r.value=e,r.label=e,r.selected=void 0!==o?o===e:e.selected),r}.bind(this));return o({items:n})}})},function(e,t,i){"use strict";var s=i(2),n=i(57),o=i(4),r=i(6),a=i(482),l=i(481);s.Form.editors.Enabler=s.Form.editors.Base.extend({tagName:"div",events:{"change .js-input":"_onCheckChange","focus .js-input":function focusJsInput(){this.trigger("focus",this)},"blur .js-input":function blurJsInput(){this.trigger("blur",this)}},initialize:function initialize(e){s.Form.editors.Base.prototype.initialize.call(this,e),n.setOptions(this,e),this.template=e.schema&&e.schema.editorAttrs&&e.schema.editorAttrs.reversed?l:e.template||a,this._initViews()},_initViews:function _initViews(){this.$el.html(this.template({checked:!this.options.disabled&&this.model.get(this.options.key),label:this.options.label,id:this.options.inputId,title:this.options.title,help:this.options.help||"",disabled:this.options.disabled})),this.options.help&&(this._removeTooltip(),this._helpTooltip=new r({el:this.$(".js-help"),gravity:"s",title:function title(){return o(this).data("tooltip")}})),this.options.disabled&&this.undelegateEvents()},_onCheckChange:function _onCheckChange(){var e=this.$(".js-input").is(":checked");this.model.set("enabler",e),this.trigger("change",this)},getValue:function getValue(){return this.$(".js-input").is(":checked")},setValue:function setValue(e){this.$(".js-input")[e?"attr":"removeAttr"]("checked",""),this.model.set(this.key,e)},_removeTooltip:function _removeTooltip(){this._helpTooltip&&this._helpTooltip.clean()},remove:function remove(){this._removeTooltip(),s.Form.editors.Base.prototype.remove.apply(this)}})},function(e,t,i){"use strict";var s=i(2),n=i(57),o=i(483),r=i(0),a=i(4),l=i(6);s.Form.editors.Radio=s.Form.editors.Radio.extend({className:"CDB-Text CDB-Size-medium u-flex u-alignCenter",initialize:function initialize(e){s.Form.editors.Base.prototype.initialize.apply(this,arguments),n.setOptions(this,e)},render:function render(){return this.setOptions(this.schema.options),this._setHelp(),this},_setHelp:function _setHelp(){r.find(this.schema.options,function(e){return e.help})&&(this._helpTooltip=this._createTooltip({$el:this.$(".js-help")}))},_createTooltip:function _createTooltip(e){return new l({el:e.$el||this.$el,gravity:e.gravity||"s",className:e.className||"",offset:e.offset||0,title:function title(){return e.msg||a(this).data("tooltip")}})},getValue:function getValue(){var e=this.$("input[type=radio]:checked").val();return""===e?null:e},_arrayToHtml:function _arrayToHtml(e){var t=this.form.model.get(this.key),i=r.map(e,function(e,i){var s=e.val,n={name:this.getName(),value:null===s?"":s.toString(),help:e.help,id:this.id,label:e.label,className:e.className};return t===s?n.selected=!0:n.disabled=e.disabled,n},this);return o({items:i})},_destroyBinds:function _destroyBinds(){},remove:function remove(){this._helpTooltip&&this._helpTooltip.clean(),s.Form.editors.Base.prototype.remove.call(this)}})},function(e,t,i){"use strict";var s=i(0),n=i(174);e.exports=n.extend({_initBinds:function _initBinds(){},setSelected:function setSelected(e){var t,i={silent:!0};return s.isArray(e)?this.each(function(n){s.contains(e,n.getValue())?(n.set({selected:!0},i),t=n):n.set({selected:!1},i)}):this.each(function(s){s.getValue()===e?(s.set({selected:!0},i),t=s):s.set({selected:!1},i)}),t}})},function(e,t,i){"use strict";var s=i(2),n=i(57),o=i(0),r=i(223),a=i(2377),l=i(354),h=i(1014),c=i(484),d=i(322),u=i(246),p=i(8);s.Form.editors.MultiSelect=s.Form.editors.Base.extend({tagName:"div",className:"u-ellipsis Editor-formSelect",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function focusJsButton(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},options:{selectedItemTemplate:l,itemListTemplate:c,customListItemView:h},initialize:function initialize(e){n.setOptions(this,e),this.collection=new a(e.schema.options),this.dialogMode=this.options.dialogMode||p.Mode.DEFAULT,this._initViews(),this.setValue(this.model.get(e.key)),s.Form.editors.Base.prototype.initialize.call(this,e),this._initBinds()},_getLabel:function _getLabel(){var e=o.compact(this.collection.pluck("selected")).length;return _t("components.backbone-forms.select.selected",{count:e})},_initViews:function _initViews(){var e=this.options.loading,t=!this.collection.length,i=!!t||this.options.disabled,s=this._getLabel(),n=null===s,o=n?"null":s;this.$el.html(d({label:o,keyAttr:this.options.keyAttr,isDisabled:i,isLoading:e,isEmpty:t,isNull:n,placeholder:null,help:this.options.help})),i&&this.undelegateEvents(),this._listView=new r({collection:this.collection,showSearch:this.options.showSearch,typeLabel:this.options.keyAttr,itemTemplate:this.options.itemListTemplate,itemView:this.options.customListItemView,actions:[{label:_t("components.backbone-forms.select.none"),action:this._deselectAll.bind(this)},{label:_t("components.backbone-forms.select.all"),action:this._selectAll.bind(this)}],searchPlaceholder:"Search"}),this._listView.bind("hidden",this._onHide,this),this._popupManager=new u(this.cid,this.$el,this._listView.$el),this._popupManager.append(this.dialogMode)},_initBinds:function _initBinds(){var e=function(){this._listView.hide(),this._popupManager.untrack()}.bind(this);this.collection.bind("change:selected",o.debounce(this._onItemSelected,50),this),this.applyESCBind(e),this.applyClickOutsideBind(e)},_selectAll:function _selectAll(){this.collection.each(function(e){e.set("selected",!0)})},_deselectAll:function _deselectAll(){this.collection.each(function(e){e.set("selected",!1)})},_onItemSelected:function _onItemSelected(e){this._renderButton(e).focus(),this.trigger("change",this)},_onButtonClick:function _onButtonClick(e){this._listView.toggle(),this._listView.isVisible()?this._popupManager.track():this._popupManager.untrack()},_onButtonKeyDown:function _onButtonKeyDown(e){13===e.which&&(e.preventDefault(),this._listView.isVisible()?this._popupManager.untrack():(e.stopPropagation(),this._listView.toggle(),this._popupManager.track()))},_getSelectedValues:function _getSelectedValues(){return this.collection.chain().map(function(e){return e.get("selected")?e.get("val"):null}).compact().value()},getValue:function getValue(){var e=this._getSelectedValues();if(e.length>0)return e},setValue:function setValue(e){if(e){var t=this.collection.setSelected(e);t&&this._renderButton(t)}},_renderButton:function _renderButton(e){var t=this.$(".js-button"),i=o.extend({},e.attributes,{label:this._getLabel()}),s=this.options.selectedItemTemplate(i);return t.removeClass("is-empty").html(s),t},_onHide:function _onHide(){this._getSelectedValues().length>0&&this.trigger("change",this)},remove:function remove(){this._popupManager&&this._popupManager.destroy(),this._listView&&this._listView.clean(),s.Form.editors.Base.prototype.remove.call(this)}})},function(e,t,i){"use strict";var s=i(2);s.Form.editors.SelectPlaceholder=s.Form.editors.Select.extend({initialize:function initialize(e){s.Form.editors.Select.prototype.initialize.call(this,e)},_renderButton:function _renderButton(e){s.Form.editors.Select.prototype._renderButton.call(this,e),this.options.forcePlaceholder&&this._getButton().addClass("is-empty")},_getLabel:function _getLabel(){return this.options.forcePlaceholder?this.options.placeholder:s.Form.editors.Select.prototype._getLabel.call(this)},_hasValue:function _hasValue(){return!this.options.forcePlaceholder&&s.Form.editors.Select.prototype._hasValue.call(this)},_getButtonTemplateData:function _getButtonTemplateData(e){var t=s.Form.editors.Select.prototype._getButtonTemplateData.call(this,e);return this.options.forcePlaceholder&&(t.label=this.options.placeholder),t}})},function(e,t,i){"use strict";var s=i(1),n=i(486);e.exports=s.extend({className:"CDB-Text CDB-Size-small is-semibold u-upperCase u-actionTextColor u-lSpace--xl",tagName:"button",events:{click:"_onClick"},initialize:function initialize(e){this.options=e},render:function render(){return this.$el.empty(),this.clearSubViews(),this.$el.append(n({label:this.options.label})),this},_onClick:function _onClick(){this.options.action&&this.options.action()}})},function(e,t,i){"use strict";var s=i(1),n=i(492);e.exports=s.extend({className:"CustomList--full",tagName:"form",events:{"keyup .js-search":"_onSearchType","click .js-clear":"_onClickClear",submit:"_submit"},initialize:function initialize(){this.template=this.options.template||n,this.searchPlaceholder=this.options.searchPlaceholder||_t("components.custom-list.placeholder",{typeLabel:this.options.typeLabel}),this._initBinds()},render:function render(){return this.$el.empty().append(this.template({query:this.model.get("query"),searchPlaceholder:this.searchPlaceholder})),this},_initBinds:function _initBinds(){this.model.on("change:query",this._checkButtons,this)},_checkButtons:function _checkButtons(){var e=this.model.get("query");this.$(".js-clear").toggleClass("u-transparent",0===e.length)},_onSearchType:function _onSearchType(e){this._submit()},_onClickClear:function _onClickClear(e){e.stopPropagation(),this.model.set("query",""),this.render(),this.focus()},focus:function focus(){this.$(".js-search").focus()},_submit:function _submit(e){this.killEvent(e);var t=this.$(".js-search").val();this.model.set("query",t)}})},function(e,t,i){"use strict";var s=i(2),n=i(1),o=i(223),r=i(353),a=i(485),l=i(3),h=["collection","itemTemplate","itemView"];e.exports=n.extend({module:"components:form-components:editors:select:select-list-view",className:"CustomList",initialize:function initialize(e){l(e,h,this),this._selectModel=this.options.selectModel,this.model=new s.Model({visible:!1}),this.options.mouseOverAction&&(this._mouseOverAction=this.options.mouseOverAction),this.options.mouseOutAction&&(this._mouseOutAction=this.options.mouseOutAction),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._renderListSection(),this},_initBinds:function _initBinds(){this.listenTo(this.model,"change:visible",function(e,t){t?this.render():this.clearSubViews(),this._toggleVisibility(),this.trigger("change:visible")}),this.collection.isAsync()&&this.listenTo(this.collection.stateModel,"change:state",this._renderListSection)},_createListView:function _createListView(){this._listView&&(this._listView.clean(),this.removeView(this._listView)),this._listView=new o({className:"CDB-Box-modal CustomList--inner",collection:this.collection,showSearch:this.options.showSearch,allowFreeTextInput:this.options.allowFreeTextInput,typeLabel:this.options.typeLabel,itemTemplate:this._itemTemplate,itemView:this._itemView,position:this.options.position,searchPlaceholder:this.options.searchPlaceholder,selectModel:this._selectModel,mouseOverAction:this._mouseOverAction,mouseOutAction:this._mouseOutAction}),this.addView(this._listView),this._listView.show(),this.el.appendChild(this._listView.render().el)},_createStatusView:function _createStatusView(e){var t=a({status:e,type:this.options.typeLabel});this.$el.html(t)},_renderListSection:function _renderListSection(){var e=this._getStatus();"fetched"===e?this._createListView():this._createStatusView(e)},show:function show(){this.model.set("visible",!0)},hide:function hide(){this.model.set("visible",!1)},toggle:function toggle(){this.model.set("visible",!this.model.get("visible"))},_renderOverlay:function _renderOverlay(){var e=this.$el.closest(".Dialog");this._dropdownOverlay=new r({container:e.length?e:void 0,onClickAction:this.hide.bind(this),visible:!0}),this.addView(this._dropdownOverlay)},_destroyOverlay:function _destroyOverlay(){this._dropdownOverlay&&this._dropdownOverlay.clean()&&this.removeView(this._dropdownOverlay)},isVisible:function isVisible(){return this.model.get("visible")},_toggleVisibility:function _toggleVisibility(){this.$el.toggleClass("is-visible",!!this.isVisible()),this.isVisible()?this._renderOverlay():this._destroyOverlay()},_getStatus:function _getStatus(){return this.collection.isAsync()?this.collection.stateModel.get("state"):"fetched"},_destroyBinds:function _destroyBinds(){this.stopListening(this.collection)},_onMouseOver:function _onMouseOver(){this._mouseOverAction&&this._mouseOverAction()},_onMouseOut:function _onMouseOut(){this._mouseOutAction&&this._mouseOutAction()},remove:function remove(){this._listView&&this._listView.clean(),this._dropdownOverlay&&this._dropdownOverlay.clean(),this._destroyBinds()}})},function(e,t,i){"use strict";var s=i(4),n=i(2),o=i(57),r=i(0),a=i(174),l=i(354),h=i(247),c=i(265),d=i(322),u=i(246),p=i(8),g=i(2382),m=i(6);n.Form.editors.Select=n.Form.editors.Base.extend({tagName:"div",className:"u-ellipsis Editor-formSelect",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function focusJsButton(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},options:{selectedItemTemplate:l,itemListTemplate:c,customListItemView:h},initialize:function initialize(e){if(n.Form.editors.Base.prototype.initialize.call(this,e),o.setOptions(this,e),this.template=e.template||d,this.dialogMode=this.options.dialogMode||p.Mode.DEFAULT,this.options.mouseOverAction&&(this._mouseOverAction=this.options.mouseOverAction),this.options.mouseOutAction&&(this._mouseOutAction=this.options.mouseOutAction),this.options.editorAttrs&&this.options.editorAttrs.help&&(this._help=this.options.editorAttrs.help),null!=this.options.options?this.collection=new a(this.options.options):this.collection=this.options.collection,void 0===this.collection.isAsync)throw new Error("collection must implement isAsync method.");this._initViews(),this.setValue(this.model.get(this.options.keyAttr)),this._initBinds()},render:function render(){var e=!this.collection.length,t=!this._hasValue();this._isDisabled=!!e||this.options.disabled;var i=this._getPlaceholder(this._isDisabled),s=t?i:this._getLabel(),n=this._isLoading();return this.$el.html(this.template({keyAttr:this.options.keyAttr,isEmpty:e,label:s,isDisabled:this._isDisabled,isNull:t,isLoading:n,help:this._help||""})),this.dialogMode===p.Mode.NESTED&&this._popupManager.append(this.dialogMode),n||this._renderSelected(),this},_initBinds:function _initBinds(){var e=function(){this._listView.hide(),this._popupManager.untrack(),this._onToggleSelected()}.bind(this);this.applyESCBind(e),this.listenTo(this.collection,"change:selected",this._onItemSelected),this.listenTo(this._listView,"change:visible",this._onToggleSelected),this.collection.isAsync()&&this.listenTo(this.collection.stateModel,"change:state",this.render)},_initViews:function _initViews(){this._listView=new g({collection:this.collection,showSearch:this.options.showSearch,allowFreeTextInput:this.options.allowFreeTextInput,typeLabel:this.options.keyAttr,itemTemplate:this.options.itemListTemplate,itemView:this.options.customListItemView,position:this.options.position,searchPlaceholder:this.options.searchPlaceholder,selectModel:this.options.defaultValue&&this.model,mouseOverAction:this._mouseOverAction,mouseOutAction:this._mouseOutAction}),this._popupManager=new u(this.cid,this.$el,this._listView.$el),this._popupManager.append(this.dialogMode)},_getPlaceholder:function _getPlaceholder(e){var t=this.options.keyAttr;return e?this.options.disabledPlaceholder||_t("components.backbone-forms.select.disabled-placeholder",{keyAttr:t}):this.options.placeholder||_t("components.backbone-forms.select.placeholder",{keyAttr:t})},_hasValue:function _hasValue(){var e=this.model.get(this.options.keyAttr);return null!=e&&""!==e},_getLabel:function _getLabel(){var e=this.model.get(this.options.keyAttr),t=this.collection.findWhere({val:e});return t&&t.getName()||e||""},_isLoading:function _isLoading(){var e=this.options.loading;return this.collection.isAsync()&&(e="fetching"===this.collection.stateModel.get("state")),e},_destroyBinds:function _destroyBinds(){this.stopListening(this.collection),n.Form.editors.Base.prototype._destroyBinds.call(this)},_onItemSelected:function _onItemSelected(e){this._listView.hide(),this._popupManager.untrack(),this._renderButton(e),this.trigger("change",this)},_onButtonClick:function _onButtonClick(){this._isDisabled||(this._listView.toggle(),this._listView.isVisible()?this._popupManager.track():this._popupManager.untrack(),this._onToggleSelected())},_onButtonKeyDown:function _onButtonKeyDown(e){this._isDisabled||13===e.which&&(e.preventDefault(),this._listView.isVisible()?this._popupManager.track():(e.stopPropagation(),this._listView.toggle()))},getValue:function getValue(){var e=this.collection.getSelectedItem();return e?e.getValue():this.value},setValue:function setValue(e){var t=this.collection.setSelected(e);t?this._renderButton(t):this.render(),this.value=e},_renderSelected:function _renderSelected(){var e=this.collection.getSelectedItem();e&&this._renderButton(e)},_getButton:function _getButton(){return this.$(".js-button")},_getButtonTemplateData:function _getButtonTemplateData(e){return r.extend({isSourceType:!1},e.attributes,{label:e.getName()})},_renderButton:function _renderButton(e){var t=this._getButton(),i=this._getButtonTemplateData(e),n=this.options.selectedItemTemplate(i);return t.removeClass("is-empty").html(n),this._initButtonBinds(),this._help&&(this._removeTooltip(),this._helpTooltip=new m({el:this.$(".js-help"),gravity:"w",title:function title(){return s(this).data("tooltip")}})),t},_removeTooltip:function _removeTooltip(){this._helpTooltip&&this._helpTooltip.clean()},_initButtonBinds:function _initButtonBinds(){this._getButton().on("mouseover",this._onMouseOver.bind(this)).on("mouseout",this._onMouseOut.bind(this))},_destroyButtonBinds:function _destroyButtonBinds(){this._getButton().off("mouseover",this._onMouseOver.bind(this)).off("mouseout",this._onMouseOut.bind(this))},remove:function remove(){this._removeTooltip(),this._popupManager&&this._popupManager.destroy(),this._listView&&this._listView.clean(),this._destroyButtonBinds(),this._destroyBinds(),n.Form.editors.Base.prototype.remove.call(this)},_onToggleSelected:function _onToggleSelected(){var e=this._listView.isVisible();this.$el.toggleClass("is-active",e),e||this._getButton().blur()},_onMouseOver:function _onMouseOver(){this._mouseOverAction&&this._mouseOverAction()},_onMouseOut:function _onMouseOut(){this._mouseOutAction&&this._mouseOutAction()},clean:function clean(){this.$el.remove()}})},function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(4),r=i(493),a=i(57);i(4),i(234);var l=i(6);s.Form.editors.Number=s.Form.editors.Base.extend({tagName:"ul",className:"CDB-OptionInput-container CDB-OptionInput-container--noMargin u-grow",options:{min:0,max:10,step:1,showSlider:!0,validators:[{type:"regexp",regexp:/^[+-]?((\.\d+)|(\d+(\.\d+)?))$/,message:_t("editor.edit-feature.valid")}]},events:{"keydown .js-input":"_onInputKeyDown","keyup .js-input":"_onInputKeyUp",focus:function focus(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},initialize:function initialize(e){s.Form.editors.Base.prototype.initialize.call(this,e),a.setOptions(this,e),this._validators=e.validators||e.schema&&e.schema.validators,this._validators&&this._validators[1]&&(this.options.min=this._validators[1].min,this.options.max=this._validators[1].max,this.options.step=this._validators[1].step),this.options.editorAttrs&&this.options.editorAttrs.help&&(this._help=this.options.editorAttrs.help),this._debouncedTriggerChange=n.debounce(this._triggerChange,333).bind(this),this._initViews()},_initViews:function _initViews(){var e=null===this.value?"null":"";this.$el.html(r({value:this.value,isDisabled:this.options.disabled,hasSlider:this.options.showSlider,isFormatted:this.options.isFormatted,placeholder:e,help:this._help||""})),this.options.showSlider&&this.$(".js-slider").slider({range:"min",value:this.value,min:this.options.min,max:this.options.max,step:this.options.step,orientation:"horizontal",disabled:this.options.disabled,slide:this._onSlideChange.bind(this),stop:this._onSlideStop.bind(this)}),this._help&&(this._removeTooltip(),this._helpTooltip=new l({el:this.$(".js-help"),gravity:"w",title:function title(){return o(this).data("tooltip")}})),this.$el.toggleClass("CDB-OptionInput-container--noSlider",!!this.options.showSlider)},_onSlideChange:function _onSlideChange(e,t){this.value=t.value,this.$(".js-input").val(this.value)},_onSlideStop:function _onSlideStop(e,t){this._debouncedTriggerChange()},_onInputKeyDown:function _onInputKeyDown(e){var t=this.$(".js-input"),i=+this.getValue(),s=!0===e.shiftKey?10:1;switch(e.which){case 32:case 13:return!1;case 38:i=this._nextValue(i,s),t.val(i);break;case 40:i=this._nextValue(i,-1*s),t.val(i)}},_nextValue:function _nextValue(e,t){var i=e+=t;return i<this.options.min?this.options.min:i>this.options.max?this.options.max:i},_hasSlider:function _hasSlider(){return this.options.showSlider&&this.$(".js-slider").data("ui-slider")},_onInputKeyUp:function _onInputKeyUp(){var e=this.$(".js-input").val();this._hasSlider()&&this.$(".js-slider").slider("value",e),this.value=e,this._debouncedTriggerChange()},_triggerChange:function _triggerChange(){this.trigger("change",this)},focus:function focus(){this.hasFocus||this.$(".js-input").focus()},blur:function blur(){this.hasFocus&&this.$(".js-input").blur()},getValue:function getValue(){var e=this.$(".js-input").val();return""===e?null:+e},setValue:function setValue(e){this._hasSlider()&&this.$(".js-slider").slider("value",e),this.$(".js-input").val(e),this.value=e},_destroySlider:function _destroySlider(){this._hasSlider()&&this.$(".js-slider").slider("destroy")},_removeTooltip:function _removeTooltip(){this._helpTooltip&&this._helpTooltip.clean()},remove:function remove(){this._destroySlider(),this._removeTooltip(),s.Form.editors.Base.prototype.remove.apply(this)},clean:function clean(){this.$el.remove()}})},function(e,t,i){"use strict";var s=i(2);s.Form.editors.TextArea=s.Form.editors.Text.extend({tagName:"textarea",className:"CDB-Textarea",render:function render(){return this.setValue(this.value),this._toggleDisableState(),this},getValue:function getValue(){var e=this.$el.val();return""===e?null:e},_toggleDisableState:function _toggleDisableState(){this.options.disabled?(this.$el.attr("readonly",""),this.$el.attr("placeholder","")):(this.$el.removeAttr("readonly"),this._togglePlaceholder()),this.$el.toggleClass("is-disabled",!!this.options.disabled)}})},function(e,t,i){"use strict";var s=i(0),n=i(2),o=i(57),r=i(6);n.Form.editors.Text=n.Form.editors.Text.extend({className:"CDB-InputText CDB-Text",initialize:function initialize(e){n.Form.editors.Base.prototype.initialize.call(this,e),o.setOptions(this,e);var t=this.schema,i="text";t&&t.editorAttrs&&t.editorAttrs.type&&(i=t.editorAttrs.type),t&&t.dataType&&(i=t.dataType),this.options.editorAttrs&&this.options.editorAttrs.help&&(this._help=this.options.editorAttrs.help),this.$el.attr("type",i),this.determineChange=s.debounce(this.determineChange,200)},render:function render(){return this.setValue(this.value),this._toggleDisableState(),this._isCopyButtonEnabled()&&this._toggleClipboardState(),this._help&&(this._removeTooltip(),this.options.disabled||(this._helpTooltip=new r({el:this.$el,gravity:"w",title:function(){return this._help}.bind(this)}))),this},getValue:function getValue(){var e=this.$el.val();return""===e?null:e},_toggleClipboardState:function _toggleClipboardState(){this.$el.toggleClass("Share-input-field u-ellipsis",this._isCopyButtonEnabled())},_togglePlaceholder:function _togglePlaceholder(){if(this.options.placeholder)this.$el.attr("placeholder",this.options.placeholder);else{var e=null===this.value?"null":"";this.$el.attr("placeholder",e)}},_toggleDisableState:function _toggleDisableState(){this.options.disabled?(this.$el.attr("readonly",""),this.$el.attr("placeholder",""),this._isCopyButtonEnabled()&&this.$el.removeAttr("disabled")):(this.$el.removeAttr("readonly"),this._togglePlaceholder()),this.$el.toggleClass("is-disabled",!!this.options.disabled)},_isCopyButtonEnabled:function _isCopyButtonEnabled(){return!!this.options.hasCopyButton},_removeTooltip:function _removeTooltip(){this._helpTooltip&&this._helpTooltip.clean()},remove:function remove(){this._removeTooltip(),n.Form.editors.Base.prototype.remove.apply(this)},clean:function clean(){this.$el.remove()}})},function(e,t,i){"use strict";var s=i(2),n=i(4);s.Form.editors.Base=s.Form.editors.Base.extend({applyESCBind:function applyESCBind(e){this._ESCBindCallback=e,this._onKeyDown=this._onKeyDown.bind(this),document.addEventListener("keydown",this._onKeyDown)},_onKeyDown:function _onKeyDown(e){27===e.which&&!this._anyModalOpen()&&this._ESCBindCallback()},applyClickOutsideBind:function applyClickOutsideBind(e){this._clickBindCallback=e,this._onDocumentClick=this._onDocumentClick.bind(this),this.$el.attr("data-cid",this.cid),document.addEventListener("click",this._onDocumentClick)},_onDocumentClick:function _onDocumentClick(e){var t=n(e.target),i=this._anyModalOpen();0!==t.closest('[data-cid="'+this.cid+'"]').length||i||this._clickBindCallback()},_anyModalOpen:function _anyModalOpen(){var e=this.options.modals;return!!e&&e.isOpen()},_destroyBinds:function _destroyBinds(){this._removeESCandClickListeners()},_removeESCandClickListeners:function _removeESCandClickListeners(){this._ESCBindCallback&&document.removeEventListener("keydown",this._onKeyDown),this._clickBindCallback&&document.removeEventListener("click",this._onDocumentClick)},remove:function remove(){this._destroyBinds&&this._destroyBinds(),s.View.prototype.remove.call(this)}})},,,,,,,,function(e,t,i){"use strict";var s=i(2),n=i(0),o=i(4),r=i(6),a=i(601);s.Form.Field=s.Form.Field.extend({initialize:function initialize(e){this.trackingClass=e.trackingClass,this.constructor.__super__.initialize.apply(this,arguments)},render:function render(){return this.constructor.__super__.render.apply(this,arguments),this.schema.help&&this._setHelp(),this._isCopyButtonEnabled()&&this._initClipboard(),this},createSchema:function createSchema(e){var t=e.type;return(e=this.constructor.__super__.createSchema.apply(this,arguments)).editorType=t,e},createEditor:function createEditor(){var e=n.extend(n.pick(this,"schema","form","key","model","value","trackingClass"),{id:this.createEditorId()});return new(0,this.schema.type)(e)},_setHelp:function _setHelp(){this._helpTooltip=this._createTooltip({$el:this.$(".js-help")})},setError:function setError(e){this.editor.hasNestedForm||this.schema.hideValidationErrors||(this.$el.addClass(this.errorClassName),this._destroyErrorTooltip(),this._errorTooltip=this._createTooltip({gravity:"w",className:"is-error",msg:e,offset:5}),this._errorTooltip.showTipsy())},clearError:function clearError(){this.$el.removeClass(this.errorClassName),this._destroyErrorTooltip()},_initClipboard:function _initClipboard(){this._clipboard&&this._clipboard.destroy();var e=this.$(".js-copy");this._clipboard=new a(e.get(0))},_createTooltip:function _createTooltip(e){return new r({el:e.$el||this.$el,gravity:e.gravity||"s",className:e.className||"",offset:e.offset||0,title:function title(){return e.msg||o(this).data("tooltip")}})},_destroyErrorTooltip:function _destroyErrorTooltip(){this._errorTooltip&&(this._errorTooltip.hideTipsy(),this._errorTooltip.destroyTipsy())},_destroyHelpTooltip:function _destroyHelpTooltip(){this._helpTooltip&&this._helpTooltip.destroyTipsy()},_destroyClipboard:function _destroyClipboard(){this._clipboard&&this._clipboard.destroy()},templateData:function templateData(){var e,t=this.schema;try{e=this.form.schema[this.key].type}catch(t){e=void 0}return{help:t.help||"",isCopyButtonEnabled:this._isCopyButtonEnabled(),hasNestedForm:this.editor.hasNestedForm,title:t.title,fieldAttrs:t.fieldAttrs,editorAttrs:t.editorAttrs,key:this.key,type:e,editorId:this.editor.id,editorType:this.editor.el.type}},_isCopyButtonEnabled:function _isCopyButtonEnabled(){return!!this.schema.hasCopyButton},remove:function remove(){this._destroyErrorTooltip(),this._destroyHelpTooltip(),this._destroyClipboard(),this.editor.remove(),s.View.prototype.remove.call(this)}},{template:i(494),errorClassName:"CDB-FieldError"})},function(e,t,i){"use strict";var s=i(2),n=i(0);s.Form.Fieldset.template=n.template('  <div class="Editor-fieldset" data-fields>    <% if (legend) { %>      <legend><%= legend %></legend>    <% } %>  </div>')},function(e,t,i){"use strict";var s=i(2);s.Form=s.Form.extend({initialize:function initialize(e){this.options=e,s.Form.Original.prototype.initialize.call(this,e)},createField:function createField(e,t){var i={form:this,key:e,schema:t,idPrefix:this.idPrefix,trackingClass:this.options.trackingClass};this.model?i.model=this.model:this.data?i.value=this.data[e]:i.value=void 0;var s=new this.Field(i);return this.listenTo(s.editor,"all",this.handleEditorEvent),s}})},function(e,t,i){"use strict";e.exports=function(e){var t={type:"required",message:_t("components.backbone-forms.required-boolean-error")};return function required(e){if(void 0===e)return t}}},function(e,t,i){"use strict";e.exports=function(e){var t=parseFloat(e.min)||0,i=parseFloat(e.max)||0,s={type:e.type,message:_t("components.backbone-forms.interval-error",{minValue:e.min,maxValue:e.max})};return function interval(e,n){var o=0;return null===e||void 0===e||""===e?s:(!isNaN(parseFloat(e))&&isFinite(e)&&(o=parseFloat(e)),t>o||i<o?s:void 0)}}},function(e,t,i){"use strict";e.exports=function(e){var t=e.columnType,i=e.columnsCollection,s={type:e.type,message:_t("components.backbone-forms.column-type-error",{columnType:t})};return function columnType(e){var n=i.findWhere({name:e});if(!(n&&n.get("type")===t))return s}}},,,function(e,t,i){"use strict";var s=i(2),n=i(1),o=i(0),r=i(5),a=i(4),l=i(7);i(181),i(1002);var h=i(1001),c=i(1e3),d={amount:4,unit:"hours"},u={amount:1,unit:"day"},p={amount:1,unit:"week"};e.exports=n.extend({className:"DatePicker",options:{flat:!0,date:["2008-07-31","2008-07-31"],current:"2008-07-31",calendars:2,mode:"range",starts:1},events:{"click .js-dates":"_toggleCalendar","click .js-fourHours":function clickJsFourHours(){this._setPreviousTime(d)},"click .js-oneDay":function clickJsOneDay(){this._setPreviousTime(u)},"click .js-oneWeek":function clickJsOneWeek(){this._setPreviousTime(p)}},initialize:function initialize(e){var t=!(!e||!e.disabled)&&e.disabled;this.model=new s.Model({fromDate:"",fromHour:0,fromMin:0,toDate:"",toHour:23,toMin:59,user_timezone:0,disabled:t}),this.template=e.template||c,this._initBinds(),this._setDefaultDate()},render:function render(){var e=this;return this.clearSubViews(),this.$el.empty(),this.$el.append(this.template(o.extend(this.model.attributes,{max_days:30,pad:l.pad}))),setTimeout(function(){e._initCalendar(),e._hideCalendar(),e._initTimers()},100),this},_initBinds:function _initBinds(){this.model.bind("change",this._setValues,this),this.model.bind("change",this._onValuesChange,this),a(document).bind("click",this._onDocumentClick.bind(this))},_destroyBinds:function _destroyBinds(){a(document).unbind("click",this._onDocumentClick.bind(this))},_formattedDate:function _formattedDate(e){return _t("components.datepicker."+e)+" <strong>"+this.model.get(e+"Date")+" "+l.pad(this.model.get(e+"Hour"),2)+":"+l.pad(this.model.get(e+"Min"),2)+"</strong>"},_setValues:function _setValues(){var e=_t("components.datepicker.dates-placeholder"),t=this.model.attributes;if(t.fromDate&&t.toDate){e=this._formattedDate("from")+" "+this._formattedDate("to")+'<i class="CDB-IconFont CDB-IconFont-calendar DatePicker-datesIcon"></i>'}this.$(".DatePicker-dates").html(e)},_setDefaultDate:function _setDefaultDate(){var e=this.model.get("user_timezone"),t=r().utc(e),i=r().utc(e).subtract(29,"days");this.options.date=[i.format("YYYY-MM-DD"),t.format("YYYY-MM-DD")],this.options.current=t.format("YYYY-MM-DD"),this._setModelFromPrevious(i)},_initCalendar:function _initCalendar(){document.body.contains(this.$(".DatePicker-calendar")[0])&&(this.calendar=this.$(".DatePicker-calendar").DatePicker(o.extend(this.options,{onChange:this._onDatesChange.bind(this),onRender:function onRender(e){var t=e.valueOf(),i=new Date,s=new Date;return s.setDate(i.getDate()-30),t<s||t>i?{disabled:!0}:""}})))},_onDatesChange:function _onDatesChange(e,t){var i=r(e[0]),s=r(e[1]);Math.abs(i.diff(s,"days"))>30&&(e[1]=r(e[0]).add("days",30).format("YYYY-MM-DD"),this.$(".DatePicker-calendar").DatePickerSetDate([e[0],e[1]])),this.model.set({fromDate:e[0],toDate:e[1]})},_hideCalendar:function _hideCalendar(e){e&&this.killEvent(e),this.$(".DatePicker-dropdown").hide()},_toggleCalendar:function _toggleCalendar(e){e&&this.killEvent(e),this.$(".DatePicker-dropdown").toggle()},_setPreviousTime:function _setPreviousTime(e){var t=r().utc(0).subtract(e.amount,e.unit);this._setModelFromPrevious(t),this._setDatepickerFromPrevious(t),this.closeCalendar()},_setModelFromPrevious:function _setModelFromPrevious(e){var t=r().utc(0);this.model.set({fromDate:e.format("YYYY-MM-DD"),fromHour:parseInt(e.format("H"),10),fromMin:parseInt(e.format("m"),10),toDate:t.format("YYYY-MM-DD"),toHour:parseInt(t.format("H"),10),toMin:parseInt(t.format("m"),10)})},_setDatepickerFromPrevious:function _setDatepickerFromPrevious(e){var t=r().utc(0);this.$(".DatePicker-calendar").DatePickerSetDate([e.format("YYYY-MM-DD"),t.format("YYYY-MM-DD")])},_initTimers:function _initTimers(){var e=function generateNumberType(e,t){return{type:"Number",title:23===t?_t("components.datepicker.hour"):_t("components.datepicker.min"),validators:["required",{type:"interval",min:e,max:t}]}};this.model.schema={fromHour:e(0,23),fromMin:e(0,59),toHour:e(0,23),toMin:e(0,59)},this._datesForm=new s.Form({model:this.model,template:h}),this._datesForm.bind("change",function(){this.commit()}),this.$(".js-timers").append(this._datesForm.render().el)},_onValuesChange:function _onValuesChange(){this.trigger("changeDate",this.model.toJSON(),this)},getDates:function getDates(){return this.model.toJSON()},closeCalendar:function closeCalendar(){this.$(".DatePicker-dropdown").hide()},_onDocumentClick:function _onDocumentClick(e){0===a(e.target).closest(".DatePicker").length&&this.closeCalendar()},clean:function clean(){this._datesForm&&this._datesForm.remove(),this._destroyBinds(),this.closeCalendar(),this.$(".DatePicker-calendar").DatePickerHide(),n.prototype.clean.call(this)}})},function(e,t,i){"use strict";var s=i(0),n=i(5),o=i(606),r=i(284),a=i(2403),l=i(2270),h=i(2267),c=i(996),d=i(3),u=["configModel","userModel"];e.exports=o.extend({options:{acceptSync:!1,type:"service",service:"twitter_search"},className:"ImportPanel ImportTwitterPanel",initialize:function initialize(e){d(e,u,this),this.model=new r({type:this.options.type,service_name:this.options.service},{userModel:this._userModel,configModel:this._configModel}),this._initBinds()},_disabledDueLackOfCredentials:function _disabledDueLackOfCredentials(){return!this._userModel.hasOwnTwitterCredentials()},render:function render(){return this.clearSubViews(),this.$el.html(c({currentGMT:n().format("Z")})),this._initViews(),this},_initViews:function _initViews(){var e=this.categories=new l({disabled:this._disabledDueLackOfCredentials()});e.bind("changeCategory",this._setModel,this),this.$(".ImportTwitterPanel-categories").append(e.render().el),this.addView(e);var t=this.datepicker=new a({className:"DatePicker DatePicker--withBorder",disabled:this._disabledDueLackOfCredentials()});t.bind("changeDate",this._setModel,this),this.$(".js-picker").append(t.render().el),this.addView(t);var i=this.creditsUsage=new h({el:this.$(".CreditsUsage"),userModel:this._userModel,disabled:this._disabledDueLackOfCredentials()});i.bind("maxCreditsChange",this._setModel,this),i.render(),this.addView(i),this._setModel()},_initBinds:function _initBinds(){this.model.bind("change",this._triggerChange,this)},_getCategories:function _getCategories(){var e=this.categories.getCategories();return s.filter(e,function(e){return e.category&&e.terms.length>0})},_getDates:function _getDates(){return this.datepicker.getDates()},_getMaxCredits:function _getMaxCredits(){return this.creditsUsage.getMaxCredits()},_setModel:function _setModel(){var e=this._getCategories(),t=this._getDates(),i=this._getMaxCredits(),s={categories:e,dates:t};this.model.setUpload({value:s,service_item_id:s,user_defined_limits:{twitter_credits_limit:i}})}})},function(e,t,i){"use strict";var s=i(7),n=i(603),o=i(602);e.exports=n.extend({render:function render(){var e=this.options.fileAttrs.title&&this.model.get("value")[this.options.fileAttrs.title]||this.model.get("value"),t=this._genDescription(),i=this.options.fileAttrs.ext?s.getFileExtension(e):"";this.options.fileAttrs.ext&&(e=e&&e.replace("."+i,""));var n=window.upgrade_url,r=this._userModel.isActionEnabled("sync_tables"),a=this._configModel.get("cartodb_com_hosted");return this.$el.html(o({title:e,description:t,ext:i,interval:this.model.get("interval"),importCanSync:this.options.acceptSync&&this._isArcGISLayer(e),userCanSync:r,showTrial:this._userModel.canStartTrial(),showUpgrade:!r&&!a&&n&&!this._userModel.isInsideOrg(),upgradeUrl:n})),this},_isArcGISLayer:function _isArcGISLayer(e){return-1!==e.search(/([0-9]+\/|[0-9]+)/)}})},function(e,t,i){"use strict";var s=i(1027),n=i(1024),o=i(2405),r=i(1028),a=i(1016),l=i(1015);e.exports=r.extend({options:{fileExtensions:[],type:"service",service:"arcgis",acceptSync:!0,fileEnabled:!1,fileAttrs:{ext:!1,title:"",description:""}},_initViews:function _initViews(){var e=new n({el:this.$(".ImportPanel-header"),model:this.model,userModel:this._userModel,collection:this.collection,fileEnabled:this.options.fileEnabled,acceptSync:this.options.acceptSync,template:a});e.render(),this.addView(e);var t=new o({el:this.$(".DatasetSelected"),userModel:this._userModel,model:this.model,acceptSync:this.options.acceptSync,fileAttrs:this.options.fileAttrs,configModel:this._configModel});t.render(),this.addView(t);var i=new s({el:this.$(".ImportPanel-form"),userModel:this._userModel,model:this.model,template:l,fileEnabled:this.options.fileEnabled});i.render(),this.addView(i)}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({defaults:{id:"",filename:"",checksum:"",service:"",size:"",title:""}})},function(e,t,i){"use strict";var s=i(2407),n=i(2);e.exports=n.Collection.extend({_DATASOURCE_NAME:"dropbox",model:s,url:function url(e){var t=this._configModel.urlVersion("imports_service");return this._configModel.get("base_url")+"/api/"+t+"/imports/service/"+this._DATASOURCE_NAME+"/list_files"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");if(!t.datasourceName)throw new Error("datasourceName is required");this._configModel=t.configModel,this._DATASOURCE_NAME=t.datasourceName},fetch:function fetch(){return this.trigger("fetch",this),n.Collection.prototype.fetch.apply(this,arguments)},parse:function parse(e){return e.files}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({_DATASOURCE_NAME:"dropbox",url:function url(e){var t=this._configModel.urlVersion("imports_service");return this._configModel.get("base_url")+"/api/"+t+"/imports/service/"+this._DATASOURCE_NAME+"/auth_url"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");if(!t.datasourceName)throw new Error("datasource_name is required");this._configModel=t.configModel,this._DATASOURCE_NAME=t.datasourceName}})},function(e,t,i){"use strict";var s=i(2);e.exports=s.Model.extend({_DATASOURCE_NAME:"dropbox",url:function url(e){var t=this._configModel.urlVersion("imports_service");return this._configModel.get("base_url")+"/api/"+t+"/imports/service/"+this._DATASOURCE_NAME+"/token_valid"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");if(!t.datasourceName)throw new Error("datasource_name is required");this._configModel=t.configModel,this._DATASOURCE_NAME=t.datasourceName}})},function(e,t,i){"use strict";var s=i(7);e.exports={formatSize:function formatSize(e){return e&&e>0?s.readablizeBytes(e):"Unknown"}}},function(e,t,i){"use strict";var s=i(1),n=i(7),o=i(2411),r=i(1019),a=i(0);e.exports=s.extend({options:{title:"",fileAttrs:{ext:!1,title:"filename",description:"size",itemName:"file",formatDescription:""}},_FORMATTERS:{size:o.formatSize,number:n.formatNumber},className:"ServiceList-item",tagName:"li",events:{"click .js-choose":"_onSelectItem"},render:function render(){var e=this.model.get(this.options.fileAttrs.title),t=this._genDescription(),i=this.options.fileAttrs.ext?n.getFileExtension(e):"";return this.options.fileAttrs.ext&&(e=e&&e.replace("."+i,"")),this.$el.html(r({name:this.options.title,ext:i,title:e,description:t})),this},_genDescription:function _genDescription(){if(this.options.fileAttrs&&this.options.fileAttrs.description){var e=this.options.fileAttrs.description,t="",i="",s=this;return e.content&&e.content.length>0&&a.each(e.content,function(n,o){o>0&&e.separator&&(i+=" "+e.separator+" ");var r=s.model.get(n.name),a=n.format&&s._FORMATTERS[n.format];i+=a&&a(r)||r,n.key&&(t=n.name)}),e.itemName&&t&&(i+=" "+(e.itemName&&_t("components.modals.add-layer.imports."+e.itemName+"-pluralize",{smart_count:t})||"")),i}return""},_onSelectItem:function _onSelectItem(){this.trigger("selected",this.model,this)}})},function(e,t,i){"use strict";var s=i(1),n=i(2412),o=i(1018);e.exports=s.extend({options:{title:"service",fileAttrs:{}},initialize:function initialize(){this._initBinds(),this._checkVisibility()},render:function render(){this.clearSubViews();var e=this.collection.size();return this.$el.html(o({size:e,title:this.options.title,pluralize:_t("components.modals.add-layer.imports.item-pluralize",{smart_count:e})})),this.collection.size()>0&&this.collection.each(this._addItem,this),this},_initBinds:function _initBinds(){this.collection.bind("sync",this.render,this),this.model.bind("change:state",this._checkVisibility,this),this.add_related_model(this.collection)},_addItem:function _addItem(e){var t=new n({model:e,title:this.options.title,fileAttrs:this.options.fileAttrs});t.bind("selected",this._onSelectedItem,this),this.$(".ServiceList-items").append(t.render().el),this.addView(t)},_onSelectedItem:function _onSelectedItem(e){this.model.setUpload({state:"selected",value:e.toJSON(),service_item_id:e.get("id")})},_checkVisibility:function _checkVisibility(){"list"===this.model.get("state")?this.show():this.hide()}})},function(e,t,i){"use strict";var s=i(1),n=i(1020);e.exports=s.extend({events:{"click .js-connect":"_checkToken"},initialize:function initialize(e){if(!e.serviceTokenModel)throw new Error("serviceTokenModel provider is required");if(!e.serviceOauthModel)throw new Error("serviceOauthModel is required");this._serviceTokenModel=e.serviceTokenModel,this._serviceOauthModel=e.serviceOauthModel,this._initBinds(),this._checkVisibility()},render:function render(){return this.$el.html(n({state:this.model.get("state")})),this},_initBinds:function _initBinds(){this.model.bind("change:state",function(){this.render(),this._checkVisibility()},this)},_checkToken:function _checkToken(){var e=this;this.model.set("state","token"),this._serviceTokenModel.fetch({success:function success(t){t.get("oauth_valid")||e._getOauthURL()},error:function error(t){e._getOauthURL()}})},_checkVisibility:function _checkVisibility(){var e=this.model.get("state");"list"!==e&&"selected"!==e?this.show():this.hide()},_getOauthURL:function _getOauthURL(){var e=this;this.model.set("state","oauth"),this._serviceOauthModel.set({url:""},{silent:!0}),this._serviceOauthModel.fetch({error:function error(){e.model.set("state","error")}})}})},function(e,t,i){"use strict";var s=i(1),n=i(1021);e.exports=s.extend({events:{"click .js-back":"_goToList"},options:{title:"Service",showAvailableFormats:!1,acceptSync:!1,fileExtensions:[],template:""},initialize:function initialize(e){if(!e.userModel)throw new Error("userModel is required");this._userModel=e.userModel,this.template=e.template||n,this._initBinds()},render:function render(){return this.$el.html(this.template({items:this.collection.size(),service_name:this.model.get("service_name"),showAvailableFormats:this.options.showAvailableFormats,fileExtensions:this.options.fileExtensions,acceptSync:this.options.acceptSync&&this._userModel.isActionEnabled("sync_tables"),state:this.model.get("state"),title:this.options.title})),this._checkVisibility(),this},_initBinds:function _initBinds(){this.model.bind("change:state",this.render,this)},_checkVisibility:function _checkVisibility(){this["list"!==this.model.get("state")?"show":"hide"]()},_goToList:function _goToList(){this.model.set("state","list")}})},function(e,t,i){"use strict";var s=i(606),n=i(284),o=i(2415),r=i(2414),a=i(2413),l=i(603),h=i(2410),c=i(2409),d=i(2408),u=i(1017);e.exports=s.extend({_DATASOURCE_NAME:"dropbox",className:"ImportPanel ImportPanelService",options:{service:"",showAvailableFormats:!1,fileExtensions:[],acceptSync:!1,fileAttrs:{ext:!1,title:"filename",description:"<%- size %>",formatDescription:"size",headerTemplate:""}},initialize:function initialize(e){if(!e.service)throw new Error("service prodiver is required");if(!e.userModel)throw new Error("userModel is required");if(!e.configModel)throw new Error("configModel is required");this._userModel=e.userModel,this._configModel=e.configModel,this._DATASOURCE_NAME=this.options.service,this.model=new n({type:"service",service_name:this._DATASOURCE_NAME},{userModel:this._userModel,configModel:this._configModel}),this._initModels(),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(u(this.options)),this._initViews(),this},_initModels:function _initModels(){this._serviceTokenModel=new h(null,{datasourceName:this._DATASOURCE_NAME,configModel:this._configModel}),this._serviceOauthModel=new c(null,{datasourceName:this._DATASOURCE_NAME,configModel:this._configModel}),this.collection=new d(null,{datasourceName:this._DATASOURCE_NAME,configModel:this._configModel})},_initBinds:function _initBinds(){this.model.bind("change",this._triggerChange,this),this.model.bind("change:state",this._checkState,this),this._serviceTokenModel.bind("change:oauth_valid",this._onOauthChange,this),this._serviceOauthModel.bind("change:url",this._openWindow,this),this.add_related_model(this._serviceOauthModel),this.add_related_model(this._serviceTokenModel)},_initViews:function _initViews(){var e=new o({el:this.$(".ImportPanel-header"),userModel:this._userModel,model:this.model,collection:this.collection,title:this.options.title,showAvailableFormats:this.options.showAvailableFormats,fileExtensions:this.options.fileExtensions,acceptSync:this.options.acceptSync,template:this.options.headerTemplate});e.render(),this.addView(e);var t=new r({el:this.$(".ServiceLoader"),model:this.model,serviceTokenModel:this._serviceTokenModel,serviceOauthModel:this._serviceOauthModel});t.render(),this.addView(t);var i=new a({el:this.$(".ServiceList"),model:this.model,collection:this.collection,title:this.options.title,fileAttrs:this.options.fileAttrs});i.render(),this.addView(i);var s=new l({el:this.$(".ServiceSelected"),userModel:this._userModel,model:this.model,acceptSync:this.options.acceptSync,fileAttrs:this.options.fileAttrs,configModel:this._configModel});s.render(),this.addView(s)},_onOauthChange:function _onOauthChange(){this._serviceTokenModel.get("oauth_valid")&&this._getFiles()},_getFiles:function _getFiles(){var e=this;this.model.set("state","retrieving"),this.collection.fetch({error:function error(){e.model.set("state","error")},success:function success(){e.model.set("state","list")}})},_checkState:function _checkState(){if("list"===this.model.get("state")&&1===this.collection.size()){var e=this.collection.at(0);this.model.setUpload({state:"selected",value:e.toJSON(),service_item_id:e.get("id")})}"selected"!==this.model.get("state")&&this.model.set({value:"",service_item_id:"",interval:0})},_openWindow:function _openWindow(){var e=this._serviceOauthModel.get("url"),t=this,i=window.open(e,null,"menubar=no,toolbar=no,width=600,height=495"),s=window.setInterval(function(){i&&i.closed?(t._getFiles(),clearInterval(s)):i||(t.model.set("state","error"),clearInterval(s))},1e3)}})},function(e,t,i){"use strict";var s=i(1028),n=i(2416),o=i(2406),r=i(2404);e.exports={File:{view:s,enabled:function enabled(e,t){return!0},name:"file",title:"Data file",options:{type:"url",fileEnabled:!0,acceptSync:!0}},GDrive:{view:n,enabled:function enabled(e,t){return!!e.get("oauth_gdrive")},name:"gdrive",title:"Google Drive",options:{service:"gdrive",fileExtensions:["Google SpreadSheet","CSV"],showAvailableFormats:!1,acceptSync:!0,fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"size",format:"size",key:!0}]}}}},Dropbox:{view:n,enabled:function enabled(e,t){return!!e.get("oauth_dropbox")},name:"dropbox",title:"Dropbox",options:{service:"dropbox",fileExtensions:["CSV","XLS"],showAvailableFormats:!1,acceptSync:!0,fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"id",format:""},{name:"size",format:"size",key:!0}],separator:"-"}}}},Box:{view:n,enabled:function enabled(e,t){return!!e.get("oauth_box")},name:"box",title:"Box",fallback:i(995),options:{service:"box",fileExtensions:["CSV","XLS"],showAvailableFormats:!1,acceptSync:!0,fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"size",format:"size",key:!0}],separator:"-"}}}},Twitter:{view:r,enabled:function enabled(e,t){return t.get("twitter").enabled&&!!e.get("datasource_search_twitter")},fallback:i(994),name:"twitter",title:"Twitter"},Mailchimp:{view:n,enabled:function enabled(e,t){return t.get("mailchimp").enabled&&!!e.get("oauth_mailchimp")},fallback:i(993),name:"mailchimp",title:"MailChimp",options:{service:"mailchimp",fileExtensions:[],acceptSync:!0,showAvailableFormats:!1,headerTemplate:i(992),fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"member_count",format:"number",key:!0}],itemName:"member",separator:""}}}},Arcgis:{view:o,enabled:function enabled(e,t){return e.get("arcgis_enabled")},fallback:i(991),name:"arcgis",title:"ArcGIS Server&trade;"},Salesforce:{view:s,enabled:function enabled(e,t){return e.get("salesforce_enabled")},fallback:i(990),name:"salesforce",title:"Salesforce"}}},function(e,t,i){"use strict";var s=i(9),n=i(2),o=i(1),r=i(54),a=i(1031),l=i(1030),h=i(6),c=i(182),d=i(177),u=i(0),p=i(2417),g=i(3),m=["createModel","userModel","configModel","privacyModel","guessingModel"];e.exports=o.extend({className:"ImportOptions",events:{"click .js-goNext":"_moveToNextTabs","click .js-goPrev":"_moveToPrevTabs"},initialize:function initialize(e){g(e,m,this),this._initModels()},render:function render(){return this._destroyBinds(),this.clearSubViews(),this.$el.empty(),this._generateContent(),this._generateNavigationTabs(),this._initBinds(),this._setOption(),this},_initModels:function _initModels(){this.model=new n.Model({page:1,maxPages:0})},_generateContent:function _generateContent(){var e=[];u.each(p,function(t,i){var n={};if(!u.isEmpty(t)&&t.enabled(this._configModel,this._userModel)){var o;(n={name:t.name,selected:"file"===t.name}).createButtonView=function(){return r.createByTemplate(l,{title:s.core.sanitize.html(t.title||t.name),name:t.name},{tagName:"button",className:"TabLink js-"+t.name+"Tab"})};var a,h=this["_check"+i+"Import"];if(h&&(a=h.bind(this)()),!a&&void 0!==a||u.isEmpty(t))t.fallback&&(o=r.createByTemplate(t.fallback));else{var c=t.view;o=new c(u.extend(t.options||{},{userModel:this._userModel,configModel:this._configModel,title:t.title,createModel:this._createModel,privacyModel:this._privacyModel,guessingModel:this._guessingModel}))}o&&(o.render(),o.bind("change",this._setUploadModel,this),n.createContentView=function(){return o}),e.push(n)}},this),this._tabPaneCollection=new d(e),this._tabPaneView=new c({template:a,collection:this._tabPaneCollection,tabPaneItemOptions:{tagName:"li",klassName:"ImportOptions-tab"}}),this.$el.append(this._tabPaneView.render().el)},_generateNavigationTabs:function _generateNavigationTabs(){var e=this.$(".ImportOptions-tab").size();e<=1&&this.$(".AddLayer-tabs").hide(),this.model.set("maxPages",Math.ceil(e/5)),this._checkNavigationTabs(),this.model.get("maxPages")<=1&&this.$(".ImportOptions-navigation").hide()},_moveToNextTabs:function _moveToNextTabs(){var e=this.model.get("page");e<this.model.get("maxPages")&&this.model.set("page",e+1)},_moveToPrevTabs:function _moveToPrevTabs(){var e=this.model.get("page");e>1&&this.model.set("page",e-1)},_moveNavigationTabs:function _moveNavigationTabs(){var e=this.model.get("page");this.$(".js-menu").css("margin-left","-"+800*(e-1)+"px"),this._checkNavigationTabs()},_checkNavigationTabs:function _checkNavigationTabs(){var e=this.model.get("page"),t=this.model.get("maxPages");this.$(".js-goPrev").toggleClass("is-disabled",e<2),this.$(".js-goNext").toggleClass("is-disabled",e>=t)},_checkGDriveImport:function _checkGDriveImport(){return!!this._configModel.get("oauth_gdrive")||(this._setFailedTab("gdrive","key"),!1)},_checkDropboxImport:function _checkDropboxImport(){return!!this._configModel.get("oauth_dropbox")||(this._setFailedTab("dropbox","key"),!1)},_checkBoxImport:function _checkBoxImport(){return!!this._configModel.get("oauth_box")||(this._setFailedTab("box","key"),!1)},_checkTwitterImport:function _checkTwitterImport(){return this._configModel.get("datasource_search_twitter")?!!this._userModel.get("twitter").enabled&&(!!this._userModel.canCreateTwitterDataset()||(this._setFailedTab("twitter","credits"),!1)):(this._setFailedTab("twitter","key"),!1)},_checkInstagramImport:function _checkInstagramImport(){return!!this._userModel.featureEnabled("instagram_import")&&(!!this._configModel.get("oauth_instagram")||(this._setFailedTab("instagram","key"),!1))},_checkSalesforceImport:function _checkSalesforceImport(){return!1},_checkMailchimpImport:function _checkMailchimpImport(){return this._configModel.get("oauth_mailchimp")?!!this._userModel.featureEnabled("mailchimp_import"):(this._setFailedTab("mailchimp","key"),!1)},_setFailedTab:function _setFailedTab(e,t){var i=this.$(".js-"+e+"Tab");i.addClass("disabled");var s=new h({el:i,title:function title(){return _t("components.modals.add-layer.imports.tab-options-error."+t,{name:e})}});this.addView(s)},_setUploadModel:function _setUploadModel(e){this._createModel.getUploadModel().setFresh(e)},_initBinds:function _initBinds(){this.model.bind("change:page",this._moveNavigationTabs,this),this._tabPaneCollection&&this._tabPaneCollection.bind("change:selected",this._onTabChange,this)},_destroyBinds:function _destroyBinds(){this._tabPaneCollection&&this._tabPaneCollection.bind("change:selected",null,this)},_setOption:function _setOption(){var e=u.first(this._tabPaneCollection.where({name:"file"}));e&&(e.set("selected",!0),this._updateImportOption())},_updateImportOption:function _updateImportOption(){this._createModel.setActiveImportPane(this._tabPaneView.getSelectedTabPaneName())},_onTabChange:function _onTabChange(e){this._tabPaneCollection.each(function(e){if(e.get("selected")){var t=e.attributes.createContentView();t.unbind("change",this._setUploadModel,this),t.bind("change",this._setUploadModel,this)}},this),this._updateImportOption()},clean:function clean(){this._destroyBinds(),o.prototype.clean.call(this)}})},function(e,t,i){"use strict";var s=i(1),n=i(286),o=i(285);e.exports=s.extend({className:"DatasetsPaginator",initialize:function initialize(e){if(!e.routerModel)throw new TypeError("routerModel is required");if(!e.tablesCollection)throw new TypeError("tablesCollection is required");this._routerModel=e.routerModel,this._tablesCollection=e.tablesCollection,this.model=new n({current_page:this._routerModel.get("page")}),this._initBinds(),this._initViews()},render:function render(){return this.clearSubViews(),this.$el.append(this.paginationView.render().el),this},_initBinds:function _initBinds(){this.model.bind("change",this.render,this),this.model.bind("change:current_page",function(){this._routerModel.set("page",this.model.get("current_page"))},this),this._tablesCollection.bind("sync",this._updatePaginationModelByCollection,this),this._routerModel.bind("change:page",this._updatePaginationModelByRouterModel,this),this.add_related_model(this._routerModel),this.add_related_model(this._tablesCollection),this.add_related_model(this.model)},_initViews:function _initViews(){this.paginationView=new o({model:this.model}),this.addView(this.paginationView)},_updatePaginationModelByCollection:function _updatePaginationModelByCollection(){this.model.set({per_page:this._tablesCollection.getDefaultParam("per_page"),total_count:this._tablesCollection.getTotalStat("total_entries")})},_updatePaginationModelByRouterModel:function _updatePaginationModelByRouterModel(){this.model.set("current_page",this._routerModel.get("page"))}})},function(e,t,i){"use strict";var s=i(9),n=i(4),o=i(1039),r=i(5),a=i(495),l=i(7),h=i(6),c=i(355),d=i(1036);e.exports=o.extend({tagName:"li",className:"ModalBlockList-item ModalBlockList-item--full",events:{"click .js-tag-link":"_onTagClick",click:"_toggleSelected"},render:function render(){var e=this.model.getTableModel(),t=this.model.get("tags")||[],i=s.core.sanitize.html(this.model.get("description")||""),n=a.toHTML(this.model.get("source")||""),o=e.getGeometryType()||[],h={isRaster:this.model.isRaster(),geometryType:o.length>0?o[0]:"",title:this.model.get("display_name")||this.model.get("name"),source:n,description:i,timeDiff:r(this.model.get("updated_at")).fromNow(),tags:t,tagsCount:t.length,routerModel:this._routerModel,maxTagsToShow:3,canImportDataset:this._canImportDataset(),rowCount:void 0,datasetSize:void 0},c=e.get("row_count");c>=0&&(h.rowCount=c,h.rowCountFormatted=c<1e4?l.formatNumber(c):l.readizableNumber(c));var u=e.get("size");return u>=0&&(h.datasetSize=l.readablizeBytes(u,u.toString().length>9)),this.$el.html(d(h)),this._setItemClasses(),this._renderTooltips(),this},_setItemClasses:function _setItemClasses(){this.$el.toggleClass("is-selected",!!this.model.get("selected")),this.$el.toggleClass("is-selectable",!!this._canImportDataset()),this.$el.toggleClass("is-banned",!this._canImportDataset())},_renderTooltips:function _renderTooltips(){this.addView(new h({el:this.$(".DatasetsList-itemStatus"),title:function title(e){return n(this).attr("data-title")}}))},_onTagClick:function _onTagClick(e){e&&this.killEvent(e);var t=n(e.target).val();t&&this._routerModel.set({tag:t,library:!0})},_canImportDataset:function _canImportDataset(){var e=this.model.getTableModel().get("size")||0;return this._userModel.get("remaining_byte_quota")*c.fileTimesBigger>=e&&this._userModel.get("limits").import_file_size>e},_toggleSelected:function _toggleSelected(e){"A"!==e.target.tagName&&(this.killEvent(e),this._canImportDataset()&&this._createModel.canSelect(this.model)&&this.model.set("selected",!this.model.get("selected")))}})},function(e,t,i){"use strict";var s=i(1),n=i(1037);e.exports=s.extend({tagName:"a",events:{click:"_toggleLike"},initialize:function initialize(){this.model.bind("change:likeable change:liked change:likes error",this.render,this)},render:function render(){return this.$el.html(n({likes:this.model.get("likes"),size:this.model.get("size"),show_count:this.model.get("show_count"),show_label:this.model.get("show_label")})),this.$el.attr({class:this._classNames(),href:this._hrefLocation()}),this},_hrefLocation:function _hrefLocation(){var e="#/like";return this.model.get("likeable")||(e=window.login_url),e},_classNames:function _classNames(){var e=["LikesIndicator"];return this.model.get("likeable")&&e.push("is-likeable"),this.model.get("liked")&&e.push("is-liked"),this._animate&&(e.push("is-animated"),this.$el.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){this._animate=!1,this.render()}.bind(this))),e.join(" ")},_toggleLike:function _toggleLike(e){this.model.get("likeable")&&(this.killEvent(e),this._animate=!0,this.model.toggleLiked())}})},function(e,t,i){"use strict";var s=i(1),n={datasets:i(1039),remotes:i(2420)};e.exports=s.extend({tagName:"ul",className:"DatasetsList fs-DatasetsList",initialize:function initialize(e){if(!e.createModel)throw new Error("createModel is required");if(!e.userModel)throw new Error("userModel is required");this._createModel=e.createModel,this._userModel=e.userModel,this._tablesCollection=this._createModel.getTablesCollection(),this._initBinds()},render:function render(){return this.clearSubViews(),this._tablesCollection.each(this._addItem,this),this},_initBinds:function _initBinds(){this._tablesCollection.bind("sync",this.render,this),this.add_related_model(this._tablesCollection)},_addItem:function _addItem(e,t){var i="remote"===e.get("type")?"remotes":"datasets",s=new n[i]({model:e,createModel:this._createModel,userModel:this._userModel});this.addView(s),this.$el.append(s.render().el)},show:function show(){this.$el.removeClass("is-hidden")},hide:function hide(){this.$el.addClass("is-hidden")}})},function(e,t,i){"use strict";var s=i(1),n=i(194);e.exports=s.extend({events:{"click .js-connect":"_onConnectClick"},initialize:function initialize(e){if(!e.routerModel)throw new Error("routerModel is required");if(!e.tablesCollection)throw new Error("tablesCollection is required");if(!e.userModel)throw new Error("userModel is required");if(!e.template)throw new Error("template is required");this._userModel=e.userModel,this._routerModel=e.routerModel,this._tablesCollection=e.tablesCollection,this.template=e.template,this._initBinds()},render:function render(){var e=this._routerModel.get("content_type");return this.$el.html(this.template({page:this._routerModel.get("page"),tag:this._routerModel.get("tag"),q:this._routerModel.get("q"),shared:this._routerModel.get("shared"),locked:this._routerModel.get("locked"),library:this._routerModel.get("library"),quote:n(),type:e,totalItems:this._tablesCollection.size(),totalEntries:this._tablesCollection.getTotalStat("total_entries")})),this},_initBinds:function _initBinds(){this._routerModel.bind("change",this.render,this),this._tablesCollection.bind("sync",this.render,this),this.add_related_model(this._routerModel),this.add_related_model(this._tablesCollection)},_onConnectClick:function _onConnectClick(){this.trigger("connectDataset",this)}})},function(e,t,i){"use strict";var s=i(1),n=i(0),o=i(2423),r=i(2422),a=i(2419),l=i(1035),h=i(1034),c=i(1033),d=i(1032);e.exports=s.extend({initialize:function initialize(e){if(!e.createModel)throw new Error("createModel is required");if(!e.userModel)throw new Error("userModel is required");this._createModel=e.createModel,this._userModel=e.userModel,this._routerModel=this._createModel.getVisualizationFetchModel(),this._tablesCollection=this._createModel.getTablesCollection(),this._initViews(),this._initBinds(),this._onDataLoading()},_initBinds:function _initBinds(){this._routerModel.bind("change",this._onRouterChange,this),this._tablesCollection.bind("loading",this._onDataLoading,this),this._tablesCollection.bind("sync",this._onDataFetched,this),this._tablesCollection.bind("error",function(e){(!e||e&&"abort"!==e.statusText)&&this._onDataError()},this),this.add_related_model(this._routerModel),this.add_related_model(this._tablesCollection)},_initViews:function _initViews(){this.controlledViews={},this.enabledViews=[];var e=new o({className:"ContentResult no-datasets",userModel:this._userModel,routerModel:this._routerModel,tablesCollection:this._tablesCollection,template:l});e.bind("connectDataset",function(){this._userModel.canCreateDatasets()&&this._createModel.set("listing","import")},this),e.render().hide(),this.controlledViews.no_datasets=e,this.$el.append(e.el),this.addView(e);var t=new r({userModel:this._userModel,createModel:this._createModel});this.controlledViews.list=t,this.$el.append(t.render().el),this.addView(t);var i=new o({userModel:this._userModel,routerModel:this._routerModel,tablesCollection:this._tablesCollection,template:h});i.render().hide(),this.controlledViews.no_results=i,this.$el.append(i.el),this.addView(i);var s=new o({userModel:this._userModel,routerModel:this._routerModel,tablesCollection:this._tablesCollection,template:c});s.render().hide(),this.controlledViews.error=s,this.$el.append(s.el),this.addView(s);var n=new o({userModel:this._userModel,routerModel:this._routerModel,tablesCollection:this._tablesCollection,template:d});this.controlledViews.main_loader=n,this.$el.append(n.render().el),this.addView(n);var u=new a({routerModel:this._routerModel,tablesCollection:this._tablesCollection});this.controlledViews.content_footer=u,this.$el.append(u.render().el),this.addView(u)},_onRouterChange:function _onRouterChange(){this._hideBlocks(),this._showBlocks(["main_loader"])},_onDataFetched:function _onDataFetched(){var e=["content_footer"],t=this._routerModel.get("tag"),i=this._routerModel.get("q"),s=this._routerModel.get("shared"),n=this._routerModel.get("locked"),o=this._routerModel.get("library");if(o&&0===this._tablesCollection.getTotalStat("total_user_entries")&&e.push("no_datasets"),0===this._tablesCollection.size())if(t||i||"no"!==s||n)e.push("no_results");else{if(!o)return void this._goToLibrary();e.push("no_results")}else e.push("list");this._hideBlocks(),this._showBlocks(e)},_onDataLoading:function _onDataLoading(){this._hideBlocks(),this._showBlocks(["main_loader"])},_onDataError:function _onDataError(e){this._hideBlocks(),this._showBlocks(["error"])},_showBlocks:function _showBlocks(e){var t=this;e?n.each(e,function(e){t.controlledViews[e]&&(t.controlledViews[e].show(),t.enabledViews.push(e))}):(t.enabledViews=[],n.each(this.controlledViews,function(e){e.show(),t.enabledViews.push(e)}))},_goToLibrary:function _goToLibrary(){this._routerModel.set({shared:"no",library:!0,page:1})},_hideBlocks:function _hideBlocks(e){var t=this;e?n.each(e,function(e){t.controlledViews[e]&&(t.controlledViews[e].hide(),t.enabledViews=n.without(t.enabledViews,e))}):(n.each(this.controlledViews,function(e){e.hide()}),t.enabledViews=[])},_isBlockEnabled:function _isBlockEnabled(e){return!!e&&n.contains(this.enabledViews,e)}})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){(function(e){!function(e){function maybeCall(e,t,i){return"function"==typeof e?e.call(t,i):e}function Tipsy(t,i){this.$element=e(t),this.options=i,this.enabled=!0,this.fixTitle()}Tipsy.prototype={show:function(){var t=this.getTitle();if(t&&this.enabled){var i=this.tip();i.find(".tipsy-inner")[this.options.html?"html":"text"](t),i[0].className="tipsy",i.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body),this.options.className&&i.addClass(maybeCall(this.options.className,this.$element[0]));var s,n=e.extend({},this.$element.offset(),{width:this.$element[0].getBoundingClientRect().width,height:this.$element[0].getBoundingClientRect().height}),o=i[0].offsetWidth,r=i[0].offsetHeight,a=maybeCall(this.options.gravity,this.$element[0],i[0]);switch(a.charAt(0)){case"n":s={top:n.top+n.height+this.options.offset,left:n.left+n.width/2-o/2},mo={top:parseInt(n.top+n.height+this.options.offset+6),opacity:this.options.opacity};break;case"s":s={top:n.top-r-this.options.offset,left:n.left+n.width/2-o/2},mo={top:parseInt(n.top-r-this.options.offset-6),opacity:this.options.opacity};break;case"e":s={top:n.top+n.height/2-r/2,left:n.left-o-this.options.offset},mo={left:parseInt(n.left-o-this.options.offset-6),opacity:this.options.opacity};break;case"w":s={top:n.top+n.height/2-r/2,left:n.left+n.width+this.options.offset},mo={left:parseInt(n.left+n.width+this.options.offset+6),opacity:this.options.opacity}}2==a.length&&("w"==a.charAt(1)?s.left=n.left+n.width/2-15:s.left=n.left+n.width/2-o+15),i.css(s).addClass("tipsy-"+a),i.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+a.charAt(0),this.options.fade?i.stop().css({opacity:0,display:"block",visibility:"visible"}).animate(mo,200):i.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){switch(gravity=maybeCall(this.options.gravity,this.$element[0]),gravity.charAt(0)){case"n":mo={top:parseInt(this.tip().css("top"))+6,opacity:0};break;case"s":mo={top:parseInt(this.tip().css("top"))-6,opacity:0};break;case"e":mo={left:parseInt(this.tip().css("left"))-6,opacity:0};break;case"w":mo={left:parseInt(this.tip().css("left"))+6,opacity:0}}this.options.fade?this.tip().stop().animate(mo,200,function(){e(this).remove()}):this.tip().remove()},fixTitle:function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("original-title"))&&e.attr("original-title",e.attr("title")||"").removeAttr("title")},getTitle:function(){var e,t=this.$element,i=this.options;return this.fixTitle(),"string"==typeof(i=this.options).title?e=t.attr("title"==i.title?"original-title":i.title):"function"==typeof i.title&&(e=i.title.call(t[0])),(e=(""+e).replace(/(^\s*|\s*$)/,""))||i.fallback},tip:function(){return this.$tip||(this.$tip=e('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>'),this.$tip.data("tipsy-pointee",this.$element[0])),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},remove:function(){this.enabled=!1,this.$tip&&this.$tip.remove()},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},e.fn.tipsy=function(t){if(!0===t)return this.data("tipsy");if("string"==typeof t){var i=this.data("tipsy");return i&&i[t](),this}function get(i){var s=e.data(i,"tipsy");return s||(s=new Tipsy(i,e.fn.tipsy.elementOptions(i,t)),e.data(i,"tipsy",s)),s}if((t=e.extend({},e.fn.tipsy.defaults,t)).live||this.each(function(){get(this)}),"manual"!=t.trigger){var s=t.live?"live":"bind",n="hover"==t.trigger?"mouseenter":"focus",o="hover"==t.trigger?"mouseleave":"blur";this[s](n,function enter(){var e=get(this);e.hoverState="in",0==t.delayIn?e.show():(e.fixTitle(),setTimeout(function(){"in"==e.hoverState&&e.show()},t.delayIn))})[s](o,function leave(){var e=get(this);e.hoverState="out",0==t.delayOut?e.hide():setTimeout(function(){"out"==e.hoverState&&e.hide()},t.delayOut)})}return this},e.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover"},e.fn.tipsy.revalidate=function(){e(".tipsy").each(function(){var t=e.data(this,"tipsy-pointee");t&&function isElementInDOM(e){for(;e=e.parentNode;)if(e==document)return!0;return!1}(t)||e(this).remove()})},e.fn.tipsy.elementOptions=function(t,i){return e.metadata?e.extend({},i,e(t).metadata()):i},e.fn.tipsy.autoNS=function(){return e(this).offset().top>e(document).scrollTop()+e(window).height()/2?"s":"n"},e.fn.tipsy.autoWE=function(){return e(this).offset().left>e(document).scrollLeft()+e(window).width()/2?"e":"w"},e.fn.tipsy.autoBounds=function(t,i){return function(){var s={ns:i[0],ew:i.length>1&&i[1]},n=e(document).scrollTop()+t,o=e(document).scrollLeft()+t,r=e(this);return r.offset().top<n&&(s.ns="n"),r.offset().left<o&&(s.ew="w"),e(window).width()+e(document).scrollLeft()-r.offset().left<t&&(s.ew="e"),e(window).height()+e(document).scrollTop()-r.offset().top<t&&(s.ns="s"),s.ns+(s.ew?s.ew:"")}}}(e)}).call(this,i(4))},,,function(e,t,i){"use strict";var s=i(1102).extend({dataLibrary:function dataLibrary(){return this.urlToPath("library")}});e.exports=s},function(e,t,i){"use strict";var s=i(290),n=i(1102),o=i(2691),r=s.extend({datasets:function datasets(){return new o({base_url:this.urlToPath("datasets")})},maps:function maps(){return new n({base_url:this.urlToPath("maps")})},deepInsights:function deepInsights(){return new n({base_url:this.urlToPath("deep-insights")})}});e.exports=r},function(e,t,i){"use strict";var s=i(0),n=i(290),o=i(2692),r=i(1101),a=n.extend({initialize:function initialize(e){if(n.prototype.initialize.apply(this,arguments),s.isUndefined(e.is_org_admin))throw new Error("is_org_admin is required")},organization:function organization(){return this.get("is_org_admin")?new r({base_url:this.urlToPath("organization")}):this.urlToPath("account")},accountProfile:function accountProfile(){return this.urlToPath("profile")},accountSettings:function accountSettings(){return this.urlToPath("account")},publicProfile:function publicProfile(){return this.urlToPath("me")},apiKeys:function apiKeys(){return this.urlToPath("your_apps")},logout:function logout(){return this.urlToPath("logout")},dashboard:function dashboard(){return new o({base_url:this.urlToPath("dashboard")})}});e.exports=a}]]);